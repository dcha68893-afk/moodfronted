<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniConnectSphere - Enhanced Social Feed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    
    <style>
        :root {
            --primary-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-primary: #ffffff;
            --text-secondary: #cbd5e1;
            --accent-color: #22d3ee;
            --accent-hover: #06b6d4;
        }

        .light-theme {
            --primary-bg: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            --glass-bg: rgba(255, 255, 255, 0.8);
            --glass-border: rgba(209, 213, 219, 0.5);
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --accent-color: #3b82f6;
            --accent-hover: #2563eb;
        }

        .dark-theme {
            --primary-bg: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            --glass-bg: rgba(30, 41, 59, 0.5);
            --glass-border: rgba(100, 116, 139, 0.3);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent-color: #22d3ee;
            --accent-hover: #06b6d4;
        }

        .cyber-theme {
            --primary-bg: linear-gradient(135deg, #1e3a8a 0%, #7e22ce 100%);
            --glass-bg: rgba(30, 58, 138, 0.3);
            --glass-border: rgba(124, 58, 237, 0.5);
            --text-primary: #f0f9ff;
            --text-secondary: #bae6fd;
            --accent-color: #f59e0b;
            --accent-hover: #d97706;
        }

        /* Emotion Reactive Backgrounds */
        .emotion-joy { --primary-bg: linear-gradient(135deg, #FFD93D 0%, #FF6B6B 100%) !important; }
        .emotion-love { --primary-bg: linear-gradient(135deg, #FF6B9D 0%, #C44569 100%) !important; }
        .emotion-calm { --primary-bg: linear-gradient(135deg, #6BC5D2 0%, #3B82F6 100%) !important; }
        .emotion-excited { --primary-bg: linear-gradient(135deg, #FF9A3D 0%, #FF6B6B 100%) !important; }
        .emotion-sad { --primary-bg: linear-gradient(135deg, #3a7bd5 0%, #3a6073 100%) !important; }
        .emotion-angry { --primary-bg: linear-gradient(135deg, #c31432 0%, #240b36 100%) !important; }

        /* Gamification Elements */
        .streak-fire {
            animation: firePulse 2s infinite;
        }
        @keyframes firePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .unicoin-glow {
            animation: coinSpin 3s linear infinite;
        }
        @keyframes coinSpin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }

        /* Enhanced UI Components */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
        }

        .cyber-gradient {
            background: var(--primary-bg);
        }

        .hologram-border {
            border: 1px solid transparent;
            background: linear-gradient(45deg, #ff6b6b, #ffa726, #4ecdc4, #45b7d1) border-box;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
        }

        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }
        .status-online {
            background-color: #10B981;
            box-shadow: 0 0 8px #10B981;
        }

        .media-preview {
            max-height: 300px;
            object-fit: cover;
            border-radius: 12px;
            margin-top: 10px;
        }

        .tag-pill {
            display: inline-flex;
            align-items: center;
            background: rgba(139, 92, 246, 0.3);
            border: 1px solid rgba(139, 92, 246, 0.5);
            border-radius: 20px;
            padding: 4px 10px;
            margin: 2px;
            font-size: 0.8rem;
        }

        .interaction-btn {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .interaction-btn:hover {
            color: var(--accent-color);
            transform: scale(1.1);
        }
        .interaction-btn.active {
            color: var(--accent-color);
        }

        .follow-btn {
            transition: all 0.3s ease;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 6px 12px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        .follow-btn:hover {
            background: var(--accent-color);
            color: white;
        }
        .follow-btn.following {
            background: rgba(16, 185, 129, 0.2);
            color: #10B981;
            border-color: #10B981;
        }

        /* Emotion Reaction Styles */
        .emotion-reaction {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 15px;
            background: var(--glass-bg);
            margin: 2px;
            font-size: 0.8rem;
        }

        /* Theme Selector */
        .theme-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        .theme-options {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 10px;
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 200px;
        }
        .theme-options.show {
            display: grid;
        }
        .theme-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        .theme-option:hover {
            transform: scale(1.1);
        }
        .theme-option.active {
            border-color: white;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        .theme-dark {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
        }
        .theme-light {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        }
        .theme-cyber {
            background: linear-gradient(135deg, #1e3a8a 0%, #7e22ce 100%);
        }

        /* Search Results */
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }
        .search-results.show {
            display: block;
        }
        .search-result-item {
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .search-result-item:hover {
            background: rgba(139, 92, 246, 0.2);
        }

        /* Audio Player */
        .audio-player {
            width: 100%;
            margin-top: 10px;
        }
        .audio-player audio {
            width: 100%;
            border-radius: 20px;
        }

        /* Status Creation */
        .status-creation-modal {
            max-width: 500px;
            width: 90%;
        }
        .status-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .status-type-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
        }
        .status-type-btn.active {
            background: var(--accent-color);
            color: white;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-container {
            background: rgba(30, 30, 60, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        body {
            background: var(--primary-bg);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .text-theme-primary {
            color: var(--text-primary);
        }
        .text-theme-secondary {
            color: var(--text-secondary);
        }
        .bg-theme-accent {
            background-color: var(--accent-color);
        }
        .border-theme-accent {
            border-color: var(--accent-color);
        }
        .hover\:text-theme-accent:hover {
            color: var(--accent-color);
        }
        .hover\:bg-theme-accent:hover {
            background-color: var(--accent-hover);
        }
    </style>
</head>
<body class="h-full dark-theme emotion-default" id="emotionBody">
    <!-- Gamification Header -->
    <div class="glass border-b border-purple-800 p-3">
        <div class="flex items-center justify-between max-w-6xl mx-auto">
            <div class="flex items-center space-x-4">
                <div class="flex items-center space-x-2">
                    <div class="streak-fire text-yellow-400">
                        <i class="fas fa-fire"></i>
                    </div>
                    <span class="text-sm font-bold" id="streakCount">0</span>
                    <span class="text-xs text-theme-secondary">day streak</span>
                </div>
                <div class="flex items-center space-x-2">
                    <div class="unicoin-glow text-yellow-300">
                        <i class="fas fa-coins"></i>
                    </div>
                    <span class="text-sm font-bold" id="unicoinsCount">0</span>
                    <span class="text-xs text-theme-secondary">UniCoins</span>
                </div>
                <div class="level-badge bg-theme-accent px-3 py-1 rounded-full text-xs">
                    Level <span id="userLevel">1</span>
                </div>
            </div>
            
            <div class="flex items-center space-x-3">
                <button id="viewLeaderboard" class="text-theme-secondary hover:text-theme-accent text-sm">
                    <i class="fas fa-trophy"></i> Leaderboard
                </button>
                <button id="viewChallenges" class="text-theme-secondary hover:text-theme-accent text-sm">
                    <i class="fas fa-flag"></i> Challenges
                </button>
            </div>
        </div>
    </div>

    <!-- Theme Selector -->
    <div class="theme-selector">
        <button id="themeToggle" class="w-12 h-12 glass rounded-2xl flex items-center justify-center text-theme-secondary hover:text-theme-accent hover:scale-110 transition">
            <i class="fas fa-palette"></i>
        </button>
        <div class="theme-options">
            <div class="theme-option theme-dark active" data-theme="dark-theme"></div>
            <div class="theme-option theme-light" data-theme="light-theme"></div>
            <div class="theme-option theme-cyber" data-theme="cyber-theme"></div>
        </div>
    </div>

    <div class="flex h-full" style="height: calc(100vh - 80px);">
        <!-- Navigation -->
        <div class="w-20 lg:w-64 glass border-r border-purple-800 flex flex-col">
            <div class="p-4">
                <a href="#" class="flex items-center space-x-3">
                    <div class="w-10 h-10 cyber-gradient rounded-2xl flex items-center justify-center">
                        <i class="fas fa-brain text-white"></i>
                    </div>
                    <span class="hidden lg:block text-xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400">
                        ConnectSphere
                    </span>
                </a>
            </div>

            <nav class="flex-1 px-2 lg:px-4 space-y-2">
                <a href="home.html" class="flex items-center space-x-3 p-3 rounded-xl bg-cyan-900/30 text-cyan-400 border border-cyan-500/50">
                    <i class="fas fa-home w-6"></i>
                    <span class="hidden lg:block font-semibold">Social Feed</span>
                </a>
                <a href="chat.html" class="flex items-center space-x-3 p-3 rounded-xl text-theme-secondary hover:bg-purple-900/30 hover:text-theme-accent transition">
                    <i class="fas fa-comment-dots w-6"></i>
                    <span class="hidden lg:block">Quantum Chat</span>
                </a>
                <a href="profile.html" class="flex items-center space-x-3 p-3 rounded-xl text-theme-secondary hover:bg-purple-900/30 hover:text-theme-accent transition">
                    <i class="fas fa-user-astronaut w-6"></i>
                    <span class="hidden lg:block">Profile</span>
                </a>
            </nav>

            <!-- User Status -->
            <div class="p-4 border-t border-purple-800">
                <div id="userStatusContainer" class="flex items-center space-x-3 p-3 glass rounded-xl cursor-pointer hover:bg-cyan-900/30 transition">
                    <div class="relative">
                        <img id="userAvatar" class="w-8 h-8 rounded-2xl object-cover" src="https://ui-avatars.com/api/?name=User&background=6366f1&color=fff" alt="User Avatar">
                        <div id="statusIndicator" class="status-indicator status-online absolute -bottom-1 -right-1 border-2 border-gray-900"></div>
                    </div>
                    <div class="hidden lg:block">
                        <p id="userDisplayName" class="text-sm font-semibold text-theme-accent">Loading...</p>
                        <p id="statusText" class="text-xs text-theme-secondary">Online</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="glass border-b border-purple-800 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex-1 max-w-2xl relative">
                        <div class="relative">
                            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-theme-secondary"></i>
                            <input type="text" id="searchInput" placeholder="Search posts, people, or topics..." 
                                   class="w-full pl-10 pr-4 py-3 glass border border-purple-700 rounded-2xl focus:outline-none focus:ring-2 focus:ring-theme-accent focus:border-transparent placeholder-theme-secondary">
                        </div>
                        <div id="searchResults" class="search-results">
                            <!-- Search results will appear here -->
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button id="createPostBtn" class="w-10 h-10 glass rounded-2xl flex items-center justify-center text-theme-secondary hover:text-theme-accent hover:scale-110 transition">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Stories -->
            <div class="glass border-b border-purple-800 p-4">
                <div class="flex space-x-6 overflow-x-auto scrollbar-hide pb-2" id="storiesContainer">
                    <!-- User Story -->
                    <div class="flex flex-col items-center space-y-2 flex-shrink-0">
                        <div class="w-20 h-20 hologram-border rounded-2xl p-0.5 cursor-pointer" id="createStoryBtn">
                            <div class="w-full h-full bg-gray-900 rounded-2xl flex items-center justify-center">
                                <i class="fas fa-plus text-theme-accent"></i>
                            </div>
                        </div>
                        <span class="text-xs font-semibold text-theme-accent">Your Story</span>
                    </div>
                    <!-- Stories will be loaded dynamically -->
                </div>
            </div>

            <!-- Post Creator -->
            <div class="glass border-b border-purple-800 p-6 hidden" id="postCreator">
                <div class="flex space-x-4">
                    <img id="currentUserAvatar" class="w-12 h-12 rounded-2xl object-cover" src="https://ui-avatars.com/api/?name=User&background=6366f1&color=fff" alt="Your Avatar">
                    <div class="flex-1">
                        <input type="text" id="postInput" placeholder="Share with your network..." 
                               class="w-full p-4 glass border border-purple-700 rounded-2xl focus:outline-none focus:ring-2 focus:ring-theme-accent focus:border-transparent placeholder-theme-secondary">
                        
                        <!-- Media Preview -->
                        <div id="mediaPreview" class="mt-3 hidden">
                            <img id="previewImage" class="media-preview w-full hidden">
                            <video id="previewVideo" class="media-preview w-full hidden" controls></video>
                            <audio id="previewAudio" class="audio-player hidden" controls></audio>
                        </div>
                        
                        <div class="flex items-center justify-between mt-4">
                            <div class="flex space-x-4 text-theme-secondary">
                                <button id="addPhoto" class="flex items-center space-x-2 hover:text-theme-accent transition">
                                    <i class="fas fa-image"></i>
                                    <span>Photo</span>
                                </button>
                                <button id="addVideo" class="flex items-center space-x-2 hover:text-theme-accent transition">
                                    <i class="fas fa-video"></i>
                                    <span>Video</span>
                                </button>
                                <button id="addAudio" class="flex items-center space-x-2 hover:text-theme-accent transition">
                                    <i class="fas fa-music"></i>
                                    <span>Audio</span>
                                </button>
                                <button id="addEmoji" class="flex items-center space-x-2 hover:text-theme-accent transition">
                                    <i class="fas fa-smile"></i>
                                    <span>Emoji</span>
                                </button>
                            </div>
                            <button id="sharePost" class="cyber-gradient text-white px-6 py-2 rounded-2xl font-semibold hover:scale-105 transition">
                                Share Post
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Feed -->
            <main class="flex-1 overflow-y-auto bg-gradient-to-b from-purple-900/20 to-gray-900/50">
                <div class="max-w-2xl mx-auto p-4 space-y-6">
                    <!-- Trending Section -->
                    <div class="glass border border-purple-700 rounded-2xl p-4">
                        <h3 class="font-bold text-theme-accent mb-4 flex items-center">
                            <i class="fas fa-fire mr-2"></i> Trending Now
                        </h3>
                        <div id="trendingContainer" class="space-y-2">
                            <!-- Trending posts will be loaded here -->
                        </div>
                    </div>

                    <!-- Main Feed -->
                    <div id="feedContainer">
                        <!-- Posts will be loaded dynamically from Firebase -->
                    </div>
                </div>
            </main>
        </div>

        <!-- Right Sidebar -->
        <div class="hidden lg:block w-80 glass border-l border-purple-800">
            <div class="p-6">
                <!-- User Profile Card -->
                <div class="glass border border-purple-700 rounded-2xl p-4 mb-6">
                    <div class="flex items-center space-x-3 mb-4">
                        <img id="sidebarUserAvatar" class="w-12 h-12 rounded-2xl object-cover" src="https://ui-avatars.com/api/?name=User&background=6366f1&color=fff" alt="User Avatar">
                        <div>
                            <h3 id="sidebarUserName" class="font-bold text-theme-accent">Loading...</h3>
                            <p id="sidebarUserStatus" class="text-xs text-theme-secondary">Online</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-2 text-center">
                        <div>
                            <p class="font-bold text-theme-accent" id="postCount">0</p>
                            <p class="text-xs text-theme-secondary">Posts</p>
                        </div>
                        <div>
                            <p class="font-bold text-theme-accent" id="followerCount">0</p>
                            <p class="text-xs text-theme-secondary">Followers</p>
                        </div>
                        <div>
                            <p class="font-bold text-theme-accent" id="followingCount">0</p>
                            <p class="text-xs text-theme-secondary">Following</p>
                        </div>
                    </div>
                </div>

                <!-- Trending Topics -->
                <div class="glass border border-purple-700 rounded-2xl p-4 mb-6">
                    <h3 class="font-bold text-theme-accent mb-4">Trending Topics</h3>
                    <div id="trendingTopicsContainer" class="space-y-3">
                        <!-- Trending topics will be loaded dynamically -->
                    </div>
                </div>

                <!-- Suggested Connections -->
                <div class="glass border border-purple-700 rounded-2xl p-4">
                    <h3 class="font-bold text-theme-accent mb-4">Suggested Connections</h3>
                    <div id="suggestedUsersContainer" class="space-y-4">
                        <!-- Suggested users will be loaded dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Post Modal -->
    <div id="createPostModal" class="modal hidden">
        <div class="modal-container">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-theme-accent">Create Post</h2>
                <button id="closePostModal" class="text-theme-secondary hover:text-theme-accent transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <textarea id="modalPostInput" placeholder="What's on your mind?" 
                          class="w-full p-4 glass border border-purple-700 rounded-2xl focus:outline-none focus:ring-2 focus:ring-theme-accent focus:border-transparent placeholder-theme-secondary h-32"></textarea>
                
                <div id="modalMediaPreview" class="hidden">
                    <img id="modalPreviewImage" class="media-preview w-full hidden">
                    <video id="modalPreviewVideo" class="media-preview w-full hidden" controls></video>
                    <audio id="modalPreviewAudio" class="audio-player hidden" controls></audio>
                </div>
                
                <div class="flex space-x-4 text-theme-secondary justify-center">
                    <button id="modalAddPhoto" class="flex items-center space-x-2 hover:text-theme-accent transition">
                        <i class="fas fa-image"></i>
                        <span>Photo</span>
                    </button>
                    <button id="modalAddVideo" class="flex items-center space-x-2 hover:text-theme-accent transition">
                        <i class="fas fa-video"></i>
                        <span>Video</span>
                    </button>
                    <button id="modalAddAudio" class="flex items-center space-x-2 hover:text-theme-accent transition">
                        <i class="fas fa-music"></i>
                        <span>Audio</span>
                    </button>
                </div>
                
                <button id="modalSharePost" class="w-full cyber-gradient text-white py-3 rounded-2xl font-semibold hover:scale-105 transition">
                    Share Post
                </button>
            </div>
        </div>
    </div>

    <!-- Create Story Modal -->
    <div id="createStoryModal" class="modal hidden">
        <div class="modal-container">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-theme-accent">Create Story</h2>
                <button id="closeStoryModal" class="text-theme-secondary hover:text-theme-accent transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <textarea id="storyInput" placeholder="Add a caption to your story..." 
                          class="w-full p-4 glass border border-purple-700 rounded-2xl focus:outline-none focus:ring-2 focus:ring-theme-accent focus:border-transparent placeholder-theme-secondary h-24"></textarea>
                
                <div id="storyMediaPreview" class="hidden">
                    <img id="storyPreviewImage" class="media-preview w-full hidden">
                </div>
                
                <div class="flex space-x-4 text-theme-secondary justify-center">
                    <button id="addStoryPhoto" class="flex items-center space-x-2 hover:text-theme-accent transition">
                        <i class="fas fa-image"></i>
                        <span>Add Photo</span>
                    </button>
                </div>
                
                <button id="shareStory" class="w-full cyber-gradient text-white py-3 rounded-2xl font-semibold hover:scale-105 transition">
                    Share Story
                </button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDHHyGgsSV18BcXrGgzi4C8frzDAE1C1zo",
            authDomain: "uniconnect-ee95c.firebaseapp.com",
            projectId: "uniconnect-ee95c",
            storageBucket: "uniconnect-ee95c.firebasestorage.app",
            messagingSenderId: "1003264444309",
            appId: "1:1003264444309:web:9f0307516e44d21e97d89c"
        };

        // Initialize Firebase
        console.log("Initializing Firebase...");
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const storage = firebase.storage();

        console.log("Firebase initialized successfully!");

        // Global variables
        let currentUser = null;
        let userData = null;
        let currentMediaFile = null;
        let currentStoryFile = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM loaded, initializing app...");
            initializeApp();
        });

        // Initialize Firebase and authentication
        async function initializeApp() {
            try {
                console.log("Starting authentication...");
                
                await auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);
                
                auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        console.log("User signed in:", user.uid);
                        currentUser = user;
                        await loadUserData(user.uid);
                        setupEventListeners();
                        await loadAllData();
                    } else {
                        console.log("No user, signing in anonymously...");
                        try {
                            const userCredential = await auth.signInAnonymously();
                            currentUser = userCredential.user;
                            console.log("Anonymous user signed in:", currentUser.uid);
                            await loadUserData(currentUser.uid);
                            setupEventListeners();
                            await loadAllData();
                        } catch (authError) {
                            console.error("Anonymous auth failed:", authError);
                            // Create demo user data
                            currentUser = { 
                                uid: 'demo-user', 
                                displayName: 'Demo User',
                                name: 'Demo User'
                            };
                            userData = {
                                displayName: 'Demo User',
                                avatar: 'https://ui-avatars.com/api/?name=Demo+User&background=6366f1&color=fff',
                                status: 'Online',
                                posts: 0,
                                followers: 0,
                                following: 0
                            };
                            setupEventListeners();
                            loadAllData();
                        }
                    }
                });
                
            } catch (error) {
                console.error("App initialization error:", error);
            }
        }

        // Load user data from Firestore
        async function loadUserData(userId) {
            try {
                console.log("Loading user data for:", userId);
                const userDoc = await db.collection('users').doc(userId).get();
                
                if (userDoc.exists) {
                    userData = userDoc.data();
                    console.log("User data loaded:", userData);
                } else {
                    console.log("Creating new user document...");
                    // Create new user document
                    userData = {
                        displayName: 'ConnectSphere User',
                        email: null,
                        avatar: `https://ui-avatars.com/api/?name=User&background=6366f1&color=fff`,
                        status: 'Ready to connect!',
                        statusType: 'online',
                        posts: 0,
                        followers: 0,
                        following: 0,
                        isAnonymous: true,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        lastSeen: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    await db.collection('users').doc(userId).set(userData);
                    console.log("New user document created");
                }
                
                updateUIWithUserData();
                
            } catch (error) {
                console.error("Error loading user data:", error);
                // Fallback data
                userData = {
                    displayName: 'ConnectSphere User',
                    avatar: `https://ui-avatars.com/api/?name=User&background=6366f1&color=fff`,
                    status: 'Ready to connect!',
                    posts: 0,
                    followers: 0,
                    following: 0
                };
                updateUIWithUserData();
            }
        }

        // Update UI with user data
        function updateUIWithUserData() {
            if (!userData) return;

            console.log("Updating UI with user data:", userData);

            // Update user avatars
            document.getElementById('userAvatar').src = userData.avatar;
            document.getElementById('currentUserAvatar').src = userData.avatar;
            document.getElementById('sidebarUserAvatar').src = userData.avatar;

            // Update user names and status
            document.getElementById('userDisplayName').textContent = userData.displayName;
            document.getElementById('sidebarUserName').textContent = userData.displayName;
            document.getElementById('statusText').textContent = userData.status;
            document.getElementById('sidebarUserStatus').textContent = userData.status;

            // Update counts
            document.getElementById('postCount').textContent = userData.posts || 0;
            document.getElementById('followerCount').textContent = userData.followers || 0;
            document.getElementById('followingCount').textContent = userData.following || 0;
        }

        // Load all data
        async function loadAllData() {
            console.log("Loading all data...");
            await loadFeedData();
            await loadStories();
            await loadTrendingTopics();
            await loadSuggestedUsers();
            showNotification('Welcome to ConnectSphere!', 'success');
        }

        // Load feed data from Firestore
        async function loadFeedData() {
            try {
                console.log("Loading feed data...");
                
                const postsQuery = db.collection('posts')
                    .orderBy('createdAt', 'desc')
                    .limit(20);

                const unsubscribe = postsQuery.onSnapshot((snapshot) => {
                    const feedContainer = document.getElementById('feedContainer');
                    const trendingContainer = document.getElementById('trendingContainer');
                    
                    feedContainer.innerHTML = '';
                    trendingContainer.innerHTML = '';

                    if (snapshot.empty) {
                        feedContainer.innerHTML = `
                            <div class="glass border border-purple-700 rounded-2xl p-6 text-center">
                                <i class="fas fa-newspaper text-4xl text-theme-secondary mb-4"></i>
                                <h3 class="text-lg font-bold text-theme-accent mb-2">No posts yet</h3>
                                <p class="text-theme-secondary">Be the first to share something with your network!</p>
                                <button onclick="showCreatePostModal()" class="mt-4 bg-theme-accent text-white px-6 py-2 rounded-xl hover:bg-theme-hover transition">
                                    Create First Post
                                </button>
                            </div>
                        `;
                        return;
                    }

                    const posts = [];
                    snapshot.forEach((doc) => {
                        const post = { id: doc.id, ...doc.data() };
                        posts.push(post);
                    });

                    // Display trending posts (most liked)
                    const trendingPosts = [...posts]
                        .sort((a, b) => (b.likes || 0) - (a.likes || 0))
                        .slice(0, 3);

                    trendingPosts.forEach(post => {
                        const trendingElement = createTrendingPostElement(post);
                        trendingContainer.appendChild(trendingElement);
                    });

                    // Display all posts
                    posts.forEach(post => {
                        const postElement = createPostElement(post);
                        feedContainer.appendChild(postElement);
                    });

                }, (error) => {
                    console.error('Error loading feed:', error);
                });

                // Store unsubscribe for cleanup
                window.feedUnsubscribe = unsubscribe;
                
            } catch (error) {
                console.error('Error loading feed data:', error);
            }
        }

        // Create a post element for the feed
        function createPostElement(post) {
            const postElement = document.createElement('div');
            postElement.className = 'glass border border-purple-700 rounded-2xl p-6';
            postElement.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <img src="${post.userAvatar || 'https://ui-avatars.com/api/?name=User&background=6366f1&color=fff'}" alt="${post.userName}" class="w-10 h-10 rounded-2xl object-cover">
                        <div>
                            <h3 class="font-bold text-theme-accent">${post.userName}</h3>
                            <p class="text-xs text-theme-secondary">${formatTimestamp(post.createdAt)}</p>
                        </div>
                    </div>
                    <button class="text-theme-secondary hover:text-theme-accent transition">
                        <i class="fas fa-ellipsis-h"></i>
                    </button>
                </div>
                
                <p class="text-theme-primary mb-4">${post.content}</p>
                
                ${post.media ? `
                    <div class="mb-4">
                        ${post.media.type === 'image' ? `<img src="${post.media.url}" class="media-preview w-full cursor-pointer" onclick="openMediaModal('${post.media.url}', 'image')">` : ''}
                        ${post.media.type === 'video' ? `<video src="${post.media.url}" class="media-preview w-full" controls></video>` : ''}
                        ${post.media.type === 'audio' ? `<audio src="${post.media.url}" class="audio-player" controls></audio>` : ''}
                    </div>
                ` : ''}
                
                ${post.tags && post.tags.length > 0 ? `
                    <div class="mb-4">
                        ${post.tags.map(tag => `<span class="tag-pill">#${tag}</span>`).join('')}
                    </div>
                ` : ''}
                
                <div class="flex items-center justify-between text-theme-secondary">
                    <div class="flex space-x-6">
                        <button class="interaction-btn like-btn" data-post-id="${post.id}">
                            <i class="far fa-heart"></i>
                            <span class="ml-1">${post.likes || 0}</span>
                        </button>
                        <button class="interaction-btn comment-btn" data-post-id="${post.id}">
                            <i class="far fa-comment"></i>
                            <span class="ml-1">${post.comments || 0}</span>
                        </button>
                        <button class="interaction-btn share-btn" data-post-id="${post.id}">
                            <i class="fas fa-share"></i>
                            <span class="ml-1">${post.shares || 0}</span>
                        </button>
                    </div>
                    <button class="interaction-btn bookmark-btn" data-post-id="${post.id}">
                        <i class="far fa-bookmark"></i>
                    </button>
                </div>

                <!-- Comments Section -->
                <div class="mt-4 hidden" id="comments-${post.id}">
                    <div class="flex space-x-3 mb-3">
                        <img src="${userData.avatar}" class="w-8 h-8 rounded-2xl object-cover">
                        <div class="flex-1">
                            <input type="text" placeholder="Write a comment..." class="w-full p-2 glass border border-purple-700 rounded-xl text-sm">
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners
            const likeBtn = postElement.querySelector('.like-btn');
            likeBtn.addEventListener('click', () => handleLikePost(post.id, likeBtn));

            const commentBtn = postElement.querySelector('.comment-btn');
            commentBtn.addEventListener('click', () => toggleComments(post.id));

            const shareBtn = postElement.querySelector('.share-btn');
            shareBtn.addEventListener('click', () => handleSharePost(post.id));

            const bookmarkBtn = postElement.querySelector('.bookmark-btn');
            bookmarkBtn.addEventListener('click', () => handleBookmarkPost(post.id, bookmarkBtn));
            
            return postElement;
        }

        // Create trending post element
        function createTrendingPostElement(post) {
            const element = document.createElement('div');
            element.className = 'flex items-center space-x-3 p-3 hover:bg-purple-900/30 rounded-lg cursor-pointer transition';
            element.innerHTML = `
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-semibold text-theme-accent truncate">${post.userName}</p>
                    <p class="text-xs text-theme-secondary truncate">${post.content.substring(0, 50)}${post.content.length > 50 ? '...' : ''}</p>
                </div>
                <div class="flex items-center space-x-1 text-yellow-400">
                    <i class="fas fa-fire"></i>
                    <span class="text-xs">${post.likes || 0}</span>
                </div>
            `;
            element.addEventListener('click', () => {
                // Scroll to post in feed
                const postElement = document.querySelector(`[data-post-id="${post.id}"]`);
                if (postElement) {
                    postElement.scrollIntoView({ behavior: 'smooth' });
                    postElement.classList.add('bg-purple-900/30');
                    setTimeout(() => postElement.classList.remove('bg-purple-900/30'), 2000);
                }
            });
            return element;
        }

        // Load stories from Firestore
        async function loadStories() {
            try {
                console.log("Loading stories...");
                
                const storiesQuery = db.collection('stories')
                    .where('expiresAt', '>', new Date())
                    .orderBy('expiresAt', 'asc')
                    .limit(10);

                const unsubscribe = storiesQuery.onSnapshot((snapshot) => {
                    const storiesContainer = document.getElementById('storiesContainer');
                    // Clear existing stories (except the "Your Story" element)
                    const yourStoryElement = storiesContainer.firstElementChild;
                    storiesContainer.innerHTML = '';
                    storiesContainer.appendChild(yourStoryElement);

                    if (snapshot.empty) {
                        return;
                    }

                    snapshot.forEach((doc) => {
                        const story = doc.data();
                        story.id = doc.id;
                        const storyElement = createStoryElement(story);
                        storiesContainer.appendChild(storyElement);
                    });
                }, (error) => {
                    console.error('Error loading stories:', error);
                });

                window.storiesUnsubscribe = unsubscribe;
                
            } catch (error) {
                console.error('Error loading stories:', error);
            }
        }

        // Create a story element
        function createStoryElement(story) {
            const storyElement = document.createElement('div');
            storyElement.className = 'flex flex-col items-center space-y-2 flex-shrink-0';
            storyElement.innerHTML = `
                <div class="w-20 h-20 hologram-border rounded-2xl p-0.5 cursor-pointer" onclick="viewStory('${story.id}')">
                    <img src="${story.userAvatar}" alt="${story.userName}" class="w-full h-full rounded-2xl object-cover">
                </div>
                <span class="text-xs font-semibold text-theme-primary">${story.userName}</span>
            `;
            return storyElement;
        }

        // Load trending topics
        async function loadTrendingTopics() {
            try {
                console.log("Loading trending topics...");
                
                // For now, create some default trending topics
                const topicsContainer = document.getElementById('trendingTopicsContainer');
                topicsContainer.innerHTML = '';

                const defaultTopics = [
                    { name: 'technology', count: 15 },
                    { name: 'programming', count: 12 },
                    { name: 'ai', count: 8 },
                    { name: 'webdev', count: 6 }
                ];

                defaultTopics.forEach(topic => {
                    const topicElement = document.createElement('div');
                    topicElement.className = 'flex items-center justify-between cursor-pointer hover:bg-purple-900/30 p-2 rounded-lg transition';
                    topicElement.innerHTML = `
                        <span class="text-theme-primary font-medium">#${topic.name}</span>
                        <span class="text-theme-secondary text-sm">${topic.count} posts</span>
                    `;
                    topicElement.addEventListener('click', () => {
                        document.getElementById('searchInput').value = `#${topic.name}`;
                        handleSearch();
                    });
                    topicsContainer.appendChild(topicElement);
                });
                
            } catch (error) {
                console.error('Error loading trending topics:', error);
            }
        }

        // Load suggested users
        async function loadSuggestedUsers() {
            try {
                console.log("Loading suggested users...");
                
                const usersQuery = db.collection('users').limit(5);

                const unsubscribe = usersQuery.onSnapshot((snapshot) => {
                    const suggestedContainer = document.getElementById('suggestedUsersContainer');
                    suggestedContainer.innerHTML = '';

                    if (snapshot.empty) {
                        suggestedContainer.innerHTML = `
                            <div class="text-center text-theme-secondary">
                                <p>No suggested users found</p>
                            </div>
                        `;
                        return;
                    }

                    snapshot.forEach((doc) => {
                        if (doc.id !== currentUser.uid) {
                            const user = doc.data();
                            user.id = doc.id;
                            const userElement = createSuggestedUserElement(user);
                            suggestedContainer.appendChild(userElement);
                        }
                    });
                }, (error) => {
                    console.error('Error loading suggested users:', error);
                });

                window.suggestedUsersUnsubscribe = unsubscribe;
                
            } catch (error) {
                console.error('Error loading suggested users:', error);
            }
        }

        // Create a suggested user element
        function createSuggestedUserElement(user) {
            const userElement = document.createElement('div');
            userElement.className = 'flex items-center justify-between';
            userElement.innerHTML = `
                <div class="flex items-center space-x-3">
                    <img src="${user.avatar}" alt="${user.displayName}" class="w-10 h-10 rounded-2xl object-cover">
                    <div>
                        <h4 class="font-semibold text-theme-accent text-sm">${user.displayName}</h4>
                        <p class="text-xs text-theme-secondary">${user.followers || 0} followers</p>
                    </div>
                </div>
                <button class="follow-btn" data-user-id="${user.id}">
                    Follow
                </button>
            `;
            
            const followBtn = userElement.querySelector('.follow-btn');
            followBtn.addEventListener('click', () => handleFollowUser(user.id, followBtn));
            
            return userElement;
        }

        // Handle like post
        async function handleLikePost(postId, button) {
            try {
                const postRef = db.collection('posts').doc(postId);
                const postDoc = await postRef.get();
                
                if (postDoc.exists) {
                    const post = postDoc.data();
                    const newLikes = (post.likes || 0) + 1;
                    
                    await postRef.update({
                        likes: newLikes
                    });
                    
                    // Update UI immediately
                    const icon = button.querySelector('i');
                    const count = button.querySelector('span');
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                    icon.style.color = 'var(--accent-color)';
                    count.textContent = newLikes;
                    
                    showNotification('Post liked!', 'success');
                }
            } catch (error) {
                console.error('Error liking post:', error);
                showNotification('Error liking post', 'error');
            }
        }

        // Handle follow user
        async function handleFollowUser(userId, button) {
            try {
                // Update UI immediately
                button.textContent = 'Following';
                button.classList.add('following');
                
                // Update in Firebase
                await db.collection('users').doc(userId).update({
                    followers: firebase.firestore.FieldValue.increment(1)
                });

                // Update current user's following count
                await db.collection('users').doc(currentUser.uid).update({
                    following: firebase.firestore.FieldValue.increment(1)
                });

                showNotification('User followed!', 'success');
            } catch (error) {
                console.error('Error following user:', error);
                showNotification('Error following user', 'error');
            }
        }

        // Handle share post
        async function handleSharePost(postId) {
            try {
                const postRef = db.collection('posts').doc(postId);
                const postDoc = await postRef.get();
                
                if (postDoc.exists) {
                    const post = postDoc.data();
                    const newShares = (post.shares || 0) + 1;
                    
                    await postRef.update({
                        shares: newShares
                    });
                    
                    showNotification('Post shared!', 'success');
                }
            } catch (error) {
                console.error('Error sharing post:', error);
                showNotification('Error sharing post', 'error');
            }
        }

        // Handle bookmark post
        async function handleBookmarkPost(postId, button) {
            try {
                const icon = button.querySelector('i');
                icon.classList.toggle('far');
                icon.classList.toggle('fas');
                icon.style.color = icon.classList.contains('fas') ? 'var(--accent-color)' : '';
                
                showNotification(icon.classList.contains('fas') ? 'Post bookmarked!' : 'Post unbookmarked', 'success');
            } catch (error) {
                console.error('Error bookmarking post:', error);
                showNotification('Error bookmarking post', 'error');
            }
        }

        // Toggle comments section
        function toggleComments(postId) {
            const commentsSection = document.getElementById(`comments-${postId}`);
            commentsSection.classList.toggle('hidden');
        }

        // Create a new post
        async function createPost() {
            const postInput = document.getElementById('modalPostInput');
            const content = postInput.value.trim();
            
            if (!content && !currentMediaFile) {
                showNotification('Please enter some content or add media to your post', 'error');
                return;
            }

            try {
                let mediaUrl = null;
                let mediaType = null;

                // Upload media if exists
                if (currentMediaFile) {
                    showNotification('Uploading media...', 'success');
                    mediaUrl = await uploadMedia(currentMediaFile);
                    mediaType = currentMediaFile.type.split('/')[0];
                }

                // Create post document
                const postData = {
                    content: content,
                    userId: currentUser.uid,
                    userName: userData.displayName,
                    userAvatar: userData.avatar,
                    media: mediaUrl ? { url: mediaUrl, type: mediaType } : null,
                    tags: extractTags(content),
                    likes: 0,
                    comments: 0,
                    shares: 0,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                await db.collection('posts').add(postData);

                // Update user post count
                await db.collection('users').doc(currentUser.uid).update({
                    posts: firebase.firestore.FieldValue.increment(1)
                });

                // Clear input and reset media
                postInput.value = '';
                clearMediaPreview();
                hideCreatePostModal();
                
                showNotification('Post shared successfully!', 'success');
            } catch (error) {
                console.error('Error creating post:', error);
                showNotification('Error sharing post. Please try again.', 'error');
            }
        }

        // Create a new story
        async function createStory() {
            const storyInput = document.getElementById('storyInput');
            const content = storyInput.value.trim();
            
            if (!content && !currentStoryFile) {
                showNotification('Please add a photo or caption to your story', 'error');
                return;
            }

            try {
                let mediaUrl = null;

                // Upload story media if exists
                if (currentStoryFile) {
                    showNotification('Uploading story...', 'success');
                    mediaUrl = await uploadMedia(currentStoryFile);
                }

                // Calculate expiration time (24 hours from now)
                const expiresAt = new Date();
                expiresAt.setHours(expiresAt.getHours() + 24);

                // Create story document
                const storyData = {
                    content: content,
                    userId: currentUser.uid,
                    userName: userData.displayName,
                    userAvatar: userData.avatar,
                    mediaUrl: mediaUrl,
                    views: 0,
                    expiresAt: expiresAt,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                await db.collection('stories').add(storyData);

                // Clear input and reset media
                storyInput.value = '';
                clearStoryPreview();
                hideCreateStoryModal();
                
                showNotification('Story shared successfully!', 'success');
            } catch (error) {
                console.error('Error creating story:', error);
                showNotification('Error sharing story. Please try again.', 'error');
            }
        }

        // Upload media to Firebase Storage
        async function uploadMedia(file) {
            try {
                const storageRef = storage.ref();
                const fileRef = storageRef.child(`posts/${currentUser.uid}/${Date.now()}_${file.name}`);
                const snapshot = await fileRef.put(file);
                const downloadURL = await snapshot.ref.getDownloadURL();
                return downloadURL;
            } catch (error) {
                console.error('Error uploading media:', error);
                throw error;
            }
        }

        // Extract hashtags from content
        function extractTags(content) {
            const tagRegex = /#(\w+)/g;
            const tags = [];
            let match;
            
            while ((match = tagRegex.exec(content)) !== null) {
                tags.push(match[1]);
            }
            
            return tags;
        }

        // Handle search functionality
        async function handleSearch() {
            const query = document.getElementById('searchInput').value.trim();
            const resultsContainer = document.getElementById('searchResults');
            
            if (query.length < 2) {
                resultsContainer.classList.remove('show');
                return;
            }

            try {
                // Search users
                const usersSnapshot = await db.collection('users')
                    .where('displayName', '>=', query)
                    .where('displayName', '<=', query + '\uf8ff')
                    .limit(5)
                    .get();

                // Search posts
                const postsSnapshot = await db.collection('posts')
                    .where('content', '>=', query)
                    .where('content', '<=', query + '\uf8ff')
                    .limit(5)
                    .get();

                let resultsHTML = '';

                // Add user results
                if (!usersSnapshot.empty) {
                    resultsHTML += '<div class="text-xs font-semibold text-theme-secondary mb-2">USERS</div>';
                    usersSnapshot.forEach(doc => {
                        const user = doc.data();
                        resultsHTML += `
                            <div class="search-result-item" data-user-id="${doc.id}">
                                <div class="flex items-center space-x-3">
                                    <img src="${user.avatar}" alt="${user.displayName}" class="w-8 h-8 rounded-2xl object-cover">
                                    <div>
                                        <p class="font-medium text-theme-primary">${user.displayName}</p>
                                        <p class="text-xs text-theme-secondary">${user.followers || 0} followers</p>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                }

                // Add post results
                if (!postsSnapshot.empty) {
                    resultsHTML += '<div class="text-xs font-semibold text-theme-secondary mb-2 mt-4">POSTS</div>';
                    postsSnapshot.forEach(doc => {
                        const post = doc.data();
                        resultsHTML += `
                            <div class="search-result-item" data-post-id="${doc.id}">
                                <p class="font-medium text-theme-primary">${post.content.substring(0, 50)}${post.content.length > 50 ? '...' : ''}</p>
                                <p class="text-xs text-theme-secondary">by ${post.userName}</p>
                            </div>
                        `;
                    });
                }

                if (resultsHTML === '') {
                    resultsHTML = '<div class="text-theme-secondary p-3 text-center">No results found</div>';
                }

                resultsContainer.innerHTML = resultsHTML;
                resultsContainer.classList.add('show');
            } catch (error) {
                console.error('Error searching:', error);
            }
        }

        // Format Firestore timestamp
        function formatTimestamp(timestamp) {
            if (!timestamp) return 'Just now';
            
            try {
                const date = timestamp.toDate();
                const now = new Date();
                const diffInSeconds = Math.floor((now - date) / 1000);
                
                if (diffInSeconds < 60) return 'Just now';
                if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
                if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
                if (diffInSeconds < 604800) return `${Math.floor(diffInSeconds / 86400)}d ago`;
                
                return date.toLocaleDateString();
            } catch (error) {
                return 'Recently';
            }
        }

        // Modal Management
        function showCreatePostModal() {
            document.getElementById('createPostModal').classList.remove('hidden');
        }

        function hideCreatePostModal() {
            document.getElementById('createPostModal').classList.add('hidden');
            clearMediaPreview();
        }

        function showCreateStoryModal() {
            document.getElementById('createStoryModal').classList.remove('hidden');
        }

        function hideCreateStoryModal() {
            document.getElementById('createStoryModal').classList.add('hidden');
            clearStoryPreview();
        }

        // Media Preview Management
        function clearMediaPreview() {
            const preview = document.getElementById('modalMediaPreview');
            preview.classList.add('hidden');
            document.getElementById('modalPreviewImage').classList.add('hidden');
            document.getElementById('modalPreviewVideo').classList.add('hidden');
            document.getElementById('modalPreviewAudio').classList.add('hidden');
            currentMediaFile = null;
        }

        function clearStoryPreview() {
            const preview = document.getElementById('storyMediaPreview');
            preview.classList.add('hidden');
            document.getElementById('storyPreviewImage').classList.add('hidden');
            currentStoryFile = null;
        }

        // Setup event listeners
        function setupEventListeners() {
            console.log("Setting up event listeners...");

            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', function() {
                const themeOptions = document.querySelector('.theme-options');
                themeOptions.classList.toggle('show');
            });

            // Theme selection
            document.querySelectorAll('.theme-option').forEach(option => {
                option.addEventListener('click', function() {
                    const theme = this.getAttribute('data-theme');
                    document.body.className = `h-full ${theme} emotion-default`;
                    
                    document.querySelectorAll('.theme-option').forEach(opt => {
                        opt.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    document.querySelector('.theme-options').classList.remove('show');
                    localStorage.setItem('selectedTheme', theme);
                });
            });

            // Load saved theme
            const savedTheme = localStorage.getItem('selectedTheme') || 'dark-theme';
            document.body.className = `h-full ${savedTheme} emotion-default`;
            document.querySelectorAll('.theme-option').forEach(opt => {
                if (opt.getAttribute('data-theme') === savedTheme) {
                    opt.classList.add('active');
                }
            });

            // Post creation
            document.getElementById('modalSharePost').addEventListener('click', createPost);
            document.getElementById('createPostBtn').addEventListener('click', showCreatePostModal);
            document.getElementById('closePostModal').addEventListener('click', hideCreatePostModal);

            // Story creation
            document.getElementById('createStoryBtn').addEventListener('click', showCreateStoryModal);
            document.getElementById('shareStory').addEventListener('click', createStory);
            document.getElementById('closeStoryModal').addEventListener('click', hideCreateStoryModal);

            // Media upload buttons
            document.getElementById('modalAddPhoto').addEventListener('click', () => triggerMediaUpload('image', 'modal'));
            document.getElementById('modalAddVideo').addEventListener('click', () => triggerMediaUpload('video', 'modal'));
            document.getElementById('modalAddAudio').addEventListener('click', () => triggerMediaUpload('audio', 'modal'));
            document.getElementById('addStoryPhoto').addEventListener('click', () => triggerMediaUpload('image', 'story'));

            // Search functionality
            document.getElementById('searchInput').addEventListener('input', handleSearch);

            // Close search results when clicking outside
            document.addEventListener('click', function(event) {
                if (!event.target.closest('#searchInput') && !event.target.closest('#searchResults')) {
                    document.getElementById('searchResults').classList.remove('show');
                }
                if (!event.target.closest('#themeToggle') && !event.target.closest('.theme-options')) {
                    document.querySelector('.theme-options').classList.remove('show');
                }
            });

            console.log("All event listeners set up successfully!");
        }

        // Trigger media upload
        function triggerMediaUpload(type, context) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = type === 'image' ? 'image/*' : type === 'video' ? 'video/*' : 'audio/*';
            input.onchange = (e) => handleMediaUpload(e, type, context);
            input.click();
        }

        // Handle media upload
        function handleMediaUpload(event, type, context) {
            const file = event.target.files[0];
            if (!file) return;

            if (type === 'image' && !file.type.startsWith('image/')) {
                showNotification('Please select an image file', 'error');
                return;
            }

            if (type === 'video' && !file.type.startsWith('video/')) {
                showNotification('Please select a video file', 'error');
                return;
            }

            if (type === 'audio' && !file.type.startsWith('audio/')) {
                showNotification('Please select an audio file', 'error');
                return;
            }

            if (context === 'modal') {
                currentMediaFile = file;
                const preview = document.getElementById('modalMediaPreview');
                const previewImage = document.getElementById('modalPreviewImage');
                const previewVideo = document.getElementById('modalPreviewVideo');
                const previewAudio = document.getElementById('modalPreviewAudio');

                preview.classList.remove('hidden');
                previewImage.classList.add('hidden');
                previewVideo.classList.add('hidden');
                previewAudio.classList.add('hidden');

                if (type === 'image') {
                    previewImage.src = URL.createObjectURL(file);
                    previewImage.classList.remove('hidden');
                } else if (type === 'video') {
                    previewVideo.src = URL.createObjectURL(file);
                    previewVideo.classList.remove('hidden');
                } else if (type === 'audio') {
                    previewAudio.src = URL.createObjectURL(file);
                    previewAudio.classList.remove('hidden');
                }
            } else if (context === 'story') {
                currentStoryFile = file;
                const preview = document.getElementById('storyMediaPreview');
                const previewImage = document.getElementById('storyPreviewImage');

                preview.classList.remove('hidden');
                previewImage.src = URL.createObjectURL(file);
                previewImage.classList.remove('hidden');
            }
        }

        // View story
        function viewStory(storyId) {
            showNotification('Viewing story: ' + storyId, 'success');
        }

        // Open media modal
        function openMediaModal(url, type) {
            showNotification(`Opening ${type}: ${url}`, 'info');
        }

        // Show notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-2xl glass border ${
                type === 'success' ? 'border-green-500 text-green-400' : 'border-red-500 text-red-400'
            } z-50 transition transform duration-300 ease-in-out`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Make functions globally available
        window.showCreatePostModal = showCreatePostModal;
        window.viewStory = viewStory;
        window.openMediaModal = openMediaModal;

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (window.feedUnsubscribe) window.feedUnsubscribe();
            if (window.storiesUnsubscribe) window.storiesUnsubscribe();
            if (window.suggestedUsersUnsubscribe) window.suggestedUsersUnsubscribe();
        });
    </script>
</body>
</html>