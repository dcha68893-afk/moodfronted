<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
    <link rel="icon" href="../icons/moodchat-192.png">
    <link rel="icon" href="../icons/moodchat-512.png">
    <meta name="theme-color" content="#000000">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Status | Knecta Chat</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="status.css">
    
    <style>
        /* ============================================= */
        /* MISSING CSS THAT WASN'T IN STATUS.CSS */
        /* ============================================= */
        
        /* Action Buttons */
        .action-btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .action-btn.primary {
            background-color: var(--primary-color);
            color: white;
        }

        .action-btn.primary:hover:not(:disabled) {
            background-color: #0073e6;
            transform: translateY(-1px);
        }

        .action-btn.secondary {
            background-color: var(--secondary-color);
            color: var(--text-primary);
        }

        .action-btn.secondary:hover:not(:disabled) {
            background-color: #e4e6e9;
            transform: translateY(-1px);
        }

        .action-btn.success {
            background-color: var(--success-color);
            color: white;
        }

        .action-btn.success:hover:not(:disabled) {
            background-color: #2da64a;
            transform: translateY(-1px);
        }

        .action-btn.danger {
            background-color: var(--danger-color);
            color: white;
        }

        .action-btn.danger:hover:not(:disabled) {
            background-color: #e5392e;
            transform: translateY(-1px);
        }

        .action-btn.warning {
            background-color: var(--warning-color);
            color: white;
        }

        .action-btn.warning:hover:not(:disabled) {
            background-color: #e68a00;
            transform: translateY(-1px);
        }

        .action-btn.info {
            background-color: var(--info-color);
            color: white;
        }

        .action-btn.info:hover:not(:disabled) {
            background-color: #1ab4f5;
            transform: translateY(-1px);
        }

        /* Text Input */
        .text-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background-color: var(--bg-color);
            color: var(--text-primary);
            transition: all 0.2s;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 132, 255, 0.1);
        }

        .text-input::placeholder {
            color: var(--text-secondary);
        }

        .text-input:disabled {
            background-color: var(--secondary-color);
            cursor: not-allowed;
        }

        /* Drafts Section */
        .drafts-section {
            display: none;
        }

        .drafts-section.active {
            display: block;
        }

        .draft-item {
            background-color: var(--secondary-color);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .draft-item:hover {
            background-color: #e4e6e9;
            border-color: var(--primary-color);
        }

        .draft-item.selected {
            background-color: rgba(0, 132, 255, 0.1);
            border-color: var(--primary-color);
        }

        .draft-preview {
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 5px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .draft-meta {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .draft-actions {
            display: flex;
            gap: 8px;
        }

        .draft-action-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .draft-action-btn:hover {
            background-color: rgba(0, 132, 255, 0.1);
        }

        .draft-action-btn.danger {
            color: var(--danger-color);
        }

        .draft-action-btn.danger:hover {
            background-color: rgba(255, 59, 48, 0.1);
        }

        /* Schedule List */
        .schedule-list {
            display: none;
        }

        .schedule-list.active {
            display: block;
        }

        .schedule-item {
            background-color: var(--secondary-color);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .schedule-info h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .schedule-time {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .schedule-actions {
            display: flex;
            gap: 8px;
        }

        /* Cancel Button */
        .cancel-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .cancel-btn:hover {
            background-color: #e5392e;
        }

        .cancel-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Save Button */
        .save-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .save-btn:hover {
            background-color: #2da64a;
        }

        .save-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Edit Button */
        .edit-btn {
            background-color: var(--info-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }

        .edit-btn:hover {
            background-color: #1ab4f5;
        }

        /* Close Button */
        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 18px;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background-color: var(--secondary-color);
            color: var(--text-primary);
        }

        /* Filter Tags */
        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }

        .filter-tag {
            background-color: var(--secondary-color);
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-tag.active {
            background-color: var(--primary-color);
            color: white;
        }

        .filter-tag:hover {
            background-color: #e4e6e9;
        }

        .filter-tag.active:hover {
            background-color: #0073e6;
        }

        /* Clear Filters Button */
        .clear-filters-btn {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .clear-filters-btn:hover {
            background-color: var(--secondary-color);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        /* Media Preview Improvements */
        .media-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .media-preview-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
        }

        .media-preview-item img,
        .media-preview-item video {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }

        .media-preview-count {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 11px;
        }

        /* Poll Creation Enhancements */
        .poll-option-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .poll-option-number {
            width: 24px;
            height: 24px;
            background-color: var(--secondary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .poll-option-input-wrapper {
            flex: 1;
            position: relative;
        }

        .poll-option-input-wrapper input {
            width: 100%;
            padding-right: 40px;
        }

        .remove-poll-option {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--danger-color);
            cursor: pointer;
            font-size: 16px;
            padding: 4px;
        }

        /* Schedule DateTime Picker */
        .schedule-datetime-picker {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .schedule-date,
        .schedule-time {
            flex: 1;
        }

        .schedule-date input,
        .schedule-time input {
            width: 100%;
        }

        /* Repeat Options */
        .repeat-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .repeat-option {
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .repeat-option:hover {
            border-color: var(--primary-color);
            background-color: rgba(0, 132, 255, 0.05);
        }

        .repeat-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(0, 132, 255, 0.1);
        }

        /* Notification Settings */
        .notification-settings {
            background-color: var(--secondary-color);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .notification-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .notification-option:last-child {
            border-bottom: none;
        }

        .notification-label {
            flex: 1;
        }

        .notification-label h4 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .notification-label p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Report Details */
        .report-details {
            margin-top: 15px;
        }

        .report-details textarea {
            width: 100%;
            min-height: 100px;
            margin-top: 8px;
        }

        /* Highlights Editor */
        .highlights-editor {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
            align-items: center;
            justify-content: center;
        }

        .highlights-editor.active {
            display: flex;
        }

        .editor-container {
            width: 90%;
            max-width: 500px;
            background-color: var(--bg-color);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow-lg);
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .editor-header h3 {
            font-size: 20px;
            font-weight: 600;
        }

        .editor-content {
            margin-bottom: 20px;
        }

        .editor-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Memory Timeline Filters */
        .timeline-filters-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        /* Stats Chart */
        .stats-chart-container {
            background-color: var(--secondary-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .stats-chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stats-chart-title {
            font-weight: 600;
        }

        .stats-chart-period {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .stats-chart-canvas {
            width: 100%;
            height: 200px;
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .quick-stat {
            background-color: var(--secondary-color);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .quick-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .quick-stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Drafts Empty State */
        .drafts-empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .drafts-empty i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* Schedule Empty State */
        .schedule-empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .schedule-empty i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* Enhanced Loading */
        .enhanced-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .enhanced-loading i {
            font-size: 32px;
            margin-bottom: 15px;
            animation: enhanced-spin 1.5s linear infinite;
        }

        .enhanced-loading p {
            margin-bottom: 10px;
        }

        .loading-progress {
            width: 100%;
            max-width: 200px;
            height: 4px;
            background-color: var(--secondary-color);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 10px;
        }

        .loading-progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            animation: loading-progress 2s ease-in-out infinite;
        }

        @keyframes enhanced-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes loading-progress {
            0% { width: 0%; transform: translateX(0); }
            50% { width: 100%; transform: translateX(0); }
            100% { width: 100%; transform: translateX(200px); }
        }

        /* Responsive Enhancements */
        @media (max-width: 768px) {
            .action-btn {
                padding: 8px 16px;
                font-size: 13px;
            }

            .quick-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .schedule-datetime-picker {
                flex-direction: column;
            }

            .repeat-options {
                grid-template-columns: 1fr;
            }

            .editor-container {
                padding: 20px;
            }

            .stats-chart-container {
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .quick-stats {
                grid-template-columns: 1fr;
            }

            .draft-actions {
                flex-direction: column;
            }

            .schedule-actions {
                flex-direction: column;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .visible {
            display: block !important;
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .text-left {
            text-align: left;
        }

        .mt-10 {
            margin-top: 10px;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-10 {
            margin-bottom: 10px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .ml-auto {
            margin-left: auto;
        }

        .mr-auto {
            margin-right: auto;
        }

        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .justify-center {
            justify-content: center;
        }

        .gap-5 {
            gap: 5px;
        }

        .gap-10 {
            gap: 10px;
        }

        .gap-15 {
            gap: 15px;
        }

        .w-full {
            width: 100%;
        }

        .w-half {
            width: 50%;
        }

        .w-auto {
            width: auto;
        }

        /* Color Utilities */
        .bg-primary {
            background-color: var(--primary-color);
        }

        .bg-secondary {
            background-color: var(--secondary-color);
        }

        .bg-success {
            background-color: var(--success-color);
        }

        .bg-danger {
            background-color: var(--danger-color);
        }

        .bg-warning {
            background-color: var(--warning-color);
        }

        .bg-info {
            background-color: var(--info-color);
        }

        .text-primary {
            color: var(--primary-color);
        }

        .text-secondary {
            color: var(--text-secondary);
        }

        .text-success {
            color: var(--success-color);
        }

        .text-danger {
            color: var(--danger-color);
        }

        .text-warning {
            color: var(--warning-color);
        }

        .text-info {
            color: var(--info-color);
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--secondary-color);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* Focus States */
        *:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        *:focus:not(.focus-visible) {
            outline: none;
        }

        /* Print Styles */
        @media print {
            .no-print {
                display: none !important;
            }
            
            .print-only {
                display: block !important;
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* High Contrast Mode */
        @media (prefers-contrast: high) {
            :root {
                --primary-color: #0056b3;
                --danger-color: #c00;
                --success-color: #007a00;
                --warning-color: #9d5c00;
            }
        }

        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }
    </style>
</head>
<body>
    <!-- Create Status Modal -->
    <div class="create-status-modal" id="createStatusModal">
        <div class="create-status-container">
            <div class="create-status-header">
                <h3>Create Status</h3>
                <button class="create-status-btn" id="closeCreateStatusModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="create-status-tabs">
                <button class="create-status-tab active" data-tab="text">Text</button>
                <button class="create-status-tab" data-tab="media">Media</button>
                <button class="create-status-tab" data-tab="poll">Poll</button>
                <button class="create-status-tab" data-tab="settings">Settings</button>
            </div>
            
            <div class="create-status-content">
                <!-- Text Status Tab -->
                <div class="create-status-tab-content active" id="textTab">
                    <div class="text-status-input-container">
                        <textarea class="text-status-input" id="textStatusInput" placeholder="What's on your mind?"></textarea>
                        <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                            <span id="textStatusCounter">0/500</span>
                            <button class="action-btn secondary" id="clearTextBtn">
                                <i class="fas fa-trash"></i> Clear
                            </button>
                        </div>
                    </div>
                    
                    <div class="emoji-picker-container">
                        <div class="metadata-title">
                            <i class="fas fa-smile"></i>
                            <span>Add Emojis</span>
                        </div>
                        <div class="emoji-grid" id="emojiGrid">
                            <!-- Emojis will be loaded here -->
                        </div>
                    </div>
                    
                    <div class="background-options">
                        <div class="metadata-title">
                            <i class="fas fa-palette"></i>
                            <span>Background</span>
                        </div>
                        <div class="background-grid" id="backgroundGrid">
                            <!-- Background options will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <!-- Media Status Tab -->
                <div class="create-status-tab-content" id="mediaTab">
                    <div class="media-upload-container" id="mediaUploadArea">
                        <div class="media-upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="media-upload-text">
                            Upload Photo or Video
                        </div>
                        <div class="media-upload-subtext">
                            Click to browse or drag and drop
                        </div>
                        <input type="file" id="mediaFileInput" accept="image/*,video/*" multiple style="display: none;">
                    </div>
                    
                    <div class="media-preview-grid" id="mediaPreview">
                        <!-- Media preview will be shown here -->
                    </div>
                    
                    <div class="text-status-input-container">
                        <textarea class="text-status-input" id="mediaCaptionInput" placeholder="Add a caption..." rows="3"></textarea>
                    </div>
                </div>
                
                <!-- Poll Status Tab -->
                <div class="create-status-tab-content" id="pollTab">
                    <div class="text-status-input-container">
                        <textarea class="text-status-input" id="pollQuestionInput" placeholder="Ask a question..." rows="2"></textarea>
                    </div>
                    
                    <div id="pollOptionsContainer">
                        <!-- Poll options will be loaded here -->
                    </div>
                    
                    <button class="add-option-btn" id="addPollOptionBtn">
                        <i class="fas fa-plus"></i> Add Option
                    </button>
                    
                    <div class="metadata-section" style="margin-top: 20px;">
                        <div class="metadata-title">
                            <i class="fas fa-clock"></i>
                            <span>Poll Duration</span>
                        </div>
                        <select class="text-input" id="pollDurationSelect">
                            <option value="3600">1 hour</option>
                            <option value="21600">6 hours</option>
                            <option value="43200">12 hours</option>
                            <option value="86400">24 hours</option>
                            <option value="604800">7 days</option>
                        </select>
                    </div>
                </div>
                
                <!-- Settings Tab -->
                <div class="create-status-tab-content" id="settingsTab">
                    <div class="status-metadata">
                        <!-- Intent -->
                        <div class="metadata-section">
                            <div class="metadata-title">
                                <i class="fas fa-bullseye"></i>
                                <span>Status Intent</span>
                            </div>
                            <div class="intent-options" id="intentOptions">
                                <!-- Intent options will be loaded here -->
                            </div>
                        </div>
                        
                        <!-- Mood -->
                        <div class="metadata-section">
                            <div class="metadata-title">
                                <i class="fas fa-brain"></i>
                                <span>Current Mood</span>
                            </div>
                            <div class="mood-options" id="moodOptions">
                                <!-- Mood options will be loaded here -->
                            </div>
                        </div>
                        
                        <!-- Category -->
                        <div class="metadata-section">
                            <div class="metadata-title">
                                <i class="fas fa-tag"></i>
                                <span>Category</span>
                            </div>
                            <div class="category-options" id="categoryOptions">
                                <!-- Category options will be loaded here -->
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="metadata-section">
                            <div class="metadata-title">
                                <i class="fas fa-hand-pointer"></i>
                                <span>Action Buttons</span>
                            </div>
                            <div class="action-buttons-selector" id="actionButtonsSelector">
                                <!-- Action button options will be loaded here -->
                            </div>
                        </div>
                        
                        <!-- Privacy -->
                        <div class="metadata-section">
                            <div class="metadata-title">
                                <i class="fas fa-lock"></i>
                                <span>Privacy</span>
                            </div>
                            <div class="privacy-options" id="privacyOptions">
                                <!-- Privacy options will be loaded here -->
                            </div>
                        </div>
                        
                        <!-- Duration -->
                        <div class="metadata-section">
                            <div class="metadata-title">
                                <i class="fas fa-hourglass-half"></i>
                                <span>Status Duration</span>
                            </div>
                            <div class="duration-options" id="durationOptions">
                                <!-- Duration options will be loaded here -->
                            </div>
                        </div>
                        
                        <!-- Advanced Options -->
                        <div class="advanced-options">
                            <div class="advanced-option">
                                <div class="advanced-option-label">
                                    <div>
                                        <div class="advanced-option-name">Sensitive Content</div>
                                        <div class="advanced-option-description">Blur media for sensitive content</div>
                                    </div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="sensitiveContentToggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="advanced-option">
                                <div class="advanced-option-label">
                                    <div>
                                        <div class="advanced-option-name">Silent Mode</div>
                                        <div class="advanced-option-description">Post without notifications</div>
                                    </div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="silentModeToggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="advanced-option">
                                <div class="advanced-option-label">
                                    <div>
                                        <div class="advanced-option-name">Auto-Translate</div>
                                        <div class="advanced-option-description">Automatically translate text</div>
                                    </div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="autoTranslateToggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="advanced-option">
                                <div class="advanced-option-label">
                                    <div>
                                        <div class="advanced-option-name">Offline Queue</div>
                                        <div class="advanced-option-description">Save for posting when online</div>
                                    </div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="offlineQueueToggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Template Section -->
                    <div class="metadata-section" style="margin-top: 20px;">
                        <div class="metadata-title">
                            <i class="fas fa-layer-group"></i>
                            <span>Templates</span>
                        </div>
                        <div class="category-options" id="templateOptions">
                            <!-- Template options will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="padding: 20px; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between;">
                <button class="action-btn secondary" id="saveDraftBtn">
                    <i class="fas fa-save"></i> Save Draft
                </button>
                <button class="action-btn primary" id="postStatusBtn">
                    <i class="fas fa-paper-plane"></i> Post Status
                </button>
                <button class="action-btn success" id="scheduleStatusBtn">
                    <i class="fas fa-clock"></i> Schedule
                </button>
            </div>
        </div>
    </div>
    
    <!-- Drafts Modal -->
    <div class="create-status-modal" id="draftsModal">
        <div class="create-status-container">
            <div class="create-status-header">
                <h3>Drafts</h3>
                <button class="create-status-btn" id="closeDraftsModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="create-status-content">
                <div class="drafts-section active" id="allDraftsSection">
                    <div class="drafts-list" id="allDraftsList">
                        <div class="drafts-empty">
                            <i class="fas fa-file-alt"></i>
                            <p>No drafts yet</p>
                            <p class="subtext">Save a status as draft to see it here</p>
                        </div>
                    </div>
                </div>
            </div>
            <div style="padding: 20px; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between;">
                <button class="action-btn secondary" id="deleteAllDraftsBtn">
                    <i class="fas fa-trash"></i> Delete All
                </button>
                <button class="action-btn primary" id="loadDraftBtn" disabled>
                    <i class="fas fa-edit"></i> Edit Draft
                </button>
            </div>
        </div>
    </div>
    
    <!-- Highlights Modal -->
    <div class="highlights-modal" id="highlightsModal">
        <div class="highlights-container">
            <div class="highlights-header">
                <h3>Status Highlights</h3>
                <div>
                    <button class="create-status-btn" id="createHighlightBtn" title="Create New Highlight">
                        <i class="fas fa-plus"></i>
                    </button>
                    <button class="create-status-btn" id="closeHighlightsModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="highlights-content" id="highlightsContent">
                <!-- Highlights will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Highlights Editor Modal -->
    <div class="highlights-editor" id="highlightsEditorModal">
        <div class="editor-container">
            <div class="editor-header">
                <h3 id="highlightEditorTitle">Create Highlight</h3>
                <button class="close-btn" id="closeHighlightsEditor">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="editor-content">
                <div class="text-input-container mb-20">
                    <label for="highlightNameInput" class="metadata-title">
                        <i class="fas fa-heading"></i>
                        <span>Highlight Name</span>
                    </label>
                    <input type="text" class="text-input" id="highlightNameInput" placeholder="Enter highlight name">
                </div>
                
                <div class="text-input-container mb-20">
                    <label for="highlightIconSelect" class="metadata-title">
                        <i class="fas fa-icons"></i>
                        <span>Icon</span>
                    </label>
                    <select class="text-input" id="highlightIconSelect">
                        <option value="fas fa-star">Star</option>
                        <option value="fas fa-heart">Heart</option>
                        <option value="fas fa-trophy">Trophy</option>
                        <option value="fas fa-gem">Gem</option>
                        <option value="fas fa-bookmark">Bookmark</option>
                        <option value="fas fa-flag">Flag</option>
                        <option value="fas fa-camera">Camera</option>
                        <option value="fas fa-music">Music</option>
                        <option value="fas fa-plane">Travel</option>
                        <option value="fas fa-utensils">Food</option>
                    </select>
                </div>
                
                <div class="text-input-container mb-20">
                    <label for="highlightColorSelect" class="metadata-title">
                        <i class="fas fa-palette"></i>
                        <span>Color</span>
                    </label>
                    <div class="background-grid" id="highlightColorGrid">
                        <!-- Color options will be loaded here -->
                    </div>
                </div>
                
                <div class="text-input-container mb-20">
                    <label class="metadata-title">
                        <i class="fas fa-lock"></i>
                        <span>Privacy</span>
                    </label>
                    <div class="privacy-options" id="highlightPrivacyOptions">
                        <!-- Privacy options will be loaded here -->
                    </div>
                </div>
            </div>
            <div class="editor-actions">
                <button class="action-btn secondary" id="cancelHighlightBtn">
                    Cancel
                </button>
                <button class="action-btn primary" id="saveHighlightBtn">
                    Save Highlight
                </button>
            </div>
        </div>
    </div>
    
    <!-- Memory Timeline Modal -->
    <div class="memory-timeline-modal" id="memoryTimelineModal">
        <div class="memory-timeline-container">
            <div class="memory-timeline-header">
                <h3>Memory Timeline</h3>
                <button class="create-status-btn" id="closeMemoryTimelineModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="timeline-filters-container">
                <button class="timeline-filter-btn active" data-filter="all">All</button>
                <button class="timeline-filter-btn" data-filter="motivational">Motivational</button>
                <button class="timeline-filter-btn" data-filter="reflective">Reflective</button>
                <button class="timeline-filter-btn" data-filter="achievements">Achievements</button>
                <button class="timeline-filter-btn" data-filter="happy">Happy Moments</button>
                <button class="timeline-filter-btn" data-filter="motivated">Motivated Days</button>
                <button class="action-btn secondary ml-auto" id="exportTimelineBtn">
                    <i class="fas fa-download"></i> Export
                </button>
            </div>
            <div class="memory-timeline-content" id="memoryTimelineContent">
                <!-- Timeline will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Stats Modal -->
    <div class="stats-modal" id="statsModal">
        <div class="stats-container">
            <div class="stats-header">
                <h3>Status Analytics</h3>
                <div>
                    <button class="create-status-btn" id="refreshStatsBtn" title="Refresh Stats">
                        <i class="fas fa-redo"></i>
                    </button>
                    <button class="create-status-btn" id="closeStatsModal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="stats-content" id="statsContent">
                <div class="quick-stats">
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="totalStatusesStat">0</div>
                        <div class="quick-stat-label">Total Statuses</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="totalViewsStat">0</div>
                        <div class="quick-stat-label">Total Views</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="totalReactionsStat">0</div>
                        <div class="quick-stat-label">Total Reactions</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-value" id="streakStat">0</div>
                        <div class="quick-stat-label">Day Streak</div>
                    </div>
                </div>
                
                <div class="stats-chart-container">
                    <div class="stats-chart-header">
                        <div class="stats-chart-title">Views Over Time</div>
                        <div class="stats-chart-period" id="chartPeriod">Last 30 days</div>
                    </div>
                    <div class="stats-chart-canvas" id="viewsChart">
                        <!-- Chart will be loaded here -->
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="avgViewTimeStat">0s</div>
                        <div class="stat-label">Avg. View Time</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="engagementRateStat">0%</div>
                        <div class="stat-label">Engagement Rate</div>
                    </div>
                </div>
                
                <div class="recent-viewers">
                    <div class="recent-viewers-title">Top Viewers</div>
                    <div id="recentViewersList">
                        <!-- Viewers will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Schedule Modal -->
    <div class="create-status-modal" id="scheduleModal">
        <div class="create-status-container">
            <div class="create-status-header">
                <h3>Schedule Status</h3>
                <button class="create-status-btn" id="closeScheduleModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="create-status-content">
                <div class="metadata-section">
                    <div class="metadata-title">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Select Date & Time</span>
                    </div>
                    <div class="schedule-datetime-picker">
                        <div class="schedule-date">
                            <input type="date" id="scheduleDate" class="text-input">
                        </div>
                        <div class="schedule-time">
                            <input type="time" id="scheduleTime" class="text-input">
                        </div>
                    </div>
                </div>
                
                <div class="metadata-section">
                    <div class="metadata-title">
                        <i class="fas fa-redo"></i>
                        <span>Repeat</span>
                    </div>
                    <div class="repeat-options" id="repeatOptions">
                        <div class="repeat-option" data-repeat="none">
                            Don't repeat
                        </div>
                        <div class="repeat-option" data-repeat="daily">
                            Daily
                        </div>
                        <div class="repeat-option" data-repeat="weekly">
                            Weekly
                        </div>
                        <div class="repeat-option" data-repeat="monthly">
                            Monthly
                        </div>
                    </div>
                </div>
                
                <div class="notification-settings">
                    <div class="notification-option">
                        <div class="notification-label">
                            <h4>Notification</h4>
                            <p>Notify me before posting</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="scheduleNotificationToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="notification-option">
                        <div class="notification-label">
                            <h4>Notification Time</h4>
                            <p>When to send notification</p>
                        </div>
                        <select class="text-input w-auto" id="notificationTimeSelect" disabled>
                            <option value="5">5 minutes before</option>
                            <option value="15">15 minutes before</option>
                            <option value="30">30 minutes before</option>
                            <option value="60">1 hour before</option>
                        </select>
                    </div>
                </div>
                
                <div class="metadata-section">
                    <div class="metadata-title">
                        <i class="fas fa-list"></i>
                        <span>Scheduled Statuses</span>
                    </div>
                    <div class="schedule-list" id="scheduledStatusesList">
                        <!-- Scheduled statuses will be loaded here -->
                    </div>
                </div>
            </div>
            <div style="padding: 20px; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between;">
                <button class="action-btn secondary" id="cancelScheduleBtn">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="action-btn success" id="confirmScheduleBtn">
                    <i class="fas fa-clock"></i> Schedule Status
                </button>
            </div>
        </div>
    </div>
    
    <!-- Report Modal -->
    <div class="create-status-modal" id="reportModal">
        <div class="create-status-container">
            <div class="create-status-header">
                <h3>Report Status</h3>
                <button class="create-status-btn" id="closeReportModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="create-status-content">
                <div class="metadata-section">
                    <div class="metadata-title">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Reason for Reporting</span>
                    </div>
                    <div class="category-options" id="reportReasons">
                        <!-- Report reasons will be loaded here -->
                    </div>
                </div>
                
                <div class="report-details">
                    <div class="metadata-title">
                        <i class="fas fa-comment"></i>
                        <span>Additional Details (Required)</span>
                    </div>
                    <textarea class="text-input" id="reportDetails" placeholder="Please explain why you are reporting this status..." rows="4"></textarea>
                    <div class="text-right mt-10">
                        <span id="reportDetailsCounter">0/500</span>
                    </div>
                </div>
                
                <div class="metadata-section mt-20">
                    <div class="metadata-title">
                        <i class="fas fa-shield-alt"></i>
                        <span>Report Anonymously</span>
                    </div>
                    <label class="toggle-switch" style="display: flex; align-items: center; gap: 15px;">
                        <span style="flex: 1;">Submit report anonymously</span>
                        <input type="checkbox" id="anonymousReportToggle">
                        <span class="toggle-slider"></span>
                    </label>
                    <p style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
                        Your identity will not be shared with the reported user
                    </p>
                </div>
            </div>
            <div style="padding: 20px; border-top: 1px solid var(--border-color); display: flex; justify-content: space-between;">
                <button class="action-btn secondary" id="cancelReportBtn">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="action-btn danger" id="submitReportBtn" disabled>
                    <i class="fas fa-flag"></i> Submit Report
                </button>
            </div>
        </div>
    </div>
    
    <div class="app-container">
        <!-- Sidebar with status list -->
        <div class="sidebar active" id="sidebar">
            <div class="sidebar-header">
                <h2>Status</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="create-status-btn" id="viewHighlightsBtn" title="View Highlights">
                        <i class="fas fa-star"></i>
                    </button>
                    <button class="create-status-btn" id="viewDraftsBtn" title="View Drafts">
                        <i class="fas fa-file-alt"></i>
                    </button>
                    <button class="create-status-btn" id="createStatusBtn" title="Create new status">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>
            
            <div class="status-categories">
                <button class="category-btn active" id="allTab">All Status</button>
                <button class="category-btn" id="friendsTab">Friends</button>
                <button class="category-btn" id="closeFriendsTab">Close Friends</button>
                <button class="category-btn" id="pinnedTab">Pinned</button>
                <button class="category-btn" id="mutedTab">Muted</button>
                <button class="category-btn" id="microCirclesTab">Micro Circles</button>
                <button class="category-btn" id="myStatusTab" style="display: none;">My Status</button>
            </div>
            
            <!-- Filter Tags -->
            <div class="filter-tags" id="filterTags">
                <button class="clear-filters-btn" id="clearFiltersBtn" style="display: none;">
                    <i class="fas fa-times"></i> Clear Filters
                </button>
            </div>
            
            <!-- My Status Preview -->
            <div class="my-status-preview" id="myStatusPreview">
                <div class="my-status-avatar">
                    <div class="my-status-avatar-ring" id="myStatusRing">
                        <div class="my-status-avatar-inner" id="myStatusAvatar">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                </div>
                <div class="my-status-info">
                    <div class="my-status-name">My Status</div>
                    <div class="my-status-text">
                        <div class="my-status-indicator" id="myStatusIndicator"></div>
                        <span id="myStatusText">No recent status</span>
                    </div>
                </div>
                <button class="status-action-btn" id="viewMyStatusBtn" title="View my status">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="status-action-btn" id="editMyStatusBtn" title="Edit my status">
                    <i class="fas fa-edit"></i>
                </button>
            </div>
            
            <!-- Streak Counter -->
            <div class="streak-counter">
                <div class="streak-info">
                    <div class="streak-icon">
                        <i class="fas fa-fire"></i>
                    </div>
                    <div class="streak-details">
                        <h4>Posting Streak</h4>
                        <p>Daily status updates</p>
                    </div>
                </div>
                <div class="streak-count" id="streakCount">0</div>
            </div>
            
            <!-- Mood Trends -->
            <div class="mood-trends">
                <h4>Mood Trends (Last 30 days)</h4>
                <div class="mood-chart" id="moodChart">
                    <!-- Mood chart bars will be loaded here -->
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="quick-actions">
                <button class="quick-action-btn" id="viewTimelineBtn" title="Memory Timeline">
                    <div class="quick-action-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <div class="quick-action-text">Timeline</div>
                </button>
                <button class="quick-action-btn" id="viewStatsBtn" title="View Stats">
                    <div class="quick-action-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="quick-action-text">Analytics</div>
                </button>
                <button class="quick-action-btn" id="viewScheduledBtn" title="View Scheduled">
                    <div class="quick-action-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="quick-action-text">Scheduled</div>
                </button>
            </div>
            
            <!-- Intent & Mood Filters -->
            <div class="status-categories" style="border-top: 1px solid var(--border-color);">
                <button class="category-btn" data-filter="intent-feedback">Feedback</button>
                <button class="category-btn" data-filter="intent-achievement">Achievement</button>
                <button class="category-btn" data-filter="intent-advice">Advice</button>
                <button class="category-btn" data-filter="mood-happy">Happy</button>
                <button class="category-btn" data-filter="mood-motivated">Motivated</button>
            </div>
            
            <div class="status-list">
                <div class="status-list-content">
                    <!-- All Status Section -->
                    <div class="statuses-section active" id="allStatusSection">
                        <div class="statuses-list" id="allStatusList">
                            <div class="enhanced-loading">
                                <i class="fas fa-spinner"></i>
                                <p>Loading statuses...</p>
                                <div class="loading-progress">
                                    <div class="loading-progress-bar"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Friends Status Section -->
                    <div class="statuses-section" id="friendsStatusSection">
                        <div class="statuses-list" id="friendsStatusList">
                            <!-- Friends statuses will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Close Friends Status Section -->
                    <div class="statuses-section" id="closeFriendsStatusSection">
                        <div class="statuses-list" id="closeFriendsStatusList">
                            <!-- Close friends statuses will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Pinned Status Section -->
                    <div class="statuses-section" id="pinnedStatusSection">
                        <div class="statuses-list" id="pinnedStatusList">
                            <!-- Pinned statuses will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Muted Status Section -->
                    <div class="statuses-section" id="mutedStatusSection">
                        <div class="statuses-list" id="mutedStatusList">
                            <!-- Muted statuses will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Micro Circles Status Section -->
                    <div class="statuses-section" id="microCirclesStatusSection">
                        <div class="statuses-list" id="microCirclesStatusList">
                            <!-- Micro circles statuses will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- My Status Section -->
                    <div class="statuses-section" id="myStatusSection">
                        <div class="statuses-list" id="myStatusList">
                            <!-- My statuses will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Status Viewer Panel -->
        <div class="status-viewer-panel" id="statusViewerPanel">
            <div class="viewer-header">
                <button class="viewer-back-btn" id="viewerBackBtn">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="viewer-user-info" id="viewerUserInfo">
                    <!-- User info will be loaded here -->
                </div>
                <div class="viewer-controls">
                    <button class="viewer-control-btn" id="pauseResumeBtn" title="Pause/Resume">
                        <i class="fas fa-pause"></i>
                    </button>
                    <button class="viewer-control-btn" id="muteUserBtn" title="Mute User">
                        <i class="fas fa-volume-mute"></i>
                    </button>
                    <button class="viewer-control-btn" id="shareStatusBtn" title="Share">
                        <i class="fas fa-share"></i>
                    </button>
                    <button class="viewer-control-btn" id="saveStatusBtn" title="Save to Highlights">
                        <i class="fas fa-bookmark"></i>
                    </button>
                    <button class="viewer-control-btn" id="reportStatusBtn" title="Report">
                        <i class="fas fa-flag"></i>
                    </button>
                </div>
            </div>
            
            <!-- Progress Indicators -->
            <div class="progress-indicators" id="progressIndicators">
                <!-- Progress bars will be loaded here -->
            </div>
            
            <div class="viewer-content" id="viewerContent">
                <!-- Status slides will be loaded here -->
            </div>
            
            <!-- Action Buttons Overlay -->
            <div class="action-buttons-overlay" id="actionButtonsOverlay">
                <!-- Action buttons will be loaded here -->
            </div>
            
            <div class="viewer-footer">
                <!-- Reactions -->
                <div class="reactions-container" id="reactionsContainer">
                    <!-- Reaction buttons will be loaded here -->
                </div>
                
                <!-- Reply Input -->
                <div class="reply-input-container">
                    <input type="text" class="reply-input" id="replyInput" placeholder="Type a reply...">
                    <button class="send-reply-btn" id="sendReplyBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Operation completed successfully</span>
        <button class="close-btn" id="closeNotificationBtn" style="margin-left: auto;">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <!-- Error UI -->
    <div class="error-ui" id="errorUI">
        <div class="error-container">
            <div class="error-icon">
                <i class="fas fa-exclamation-circle"></i>
            </div>
            <div class="error-title" id="errorTitle">Connection Error</div>
            <div class="error-message" id="errorMessage">Unable to connect to the server. Please check your internet connection.</div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="action-btn secondary" id="retryConnectionBtn">
                    <i class="fas fa-redo"></i> Retry
                </button>
                <button class="action-btn primary" id="offlineModeBtn">
                    <i class="fas fa-wifi-slash"></i> Use Offline
                </button>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // STATUS SYSTEM - USING PARENT API
        // =============================================

        // Global variables
        let currentUser = null;
        let userData = null;
        let statuses = [];
        let myStatuses = [];
        let friendsStatuses = [];
        let closeFriendsStatuses = [];
        let pinnedStatuses = [];
        let mutedStatuses = [];
        let microCirclesStatuses = [];
        let highlights = [];
        let drafts = [];
        let scheduledStatuses = [];
        let viewedStatuses = new Set();
        let mutedUsers = new Set();
        let currentViewerStatus = null;
        let currentSlideIndex = 0;
        let autoAdvanceInterval = null;
        let isAutoAdvancePaused = false;
        let progressInterval = null;
        let currentCategoryFilter = 'all';
        let currentIntentFilter = null;
        let currentMoodFilter = null;
        let isMobile = window.innerWidth <= 768;
        let isOfflineMode = false;
        let pendingReplies = [];
        let pendingReactions = [];
        let moodChartData = [];
        let streakCount = 0;
        let lastPostDate = null;
        let activeFilters = new Set();
        let selectedDraft = null;
        
        // Status types
        const statusTypes = {
            'text': {
                name: 'Text Status',
                icon: 'fas fa-font',
                color: 'var(--primary-color)'
            },
            'media': {
                name: 'Media Status',
                icon: 'fas fa-image',
                color: 'var(--success-color)'
            },
            'poll': {
                name: 'Poll Status',
                icon: 'fas fa-poll',
                color: 'var(--warning-color)'
            }
        };
        
        // Status intents
        const statusIntents = {
            'feedback': {
                name: 'Looking for feedback',
                icon: 'fas fa-comments',
                color: 'var(--intent-feedback)'
            },
            'achievement': {
                name: 'Sharing achievement',
                icon: 'fas fa-trophy',
                color: 'var(--intent-achievement)'
            },
            'advice': {
                name: 'Need advice',
                icon: 'fas fa-hands-helping',
                color: 'var(--intent-advice)'
            },
            'chat': {
                name: 'Available to chat',
                icon: 'fas fa-comment-dots',
                color: 'var(--intent-chat)'
            },
            'venting': {
                name: 'Just venting',
                icon: 'fas fa-wind',
                color: 'var(--intent-venting)'
            },
            'reflection': {
                name: 'Personal reflection',
                icon: 'fas fa-brain',
                color: 'var(--intent-reflection)'
            },
            'question': {
                name: 'Asking a question',
                icon: 'fas fa-question-circle',
                color: 'var(--intent-question)'
            },
            'celebration': {
                name: 'Celebration',
                icon: 'fas fa-glass-cheers',
                color: 'var(--intent-celebration)'
            }
        };
        
        // Moods
        const statusMoods = {
            'happy': {
                name: 'Happy',
                emoji: '',
                color: 'var(--mood-happy)'
            },
            'stressed': {
                name: 'Stressed',
                emoji: '',
                color: 'var(--mood-stressed)'
            },
            'motivated': {
                name: 'Motivated',
                emoji: '',
                color: 'var(--mood-motivated)'
            },
            'lonely': {
                name: 'Lonely',
                emoji: '',
                color: 'var(--mood-lonely)'
            },
            'excited': {
                name: 'Excited',
                emoji: '',
                color: 'var(--mood-excited)'
            },
            'calm': {
                name: 'Calm',
                emoji: '',
                color: 'var(--mood-calm)'
            },
            'sad': {
                name: 'Sad',
                emoji: '',
                color: 'var(--mood-sad)'
            },
            'angry': {
                name: 'Angry',
                emoji: '',
                color: 'var(--mood-angry)'
            }
        };
        
        // Categories
        const statusCategories = {
            'life': {
                name: 'Life',
                icon: 'fas fa-heart',
                color: 'var(--category-life)'
            },
            'business': {
                name: 'Business',
                icon: 'fas fa-briefcase',
                color: 'var(--category-business)'
            },
            'study': {
                name: 'Study',
                icon: 'fas fa-graduation-cap',
                color: 'var(--category-study)'
            },
            'motivation': {
                name: 'Motivation',
                icon: 'fas fa-fire',
                color: 'var(--category-motivation)'
            },
            'event': {
                name: 'Event',
                icon: 'fas fa-calendar-alt',
                color: 'var(--category-event)'
            }
        };
        
        // Action buttons
        const actionButtons = {
            'message': {
                name: 'Message me',
                icon: 'fas fa-comments',
                color: 'var(--primary-color)'
            },
            'join': {
                name: 'Join discussion',
                icon: 'fas fa-users',
                color: 'var(--success-color)'
            },
            'vote': {
                name: 'Vote now',
                icon: 'fas fa-vote-yea',
                color: 'var(--warning-color)'
            },
            'book': {
                name: 'Book a call',
                icon: 'fas fa-phone',
                color: 'var(--info-color)'
            },
            'learn': {
                name: 'Learn more',
                icon: 'fas fa-book',
                color: 'var(--primary-color)'
            },
            'support': {
                name: 'Show support',
                icon: 'fas fa-hands-helping',
                color: 'var(--success-color)'
            },
            'collaborate': {
                name: 'Collaborate',
                icon: 'fas fa-handshake',
                color: 'var(--warning-color)'
            },
            'resource': {
                name: 'View resource',
                icon: 'fas fa-external-link-alt',
                color: 'var(--info-color)'
            }
        };
        
        // Privacy settings
        const privacySettings = {
            'everyone': {
                name: 'Everyone',
                description: 'Visible to all Knecta users',
                icon: 'fas fa-globe'
            },
            'friends': {
                name: 'Friends Only',
                description: 'Visible to your friends only',
                icon: 'fas fa-user-friends'
            },
            'close-friends': {
                name: 'Close Friends',
                description: 'Visible to close friends only',
                icon: 'fas fa-heart'
            },
            'except': {
                name: 'All Except...',
                description: 'Hide from specific people',
                icon: 'fas fa-user-minus'
            },
            'specific': {
                name: 'Specific People...',
                description: 'Share with select individuals',
                icon: 'fas fa-user-check'
            },
            'micro-circle': {
                name: 'Micro Circle',
                description: 'Share with a specific group',
                icon: 'fas fa-users'
            }
        };
        
        // Duration options
        const durationOptions = {
            '3600': '1 hour',
            '21600': '6 hours',
            '43200': '12 hours',
            '86400': '24 hours',
            '0': 'Permanent'
        };
        
        // Report reasons
        const reportReasons = {
            'spam': 'Spam',
            'inappropriate': 'Inappropriate Content',
            'harassment': 'Harassment',
            'false-info': 'False Information',
            'violence': 'Violence',
            'hate-speech': 'Hate Speech',
            'self-harm': 'Self-Harm',
            'copyright': 'Copyright Violation'
        };
        
        // Reactions
        const reactions = {
            'like': '',
            'love': '',
            'helpful': '',
            'inspiring': '',
            'funny': '',
            'not-useful': ''
        };
        
        // Emojis for picker
        const emojis = ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''];
        
        // Background options
        const backgroundOptions = [
            { id: '1', type: 'solid', color: 'var(--status-bg-1)' },
            { id: '2', type: 'solid', color: 'var(--status-bg-2)' },
            { id: '3', type: 'solid', color: 'var(--status-bg-3)' },
            { id: '4', type: 'solid', color: 'var(--status-bg-4)' },
            { id: '5', type: 'solid', color: 'var(--status-bg-5)' },
            { id: '6', type: 'solid', color: 'var(--status-bg-6)' },
            { id: '7', type: 'solid', color: 'var(--status-bg-7)' },
            { id: '8', type: 'solid', color: 'var(--status-bg-8)' },
            { id: 'gradient-1', type: 'gradient', gradient: 'linear-gradient(45deg, #667eea, #764ba2)' },
            { id: 'gradient-2', type: 'gradient', gradient: 'linear-gradient(45deg, #f6d365, #fda085)' },
            { id: 'gradient-3', type: 'gradient', gradient: 'linear-gradient(45deg, #a8edea, #fed6e3)' },
            { id: 'gradient-4', type: 'gradient', gradient: 'linear-gradient(45deg, #ff6b6b, #ffa726)' }
        ];
        
        // Templates
        const statusTemplates = {
            'motivation': {
                name: 'Motivation',
                text: 'Today is a new opportunity to be better than yesterday. Keep pushing forward! ',
                background: 'gradient-2',
                mood: 'motivated',
                intent: 'reflection'
            },
            'question': {
                name: 'Question',
                text: 'What\'s the best piece of advice you\'ve ever received? ',
                background: '3',
                mood: 'curious',
                intent: 'question'
            },
            'achievement': {
                name: 'Achievement',
                text: 'Just reached a personal milestone! Celebrating small wins along the way. ',
                background: 'gradient-1',
                mood: 'happy',
                intent: 'achievement'
            },
            'reflection': {
                name: 'Reflection',
                text: 'Taking a moment to reflect on what truly matters in life. Peace comes from within. ',
                background: '6',
                mood: 'calm',
                intent: 'reflection'
            }
        };
        
        // DOM Elements
        const createStatusModal = document.getElementById('createStatusModal');
        const draftsModal = document.getElementById('draftsModal');
        const highlightsModal = document.getElementById('highlightsModal');
        const highlightsEditorModal = document.getElementById('highlightsEditorModal');
        const memoryTimelineModal = document.getElementById('memoryTimelineModal');
        const statsModal = document.getElementById('statsModal');
        const scheduleModal = document.getElementById('scheduleModal');
        const reportModal = document.getElementById('reportModal');
        const statusViewerPanel = document.getElementById('statusViewerPanel');
        const notification = document.getElementById('notification');
        const errorUI = document.getElementById('errorUI');
        
        // Status sections
        const allStatusSection = document.getElementById('allStatusSection');
        const friendsStatusSection = document.getElementById('friendsStatusSection');
        const closeFriendsStatusSection = document.getElementById('closeFriendsStatusSection');
        const pinnedStatusSection = document.getElementById('pinnedStatusSection');
        const mutedStatusSection = document.getElementById('mutedStatusSection');
        const microCirclesStatusSection = document.getElementById('microCirclesStatusSection');
        const myStatusSection = document.getElementById('myStatusSection');
        
        const allStatusList = document.getElementById('allStatusList');
        const friendsStatusList = document.getElementById('friendsStatusList');
        const closeFriendsStatusList = document.getElementById('closeFriendsStatusList');
        const pinnedStatusList = document.getElementById('pinnedStatusList');
        const mutedStatusList = document.getElementById('mutedStatusList');
        const microCirclesStatusList = document.getElementById('microCirclesStatusList');
        const myStatusList = document.getElementById('myStatusList');
        
        // Local Storage Keys
        const LOCAL_STORAGE_KEYS = {
            USER: 'knecta_current_user',
            USER_TOKEN: 'knecta_user_token',
            STATUSES: 'knecta_statuses_cache',
            MY_STATUSES: 'knecta_my_statuses_cache',
            VIEWED_STATUSES: 'knecta_viewed_statuses',
            MUTED_USERS: 'knecta_muted_users',
            HIGHLIGHTS: 'knecta_status_highlights',
            DRAFTS: 'knecta_status_drafts',
            SCHEDULED: 'knecta_scheduled_statuses',
            PENDING_REPLIES: 'knecta_pending_replies',
            PENDING_REACTIONS: 'knecta_pending_reactions',
            MOOD_DATA: 'knecta_mood_data',
            STREAK: 'knecta_posting_streak',
            LAST_POST_DATE: 'knecta_last_post_date',
            OFFLINE_QUEUE: 'knecta_offline_status_queue',
            LAST_SYNC: 'knecta_status_last_sync'
        };
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('Status page loaded');
            
            // Check if we're already in an iframe with API available
            if (window.parent && window.parent.api) {
                console.log('Parent API available immediately');
                await initializeStatusSystem();
            } else {
                console.log('Waiting for API ready event...');
                // Show loading state
                showNotification('Connecting to server...', 'info');
                
                // Request API ready event
                if (window.parent) {
                    window.parent.postMessage({ type: 'REQUEST_API_READY' }, '*');
                }
                
                // Fallback: Try to initialize after a delay
                setTimeout(async () => {
                    if (window.parent && window.parent.api) {
                        console.log('API found after timeout');
                        await initializeStatusSystem();
                    } else {
                        console.log('API not available, using cached data');
                        loadCachedDataInstantly();
                        setupEventListeners();
                        showNotification('Using offline mode', 'warning');
                        isOfflineMode = true;
                    }
                }, 2000);
            }
            
            // Load cached data instantly
            loadCachedDataInstantly();
        });
        
        // Initialize status system
        async function initializeStatusSystem() {
            console.log('=== INITIALIZING STATUS SYSTEM ===');
            
            try {
                // Get API from parent
                const api = window.parent.api;
                if (!api) {
                    throw new Error('API not available in parent window');
                }
                
                console.log('API available:', typeof api);
                
                // Get current user
                try {
                    const userResponse = await api.get('/api/auth/user');
                    if (userResponse && userResponse.user) {
                        currentUser = userResponse.user;
                        userData = currentUser;
                        console.log('Current user loaded:', currentUser.id);
                        
                        // Save to cache
                        localStorage.setItem(LOCAL_STORAGE_KEYS.USER, JSON.stringify({
                            uid: currentUser.id,
                            id: currentUser.id,
                            displayName: currentUser.displayName,
                            email: currentUser.email,
                            photoURL: currentUser.photoURL
                        }));
                    }
                } catch (userError) {
                    console.log('Could not load user from API, using cache:', userError.message);
                    await loadUserFromCache();
                }
                
                // Setup event listeners
                setupEventListeners();
                
                // Initialize UI components
                initializeUIComponents();
                
                // Load initial data
                await loadInitialData();
                
                // Update my status preview
                updateMyStatusPreview();
                
                // Update streak counter
                updateStreakCounter();
                
                // Update mood chart
                updateMoodChart();
                
                showNotification('Status system ready', 'success');
                console.log('=== STATUS SYSTEM INITIALIZED SUCCESSFULLY ===');
                
            } catch (error) {
                console.error('Error initializing status system:', error);
                showNotification('Could not connect to server', 'error');
                
                // Fallback to cached data
                loadCachedDataInstantly();
                setupEventListeners();
                initializeUIComponents();
                updateCurrentSection();
                errorUI.classList.add('active');
            }
        }
        
        // Load user from cache
        async function loadUserFromCache() {
            try {
                const cachedUser = localStorage.getItem(LOCAL_STORAGE_KEYS.USER);
                if (cachedUser) {
                    currentUser = JSON.parse(cachedUser);
                    console.log('Loaded user from cache:', currentUser.id);
                } else {
                    currentUser = {
                        id: 'local_user_' + Date.now(),
                        displayName: 'Local User',
                        email: '',
                        photoURL: ''
                    };
                }
            } catch (error) {
                console.error('Error loading user from cache:', error);
                currentUser = {
                    id: 'fallback_user_' + Date.now(),
                    displayName: 'User',
                    email: '',
                    photoURL: ''
                };
            }
        }
        
        // Load cached data instantly for offline use
        function loadCachedDataInstantly() {
            console.log('Loading cached data instantly...');
            
            try {
                // Load user from cache
                const cachedUser = localStorage.getItem(LOCAL_STORAGE_KEYS.USER);
                if (cachedUser) {
                    currentUser = JSON.parse(cachedUser);
                    console.log('Loaded user from cache');
                }
                
                // Load statuses
                const statusesData = localStorage.getItem(LOCAL_STORAGE_KEYS.STATUSES);
                if (statusesData) {
                    statuses = JSON.parse(statusesData);
                    console.log('Loaded statuses from cache:', statuses.length);
                }
                
                // Load my statuses
                const myStatusesData = localStorage.getItem(LOCAL_STORAGE_KEYS.MY_STATUSES);
                if (myStatusesData) {
                    myStatuses = JSON.parse(myStatusesData);
                }
                
                // Load viewed statuses
                const viewedStatusesData = localStorage.getItem(LOCAL_STORAGE_KEYS.VIEWED_STATUSES);
                if (viewedStatusesData) {
                    viewedStatuses = new Set(JSON.parse(viewedStatusesData));
                }
                
                // Load muted users
                const mutedUsersData = localStorage.getItem(LOCAL_STORAGE_KEYS.MUTED_USERS);
                if (mutedUsersData) {
                    mutedUsers = new Set(JSON.parse(mutedUsersData));
                }
                
                // Load highlights
                const highlightsData = localStorage.getItem(LOCAL_STORAGE_KEYS.HIGHLIGHTS);
                if (highlightsData) {
                    highlights = JSON.parse(highlightsData);
                }
                
                // Load drafts
                const draftsData = localStorage.getItem(LOCAL_STORAGE_KEYS.DRAFTS);
                if (draftsData) {
                    drafts = JSON.parse(draftsData);
                }
                
                // Load scheduled statuses
                const scheduledData = localStorage.getItem(LOCAL_STORAGE_KEYS.SCHEDULED);
                if (scheduledData) {
                    scheduledStatuses = JSON.parse(scheduledData);
                }
                
                // Load pending replies
                const pendingRepliesData = localStorage.getItem(LOCAL_STORAGE_KEYS.PENDING_REPLIES);
                if (pendingRepliesData) {
                    pendingReplies = JSON.parse(pendingRepliesData);
                }
                
                // Load pending reactions
                const pendingReactionsData = localStorage.getItem(LOCAL_STORAGE_KEYS.PENDING_REACTIONS);
                if (pendingReactionsData) {
                    pendingReactions = JSON.parse(pendingReactionsData);
                }
                
                // Load mood data
                const moodData = localStorage.getItem(LOCAL_STORAGE_KEYS.MOOD_DATA);
                if (moodData) {
                    moodChartData = JSON.parse(moodData);
                }
                
                // Load streak data
                const streakData = localStorage.getItem(LOCAL_STORAGE_KEYS.STREAK);
                if (streakData) {
                    streakCount = parseInt(streakData);
                    document.getElementById('streakCount').textContent = streakCount;
                }
                
                // Load last post date
                const lastPostDateData = localStorage.getItem(LOCAL_STORAGE_KEYS.LAST_POST_DATE);
                if (lastPostDateData) {
                    lastPostDate = new Date(lastPostDateData);
                }
                
                console.log('Cached data loaded successfully');
                
                // Render status list instantly
                renderStatusListInstantly();
                
            } catch (error) {
                console.error('Error loading cached data:', error);
            }
        }
        
        // Render status list instantly from cache
        function renderStatusListInstantly() {
            if (!allStatusList) return;
            
            allStatusList.innerHTML = '';
            
            if (statuses.length === 0) {
                allStatusList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-comment-dots"></i>
                        <p>No statuses yet</p>
                        <p class="subtext">Be the first to post a status!</p>
                    </div>
                `;
                return;
            }
            
            const fragment = document.createDocumentFragment();
            
            statuses.slice(0, 20).forEach(status => {
                addStatusItemInstant(status, fragment);
            });
            
            allStatusList.appendChild(fragment);
            allStatusList.classList.add('instant-load');
        }
        
        // Add status item instantly (for offline cache display)
        function addStatusItemInstant(statusData, container) {
            const statusItem = document.createElement('div');
            statusItem.className = 'status-item';
            statusItem.dataset.statusId = statusData.id;
            statusItem.dataset.userId = statusData.userId;
            
            const user = statusData.user || { displayName: 'Unknown User', photoURL: '', id: statusData.userId };
            const initials = user.displayName ? 
                user.displayName.split(' ').map(word => word[0]).join('').toUpperCase().substring(0, 2) : 
                'U';
            
            const isViewed = viewedStatuses.has(statusData.id);
            const isPinned = statusData.isPinned || false;
            const isMuted = mutedUsers.has(statusData.userId);
            const mood = statusData.mood || 'happy';
            const intent = statusData.intent || 'reflection';
            const category = statusData.category || 'life';
            
            let previewText = '';
            if (statusData.type === 'text') {
                previewText = statusData.text || 'Text status';
            } else if (statusData.type === 'media') {
                previewText = `<i class="fas fa-image"></i> Media status`;
                if (statusData.caption) {
                    previewText += `: ${statusData.caption}`;
                }
            } else if (statusData.type === 'poll') {
                previewText = `<i class="fas fa-poll"></i> Poll: ${statusData.question || 'Poll status'}`;
            }
            
            const timeAgo = statusData.createdAt ? formatTimeAgo(new Date(statusData.createdAt)) : 'Just now';
            
            statusItem.innerHTML = `
                <div class="status-avatar">
                    <div class="status-ring ${isViewed ? 'viewed' : ''}"></div>
                    <div class="status-avatar-inner" ${user.photoURL ? `style="background-image: url('${escapeHtml(user.photoURL)}')"` : ''}>
                        ${user.photoURL ? '' : `<span>${initials}</span>`}
                    </div>
                    <div class="status-indicators">
                        ${mood ? `<div class="status-indicator mood" style="background-color: ${statusMoods[mood]?.color || 'var(--mood-happy)'}" title="${statusMoods[mood]?.name || 'Mood'}"></div>` : ''}
                        ${intent ? `<div class="status-indicator intent" style="background-color: ${statusIntents[intent]?.color || 'var(--intent-feedback)'}" title="${statusIntents[intent]?.name || 'Intent'}"></div>` : ''}
                        ${isPinned ? `<div class="status-indicator pinned" title="Pinned Status"></div>` : ''}
                        ${isMuted ? `<div class="status-indicator muted" title="Muted User"></div>` : ''}
                    </div>
                </div>
                <div class="status-info">
                    <div class="status-name">
                        <span class="status-name-text">${escapeHtml(user.displayName || 'Unknown User')}</span>
                        <span class="status-time">${timeAgo}</span>
                    </div>
                    <div class="status-details">
                        <span class="status-type" style="color: ${statusTypes[statusData.type]?.color || 'var(--primary-color)'}">
                            <i class="${statusTypes[statusData.type]?.icon || 'fas fa-comment'}"></i>
                            ${statusTypes[statusData.type]?.name || 'Status'}
                        </span>
                        ${statusData.isSensitive ? '<span class="status-tag privacy"><i class="fas fa-eye-slash"></i> Sensitive</span>' : ''}
                        ${statusData.isSilent ? '<span class="status-tag privacy"><i class="fas fa-bell-slash"></i> Silent</span>' : ''}
                    </div>
                    <div class="status-preview ${statusData.type === 'media' || statusData.type === 'poll' ? statusData.type : ''}">
                        ${previewText}
                    </div>
                    <div class="status-tags">
                        ${mood ? `<span class="status-tag mood"><i class="fas fa-brain"></i> ${statusMoods[mood]?.name || 'Mood'}</span>` : ''}
                        ${intent ? `<span class="status-tag intent"><i class="fas fa-bullseye"></i> ${statusIntents[intent]?.name || 'Intent'}</span>` : ''}
                        ${category ? `<span class="status-tag category"><i class="${statusCategories[category]?.icon || 'fas fa-tag'}"></i> ${statusCategories[category]?.name || 'Category'}</span>` : ''}
                        ${statusData.privacy ? `<span class="status-tag privacy"><i class="${privacySettings[statusData.privacy]?.icon || 'fas fa-lock'}"></i> ${privacySettings[statusData.privacy]?.name || 'Privacy'}</span>` : ''}
                    </div>
                </div>
                <div class="status-actions">
                    <button class="status-action-btn" data-action="view" title="View Status">
                        <i class="fas fa-eye"></i>
                    </button>
                    ${isPinned ? `
                    <button class="status-action-btn warning" data-action="unpin" title="Unpin Status">
                        <i class="fas fa-thumbtack"></i>
                    </button>
                    ` : `
                    <button class="status-action-btn" data-action="pin" title="Pin Status">
                        <i class="fas fa-thumbtack"></i>
                    </button>
                    `}
                    ${isMuted ? `
                    <button class="status-action-btn" data-action="unmute" title="Unmute User">
                        <i class="fas fa-volume-up"></i>
                    </button>
                    ` : `
                    <button class="status-action-btn" data-action="mute" title="Mute User">
                        <i class="fas fa-volume-mute"></i>
                    </button>
                    `}
                </div>
            `;
            
            statusItem.addEventListener('click', (e) => {
                if (!e.target.closest('.status-actions')) {
                    showStatusViewer(statusData);
                }
            });
            
            const actionButtons = statusItem.querySelectorAll('.status-action-btn');
            actionButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const action = btn.dataset.action;
                    handleStatusAction(action, statusData, btn);
                });
            });
            
            container.appendChild(statusItem);
        }
        
        // Initialize UI components
        function initializeUIComponents() {
            // Initialize emoji picker
            initializeEmojiPicker();
            
            // Initialize background options
            initializeBackgroundOptions();
            
            // Initialize intent options
            initializeIntentOptions();
            
            // Initialize mood options
            initializeMoodOptions();
            
            // Initialize category options
            initializeCategoryOptions();
            
            // Initialize action buttons selector
            initializeActionButtonsSelector();
            
            // Initialize privacy options
            initializePrivacyOptions();
            
            // Initialize duration options
            initializeDurationOptions();
            
            // Initialize template options
            initializeTemplateOptions();
            
            // Initialize report reasons
            initializeReportReasons();
            
            // Initialize reactions
            initializeReactions();
            
            // Initialize poll options
            initializePollOptions();
            
            // Initialize highlight color options
            initializeHighlightColorOptions();
            
            // Initialize highlight privacy options
            initializeHighlightPrivacyOptions();
            
            // Initialize repeat options
            initializeRepeatOptions();
        }
        
        // Initialize emoji picker
        function initializeEmojiPicker() {
            const emojiGrid = document.getElementById('emojiGrid');
            if (!emojiGrid) return;
            
            emojiGrid.innerHTML = '';
            emojis.forEach(emoji => {
                const emojiBtn = document.createElement('button');
                emojiBtn.className = 'emoji-btn';
                emojiBtn.textContent = emoji;
                emojiBtn.title = `Add ${emoji}`;
                emojiBtn.addEventListener('click', () => {
                    const textInput = document.getElementById('textStatusInput');
                    if (textInput) {
                        textInput.value += emoji;
                        textInput.focus();
                        updateTextStatusCounter();
                    }
                });
                emojiGrid.appendChild(emojiBtn);
            });
        }
        
        // Initialize background options
        function initializeBackgroundOptions() {
            const backgroundGrid = document.getElementById('backgroundGrid');
            if (!backgroundGrid) return;
            
            backgroundGrid.innerHTML = '';
            backgroundOptions.forEach(bg => {
                const bgOption = document.createElement('div');
                bgOption.className = 'background-option';
                bgOption.dataset.bg = bg.id;
                bgOption.dataset.type = bg.type;
                
                if (bg.type === 'solid') {
                    bgOption.style.backgroundColor = bg.color;
                    bgOption.textContent = 'A';
                } else if (bg.type === 'gradient') {
                    bgOption.style.background = bg.gradient;
                    bgOption.textContent = 'G';
                }
                
                bgOption.title = `Background ${bg.id}`;
                bgOption.addEventListener('click', () => {
                    document.querySelectorAll('.background-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    bgOption.classList.add('selected');
                    localStorage.setItem('selected_background', bg.id);
                });
                
                backgroundGrid.appendChild(bgOption);
            });
            
            // Select first background by default
            const firstBg = backgroundGrid.querySelector('.background-option');
            if (firstBg) {
                firstBg.classList.add('selected');
            }
        }
        
        // Initialize intent options
        function initializeIntentOptions() {
            const intentOptions = document.getElementById('intentOptions');
            if (!intentOptions) return;
            
            intentOptions.innerHTML = '';
            Object.entries(statusIntents).forEach(([key, intent]) => {
                const intentOption = document.createElement('div');
                intentOption.className = 'intent-option';
                intentOption.dataset.intent = key;
                intentOption.innerHTML = `
                    <div class="intent-icon" style="color: ${intent.color}">
                        <i class="${intent.icon}"></i>
                    </div>
                    <div class="intent-name">${intent.name}</div>
                `;
                
                intentOption.addEventListener('click', () => {
                    document.querySelectorAll('.intent-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    intentOption.classList.add('selected');
                    localStorage.setItem('selected_intent', key);
                });
                
                intentOptions.appendChild(intentOption);
            });
        }
        
        // Initialize mood options
        function initializeMoodOptions() {
            const moodOptions = document.getElementById('moodOptions');
            if (!moodOptions) return;
            
            moodOptions.innerHTML = '';
            Object.entries(statusMoods).forEach(([key, mood]) => {
                const moodOption = document.createElement('div');
                moodOption.className = 'mood-option';
                moodOption.dataset.mood = key;
                moodOption.classList.add(key);
                moodOption.textContent = mood.emoji;
                moodOption.title = mood.name;
                
                moodOption.addEventListener('click', () => {
                    document.querySelectorAll('.mood-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    moodOption.classList.add('selected');
                    localStorage.setItem('selected_mood', key);
                });
                
                moodOptions.appendChild(moodOption);
            });
        }
        
        // Initialize category options
        function initializeCategoryOptions() {
            const categoryOptions = document.getElementById('categoryOptions');
            if (!categoryOptions) return;
            
            categoryOptions.innerHTML = '';
            Object.entries(statusCategories).forEach(([key, category]) => {
                const categoryOption = document.createElement('div');
                categoryOption.className = 'category-option';
                categoryOption.dataset.category = key;
                categoryOption.textContent = category.name;
                
                categoryOption.addEventListener('click', () => {
                    document.querySelectorAll('.category-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    categoryOption.classList.add('selected');
                    localStorage.setItem('selected_category', key);
                });
                
                categoryOptions.appendChild(categoryOption);
            });
        }
        
        // Initialize action buttons selector
        function initializeActionButtonsSelector() {
            const actionButtonsSelector = document.getElementById('actionButtonsSelector');
            if (!actionButtonsSelector) return;
            
            actionButtonsSelector.innerHTML = '';
            Object.entries(actionButtons).forEach(([key, button]) => {
                const buttonOption = document.createElement('div');
                buttonOption.className = 'action-button-option';
                buttonOption.dataset.action = key;
                buttonOption.innerHTML = `
                    <div style="font-size: 20px; margin-bottom: 8px; color: ${button.color}">
                        <i class="${button.icon}"></i>
                    </div>
                    <div style="font-size: 12px;">${button.name}</div>
                `;
                
                buttonOption.addEventListener('click', () => {
                    buttonOption.classList.toggle('selected');
                    
                    const selectedActions = Array.from(document.querySelectorAll('.action-button-option.selected')).map(opt => opt.dataset.action);
                    localStorage.setItem('selected_actions', JSON.stringify(selectedActions));
                });
                
                actionButtonsSelector.appendChild(buttonOption);
            });
        }
        
        // Initialize privacy options
        function initializePrivacyOptions() {
            const privacyOptions = document.getElementById('privacyOptions');
            if (!privacyOptions) return;
            
            privacyOptions.innerHTML = '';
            Object.entries(privacySettings).forEach(([key, privacy]) => {
                const privacyOption = document.createElement('div');
                privacyOption.className = 'privacy-option';
                privacyOption.dataset.privacy = key;
                privacyOption.innerHTML = `
                    <div class="privacy-icon">
                        <i class="${privacy.icon}"></i>
                    </div>
                    <div class="privacy-details">
                        <div class="privacy-name">${privacy.name}</div>
                        <div class="privacy-description">${privacy.description}</div>
                    </div>
                `;
                
                privacyOption.addEventListener('click', () => {
                    document.querySelectorAll('.privacy-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    privacyOption.classList.add('selected');
                    localStorage.setItem('selected_privacy', key);
                });
                
                privacyOptions.appendChild(privacyOption);
            });
            
            // Select "Friends Only" by default
            const friendsPrivacy = privacyOptions.querySelector('[data-privacy="friends"]');
            if (friendsPrivacy) {
                friendsPrivacy.classList.add('selected');
            }
        }
        
        // Initialize duration options
        function initializeDurationOptions() {
            const durationOptions = document.getElementById('durationOptions');
            if (!durationOptions) return;
            
            durationOptions.innerHTML = '';
            Object.entries(durationOptions).forEach(([key, duration]) => {
                const durationOption = document.createElement('div');
                durationOption.className = 'duration-option';
                durationOption.dataset.duration = key;
                durationOption.textContent = duration;
                
                durationOption.addEventListener('click', () => {
                    document.querySelectorAll('.duration-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    durationOption.classList.add('selected');
                    localStorage.setItem('selected_duration', key);
                });
                
                durationOptions.appendChild(durationOption);
            });
            
            // Select "24 hours" by default
            const dayDuration = durationOptions.querySelector('[data-duration="86400"]');
            if (dayDuration) {
                dayDuration.classList.add('selected');
            }
        }
        
        // Initialize template options
        function initializeTemplateOptions() {
            const templateOptions = document.getElementById('templateOptions');
            if (!templateOptions) return;
            
            templateOptions.innerHTML = '';
            Object.entries(statusTemplates).forEach(([key, template]) => {
                const templateOption = document.createElement('div');
                templateOption.className = 'category-option';
                templateOption.dataset.template = key;
                templateOption.textContent = template.name;
                
                templateOption.addEventListener('click', () => {
                    document.getElementById('textStatusInput').value = template.text;
                    
                    // Select corresponding background
                    const bgOption = document.querySelector(`.background-option[data-bg="${template.background}"]`);
                    if (bgOption) {
                        document.querySelectorAll('.background-option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        bgOption.classList.add('selected');
                    }
                    
                    // Select mood if available
                    if (template.mood) {
                        const moodOption = document.querySelector(`.mood-option[data-mood="${template.mood}"]`);
                        if (moodOption) {
                            document.querySelectorAll('.mood-option').forEach(opt => {
                                opt.classList.remove('selected');
                            });
                            moodOption.classList.add('selected');
                        }
                    }
                    
                    // Select intent if available
                    if (template.intent) {
                        const intentOption = document.querySelector(`.intent-option[data-intent="${template.intent}"]`);
                        if (intentOption) {
                            document.querySelectorAll('.intent-option').forEach(opt => {
                                opt.classList.remove('selected');
                            });
                            intentOption.classList.add('selected');
                        }
                    }
                    
                    showNotification(`"${template.name}" template applied`, 'success');
                });
                
                templateOptions.appendChild(templateOption);
            });
        }
        
        // Initialize report reasons
        function initializeReportReasons() {
            const reportReasonsElement = document.getElementById('reportReasons');
            if (!reportReasonsElement) return;
            
            reportReasonsElement.innerHTML = '';
            Object.entries(reportReasons).forEach(([key, reason]) => {
                const reasonOption = document.createElement('div');
                reasonOption.className = 'category-option';
                reasonOption.dataset.reason = key;
                reasonOption.textContent = reason;
                
                reasonOption.addEventListener('click', () => {
                    document.querySelectorAll('#reportReasons .category-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    reasonOption.classList.add('selected');
                    updateReportSubmitButton();
                });
                
                reportReasonsElement.appendChild(reasonOption);
            });
        }
        
        // Initialize reactions
        function initializeReactions() {
            const reactionsContainer = document.getElementById('reactionsContainer');
            if (!reactionsContainer) return;
            
            reactionsContainer.innerHTML = '';
            Object.entries(reactions).forEach(([key, emoji]) => {
                const reactionBtn = document.createElement('button');
                reactionBtn.className = 'reaction-btn';
                reactionBtn.dataset.reaction = key;
                reactionBtn.textContent = emoji;
                reactionBtn.title = key.charAt(0).toUpperCase() + key.slice(1);
                
                reactionBtn.addEventListener('click', () => {
                    if (currentViewerStatus) {
                        addReactionToStatus(currentViewerStatus.id, key);
                        reactionBtn.classList.add('selected');
                        
                        // Remove selected class from other reactions
                        document.querySelectorAll('.reaction-btn').forEach(btn => {
                            if (btn !== reactionBtn) {
                                btn.classList.remove('selected');
                            }
                        });
                    }
                });
                
                reactionsContainer.appendChild(reactionBtn);
            });
        }
        
        // Initialize poll options
        function initializePollOptions() {
            const pollOptionsContainer = document.getElementById('pollOptionsContainer');
            if (!pollOptionsContainer) return;
            
            // Clear existing options
            pollOptionsContainer.innerHTML = '';
            
            // Add initial 2 options
            for (let i = 1; i <= 2; i++) {
                addPollOption(i);
            }
        }
        
        // Add poll option
        function addPollOption(index) {
            const pollOptionsContainer = document.getElementById('pollOptionsContainer');
            if (!pollOptionsContainer) return;
            
            const optionItem = document.createElement('div');
            optionItem.className = 'poll-option-item';
            optionItem.innerHTML = `
                <div class="poll-option-number">${index}</div>
                <div class="poll-option-input-wrapper">
                    <input type="text" class="text-input poll-option-input" placeholder="Option ${index}" data-index="${index}">
                    ${index > 2 ? `
                    <button class="remove-poll-option" type="button">
                        <i class="fas fa-times"></i>
                    </button>
                    ` : ''}
                </div>
            `;
            
            // Remove button event
            const removeBtn = optionItem.querySelector('.remove-poll-option');
            if (removeBtn) {
                removeBtn.addEventListener('click', () => {
                    if (pollOptionsContainer.children.length > 2) {
                        optionItem.remove();
                        updatePollOptionNumbers();
                    } else {
                        showNotification('Minimum 2 options required', 'warning');
                    }
                });
            }
            
            pollOptionsContainer.appendChild(optionItem);
        }
        
        // Update poll option numbers
        function updatePollOptionNumbers() {
            const pollOptions = document.querySelectorAll('.poll-option-item');
            pollOptions.forEach((item, index) => {
                const numberElement = item.querySelector('.poll-option-number');
                const inputElement = item.querySelector('.poll-option-input');
                const removeBtn = item.querySelector('.remove-poll-option');
                
                if (numberElement) {
                    numberElement.textContent = index + 1;
                }
                
                if (inputElement) {
                    inputElement.dataset.index = index + 1;
                    inputElement.placeholder = `Option ${index + 1}`;
                }
                
                // Show remove button for options beyond minimum
                if (removeBtn && index >= 2) {
                    removeBtn.style.display = 'block';
                } else if (removeBtn) {
                    removeBtn.style.display = 'none';
                }
            });
        }
        
        // Initialize highlight color options
        function initializeHighlightColorOptions() {
            const highlightColorGrid = document.getElementById('highlightColorGrid');
            if (!highlightColorGrid) return;
            
            highlightColorGrid.innerHTML = '';
            backgroundOptions.forEach(bg => {
                const colorOption = document.createElement('div');
                colorOption.className = 'background-option';
                colorOption.dataset.bg = bg.id;
                colorOption.dataset.type = bg.type;
                
                if (bg.type === 'solid') {
                    colorOption.style.backgroundColor = bg.color;
                    colorOption.textContent = 'A';
                } else if (bg.type === 'gradient') {
                    colorOption.style.background = bg.gradient;
                    colorOption.textContent = 'G';
                }
                
                colorOption.title = `Color ${bg.id}`;
                colorOption.addEventListener('click', () => {
                    document.querySelectorAll('#highlightColorGrid .background-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    colorOption.classList.add('selected');
                });
                
                highlightColorGrid.appendChild(colorOption);
            });
            
            // Select first color by default
            const firstColor = highlightColorGrid.querySelector('.background-option');
            if (firstColor) {
                firstColor.classList.add('selected');
            }
        }
        
        // Initialize highlight privacy options
        function initializeHighlightPrivacyOptions() {
            const highlightPrivacyOptions = document.getElementById('highlightPrivacyOptions');
            if (!highlightPrivacyOptions) return;
            
            highlightPrivacyOptions.innerHTML = '';
            ['everyone', 'friends', 'close-friends'].forEach(privacyKey => {
                const privacy = privacySettings[privacyKey];
                if (!privacy) return;
                
                const privacyOption = document.createElement('div');
                privacyOption.className = 'privacy-option';
                privacyOption.dataset.privacy = privacyKey;
                privacyOption.innerHTML = `
                    <div class="privacy-icon">
                        <i class="${privacy.icon}"></i>
                    </div>
                    <div class="privacy-details">
                        <div class="privacy-name">${privacy.name}</div>
                        <div class="privacy-description">${privacy.description}</div>
                    </div>
                `;
                
                privacyOption.addEventListener('click', () => {
                    document.querySelectorAll('#highlightPrivacyOptions .privacy-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    privacyOption.classList.add('selected');
                });
                
                highlightPrivacyOptions.appendChild(privacyOption);
            });
            
            // Select "friends" by default
            const friendsPrivacy = highlightPrivacyOptions.querySelector('[data-privacy="friends"]');
            if (friendsPrivacy) {
                friendsPrivacy.classList.add('selected');
            }
        }
        
        // Initialize repeat options
        function initializeRepeatOptions() {
            const repeatOptions = document.getElementById('repeatOptions');
            if (!repeatOptions) return;
            
            repeatOptions.innerHTML = '';
            const repeatOptionsData = {
                'none': 'Don\'t repeat',
                'daily': 'Daily',
                'weekly': 'Weekly',
                'monthly': 'Monthly'
            };
            
            Object.entries(repeatOptionsData).forEach(([key, text]) => {
                const repeatOption = document.createElement('div');
                repeatOption.className = 'repeat-option';
                repeatOption.dataset.repeat = key;
                repeatOption.textContent = text;
                
                repeatOption.addEventListener('click', () => {
                    document.querySelectorAll('.repeat-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    repeatOption.classList.add('selected');
                });
                
                repeatOptions.appendChild(repeatOption);
            });
            
            // Select "none" by default
            const noneOption = repeatOptions.querySelector('[data-repeat="none"]');
            if (noneOption) {
                noneOption.classList.add('selected');
            }
        }
        
        // Load initial data from API
        async function loadInitialData() {
            try {
                const api = window.parent.api;
                if (!api) {
                    throw new Error('API not available');
                }
                
                console.log('Loading initial data from API...');
                
                // Load statuses
                try {
                    const statusesResponse = await api.get('/api/statuses');
                    if (statusesResponse && statusesResponse.statuses) {
                        statuses = statusesResponse.statuses;
                        console.log('Loaded statuses from API:', statuses.length);
                        
                        // Filter by privacy and sort by time
                        statuses = filterStatusesByPrivacy(statuses);
                        statuses.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                        
                        // Save to cache
                        localStorage.setItem(LOCAL_STORAGE_KEYS.STATUSES, JSON.stringify(statuses));
                        
                        // Update UI
                        updateCurrentSection();
                    }
                } catch (statusesError) {
                    console.error('Error loading statuses:', statusesError);
                }
                
                // Load my statuses
                try {
                    const myStatusesResponse = await api.get('/api/statuses/my');
                    if (myStatusesResponse && myStatusesResponse.statuses) {
                        myStatuses = myStatusesResponse.statuses;
                        localStorage.setItem(LOCAL_STORAGE_KEYS.MY_STATUSES, JSON.stringify(myStatuses));
                        updateMyStatusPreview();
                    }
                } catch (myStatusesError) {
                    console.error('Error loading my statuses:', myStatusesError);
                }
                
                // Load highlights
                try {
                    const highlightsResponse = await api.get('/api/statuses/highlights');
                    if (highlightsResponse && highlightsResponse.highlights) {
                        highlights = highlightsResponse.highlights;
                        localStorage.setItem(LOCAL_STORAGE_KEYS.HIGHLIGHTS, JSON.stringify(highlights));
                    }
                } catch (highlightsError) {
                    console.error('Error loading highlights:', highlightsError);
                }
                
                // Load drafts
                try {
                    const draftsResponse = await api.get('/api/statuses/drafts');
                    if (draftsResponse && draftsResponse.drafts) {
                        drafts = draftsResponse.drafts;
                        localStorage.setItem(LOCAL_STORAGE_KEYS.DRAFTS, JSON.stringify(drafts));
                    }
                } catch (draftsError) {
                    console.error('Error loading drafts:', draftsError);
                }
                
                // Load scheduled statuses
                try {
                    const scheduledResponse = await api.get('/api/statuses/scheduled');
                    if (scheduledResponse && scheduledResponse.scheduled) {
                        scheduledStatuses = scheduledResponse.scheduled;
                        localStorage.setItem(LOCAL_STORAGE_KEYS.SCHEDULED, JSON.stringify(scheduledStatuses));
                        updateScheduledStatusesList();
                    }
                } catch (scheduledError) {
                    console.error('Error loading scheduled statuses:', scheduledError);
                }
                
                // Load muted users
                try {
                    const mutedResponse = await api.get('/api/users/muted');
                    if (mutedResponse && mutedResponse.users) {
                        mutedUsers = new Set(mutedResponse.users.map(user => user.id));
                        localStorage.setItem(LOCAL_STORAGE_KEYS.MUTED_USERS, JSON.stringify(Array.from(mutedUsers)));
                    }
                } catch (mutedError) {
                    console.error('Error loading muted users:', mutedError);
                }
                
                // Load mood data
                try {
                    const moodResponse = await api.get('/api/statuses/mood-data');
                    if (moodResponse && moodResponse.data) {
                        moodChartData = moodResponse.data;
                        localStorage.setItem(LOCAL_STORAGE_KEYS.MOOD_DATA, JSON.stringify(moodChartData));
                        updateMoodChart();
                    }
                } catch (moodError) {
                    console.error('Error loading mood data:', moodError);
                }
                
                // Load streak data
                try {
                    const streakResponse = await api.get('/api/statuses/streak');
                    if (streakResponse && streakResponse.streak !== undefined) {
                        streakCount = streakResponse.streak;
                        localStorage.setItem(LOCAL_STORAGE_KEYS.STREAK, streakCount.toString());
                        document.getElementById('streakCount').textContent = streakCount;
                    }
                } catch (streakError) {
                    console.error('Error loading streak data:', streakError);
                }
                
                showNotification('Status data loaded', 'success');
                
            } catch (error) {
                console.error('Error loading initial data:', error);
                showNotification('Error loading status data', 'error');
            }
        }
        
        // Filter statuses by privacy
        function filterStatusesByPrivacy(statuses) {
            return statuses.filter(status => {
                // If user is muted, skip
                if (mutedUsers.has(status.userId)) {
                    return false;
                }
                
                // Check privacy settings
                const privacy = status.privacy || 'friends';
                
                switch(privacy) {
                    case 'everyone':
                        return true;
                    case 'friends':
                        // In real implementation, check if user is friends with status owner
                        return true; // Simplified for demo
                    case 'close-friends':
                        // In real implementation, check if user is close friends with status owner
                        return false; // Simplified for demo
                    case 'except':
                        // In real implementation, check if user is in exception list
                        return true; // Simplified for demo
                    case 'specific':
                        // In real implementation, check if user is in specific list
                        return false; // Simplified for demo
                    case 'micro-circle':
                        // In real implementation, check if user is in the micro circle
                        return false; // Simplified for demo
                    default:
                        return true;
                }
            });
        }
        
        // Update my status preview
        function updateMyStatusPreview() {
            const myStatusRing = document.getElementById('myStatusRing');
            const myStatusAvatar = document.getElementById('myStatusAvatar');
            const myStatusIndicator = document.getElementById('myStatusIndicator');
            const myStatusText = document.getElementById('myStatusText');
            
            if (currentUser && currentUser.photoURL) {
                myStatusAvatar.innerHTML = `<img src="${escapeHtml(currentUser.photoURL)}" style="width: 100%; height: 100%; border-radius: 50%;">`;
            }
            
            if (myStatuses.length > 0) {
                const latestStatus = myStatuses[0];
                myStatusRing.classList.remove('viewed');
                myStatusIndicator.classList.remove('viewed');
                myStatusText.textContent = getStatusPreviewText(latestStatus);
            } else {
                myStatusRing.classList.add('viewed');
                myStatusIndicator.classList.add('viewed');
                myStatusText.textContent = 'No recent status';
            }
        }
        
        // Update streak counter
        function updateStreakCounter() {
            // Check if user posted today
            const today = new Date().toDateString();
            if (lastPostDate && lastPostDate.toDateString() === today) {
                // Already counted today
                return;
            }
            
            // Check if posted yesterday
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (lastPostDate && lastPostDate.toDateString() === yesterday.toDateString()) {
                // Continue streak
                streakCount++;
            } else if (lastPostDate) {
                // Broken streak, reset
                streakCount = 1;
            } else {
                // First post
                streakCount = 1;
            }
            
            document.getElementById('streakCount').textContent = streakCount;
            localStorage.setItem(LOCAL_STORAGE_KEYS.STREAK, streakCount.toString());
        }
        
        // Update mood chart
        function updateMoodChart() {
            const moodChart = document.getElementById('moodChart');
            if (!moodChart) return;
            
            moodChart.innerHTML = '';
            
            // Use cached data or generate sample data
            const chartData = moodChartData.length > 0 ? moodChartData : generateSampleMoodData();
            
            chartData.forEach((day, index) => {
                const moodBar = document.createElement('div');
                moodBar.className = 'mood-bar';
                moodBar.style.backgroundColor = statusMoods[day.mood]?.color || 'var(--mood-happy)';
                moodBar.style.height = `${day.value}%`;
                moodBar.title = `Day ${index + 1}: ${statusMoods[day.mood]?.name || 'Happy'} (${day.value}%)`;
                moodChart.appendChild(moodBar);
            });
        }
        
        // Generate sample mood data
        function generateSampleMoodData() {
            const moods = Object.keys(statusMoods);
            const data = [];
            
            for (let i = 0; i < 30; i++) {
                const randomMood = moods[Math.floor(Math.random() * moods.length)];
                data.push({
                    mood: randomMood,
                    value: 20 + Math.floor(Math.random() * 60) // Random height between 20-80%
                });
            }
            
            return data;
        }
        
        // Get status preview text
        function getStatusPreviewText(status) {
            if (status.type === 'text') {
                return status.text.length > 30 ? status.text.substring(0, 30) + '...' : status.text;
            } else if (status.type === 'media') {
                return status.caption ? status.caption.substring(0, 30) + '...' : 'Media status';
            } else if (status.type === 'poll') {
                return status.question ? status.question.substring(0, 30) + '...' : 'Poll status';
            }
            return 'Status';
        }
        
        // Update current section
        function updateCurrentSection() {
            const activeSection = document.querySelector('.statuses-section.active');
            if (activeSection) {
                const sectionId = activeSection.id;
                
                switch(sectionId) {
                    case 'allStatusSection':
                        renderStatusesList(allStatusList, statuses);
                        break;
                    case 'friendsStatusSection':
                        renderStatusesList(friendsStatusList, filterStatusesByType('friends'));
                        break;
                    case 'closeFriendsStatusSection':
                        renderStatusesList(closeFriendsStatusList, filterStatusesByType('close-friends'));
                        break;
                    case 'pinnedStatusSection':
                        renderStatusesList(pinnedStatusList, filterStatusesByType('pinned'));
                        break;
                    case 'mutedStatusSection':
                        renderStatusesList(mutedStatusList, filterStatusesByType('muted'));
                        break;
                    case 'microCirclesStatusSection':
                        renderStatusesList(microCirclesStatusList, filterStatusesByType('micro-circle'));
                        break;
                    case 'myStatusSection':
                        renderStatusesList(myStatusList, myStatuses);
                        break;
                }
            }
        }
        
        // Filter statuses by type
        function filterStatusesByType(type) {
            switch(type) {
                case 'friends':
                    return statuses.filter(status => status.privacy === 'friends' || status.privacy === 'everyone');
                case 'close-friends':
                    return statuses.filter(status => status.privacy === 'close-friends');
                case 'pinned':
                    return statuses.filter(status => status.isPinned);
                case 'muted':
                    return statuses.filter(status => mutedUsers.has(status.userId));
                case 'micro-circle':
                    return statuses.filter(status => status.privacy === 'micro-circle');
                default:
                    return statuses;
            }
        }
        
        // Render statuses list
        function renderStatusesList(container, statusesList) {
            container.innerHTML = '';
            
            // Apply additional filters
            let filteredStatuses = statusesList;
            
            if (currentIntentFilter) {
                filteredStatuses = filteredStatuses.filter(status => status.intent === currentIntentFilter);
            }
            
            if (currentMoodFilter) {
                filteredStatuses = filteredStatuses.filter(status => status.mood === currentMoodFilter);
            }
            
            // Apply active filters
            if (activeFilters.size > 0) {
                filteredStatuses = filteredStatuses.filter(status => {
                    return Array.from(activeFilters).every(filter => {
                        if (filter.startsWith('intent-')) {
                            return status.intent === filter.replace('intent-', '');
                        }
                        if (filter.startsWith('mood-')) {
                            return status.mood === filter.replace('mood-', '');
                        }
                        if (filter.startsWith('category-')) {
                            return status.category === filter.replace('category-', '');
                        }
                        return true;
                    });
                });
            }
            
            if (filteredStatuses.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-comment-dots"></i>
                        <p>No statuses found</p>
                        <p class="subtext">${getEmptyStateMessage()}</p>
                    </div>
                `;
                return;
            }
            
            filteredStatuses.forEach(status => {
                addStatusItem(status, container);
            });
        }
        
        // Get empty state message
        function getEmptyStateMessage() {
            if (activeFilters.size > 0) {
                return `No statuses match your filters`;
            }
            if (currentIntentFilter) {
                return `No statuses with "${statusIntents[currentIntentFilter]?.name || currentIntentFilter}" intent`;
            }
            if (currentMoodFilter) {
                return `No statuses with "${statusMoods[currentMoodFilter]?.name || currentMoodFilter}" mood`;
            }
            return 'Be the first to post a status!';
        }
        
        // Add status item to list
        function addStatusItem(statusData, container) {
            const statusItem = document.createElement('div');
            statusItem.className = 'status-item';
            statusItem.dataset.statusId = statusData.id;
            statusItem.dataset.userId = statusData.userId;
            
            const user = statusData.user || { displayName: 'Unknown User', photoURL: '', id: statusData.userId };
            const initials = user.displayName ? 
                user.displayName.split(' ').map(word => word[0]).join('').toUpperCase().substring(0, 2) : 
                'U';
            
            const isViewed = viewedStatuses.has(statusData.id);
            const isPinned = statusData.isPinned || false;
            const isMuted = mutedUsers.has(statusData.userId);
            const mood = statusData.mood || 'happy';
            const intent = statusData.intent || 'reflection';
            const category = statusData.category || 'life';
            
            let previewText = '';
            let previewClass = '';
            if (statusData.type === 'text') {
                previewText = statusData.text || 'Text status';
            } else if (statusData.type === 'media') {
                previewText = `<i class="fas fa-image"></i> ${statusData.caption ? statusData.caption.substring(0, 40) + (statusData.caption.length > 40 ? '...' : '') : 'Media status'}`;
                previewClass = 'media';
            } else if (statusData.type === 'poll') {
                previewText = `<i class="fas fa-poll"></i> ${statusData.question ? statusData.question.substring(0, 40) + (statusData.question.length > 40 ? '...' : '') : 'Poll status'}`;
                previewClass = 'poll';
            }
            
            const timeAgo = statusData.createdAt ? formatTimeAgo(new Date(statusData.createdAt)) : 'Just now';
            
            statusItem.innerHTML = `
                <div class="status-avatar">
                    <div class="status-ring ${isViewed ? 'viewed' : ''}"></div>
                    <div class="status-avatar-inner" ${user.photoURL ? `style="background-image: url('${escapeHtml(user.photoURL)}')"` : ''}>
                        ${user.photoURL ? '' : `<span>${initials}</span>`}
                    </div>
                    <div class="status-indicators">
                        ${mood ? `<div class="status-indicator mood" style="background-color: ${statusMoods[mood]?.color || 'var(--mood-happy)'}" title="${statusMoods[mood]?.name || 'Mood'}"></div>` : ''}
                        ${intent ? `<div class="status-indicator intent" style="background-color: ${statusIntents[intent]?.color || 'var(--intent-feedback)'}" title="${statusIntents[intent]?.name || 'Intent'}"></div>` : ''}
                        ${isPinned ? `<div class="status-indicator pinned" title="Pinned Status"></div>` : ''}
                        ${isMuted ? `<div class="status-indicator muted" title="Muted User"></div>` : ''}
                    </div>
                </div>
                <div class="status-info">
                    <div class="status-name">
                        <span class="status-name-text">${escapeHtml(user.displayName || 'Unknown User')}</span>
                        <span class="status-time">${timeAgo}</span>
                    </div>
                    <div class="status-details">
                        <span class="status-type" style="color: ${statusTypes[statusData.type]?.color || 'var(--primary-color)'}">
                            <i class="${statusTypes[statusData.type]?.icon || 'fas fa-comment'}"></i>
                            ${statusTypes[statusData.type]?.name || 'Status'}
                        </span>
                        ${statusData.isSensitive ? '<span class="status-tag privacy"><i class="fas fa-eye-slash"></i> Sensitive</span>' : ''}
                        ${statusData.isSilent ? '<span class="status-tag privacy"><i class="fas fa-bell-slash"></i> Silent</span>' : ''}
                        ${statusData.duration !== '0' ? `<span class="status-tag privacy"><i class="fas fa-clock"></i> ${durationOptions[statusData.duration] || '24h'}</span>` : ''}
                    </div>
                    <div class="status-preview ${previewClass}">
                        ${previewText}
                    </div>
                    <div class="status-tags">
                        ${mood ? `<span class="status-tag mood"><i class="fas fa-brain"></i> ${statusMoods[mood]?.name || 'Mood'}</span>` : ''}
                        ${intent ? `<span class="status-tag intent"><i class="fas fa-bullseye"></i> ${statusIntents[intent]?.name || 'Intent'}</span>` : ''}
                        ${category ? `<span class="status-tag category"><i class="${statusCategories[category]?.icon || 'fas fa-tag'}"></i> ${statusCategories[category]?.name || 'Category'}</span>` : ''}
                        ${statusData.privacy ? `<span class="status-tag privacy"><i class="${privacySettings[statusData.privacy]?.icon || 'fas fa-lock'}"></i> ${privacySettings[statusData.privacy]?.name || 'Privacy'}</span>` : ''}
                    </div>
                </div>
                <div class="status-actions">
                    <button class="status-action-btn" data-action="view" title="View Status">
                        <i class="fas fa-eye"></i>
                    </button>
                    ${isPinned ? `
                    <button class="status-action-btn warning" data-action="unpin" title="Unpin Status">
                        <i class="fas fa-thumbtack"></i>
                    </button>
                    ` : `
                    <button class="status-action-btn" data-action="pin" title="Pin Status">
                        <i class="fas fa-thumbtack"></i>
                    </button>
                    `}
                    ${isMuted ? `
                    <button class="status-action-btn" data-action="unmute" title="Unmute User">
                        <i class="fas fa-volume-up"></i>
                    </button>
                    ` : `
                    <button class="status-action-btn" data-action="mute" title="Mute User">
                        <i class="fas fa-volume-mute"></i>
                    </button>
                    `}
                </div>
            `;
            
            statusItem.addEventListener('click', (e) => {
                if (!e.target.closest('.status-actions')) {
                    showStatusViewer(statusData);
                }
            });
            
            const actionButtons = statusItem.querySelectorAll('.status-action-btn');
            actionButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const action = btn.dataset.action;
                    handleStatusAction(action, statusData, btn);
                });
            });
            
            container.appendChild(statusItem);
        }
        
        // Handle status action
        function handleStatusAction(action, statusData, button) {
            switch(action) {
                case 'view':
                    showStatusViewer(statusData);
                    break;
                case 'pin':
                    pinStatus(statusData);
                    break;
                case 'unpin':
                    unpinStatus(statusData);
                    break;
                case 'mute':
                    muteUser(statusData.userId);
                    break;
                case 'unmute':
                    unmuteUser(statusData.userId);
                    break;
            }
        }
        
        // Show status viewer
        function showStatusViewer(statusData) {
            currentViewerStatus = statusData;
            currentSlideIndex = 0;
            
            // Mark as viewed
            if (!viewedStatuses.has(statusData.id)) {
                viewedStatuses.add(statusData.id);
                localStorage.setItem(LOCAL_STORAGE_KEYS.VIEWED_STATUSES, JSON.stringify(Array.from(viewedStatuses)));
                
                // Update UI
                const statusItem = document.querySelector(`[data-status-id="${statusData.id}"]`);
                if (statusItem) {
                    const ring = statusItem.querySelector('.status-ring');
                    if (ring) {
                        ring.classList.add('viewed');
                    }
                }
            }
            
            // Show viewer panel
            statusViewerPanel.classList.add('active');
            
            // Load viewer content
            loadViewerContent(statusData);
            
            // Start auto-advance
            startAutoAdvance();
        }
        
        // Load viewer content
        function loadViewerContent(statusData) {
            const viewerUserInfo = document.getElementById('viewerUserInfo');
            const viewerContent = document.getElementById('viewerContent');
            const progressIndicators = document.getElementById('progressIndicators');
            const actionButtonsOverlay = document.getElementById('actionButtonsOverlay');
            
            if (!viewerUserInfo || !viewerContent) return;
            
            const user = statusData.user || { displayName: 'Unknown User', photoURL: '', id: statusData.userId };
            const initials = user.displayName ? 
                user.displayName.split(' ').map(word => word[0]).join('').toUpperCase().substring(0, 2) : 
                'U';
            
            const timeAgo = statusData.createdAt ? formatTimeAgo(new Date(statusData.createdAt)) : 'Just now';
            
            // User info
            viewerUserInfo.innerHTML = `
                <div class="viewer-user-avatar" ${user.photoURL ? `style="background-image: url('${escapeHtml(user.photoURL)}')"` : ''}>
                    ${user.photoURL ? '' : `<span>${initials}</span>`}
                </div>
                <div class="viewer-user-details">
                    <div class="viewer-user-name">${escapeHtml(user.displayName || 'Unknown User')}</div>
                    <div class="viewer-status-time">${timeAgo}</div>
                </div>
            `;
            
            // Viewer content based on status type
            viewerContent.innerHTML = '';
            
            if (statusData.type === 'text') {
                const slide = createTextStatusSlide(statusData);
                viewerContent.appendChild(slide);
            } else if (statusData.type === 'media') {
                const slide = createMediaStatusSlide(statusData);
                viewerContent.appendChild(slide);
            } else if (statusData.type === 'poll') {
                const slide = createPollStatusSlide(statusData);
                viewerContent.appendChild(slide);
            }
            
            // Progress indicators
            progressIndicators.innerHTML = `
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            `;
            
            // Action buttons
            if (statusData.actionButtons && statusData.actionButtons.length > 0) {
                actionButtonsOverlay.innerHTML = '';
                statusData.actionButtons.forEach(actionKey => {
                    const action = actionButtons[actionKey];
                    if (action) {
                        const actionButton = document.createElement('button');
                        actionButton.className = 'action-button';
                        actionButton.innerHTML = `<i class="${action.icon}"></i> ${action.name}`;
                        actionButton.addEventListener('click', () => {
                            handleActionButtonClick(actionKey, statusData);
                        });
                        actionButtonsOverlay.appendChild(actionButton);
                    }
                });
            } else {
                actionButtonsOverlay.innerHTML = '';
            }
            
            // Update mute button state
            const muteUserBtn = document.getElementById('muteUserBtn');
            if (muteUserBtn) {
                if (mutedUsers.has(statusData.userId)) {
                    muteUserBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
                    muteUserBtn.title = 'Unmute User';
                } else {
                    muteUserBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
                    muteUserBtn.title = 'Mute User';
                }
            }
            
            // Update save button state
            const saveStatusBtn = document.getElementById('saveStatusBtn');
            if (saveStatusBtn) {
                // Check if status is already saved in highlights
                const isSaved = highlights.some(h => h.statusIds && h.statusIds.includes(statusData.id));
                if (isSaved) {
                    saveStatusBtn.innerHTML = '<i class="fas fa-bookmark"></i>';
                    saveStatusBtn.title = 'Remove from Highlights';
                } else {
                    saveStatusBtn.innerHTML = '<i class="far fa-bookmark"></i>';
                    saveStatusBtn.title = 'Save to Highlights';
                }
            }
        }
        
        // Create text status slide
        function createTextStatusSlide(statusData) {
            const slide = document.createElement('div');
            slide.className = 'status-slide text-status-slide active';
            
            // Get selected background
            const selectedBg = statusData.background || '1';
            const bgOption = backgroundOptions.find(bg => bg.id === selectedBg);
            
            if (bgOption) {
                if (bgOption.type === 'solid') {
                    slide.style.backgroundColor = bgOption.color;
                } else if (bgOption.type === 'gradient') {
                    slide.style.background = bgOption.gradient;
                }
            }
            
            slide.innerHTML = `
                <div class="text-status-content">${escapeHtml(statusData.text || '')}</div>
                <div class="text-status-author"> ${escapeHtml(statusData.user?.displayName || 'Unknown User')}</div>
            `;
            
            return slide;
        }
        
        // Create media status slide
        function createMediaStatusSlide(statusData) {
            const slide = document.createElement('div');
            slide.className = 'status-slide media-status-slide active';
            
            let mediaContent = '';
            if (statusData.mediaType === 'image') {
                mediaContent = `<img src="${escapeHtml(statusData.mediaUrl)}" class="media-status-content" alt="Status image">`;
            } else if (statusData.mediaType === 'video') {
                mediaContent = `<video src="${escapeHtml(statusData.mediaUrl)}" class="media-status-content" autoplay muted loop controls></video>`;
            }
            
            slide.innerHTML = `
                ${mediaContent}
                ${statusData.caption ? `<div class="media-caption">${escapeHtml(statusData.caption)}</div>` : ''}
            `;
            
            // Add blur if sensitive
            if (statusData.isSensitive) {
                const mediaElement = slide.querySelector('.media-status-content');
                if (mediaElement) {
                    mediaElement.style.filter = 'blur(20px)';
                    mediaElement.addEventListener('click', () => {
                        mediaElement.style.filter = 'none';
                    });
                }
            }
            
            return slide;
        }
        
        // Create poll status slide
        function createPollStatusSlide(statusData) {
            const slide = document.createElement('div');
            slide.className = 'status-slide poll-status-slide active';
            
            const totalVotes = statusData.options?.reduce((sum, option) => sum + (option.votes || 0), 0) || 0;
            
            let optionsHtml = '';
            if (statusData.options) {
                statusData.options.forEach(option => {
                    const percentage = totalVotes > 0 ? Math.round((option.votes || 0) / totalVotes * 100) : 0;
                    optionsHtml += `
                        <div class="poll-option" data-option="${option.id}">
                            <div class="poll-option-text">${escapeHtml(option.text)}</div>
                            <div class="poll-option-percentage">${percentage}% (${option.votes || 0} votes)</div>
                            <div class="poll-option-bar" style="width: ${percentage}%"></div>
                        </div>
                    `;
                });
            }
            
            slide.innerHTML = `
                <div class="poll-container">
                    <div class="poll-question">${escapeHtml(statusData.question || '')}</div>
                    <div class="poll-options">
                        ${optionsHtml}
                    </div>
                    <div class="poll-total-votes">Total votes: ${totalVotes}</div>
                </div>
            `;
            
            // Add vote functionality
            const pollOptions = slide.querySelectorAll('.poll-option');
            pollOptions.forEach(option => {
                option.addEventListener('click', () => {
                    if (!statusData.hasVoted) {
                        voteOnPoll(statusData.id, option.dataset.option);
                    }
                });
            });
            
            return slide;
        }
        
        // Handle action button click
        function handleActionButtonClick(actionKey, statusData) {
            switch(actionKey) {
                case 'message':
                    // Navigate to chat with user
                    if (window.parent && window.parent.navigateToChat) {
                        window.parent.navigateToChat(statusData.userId, statusData.user?.displayName || 'User');
                    }
                    break;
                case 'join':
                    // Join discussion (would navigate to group chat)
                    showNotification('Joining discussion...', 'info');
                    break;
                case 'vote':
                    // Vote on poll (handled in poll slide)
                    showNotification('Vote on the poll above', 'info');
                    break;
                case 'book':
                    // Book a call
                    if (window.parent && window.parent.navigateToCall) {
                        window.parent.navigateToCall(statusData.userId, statusData.user?.displayName || 'User');
                    }
                    break;
                case 'learn':
                    // Learn more (open URL)
                    if (statusData.externalUrl) {
                        window.open(statusData.externalUrl, '_blank');
                    }
                    break;
                case 'support':
                    // Show support (add reaction)
                    addReactionToStatus(statusData.id, 'love');
                    break;
                case 'collaborate':
                    // Start collaboration
                    showNotification('Starting collaboration...', 'info');
                    break;
                case 'resource':
                    // View resource
                    if (statusData.resourceUrl) {
                        window.open(statusData.resourceUrl, '_blank');
                    }
                    break;
            }
        }
        
        // Start auto-advance
        function startAutoAdvance() {
            if (autoAdvanceInterval) {
                clearInterval(autoAdvanceInterval);
            }
            
            if (progressInterval) {
                clearInterval(progressInterval);
            }
            
            isAutoAdvancePaused = false;
            const pauseResumeBtn = document.getElementById('pauseResumeBtn');
            if (pauseResumeBtn) {
                pauseResumeBtn.innerHTML = '<i class="fas fa-pause"></i>';
                pauseResumeBtn.title = 'Pause';
            }
            
            // Start progress bar animation
            const progressFill = document.getElementById('progressFill');
            if (progressFill) {
                progressFill.style.width = '0%';
                progressFill.style.transition = 'width 5s linear';
                
                progressInterval = setInterval(() => {
                    const currentWidth = parseFloat(progressFill.style.width) || 0;
                    if (currentWidth < 100) {
                        progressFill.style.width = (currentWidth + 1) + '%';
                    } else {
                        // Move to next status (if there are multiple)
                        // For now, just reset
                        progressFill.style.width = '0%';
                    }
                }, 50); // Update every 50ms for smooth animation
            }
        }
        
        // Pause/resume auto-advance
        function toggleAutoAdvance() {
            isAutoAdvancePaused = !isAutoAdvancePaused;
            const pauseResumeBtn = document.getElementById('pauseResumeBtn');
            
            if (isAutoAdvancePaused) {
                if (progressInterval) {
                    clearInterval(progressInterval);
                }
                if (pauseResumeBtn) {
                    pauseResumeBtn.innerHTML = '<i class="fas fa-play"></i>';
                    pauseResumeBtn.title = 'Resume';
                }
            } else {
                startAutoAdvance();
                if (pauseResumeBtn) {
                    pauseResumeBtn.innerHTML = '<i class="fas fa-pause"></i>';
                    pauseResumeBtn.title = 'Pause';
                }
            }
        }
        
        // Add reaction to status
        async function addReactionToStatus(statusId, reaction) {
            try {
                if (isOfflineMode) {
                    // Store for later sync
                    pendingReactions.push({ statusId, reaction, timestamp: new Date().toISOString() });
                    localStorage.setItem(LOCAL_STORAGE_KEYS.PENDING_REACTIONS, JSON.stringify(pendingReactions));
                    showNotification(`Reacted with ${reactions[reaction]} (offline)`, 'success');
                    return;
                }
                
                const api = window.parent.api;
                if (!api) {
                    throw new Error('API not available');
                }
                
                const response = await api.post(`/api/statuses/${statusId}/react`, { reaction });
                
                if (response && response.success) {
                    showNotification(`Reacted with ${reactions[reaction]}`, 'success');
                }
            } catch (error) {
                console.error('Error adding reaction:', error);
                showNotification('Failed to add reaction', 'error');
            }
        }
        
        // Vote on poll
        async function voteOnPoll(statusId, optionId) {
            try {
                if (isOfflineMode) {
                    showNotification('Cannot vote while offline', 'warning');
                    return;
                }
                
                const api = window.parent.api;
                if (!api) {
                    throw new Error('API not available');
                }
                
                const response = await api.post(`/api/statuses/${statusId}/vote`, { optionId });
                
                if (response && response.success) {
                    showNotification('Vote recorded', 'success');
                    
                    // Update poll display
                    const pollOption = document.querySelector(`.poll-option[data-option="${optionId}"]`);
                    if (pollOption) {
                        pollOption.classList.add('selected');
                    }
                }
            } catch (error) {
                console.error('Error voting on poll:', error);
                showNotification('Failed to vote', 'error');
            }
        }
        
        // Pin status
        async function pinStatus(statusData) {
            try {
                const api = window.parent.api;
                if (!api) {
                    showNotification('Cannot pin while offline', 'warning');
                    return;
                }
                
                const response = await api.post(`/api/statuses/${statusData.id}/pin`);
                
                if (response && response.success) {
                    statusData.isPinned = true;
                    pinnedStatuses.push(statusData);
                    showNotification('Status pinned', 'success');
                    updateCurrentSection();
                }
            } catch (error) {
                console.error('Error pinning status:', error);
                showNotification('Failed to pin status', 'error');
            }
        }
        
        // Unpin status
        async function unpinStatus(statusData) {
            try {
                const api = window.parent.api;
                if (!api) {
                    showNotification('Cannot unpin while offline', 'warning');
                    return;
                }
                
                const response = await api.delete(`/api/statuses/${statusData.id}/pin`);
                
                if (response && response.success) {
                    statusData.isPinned = false;
                    pinnedStatuses = pinnedStatuses.filter(s => s.id !== statusData.id);
                    showNotification('Status unpinned', 'success');
                    updateCurrentSection();
                }
            } catch (error) {
                console.error('Error unpinning status:', error);
                showNotification('Failed to unpin status', 'error');
            }
        }
        
        // Mute user
        async function muteUser(userId) {
            try {
                const api = window.parent.api;
                if (!api) {
                    // Store for later sync
                    mutedUsers.add(userId);
                    localStorage.setItem(LOCAL_STORAGE_KEYS.MUTED_USERS, JSON.stringify(Array.from(mutedUsers)));
                    showNotification('User muted (offline)', 'success');
                    updateCurrentSection();
                    return;
                }
                
                const response = await api.post(`/api/users/${userId}/mute`);
                
                if (response && response.success) {
                    mutedUsers.add(userId);
                    localStorage.setItem(LOCAL_STORAGE_KEYS.MUTED_USERS, JSON.stringify(Array.from(mutedUsers)));
                    showNotification('User muted', 'success');
                    updateCurrentSection();
                }
            } catch (error) {
                console.error('Error muting user:', error);
                showNotification('Failed to mute user', 'error');
            }
        }
        
        // Unmute user
        async function unmuteUser(userId) {
            try {
                const api = window.parent.api;
                if (!api) {
                    // Store for later sync
                    mutedUsers.delete(userId);
                    localStorage.setItem(LOCAL_STORAGE_KEYS.MUTED_USERS, JSON.stringify(Array.from(mutedUsers)));
                    showNotification('User unmuted (offline)', 'success');
                    updateCurrentSection();
                    return;
                }
                
                const response = await api.delete(`/api/users/${userId}/mute`);
                
                if (response && response.success) {
                    mutedUsers.delete(userId);
                    localStorage.setItem(LOCAL_STORAGE_KEYS.MUTED_USERS, JSON.stringify(Array.from(mutedUsers)));
                    showNotification('User unmuted', 'success');
                    updateCurrentSection();
                }
            } catch (error) {
                console.error('Error unmuting user:', error);
                showNotification('Failed to unmute user', 'error');
            }
        }
        
        // Post status
        async function postStatus(statusData) {
            try {
                if (isOfflineMode) {
                    // Store in offline queue
                    const offlineQueue = JSON.parse(localStorage.getItem(LOCAL_STORAGE_KEYS.OFFLINE_QUEUE) || '[]');
                    statusData.id = 'offline_' + Date.now();
                    statusData.createdAt = new Date().toISOString();
                    offlineQueue.push(statusData);
                    localStorage.setItem(LOCAL_STORAGE_KEYS.OFFLINE_QUEUE, JSON.stringify(offlineQueue));
                    
                    // Update local cache
                    statuses.unshift(statusData);
                    myStatuses.unshift(statusData);
                    localStorage.setItem(LOCAL_STORAGE_KEYS.STATUSES, JSON.stringify(statuses));
                    localStorage.setItem(LOCAL_STORAGE_KEYS.MY_STATUSES, JSON.stringify(myStatuses));
                    
                    // Update streak
                    lastPostDate = new Date();
                    localStorage.setItem(LOCAL_STORAGE_KEYS.LAST_POST_DATE, lastPostDate.toISOString());
                    updateStreakCounter();
                    
                    showNotification('Status saved offline. Will post when connected.', 'success');
                    updateMyStatusPreview();
                    updateCurrentSection();
                    return;
                }
                
                const api = window.parent.api;
                if (!api) {
                    throw new Error('API not available');
                }
                
                const response = await api.post('/api/statuses/create', statusData);
                
                if (response && response.status) {
                    // Update local cache
                    statuses.unshift(response.status);
                    myStatuses.unshift(response.status);
                    localStorage.setItem(LOCAL_STORAGE_KEYS.STATUSES, JSON.stringify(statuses));
                    localStorage.setItem(LOCAL_STORAGE_KEYS.MY_STATUSES, JSON.stringify(myStatuses));
                    
                    // Update streak
                    lastPostDate = new Date();
                    localStorage.setItem(LOCAL_STORAGE_KEYS.LAST_POST_DATE, lastPostDate.toISOString());
                    updateStreakCounter();
                    
                    // Update mood data
                    if (statusData.mood) {
                        moodChartData.push({
                            mood: statusData.mood,
                            value: 50 + Math.floor(Math.random() * 30),
                            date: new Date().toISOString()
                        });
                        if (moodChartData.length > 30) {
                            moodChartData = moodChartData.slice(-30);
                        }
                        localStorage.setItem(LOCAL_STORAGE_KEYS.MOOD_DATA, JSON.stringify(moodChartData));
                        updateMoodChart();
                    }
                    
                    showNotification('Status posted successfully', 'success');
                    updateMyStatusPreview();
                    updateCurrentSection();
                }
            } catch (error) {
                console.error('Error posting status:', error);
                showNotification('Failed to post status', 'error');
            }
        }
        
        // Schedule status
        async function scheduleStatus(statusData, scheduleTime) {
            try {
                const api = window.parent.api;
                if (!api) {
                    throw new Error('API not available');
                }
                
                const response = await api.post('/api/statuses/schedule', {
                    ...statusData,
                    scheduledFor: scheduleTime
                });
                
                if (response && response.success) {
                    scheduledStatuses.push({
                        ...statusData,
                        scheduledFor: scheduleTime
                    });
                    localStorage.setItem(LOCAL_STORAGE_KEYS.SCHEDULED, JSON.stringify(scheduledStatuses));
                    showNotification('Status scheduled successfully', 'success');
                }
            } catch (error) {
                console.error('Error scheduling status:', error);
                showNotification('Failed to schedule status', 'error');
            }
        }
        
        // Save draft
        function saveDraft(statusData) {
            try {
                statusData.id = 'draft_' + Date.now();
                statusData.createdAt = new Date().toISOString();
                statusData.isDraft = true;
                drafts.unshift(statusData);
                localStorage.setItem(LOCAL_STORAGE_KEYS.DRAFTS, JSON.stringify(drafts));
                showNotification('Draft saved successfully', 'success');
                updateDraftsList();
            } catch (error) {
                console.error('Error saving draft:', error);
                showNotification('Failed to save draft', 'error');
            }
        }
        
        // Report status
        async function reportStatus(statusId, reason, details) {
            try {
                const api = window.parent.api;
                if (!api) {
                    throw new Error('API not available');
                }
                
                const response = await api.post(`/api/statuses/${statusId}/report`, {
                    reason,
                    details
                });
                
                if (response && response.success) {
                    showNotification('Report submitted successfully', 'success');
                }
            } catch (error) {
                console.error('Error reporting status:', error);
                showNotification('Failed to submit report', 'error');
            }
        }
        
        // Update text status counter
        function updateTextStatusCounter() {
            const textInput = document.getElementById('textStatusInput');
            const counter = document.getElementById('textStatusCounter');
            
            if (textInput && counter) {
                const length = textInput.value.length;
                counter.textContent = `${length}/500`;
                counter.style.color = length > 500 ? 'var(--danger-color)' : 'var(--text-secondary)';
            }
        }
        
        // Update report details counter
        function updateReportDetailsCounter() {
            const reportDetails = document.getElementById('reportDetails');
            const counter = document.getElementById('reportDetailsCounter');
            
            if (reportDetails && counter) {
                const length = reportDetails.value.length;
                counter.textContent = `${length}/500`;
                counter.style.color = length > 500 ? 'var(--danger-color)' : 'var(--text-secondary)';
                updateReportSubmitButton();
            }
        }
        
        // Update report submit button
        function updateReportSubmitButton() {
            const reportDetails = document.getElementById('reportDetails');
            const selectedReason = document.querySelector('#reportReasons .category-option.selected');
            const submitBtn = document.getElementById('submitReportBtn');
            
            if (reportDetails && selectedReason && submitBtn) {
                const hasDetails = reportDetails.value.trim().length >= 10;
                const hasReason = selectedReason !== null;
                submitBtn.disabled = !(hasDetails && hasReason);
            }
        }
        
        // Show highlights modal
        function showHighlightsModal() {
            highlightsModal.classList.add('active');
            loadHighlightsContent();
        }
        
        // Load highlights content
        function loadHighlightsContent() {
            const highlightsContent = document.getElementById('highlightsContent');
            if (!highlightsContent) return;
            
            highlightsContent.innerHTML = '';
            
            if (highlights.length === 0) {
                highlightsContent.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary); width: 100%;">
                        <i class="fas fa-star" style="font-size: 48px; margin-bottom: 15px;"></i>
                        <p>No highlights yet</p>
                        <p style="font-size: 14px; margin-top: 10px;">Save important statuses to highlights</p>
                    </div>
                `;
                return;
            }
            
            highlights.forEach(highlight => {
                const highlightItem = document.createElement('div');
                highlightItem.className = 'highlight-item';
                highlightItem.innerHTML = `
                    <div class="highlight-cover" style="background: ${highlight.color || 'var(--highlight-gradient)'}">
                        <i class="${highlight.icon || 'fas fa-star'}"></i>
                    </div>
                    <div class="highlight-info">
                        <div class="highlight-name">${escapeHtml(highlight.name)}</div>
                        <div class="highlight-count">${highlight.count || 0} statuses</div>
                    </div>
                `;
                
                highlightItem.addEventListener('click', () => {
                    // Show highlight content
                    showNotification(`Opening ${highlight.name}`, 'info');
                });
                
                highlightsContent.appendChild(highlightItem);
            });
        }
        
        // Show highlights editor
        function showHighlightsEditor(highlight = null) {
            const editorTitle = document.getElementById('highlightEditorTitle');
            const nameInput = document.getElementById('highlightNameInput');
            const iconSelect = document.getElementById('highlightIconSelect');
            
            if (editorTitle && nameInput && iconSelect) {
                if (highlight) {
                    editorTitle.textContent = 'Edit Highlight';
                    nameInput.value = highlight.name || '';
                    iconSelect.value = highlight.icon || 'fas fa-star';
                    
                    // Select color
                    const colorGrid = document.getElementById('highlightColorGrid');
                    if (colorGrid && highlight.color) {
                        const colorOption = colorGrid.querySelector(`[data-bg="${highlight.color}"]`);
                        if (colorOption) {
                            document.querySelectorAll('#highlightColorGrid .background-option').forEach(opt => {
                                opt.classList.remove('selected');
                            });
                            colorOption.classList.add('selected');
                        }
                    }
                    
                    // Select privacy
                    const privacyOptions = document.getElementById('highlightPrivacyOptions');
                    if (privacyOptions && highlight.privacy) {
                        const privacyOption = privacyOptions.querySelector(`[data-privacy="${highlight.privacy}"]`);
                        if (privacyOption) {
                            document.querySelectorAll('#highlightPrivacyOptions .privacy-option').forEach(opt => {
                                opt.classList.remove('selected');
                            });
                            privacyOption.classList.add('selected');
                        }
                    }
                } else {
                    editorTitle.textContent = 'Create Highlight';
                    nameInput.value = '';
                    iconSelect.value = 'fas fa-star';
                }
            }
            
            highlightsEditorModal.classList.add('active');
        }
        
        // Save highlight
        function saveHighlight() {
            const nameInput = document.getElementById('highlightNameInput');
            const iconSelect = document.getElementById('highlightIconSelect');
            const selectedColor = document.querySelector('#highlightColorGrid .background-option.selected');
            const selectedPrivacy = document.querySelector('#highlightPrivacyOptions .privacy-option.selected');
            
            if (!nameInput || !nameInput.value.trim()) {
                showNotification('Please enter a highlight name', 'error');
                return;
            }
            
            const highlight = {
                id: 'highlight_' + Date.now(),
                name: nameInput.value.trim(),
                icon: iconSelect.value,
                color: selectedColor ? selectedColor.dataset.bg : 'gradient-1',
                privacy: selectedPrivacy ? selectedPrivacy.dataset.privacy : 'friends',
                count: 0,
                statusIds: [],
                createdAt: new Date().toISOString()
            };
            
            highlights.push(highlight);
            localStorage.setItem(LOCAL_STORAGE_KEYS.HIGHLIGHTS, JSON.stringify(highlights));
            
            showNotification('Highlight saved successfully', 'success');
            highlightsEditorModal.classList.remove('active');
            loadHighlightsContent();
        }
        
        // Show memory timeline modal
        function showMemoryTimelineModal() {
            memoryTimelineModal.classList.add('active');
            loadMemoryTimelineContent();
        }
        
        // Load memory timeline content
        function loadMemoryTimelineContent() {
            const memoryTimelineContent = document.getElementById('memoryTimelineContent');
            if (!memoryTimelineContent) return;
            
            // Group statuses by month
            const groupedByMonth = {};
            myStatuses.forEach(status => {
                const date = new Date(status.createdAt);
                const monthYear = date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                
                if (!groupedByMonth[monthYear]) {
                    groupedByMonth[monthYear] = [];
                }
                groupedByMonth[monthYear].push(status);
            });
            
            memoryTimelineContent.innerHTML = '';
            
            Object.entries(groupedByMonth).forEach(([monthYear, monthStatuses]) => {
                const monthSection = document.createElement('div');
                monthSection.className = 'timeline-month';
                
                let daysHtml = '';
                monthStatuses.slice(0, 10).forEach(status => {
                    const date = new Date(status.createdAt);
                    const day = date.getDate();
                    const month = date.toLocaleDateString('en-US', { month: 'short' });
                    
                    daysHtml += `
                        <div class="timeline-day" data-status-id="${status.id}">
                            <div class="timeline-date">${day} ${month}</div>
                            <div class="timeline-status">${getStatusPreviewText(status)}</div>
                            ${status.mood ? `<div class="timeline-mood" style="background-color: ${statusMoods[status.mood]?.color || 'var(--mood-happy)'}"></div>` : ''}
                        </div>
                    `;
                });
                
                monthSection.innerHTML = `
                    <div class="timeline-month-header">${monthYear}</div>
                    <div class="timeline-days">
                        ${daysHtml}
                    </div>
                `;
                
                // Add click events to days
                const dayElements = monthSection.querySelectorAll('.timeline-day');
                dayElements.forEach(dayElement => {
                    dayElement.addEventListener('click', () => {
                        const statusId = dayElement.dataset.statusId;
                        const status = myStatuses.find(s => s.id === statusId);
                        if (status) {
                            showStatusViewer(status);
                            memoryTimelineModal.classList.remove('active');
                        }
                    });
                });
                
                memoryTimelineContent.appendChild(monthSection);
            });
        }
        
        // Show stats modal
        function showStatsModal() {
            statsModal.classList.add('active');
            loadStatsContent();
        }
        
        // Load stats content
        function loadStatsContent() {
            const statsContent = document.getElementById('statsContent');
            if (!statsContent) return;
            
            // Calculate stats
            const totalStatuses = myStatuses.length;
            const totalViews = myStatuses.reduce((sum, status) => sum + (status.views || 0), 0);
            const avgViewTime = myStatuses.length > 0 ? 
                Math.round(myStatuses.reduce((sum, status) => sum + (status.avgViewTime || 0), 0) / myStatuses.length) : 0;
            const totalReactions = myStatuses.reduce((sum, status) => sum + (status.reactions || 0), 0);
            const engagementRate = totalViews > 0 ? Math.round((totalReactions / totalViews) * 100) : 0;
            
            const mostPopularMood = getMostPopularMood();
            
            // Update quick stats
            document.getElementById('totalStatusesStat').textContent = totalStatuses;
            document.getElementById('totalViewsStat').textContent = totalViews;
            document.getElementById('totalReactionsStat').textContent = totalReactions;
            document.getElementById('streakStat').textContent = streakCount;
            document.getElementById('avgViewTimeStat').textContent = avgViewTime + 's';
            document.getElementById('engagementRateStat').textContent = engagementRate + '%';
            
            // Update chart
            updateStatsChart();
            
            // Load recent viewers
            loadRecentViewers();
        }
        
        // Update stats chart
        function updateStatsChart() {
            const viewsChart = document.getElementById('viewsChart');
            if (!viewsChart) return;
            
            // Generate sample data for demo
            const chartData = [];
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                chartData.push({
                    date: date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                    views: Math.floor(Math.random() * 100) + 10
                });
            }
            
            // Create simple bar chart
            viewsChart.innerHTML = '';
            const chartHeight = 200;
            const maxViews = Math.max(...chartData.map(d => d.views));
            
            const chartContainer = document.createElement('div');
            chartContainer.style.display = 'flex';
            chartContainer.style.alignItems = 'flex-end';
            chartContainer.style.gap = '2px';
            chartContainer.style.height = chartHeight + 'px';
            chartContainer.style.width = '100%';
            
            chartData.forEach((data, index) => {
                const bar = document.createElement('div');
                bar.style.flex = '1';
                bar.style.height = (data.views / maxViews * 100) + '%';
                bar.style.backgroundColor = 'var(--primary-color)';
                bar.style.borderRadius = '2px 2px 0 0';
                bar.style.position = 'relative';
                bar.title = `${data.date}: ${data.views} views`;
                
                // Add hover effect
                bar.addEventListener('mouseenter', () => {
                    bar.style.backgroundColor = '#0073e6';
                });
                bar.addEventListener('mouseleave', () => {
                    bar.style.backgroundColor = 'var(--primary-color)';
                });
                
                chartContainer.appendChild(bar);
            });
            
            viewsChart.appendChild(chartContainer);
        }
        
        // Load recent viewers
        function loadRecentViewers() {
            const recentViewersList = document.getElementById('recentViewersList');
            if (!recentViewersList) return;
            
            recentViewersList.innerHTML = '';
            
            // Generate sample viewers for demo
            const sampleViewers = [
                { name: 'Alex Johnson', time: '2 hours ago', avatar: 'AJ' },
                { name: 'Sam Wilson', time: '5 hours ago', avatar: 'SW' },
                { name: 'Taylor Swift', time: '1 day ago', avatar: 'TS' },
                { name: 'John Doe', time: '2 days ago', avatar: 'JD' },
                { name: 'Jane Smith', time: '3 days ago', avatar: 'JS' }
            ];
            
            sampleViewers.forEach(viewer => {
                const viewerItem = document.createElement('div');
                viewerItem.className = 'viewer-item';
                viewerItem.innerHTML = `
                    <div class="viewer-avatar">${viewer.avatar}</div>
                    <div class="viewer-info">
                        <div class="viewer-name">${viewer.name}</div>
                        <div class="viewer-time">${viewer.time}</div>
                    </div>
                `;
                recentViewersList.appendChild(viewerItem);
            });
        }
        
        // Get most popular mood
        function getMostPopularMood() {
            const moodCounts = {};
            myStatuses.forEach(status => {
                if (status.mood) {
                    moodCounts[status.mood] = (moodCounts[status.mood] || 0) + 1;
                }
            });
            
            let mostPopular = null;
            let maxCount = 0;
            
            Object.entries(moodCounts).forEach(([mood, count]) => {
                if (count > maxCount) {
                    mostPopular = mood;
                    maxCount = count;
                }
            });
            
            return mostPopular;
        }
        
        // Show drafts modal
        function showDraftsModal() {
            draftsModal.classList.add('active');
            updateDraftsList();
        }
        
        // Update drafts list
        function updateDraftsList() {
            const allDraftsList = document.getElementById('allDraftsList');
            if (!allDraftsList) return;
            
            allDraftsList.innerHTML = '';
            
            if (drafts.length === 0) {
                allDraftsList.innerHTML = `
                    <div class="drafts-empty">
                        <i class="fas fa-file-alt"></i>
                        <p>No drafts yet</p>
                        <p class="subtext">Save a status as draft to see it here</p>
                    </div>
                `;
                return;
            }
            
            drafts.forEach(draft => {
                const draftItem = document.createElement('div');
                draftItem.className = 'draft-item';
                draftItem.dataset.draftId = draft.id;
                
                let previewText = '';
                if (draft.type === 'text') {
                    previewText = draft.text || 'Text draft';
                } else if (draft.type === 'media') {
                    previewText = ` ${draft.caption || 'Media draft'}`;
                } else if (draft.type === 'poll') {
                    previewText = ` ${draft.question || 'Poll draft'}`;
                }
                
                const timeAgo = draft.createdAt ? formatTimeAgo(new Date(draft.createdAt)) : 'Just now';
                
                draftItem.innerHTML = `
                    <div class="draft-preview">${escapeHtml(previewText.substring(0, 100) + (previewText.length > 100 ? '...' : ''))}</div>
                    <div class="draft-meta">
                        <span>${timeAgo}  ${draft.type || 'Unknown'}</span>
                        <div class="draft-actions">
                            <button class="draft-action-btn" data-action="edit" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="draft-action-btn danger" data-action="delete" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                // Handle selection
                draftItem.addEventListener('click', (e) => {
                    if (!e.target.closest('.draft-actions')) {
                        draftItem.classList.toggle('selected');
                        if (draftItem.classList.contains('selected')) {
                            selectedDraft = draft;
                            document.getElementById('loadDraftBtn').disabled = false;
                        } else {
                            selectedDraft = null;
                            document.getElementById('loadDraftBtn').disabled = true;
                        }
                    }
                });
                
                // Handle draft actions
                const actionButtons = draftItem.querySelectorAll('.draft-action-btn');
                actionButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const action = btn.dataset.action;
                        handleDraftAction(action, draft);
                    });
                });
                
                allDraftsList.appendChild(draftItem);
            });
        }
        
        // Handle draft action
        function handleDraftAction(action, draft) {
            switch(action) {
                case 'edit':
                    loadDraft(draft);
                    break;
                case 'delete':
                    deleteDraft(draft.id);
                    break;
            }
        }
        
        // Load draft into editor
        function loadDraft(draft) {
            if (!draft) return;
            
            // Open create status modal
            createStatusModal.classList.add('active');
            
            // Set text based on draft type
            if (draft.type === 'text') {
                document.querySelector('.create-status-tab[data-tab="text"]').click();
                if (draft.text) {
                    document.getElementById('textStatusInput').value = draft.text;
                    updateTextStatusCounter();
                }
            } else if (draft.type === 'media') {
                document.querySelector('.create-status-tab[data-tab="media"]').click();
                if (draft.caption) {
                    document.getElementById('mediaCaptionInput').value = draft.caption;
                }
            } else if (draft.type === 'poll') {
                document.querySelector('.create-status-tab[data-tab="poll"]').click();
                if (draft.question) {
                    document.getElementById('pollQuestionInput').value = draft.question;
                }
            }
            
            // Close drafts modal
            draftsModal.classList.remove('active');
            showNotification('Draft loaded', 'success');
        }
        
        // Delete draft
        function deleteDraft(draftId) {
            if (!confirm('Are you sure you want to delete this draft?')) {
                return;
            }
            
            drafts = drafts.filter(draft => draft.id !== draftId);
            localStorage.setItem(LOCAL_STORAGE_KEYS.DRAFTS, JSON.stringify(drafts));
            showNotification('Draft deleted', 'success');
            updateDraftsList();
        }
        
        // Delete all drafts
        function deleteAllDrafts() {
            if (drafts.length === 0) {
                showNotification('No drafts to delete', 'info');
                return;
            }
            
            if (!confirm('Are you sure you want to delete all drafts? This action cannot be undone.')) {
                return;
            }
            
            drafts = [];
            localStorage.setItem(LOCAL_STORAGE_KEYS.DRAFTS, JSON.stringify(drafts));
            showNotification('All drafts deleted', 'success');
            updateDraftsList();
        }
        
        // Update scheduled statuses list
        function updateScheduledStatusesList() {
            const scheduledStatusesList = document.getElementById('scheduledStatusesList');
            if (!scheduledStatusesList) return;
            
            scheduledStatusesList.innerHTML = '';
            
            if (scheduledStatuses.length === 0) {
                scheduledStatusesList.innerHTML = `
                    <div class="schedule-empty">
                        <i class="fas fa-clock"></i>
                        <p>No scheduled statuses</p>
                        <p class="subtext">Schedule a status to see it here</p>
                    </div>
                `;
                return;
            }
            
            scheduledStatuses.forEach(scheduled => {
                const scheduleItem = document.createElement('div');
                scheduleItem.className = 'schedule-item';
                
                const scheduledFor = new Date(scheduled.scheduledFor);
                const timeString = scheduledFor.toLocaleString();
                
                scheduleItem.innerHTML = `
                    <div class="schedule-info">
                        <h4>${scheduled.type || 'Status'} - ${getStatusPreviewText(scheduled)}</h4>
                        <div class="schedule-time">Scheduled for: ${timeString}</div>
                    </div>
                    <div class="schedule-actions">
                        <button class="edit-btn" data-action="edit" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="cancel-btn" data-action="cancel" title="Cancel">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                // Handle schedule actions
                const actionButtons = scheduleItem.querySelectorAll('button');
                actionButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const action = btn.dataset.action;
                        handleScheduleAction(action, scheduled);
                    });
                });
                
                scheduledStatusesList.appendChild(scheduleItem);
            });
        }
        
        // Handle schedule action
        function handleScheduleAction(action, scheduled) {
            switch(action) {
                case 'edit':
                    // Load scheduled status for editing
                    showNotification('Edit scheduled status feature coming soon', 'info');
                    break;
                case 'cancel':
                    cancelScheduledStatus(scheduled.id);
                    break;
            }
        }
        
        // Cancel scheduled status
        function cancelScheduledStatus(scheduleId) {
            if (!confirm('Are you sure you want to cancel this scheduled status?')) {
                return;
            }
            
            scheduledStatuses = scheduledStatuses.filter(s => s.id !== scheduleId);
            localStorage.setItem(LOCAL_STORAGE_KEYS.SCHEDULED, JSON.stringify(scheduledStatuses));
            showNotification('Scheduled status cancelled', 'success');
            updateScheduledStatusesList();
        }
        
        // Add filter tag
        function addFilterTag(filter, label) {
            const filterTags = document.getElementById('filterTags');
            if (!filterTags) return;
            
            // Check if filter already exists
            if (activeFilters.has(filter)) return;
            
            activeFilters.add(filter);
            
            const filterTag = document.createElement('div');
            filterTag.className = 'filter-tag active';
            filterTag.dataset.filter = filter;
            filterTag.innerHTML = `
                ${label}
                <i class="fas fa-times"></i>
            `;
            
            filterTag.addEventListener('click', () => {
                removeFilterTag(filter);
            });
            
            filterTags.appendChild(filterTag);
            
            // Show clear filters button
            const clearFiltersBtn = document.getElementById('clearFiltersBtn');
            if (clearFiltersBtn) {
                clearFiltersBtn.style.display = 'block';
            }
            
            updateCurrentSection();
        }
        
        // Remove filter tag
        function removeFilterTag(filter) {
            activeFilters.delete(filter);
            
            const filterTag = document.querySelector(`.filter-tag[data-filter="${filter}"]`);
            if (filterTag) {
                filterTag.remove();
            }
            
            // Hide clear filters button if no filters
            const clearFiltersBtn = document.getElementById('clearFiltersBtn');
            if (clearFiltersBtn && activeFilters.size === 0) {
                clearFiltersBtn.style.display = 'none';
            }
            
            updateCurrentSection();
        }
        
        // Clear all filters
        function clearAllFilters() {
            activeFilters.clear();
            
            const filterTags = document.getElementById('filterTags');
            if (filterTags) {
                filterTags.innerHTML = '';
            }
            
            const clearFiltersBtn = document.getElementById('clearFiltersBtn');
            if (clearFiltersBtn) {
                clearFiltersBtn.style.display = 'none';
            }
            
            updateCurrentSection();
        }
        
        // Show notification
        function showNotification(message, type = 'success') {
            const notificationText = document.getElementById('notificationText');
            if (!notificationText) return;
            
            notificationText.textContent = message;
            notification.className = 'notification';
            notification.classList.add(type);
            notification.classList.add('active');
            
            setTimeout(() => {
                notification.classList.remove('active');
            }, 3000);
        }
        
        // Utility functions
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function formatTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return `${Math.floor(diffDays / 7)}w ago`;
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Create status button
            document.getElementById('createStatusBtn').addEventListener('click', () => {
                createStatusModal.classList.add('active');
                document.querySelector('.create-status-tab[data-tab="text"]').click();
            });
            
            // Close create status modal
            document.getElementById('closeCreateStatusModal').addEventListener('click', () => {
                createStatusModal.classList.remove('active');
            });
            
            // Create status tabs
            document.querySelectorAll('.create-status-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    
                    document.querySelectorAll('.create-status-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    document.querySelectorAll('.create-status-tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    const tabContent = document.getElementById(`${tabName}Tab`);
                    if (tabContent) {
                        tabContent.classList.add('active');
                    }
                });
            });
            
            // Text status input counter
            const textStatusInput = document.getElementById('textStatusInput');
            if (textStatusInput) {
                textStatusInput.addEventListener('input', updateTextStatusCounter);
                updateTextStatusCounter();
            }
            
            // Clear text button
            document.getElementById('clearTextBtn').addEventListener('click', () => {
                if (textStatusInput) {
                    textStatusInput.value = '';
                    updateTextStatusCounter();
                }
            });
            
            // Media upload area
            const mediaUploadArea = document.getElementById('mediaUploadArea');
            const mediaFileInput = document.getElementById('mediaFileInput');
            
            if (mediaUploadArea && mediaFileInput) {
                mediaUploadArea.addEventListener('click', () => {
                    mediaFileInput.click();
                });
                
                mediaFileInput.addEventListener('change', handleMediaUpload);
            }
            
            // Add poll option
            document.getElementById('addPollOptionBtn').addEventListener('click', () => {
                const pollOptionsContainer = document.getElementById('pollOptionsContainer');
                if (!pollOptionsContainer) return;
                
                const optionCount = pollOptionsContainer.children.length + 1;
                if (optionCount > 6) {
                    showNotification('Maximum 6 options allowed', 'warning');
                    return;
                }
                
                addPollOption(optionCount);
            });
            
            // Post status button
            document.getElementById('postStatusBtn').addEventListener('click', () => {
                const activeTab = document.querySelector('.create-status-tab.active');
                if (!activeTab) return;
                
                const activeTabName = activeTab.dataset.tab;
                let statusData = {
                    type: activeTabName,
                    userId: currentUser?.id,
                    user: currentUser,
                    createdAt: new Date().toISOString()
                };
                
                // Get metadata
                const selectedIntent = document.querySelector('.intent-option.selected')?.dataset.intent;
                const selectedMood = document.querySelector('.mood-option.selected')?.dataset.mood;
                const selectedCategory = document.querySelector('.category-option.selected')?.dataset.category;
                const selectedPrivacy = document.querySelector('.privacy-option.selected')?.dataset.privacy;
                const selectedDuration = document.querySelector('.duration-option.selected')?.dataset.duration;
                const selectedActions = Array.from(document.querySelectorAll('.action-button-option.selected')).map(opt => opt.dataset.action);
                
                if (selectedIntent) statusData.intent = selectedIntent;
                if (selectedMood) statusData.mood = selectedMood;
                if (selectedCategory) statusData.category = selectedCategory;
                if (selectedPrivacy) statusData.privacy = selectedPrivacy;
                if (selectedDuration) statusData.duration = selectedDuration;
                if (selectedActions.length > 0) statusData.actionButtons = selectedActions;
                
                // Advanced options
                statusData.isSensitive = document.getElementById('sensitiveContentToggle').checked;
                statusData.isSilent = document.getElementById('silentModeToggle').checked;
                statusData.autoTranslate = document.getElementById('autoTranslateToggle').checked;
                statusData.offlineQueue = document.getElementById('offlineQueueToggle').checked;
                
                if (activeTabName === 'text') {
                    const text = document.getElementById('textStatusInput').value.trim();
                    if (!text) {
                        showNotification('Please enter text for your status', 'error');
                        return;
                    }
                    
                    statusData.text = text;
                    statusData.background = document.querySelector('.background-option.selected')?.dataset.bg;
                    
                } else if (activeTabName === 'media') {
                    // In a real implementation, you would upload media files
                    const caption = document.getElementById('mediaCaptionInput').value.trim();
                    statusData.caption = caption;
                    statusData.mediaType = 'image'; // Simplified
                    statusData.mediaUrl = 'https://via.placeholder.com/600x400'; // Placeholder
                    
                } else if (activeTabName === 'poll') {
                    const question = document.getElementById('pollQuestionInput').value.trim();
                    if (!question) {
                        showNotification('Please enter a question for your poll', 'error');
                        return;
                    }
                    
                    const options = Array.from(document.querySelectorAll('.poll-option-input')).map(input => ({
                        id: `option_${input.dataset.index}`,
                        text: input.value.trim(),
                        votes: 0
                    })).filter(opt => opt.text);
                    
                    if (options.length < 2) {
                        showNotification('Please enter at least 2 options', 'error');
                        return;
                    }
                    
                    statusData.question = question;
                    statusData.options = options;
                    statusData.duration = document.getElementById('pollDurationSelect').value;
                }
                
                postStatus(statusData);
                createStatusModal.classList.remove('active');
            });
            
            // Save draft button
            document.getElementById('saveDraftBtn').addEventListener('click', () => {
                const activeTab = document.querySelector('.create-status-tab.active');
                if (!activeTab) return;
                
                const activeTabName = activeTab.dataset.tab;
                let draftData = {
                    type: activeTabName,
                    createdAt: new Date().toISOString()
                };
                
                if (activeTabName === 'text') {
                    const text = document.getElementById('textStatusInput').value.trim();
                    if (!text) {
                        showNotification('Nothing to save', 'warning');
                        return;
                    }
                    draftData.text = text;
                    draftData.background = document.querySelector('.background-option.selected')?.dataset.bg;
                } else if (activeTabName === 'media') {
                    const caption = document.getElementById('mediaCaptionInput').value.trim();
                    if (!caption) {
                        showNotification('Nothing to save', 'warning');
                        return;
                    }
                    draftData.caption = caption;
                } else if (activeTabName === 'poll') {
                    const question = document.getElementById('pollQuestionInput').value.trim();
                    if (!question) {
                        showNotification('Nothing to save', 'warning');
                        return;
                    }
                    draftData.question = question;
                    
                    const options = Array.from(document.querySelectorAll('.poll-option-input')).map(input => ({
                        id: `option_${input.dataset.index}`,
                        text: input.value.trim(),
                        votes: 0
                    })).filter(opt => opt.text);
                    
                    if (options.length < 2) {
                        showNotification('Please enter at least 2 options to save as draft', 'error');
                        return;
                    }
                    
                    draftData.options = options;
                }
                
                // Get metadata
                const selectedIntent = document.querySelector('.intent-option.selected')?.dataset.intent;
                const selectedMood = document.querySelector('.mood-option.selected')?.dataset.mood;
                const selectedCategory = document.querySelector('.category-option.selected')?.dataset.category;
                
                if (selectedIntent) draftData.intent = selectedIntent;
                if (selectedMood) draftData.mood = selectedMood;
                if (selectedCategory) draftData.category = selectedCategory;
                
                saveDraft(draftData);
                createStatusModal.classList.remove('active');
            });
            
            // Schedule button
            document.getElementById('scheduleStatusBtn').addEventListener('click', () => {
                scheduleModal.classList.add('active');
            });
            
            // Close schedule modal
            document.getElementById('closeScheduleModal').addEventListener('click', () => {
                scheduleModal.classList.remove('active');
            });
            
            // Confirm schedule
            document.getElementById('confirmScheduleBtn').addEventListener('click', () => {
                const scheduleDate = document.getElementById('scheduleDate').value;
                const scheduleTime = document.getElementById('scheduleTime').value;
                
                if (!scheduleDate || !scheduleTime) {
                    showNotification('Please select both date and time', 'error');
                    return;
                }
                
                const scheduleDateTime = new Date(`${scheduleDate}T${scheduleTime}`);
                if (scheduleDateTime <= new Date()) {
                    showNotification('Please select a future date and time', 'error');
                    return;
                }
                
                // Get status data from create modal
                const activeTab = document.querySelector('.create-status-tab.active');
                if (!activeTab) {
                    showNotification('Please create a status first', 'error');
                    return;
                }
                
                const activeTabName = activeTab.dataset.tab;
                let statusData = {
                    type: activeTabName,
                    userId: currentUser?.id,
                    user: currentUser
                };
                
                if (activeTabName === 'text') {
                    const text = document.getElementById('textStatusInput').value.trim();
                    if (!text) {
                        showNotification('Please enter text for your status', 'error');
                        return;
                    }
                    statusData.text = text;
                } else if (activeTabName === 'media') {
                    const caption = document.getElementById('mediaCaptionInput').value.trim();
                    statusData.caption = caption;
                } else if (activeTabName === 'poll') {
                    const question = document.getElementById('pollQuestionInput').value.trim();
                    if (!question) {
                        showNotification('Please enter a question for your poll', 'error');
                        return;
                    }
                    statusData.question = question;
                }
                
                // Get repeat option
                const selectedRepeat = document.querySelector('.repeat-option.selected')?.dataset.repeat;
                
                scheduleStatus(statusData, scheduleDateTime.toISOString());
                showNotification('Status scheduled successfully', 'success');
                scheduleModal.classList.remove('active');
                createStatusModal.classList.remove('active');
            });
            
            // Category tabs
            const categoryTabs = {
                'allTab': 'allStatusSection',
                'friendsTab': 'friendsStatusSection',
                'closeFriendsTab': 'closeFriendsStatusSection',
                'pinnedTab': 'pinnedStatusSection',
                'mutedTab': 'mutedStatusSection',
                'microCirclesTab': 'microCirclesStatusSection',
                'myStatusTab': 'myStatusSection'
            };
            
            Object.keys(categoryTabs).forEach(tabId => {
                const tab = document.getElementById(tabId);
                if (tab) {
                    tab.addEventListener('click', function() {
                        document.querySelectorAll('.category-btn').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        this.classList.add('active');
                        
                        document.querySelectorAll('.statuses-section').forEach(section => {
                            section.classList.remove('active');
                        });
                        
                        const sectionId = categoryTabs[tabId];
                        document.getElementById(sectionId).classList.add('active');
                        updateCurrentSection();
                    });
                }
            });
            
            // Intent & mood filter buttons
            document.querySelectorAll('.category-btn[data-filter]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const filter = this.dataset.filter;
                    let label = '';
                    
                    if (filter.startsWith('intent-')) {
                        const intentKey = filter.replace('intent-', '');
                        label = statusIntents[intentKey]?.name || intentKey;
                        addFilterTag(filter, label);
                    } else if (filter.startsWith('mood-')) {
                        const moodKey = filter.replace('mood-', '');
                        label = statusMoods[moodKey]?.name || moodKey;
                        addFilterTag(filter, label);
                    }
                });
            });
            
            // Clear filters button
            document.getElementById('clearFiltersBtn').addEventListener('click', clearAllFilters);
            
            // Viewer back button
            document.getElementById('viewerBackBtn').addEventListener('click', () => {
                statusViewerPanel.classList.remove('active');
                stopAutoAdvance();
            });
            
            // Pause/resume button
            document.getElementById('pauseResumeBtn').addEventListener('click', toggleAutoAdvance);
            
            // Mute user button
            document.getElementById('muteUserBtn').addEventListener('click', () => {
                if (currentViewerStatus) {
                    if (mutedUsers.has(currentViewerStatus.userId)) {
                        unmuteUser(currentViewerStatus.userId);
                    } else {
                        muteUser(currentViewerStatus.userId);
                    }
                }
            });
            
            // Share status button
            document.getElementById('shareStatusBtn').addEventListener('click', () => {
                if (currentViewerStatus) {
                    // In a real implementation, this would use the Web Share API
                    showNotification('Share feature coming soon', 'info');
                }
            });
            
            // Save status button
            document.getElementById('saveStatusBtn').addEventListener('click', () => {
                if (currentViewerStatus) {
                    // Save to highlights
                    showNotification('Save to highlights feature coming soon', 'info');
                }
            });
            
            // Report status button
            document.getElementById('reportStatusBtn').addEventListener('click', () => {
                if (currentViewerStatus) {
                    reportModal.classList.add('active');
                }
            });
            
            // Close report modal
            document.getElementById('closeReportModal').addEventListener('click', () => {
                reportModal.classList.remove('active');
            });
            
            // Report details counter
            const reportDetails = document.getElementById('reportDetails');
            if (reportDetails) {
                reportDetails.addEventListener('input', updateReportDetailsCounter);
            }
            
            // Anonymous report toggle
            const anonymousReportToggle = document.getElementById('anonymousReportToggle');
            if (anonymousReportToggle) {
                anonymousReportToggle.addEventListener('change', updateReportSubmitButton);
            }
            
            // Submit report
            document.getElementById('submitReportBtn').addEventListener('click', () => {
                const selectedReason = document.querySelector('#reportReasons .category-option.selected')?.dataset.reason;
                const details = document.getElementById('reportDetails').value.trim();
                const isAnonymous = document.getElementById('anonymousReportToggle').checked;
                
                if (!selectedReason) {
                    showNotification('Please select a reason', 'error');
                    return;
                }
                
                if (details.length < 10) {
                    showNotification('Please provide more details (minimum 10 characters)', 'error');
                    return;
                }
                
                if (currentViewerStatus) {
                    reportStatus(currentViewerStatus.id, selectedReason, details);
                    showNotification(`Report submitted ${isAnonymous ? 'anonymously' : ''}`, 'success');
                    reportModal.classList.remove('active');
                }
            });
            
            // Send reply
            document.getElementById('sendReplyBtn').addEventListener('click', () => {
                const replyInput = document.getElementById('replyInput');
                if (!replyInput) return;
                
                const replyText = replyInput.value.trim();
                if (!replyText) return;
                
                if (currentViewerStatus) {
                    // In a real implementation, this would send a reply to the status
                    showNotification('Reply sent: ' + replyText, 'success');
                    replyInput.value = '';
                }
            });
            
            // Reply input enter key
            const replyInput = document.getElementById('replyInput');
            if (replyInput) {
                replyInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        document.getElementById('sendReplyBtn').click();
                    }
                });
            }
            
            // View highlights
            document.getElementById('viewHighlightsBtn').addEventListener('click', showHighlightsModal);
            document.getElementById('closeHighlightsModal').addEventListener('click', () => {
                highlightsModal.classList.remove('active');
            });
            
            // Create highlight
            document.getElementById('createHighlightBtn').addEventListener('click', () => {
                showHighlightsEditor();
            });
            
            // Close highlights editor
            document.getElementById('closeHighlightsEditor').addEventListener('click', () => {
                highlightsEditorModal.classList.remove('active');
            });
            
            // Cancel highlight
            document.getElementById('cancelHighlightBtn').addEventListener('click', () => {
                highlightsEditorModal.classList.remove('active');
            });
            
            // Save highlight
            document.getElementById('saveHighlightBtn').addEventListener('click', saveHighlight);
            
            // View timeline
            document.getElementById('viewTimelineBtn').addEventListener('click', showMemoryTimelineModal);
            document.getElementById('closeMemoryTimelineModal').addEventListener('click', () => {
                memoryTimelineModal.classList.remove('active');
            });
            
            // Export timeline
            document.getElementById('exportTimelineBtn').addEventListener('click', () => {
                showNotification('Export feature coming soon', 'info');
            });
            
            // View stats
            document.getElementById('viewStatsBtn').addEventListener('click', showStatsModal);
            document.getElementById('closeStatsModal').addEventListener('click', () => {
                statsModal.classList.remove('active');
            });
            
            // Refresh stats
            document.getElementById('refreshStatsBtn').addEventListener('click', () => {
                loadStatsContent();
                showNotification('Stats refreshed', 'success');
            });
            
            // View drafts
            document.getElementById('viewDraftsBtn').addEventListener('click', showDraftsModal);
            document.getElementById('closeDraftsModal').addEventListener('click', () => {
                draftsModal.classList.remove('active');
            });
            
            // Delete all drafts
            document.getElementById('deleteAllDraftsBtn').addEventListener('click', deleteAllDrafts);
            
            // Load draft
            document.getElementById('loadDraftBtn').addEventListener('click', () => {
                if (selectedDraft) {
                    loadDraft(selectedDraft);
                }
            });
            
            // View scheduled
            document.getElementById('viewScheduledBtn').addEventListener('click', () => {
                scheduleModal.classList.add('active');
            });
            
            // View my status
            document.getElementById('viewMyStatusBtn').addEventListener('click', () => {
                if (myStatuses.length > 0) {
                    showStatusViewer(myStatuses[0]);
                } else {
                    showNotification('You have no statuses yet', 'info');
                }
            });
            
            // Edit my status
            document.getElementById('editMyStatusBtn').addEventListener('click', () => {
                if (myStatuses.length > 0) {
                    // Load latest status for editing
                    showNotification('Edit status feature coming soon', 'info');
                } else {
                    createStatusModal.classList.add('active');
                }
            });
            
            // My status preview click
            document.getElementById('myStatusPreview').addEventListener('click', () => {
                if (myStatuses.length > 0) {
                    showStatusViewer(myStatuses[0]);
                } else {
                    createStatusModal.classList.add('active');
                }
            });
            
            // Notification time select
            const notificationTimeSelect = document.getElementById('notificationTimeSelect');
            const scheduleNotificationToggle = document.getElementById('scheduleNotificationToggle');
            
            if (notificationTimeSelect && scheduleNotificationToggle) {
                scheduleNotificationToggle.addEventListener('change', function() {
                    notificationTimeSelect.disabled = !this.checked;
                });
            }
            
            // Error UI buttons
            document.getElementById('retryConnectionBtn').addEventListener('click', async () => {
                errorUI.classList.remove('active');
                showNotification('Retrying connection...', 'info');
                
                try {
                    await initializeStatusSystem();
                } catch (error) {
                    errorUI.classList.add('active');
                }
            });
            
            document.getElementById('offlineModeBtn').addEventListener('click', () => {
                errorUI.classList.remove('active');
                isOfflineMode = true;
                showNotification('Offline mode enabled', 'warning');
            });
            
            // Close notification
            document.getElementById('closeNotificationBtn').addEventListener('click', () => {
                notification.classList.remove('active');
            });
            
            // Window resize
            window.addEventListener('resize', () => {
                isMobile = window.innerWidth <= 768;
            });
            
            // Before unload
            window.addEventListener('beforeunload', () => {
                stopAutoAdvance();
            });
        }
        
        // Handle media upload
        function handleMediaUpload(event) {
            const files = event.target.files;
            const mediaPreview = document.getElementById('mediaPreview');
            
            if (!mediaPreview) return;
            
            mediaPreview.innerHTML = '';
            
            for (let i = 0; i < Math.min(files.length, 5); i++) {
                const file = files[i];
                const fileType = file.type.split('/')[0];
                
                if (fileType !== 'image' && fileType !== 'video') {
                    showNotification('Only images and videos are supported', 'error');
                    continue;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const mediaItem = document.createElement('div');
                    mediaItem.className = 'media-preview-item';
                    
                    if (fileType === 'image') {
                        mediaItem.innerHTML = `
                            <img src="${e.target.result}" class="media-preview-image" alt="Preview">
                            <button class="remove-media-btn" type="button">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                    } else if (fileType === 'video') {
                        mediaItem.innerHTML = `
                            <video src="${e.target.result}" class="media-preview-image" controls></video>
                            <button class="remove-media-btn" type="button">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                    }
                    
                    // Remove button
                    const removeBtn = mediaItem.querySelector('.remove-media-btn');
                    removeBtn.addEventListener('click', () => {
                        mediaItem.remove();
                    });
                    
                    mediaPreview.appendChild(mediaItem);
                };
                
                reader.readAsDataURL(file);
            }
        }
        
        // Stop auto-advance
        function stopAutoAdvance() {
            if (autoAdvanceInterval) {
                clearInterval(autoAdvanceInterval);
                autoAdvanceInterval = null;
            }
            
            if (progressInterval) {
                clearInterval(progressInterval);
                progressInterval = null;
            }
        }
        
        console.log('Status system initialized successfully');
    </script>
</body>
</html>