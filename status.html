<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
    <link rel="icon" href="../icons/moodchat-192.png">
    <link rel="icon" href="../icons/moodchat-512.png">
    <meta name="theme-color" content="#000000">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Status | Knecta Chat</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Color Picker Library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.1/spectrum.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.1/spectrum.min.js"></script>
    
    <!-- Emoji Picker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/emoji-picker-element@1.12.0/css/picker.css">
    <script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@1.12.0/index.js"></script>
    
    <!-- Video Player -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/video.js/7.21.5/video.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/video.js/7.21.5/video-js.min.css" rel="stylesheet">
    
    <style>
        /* CSS remains exactly the same - no changes */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-color: #0084ff;
            --secondary-color: #f0f2f5;
            --danger-color: #ff3b30;
            --success-color: #34c759;
            --warning-color: #ff9500;
            --info-color: #5ac8fa;
            --text-primary: #050505;
            --text-secondary: #65676b;
            --bg-color: #ffffff;
            --border-color: #dddfe2;
            --status-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.2);
            --story-ring: linear-gradient(45deg, #ff6b6b, #ffa726, #ffeb3b, #4caf50, #2196f3, #9c27b0);
            --story-ring-seen: linear-gradient(45deg, #b0b0b0, #d0d0d0);
            --dark-bg: #121212;
            --dark-card: #1e1e1e;
            --dark-text: #e4e6eb;
        }
        
        [data-theme="dark"] {
            --bg-color: var(--dark-bg);
            --secondary-color: var(--dark-card);
            --text-primary: var(--dark-text);
            --text-secondary: #a0a0a0;
            --border-color: #333;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.3s ease;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
            position: relative;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 380px;
            background-color: var(--bg-color);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
            position: relative;
            transition: all 0.3s ease;
        }
        
        @media (min-width: 769px) {
            .sidebar {
                display: flex;
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                display: flex !important;
                position: relative !important;
                width: 100% !important;
                height: 100vh !important;
                border-right: none !important;
                z-index: auto !important;
            }
            
            .status-viewer-panel {
                position: relative !important;
                width: 100% !important;
                height: auto !important;
                z-index: auto !important;
            }
            
            .app-container {
                flex-direction: column !important;
                height: auto !important;
                min-height: 100vh !important;
            }
            
            .status-list-content {
                padding-bottom: 20px !important;
            }
        }
        
        .sidebar-header {
            padding: 20px;
            background: var(--status-gradient);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        
        .sidebar-header h2 {
            font-size: 24px;
            font-weight: 600;
        }
        
        .add-status-btn {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
        }
        
        .add-status-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        /* Status Categories */
        .status-categories {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--bg-color);
            flex-shrink: 0;
            overflow-x: auto;
            scrollbar-width: none;
        }
        
        .status-categories::-webkit-scrollbar {
            display: none;
        }
        
        .category-btn {
            padding: 15px 20px;
            text-align: center;
            font-weight: 500;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .category-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        
        .category-btn:hover {
            background-color: var(--secondary-color);
        }
        
        /* My Status Section */
        .my-status-section {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .my-status-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .my-status-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            margin-right: 15px;
            position: relative;
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }
        
        .my-status-avatar.has-status {
            padding: 3px;
            background: var(--story-ring);
            background-size: 400% 400%;
            animation: gradient-ring 3s ease infinite;
        }
        
        .my-status-avatar.has-status.seen {
            background: var(--story-ring-seen);
            animation: none;
        }
        
        .my-status-info {
            flex: 1;
        }
        
        .my-status-name {
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .my-status-text {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .my-status-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .my-status-action-btn {
            flex: 1;
            padding: 12px;
            background-color: var(--secondary-color);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .my-status-action-btn:hover {
            background-color: #e4e6e9;
        }
        
        .my-status-action-btn.primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .my-status-action-btn.primary:hover {
            background-color: #0073e6;
        }
        
        /* Status List */
        .status-list {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .status-list-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }
        
        .section-title {
            padding: 15px 20px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: var(--bg-color);
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }
        
        .status-item:hover {
            background-color: var(--secondary-color);
        }
        
        .status-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            margin-right: 15px;
            position: relative;
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }
        
        .status-avatar.has-status {
            padding: 3px;
            background: var(--story-ring);
            background-size: 400% 400%;
            animation: gradient-ring 3s ease infinite;
        }
        
        .status-avatar.has-status.seen {
            background: var(--story-ring-seen);
            animation: none;
        }
        
        .status-info {
            flex: 1;
            min-width: 0;
        }
        
        .status-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .status-time {
            color: var(--text-secondary);
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-preview {
            color: var(--text-secondary);
            font-size: 14px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .status-count {
            background-color: var(--primary-color);
            color: white;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
        }
        
        /* Status Viewer Panel */
        .status-viewer-panel {
            flex: 1;
            background-color: #000;
            position: relative;
            display: none;
            overflow: hidden;
        }
        
        .status-viewer-panel.active {
            display: flex;
            flex-direction: column;
        }
        
        .status-viewer-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 100;
            background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%);
        }
        
        .back-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 20px;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.2s;
        }
        
        .back-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .status-viewer-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }
        
        .status-viewer-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }
        
        .status-viewer-name {
            font-weight: 600;
            font-size: 16px;
        }
        
        .status-viewer-time {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .status-viewer-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .status-media {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .status-text-content {
            padding: 40px;
            color: white;
            font-size: 24px;
            text-align: center;
            word-break: break-word;
            max-width: 600px;
        }
        
        .status-viewer-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%);
        }
        
        .status-viewer-actions {
            display: flex;
            gap: 15px;
        }
        
        .status-action-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 20px;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .status-action-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .status-progress-container {
            position: absolute;
            top: 10px;
            left: 20px;
            right: 20px;
            display: flex;
            gap: 5px;
            z-index: 101;
        }
        
        .status-progress-bar {
            flex: 1;
            height: 3px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .status-progress-fill {
            height: 100%;
            background-color: white;
            width: 0%;
            transition: width 0.1s linear;
        }
        
        .status-reply-container {
            position: absolute;
            bottom: 80px;
            left: 0;
            right: 0;
            padding: 0 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }
        
        .status-reply-input {
            flex: 1;
            padding: 12px 20px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 24px;
            color: white;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }
        
        .status-reply-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .status-reply-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s;
        }
        
        .status-reply-btn:hover {
            background-color: #0073e6;
            transform: scale(1.05);
        }
        
        /* Create Status Modal */
        .create-status-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .create-status-modal.active {
            display: flex;
        }
        
        .create-status-container {
            width: 90%;
            max-width: 500px;
            background-color: var(--bg-color);
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
            box-shadow: var(--shadow-lg);
        }
        
        .create-status-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--status-gradient);
            color: white;
        }
        
        .create-status-header h3 {
            font-size: 20px;
            font-weight: 600;
        }
        
        .create-status-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
        }
        
        .create-status-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
        }
        
        .create-status-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        
        .create-status-content {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
        }
        
        .create-status-tab-content {
            display: none;
        }
        
        .create-status-tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        /* Text Status Tab */
        .text-status-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .text-status-preview {
            height: 300px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 30px;
            text-align: center;
            font-size: 24px;
            font-weight: 500;
            word-break: break-word;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .text-status-input {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
            margin-bottom: 10px;
        }
        
        .text-status-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .text-status-options {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .text-status-bg {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .text-status-bg:hover {
            transform: scale(1.05);
        }
        
        .text-status-bg.selected {
            border-color: var(--primary-color);
        }
        
        .emoji-picker-container {
            position: relative;
            margin-bottom: 20px;
        }
        
        .emoji-trigger-btn {
            background-color: var(--secondary-color);
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .emoji-picker-wrapper {
            position: absolute;
            z-index: 1000;
            display: none;
        }
        
        .emoji-picker-wrapper.active {
            display: block;
        }
        
        /* Media Status Tab */
        .media-status-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .media-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .media-upload-area:hover {
            border-color: var(--primary-color);
            background-color: rgba(0, 132, 255, 0.05);
        }
        
        .media-upload-icon {
            font-size: 48px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .media-preview {
            margin-top: 20px;
            max-height: 300px;
            overflow: hidden;
            border-radius: 12px;
            position: relative;
        }
        
        .media-preview img,
        .media-preview video {
            width: 100%;
            max-height: 300px;
            object-fit: contain;
            border-radius: 12px;
        }
        
        .media-remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Status Options Tab */
        .status-options-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .option-group {
            background-color: var(--secondary-color);
            border-radius: 12px;
            padding: 20px;
        }
        
        .option-title {
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .option-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .option-item:last-child {
            border-bottom: none;
        }
        
        .option-label {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .option-icon {
            color: var(--primary-color);
            font-size: 18px;
        }
        
        .privacy-select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-primary);
        }
        
        .duration-select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-primary);
        }
        
        /* Category Select */
        .category-select-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .category-chip {
            padding: 8px 16px;
            background-color: var(--secondary-color);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .category-chip:hover {
            background-color: #e4e6e9;
        }
        
        .category-chip.selected {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* Template Select */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .template-item {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .template-item:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }
        
        .template-item.selected {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(0, 132, 255, 0.2);
        }
        
        .template-preview {
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 500;
        }
        
        .template-name {
            padding: 10px;
            text-align: center;
            font-size: 14px;
            background-color: var(--secondary-color);
        }
        
        /* Poll Creator */
        .poll-creator {
            background-color: var(--secondary-color);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .poll-question-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .poll-option {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .poll-option-input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }
        
        .add-option-btn {
            background-color: var(--secondary-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 10px;
        }
        
        /* Music Selector */
        .music-selector {
            background-color: var(--secondary-color);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .music-search {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .music-tracks {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .music-track {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .music-track:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        .music-track.selected {
            background-color: rgba(0, 132, 255, 0.1);
        }
        
        .music-track-icon {
            font-size: 20px;
            margin-right: 10px;
            color: var(--primary-color);
        }
        
        /* Schedule Status */
        .schedule-container {
            background-color: var(--secondary-color);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .schedule-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        /* Status Drafts */
        .drafts-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .draft-item {
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
        }
        
        .draft-preview {
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            padding: 15px;
            text-align: center;
        }
        
        .draft-info {
            padding: 10px;
            background-color: var(--secondary-color);
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 10px;
            padding: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .action-btn.primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .action-btn.primary:hover {
            background-color: #0073e6;
        }
        
        .action-btn.secondary {
            background-color: var(--secondary-color);
            color: var(--text-primary);
        }
        
        .action-btn.secondary:hover {
            background-color: #e4e6e9;
        }
        
        /* Status Highlights Modal */
        .highlights-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .highlights-modal.active {
            display: flex;
        }
        
        .highlights-container {
            width: 90%;
            max-width: 600px;
            background-color: var(--bg-color);
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
        }
        
        .highlights-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .highlights-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 20px;
            overflow-y: auto;
        }
        
        .highlight-item {
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }
        
        .highlight-cover {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .highlight-name {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 10px;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            color: white;
            font-size: 12px;
            text-align: center;
        }
        
        /* Stats Modal */
        .stats-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .stats-modal.active {
            display: flex;
        }
        
        .stats-container {
            width: 90%;
            max-width: 500px;
            background-color: var(--bg-color);
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
        }
        
        .stats-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }
        
        .stats-content {
            padding: 20px;
            overflow-y: auto;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .stat-item:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            color: var(--text-secondary);
        }
        
        .stat-value {
            font-weight: 600;
        }
        
        .viewers-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .viewer-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            background-color: var(--secondary-color);
        }
        
        .viewer-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 12px;
            background-size: cover;
            background-position: center;
        }
        
        .viewer-info {
            flex: 1;
        }
        
        .viewer-name {
            font-weight: 600;
            margin-bottom: 3px;
        }
        
        .viewer-time {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .viewer-duration {
            font-size: 12px;
            color: var(--primary-color);
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
        }
        
        .notification.active {
            transform: translateY(0);
            opacity: 1;
        }
        
        .notification.error {
            background-color: var(--danger-color);
        }
        
        .notification.warning {
            background-color: var(--warning-color);
        }
        
        .notification.info {
            background-color: var(--info-color);
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes gradient-ring {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            body {
                overflow: auto;
            }
            
            .app-container {
                flex-direction: column;
                height: auto;
                min-height: 100vh;
                overflow: hidden;
            }
            
            .sidebar {
                width: 100% !important;
                height: 100vh !important;
                max-height: 100vh !important;
                border-right: none !important;
                display: flex !important;
                position: relative !important;
                z-index: auto !important;
            }
            
            .status-viewer-panel {
                position: relative !important;
                width: 100% !important;
                height: auto !important;
                z-index: auto !important;
            }
            
            .status-categories {
                padding: 0 10px;
                overflow-x: auto;
            }
            
            .category-btn {
                padding: 12px 15px;
                font-size: 14px;
                min-width: 120px;
            }
            
            .text-status-options {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .template-grid {
                grid-template-columns: 1fr;
            }
            
            .drafts-container {
                grid-template-columns: 1fr;
            }
            
            .highlights-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .status-list-content {
                padding-bottom: 20px !important;
            }
        }
        
        @media (max-width: 480px) {
            .sidebar-header h2 {
                font-size: 20px;
            }
            
            .status-categories {
                padding: 0 5px;
            }
            
            .category-btn {
                padding: 10px 12px;
                font-size: 13px;
                min-width: 100px;
            }
            
            .text-status-options {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .highlights-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Dark mode preview */
        .dark-mode-preview {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            display: none;
        }
        
        [data-theme="dark"] .dark-mode-preview {
            display: block;
        }
        
        /* Upload Progress */
        .upload-progress {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background-color: var(--primary-color);
            width: 0%;
            z-index: 3000;
            transition: width 0.3s ease;
        }
        
        /* Blur sensitive content */
        .sensitive-content {
            filter: blur(10px);
            transition: filter 0.3s ease;
        }
        
        .sensitive-content.revealed {
            filter: blur(0);
        }
        
        .sensitive-warning {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            backdrop-filter: blur(10px);
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar with status list -->
        <div class="sidebar active" id="sidebar">
            <div class="sidebar-header">
                <h2>Status</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="add-status-btn" id="viewHighlightsBtn" title="View Highlights">
                        <i class="fas fa-star"></i>
                    </button>
                    <button class="add-status-btn" id="viewStatsBtn" title="View Stats">
                        <i class="fas fa-chart-bar"></i>
                    </button>
                    <button class="add-status-btn" id="createStatusBtn" title="Create Status">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>
            
            <div class="status-categories">
                <button class="category-btn active" id="allTab">All Status</button>
                <button class="category-btn" id="friendsTab">Friends <span class="status-count" id="friendsStatusCount">0</span></button>
                <button class="category-btn" id="closeTab">Close Friends</button>
                <button class="category-btn" id="pinnedTab">Pinned</button>
                <button class="category-btn" id="mutedTab">Muted</button>
            </div>
            
            <!-- My Status Section -->
            <div class="my-status-section">
                <div class="my-status-header">
                    <div class="my-status-avatar" id="myStatusAvatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="my-status-info">
                        <div class="my-status-name" id="myStatusName">My Status</div>
                        <div class="my-status-text" id="myStatusText">Tap to add status update</div>
                    </div>
                </div>
                <div class="my-status-actions">
                    <button class="my-status-action-btn" id="textStatusBtn">
                        <i class="fas fa-font"></i> Text
                    </button>
                    <button class="my-status-action-btn" id="photoStatusBtn">
                        <i class="fas fa-camera"></i> Photo
                    </button>
                    <button class="my-status-action-btn primary" id="createStatusQuickBtn">
                        <i class="fas fa-plus"></i> Create
                    </button>
                </div>
            </div>
            
            <div class="status-list">
                <div class="section-title">
                    <span>Recent Updates</span>
                    <span class="section-count" id="recentUpdatesCount">0</span>
                </div>
                
                <div class="status-list-content" id="statusListContent">
                    <!-- Status items will be loaded here -->
                    <div class="loading-placeholder" style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 15px;"></i>
                        <p>Loading status updates...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Status Viewer Panel -->
        <div class="status-viewer-panel" id="statusViewerPanel">
            <div class="status-progress-container" id="statusProgressContainer">
                <!-- Progress bars will be added here -->
            </div>
            
            <div class="status-viewer-header">
                <button class="back-btn" id="backBtn">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="status-viewer-info">
                    <div class="status-viewer-avatar" id="viewerAvatar"></div>
                    <div>
                        <div class="status-viewer-name" id="viewerName"></div>
                        <div class="status-viewer-time" id="viewerTime"></div>
                    </div>
                </div>
                <button class="status-action-btn" id="viewerMenuBtn">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
            </div>
            
            <div class="status-viewer-content" id="statusViewerContent">
                <!-- Status content will be loaded here -->
            </div>
            
            <div class="status-reply-container" id="statusReplyContainer">
                <input type="text" class="status-reply-input" id="statusReplyInput" placeholder="Reply to status...">
                <button class="status-reply-btn" id="sendReplyBtn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            
            <div class="status-viewer-controls">
                <div class="status-viewer-actions">
                    <button class="status-action-btn" id="prevStatusBtn">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="status-action-btn" id="nextStatusBtn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="status-viewer-actions">
                    <button class="status-action-btn" id="reactStatusBtn">
                        <i class="fas fa-smile"></i>
                    </button>
                    <button class="status-action-btn" id="shareStatusBtn">
                        <i class="fas fa-share"></i>
                    </button>
                    <button class="status-action-btn" id="muteStatusBtn">
                        <i class="fas fa-volume-mute"></i>
                    </button>
                    <button class="status-action-btn" id="reportStatusBtn">
                        <i class="fas fa-flag"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Create Status Modal -->
    <div class="create-status-modal" id="createStatusModal">
        <div class="create-status-container">
            <div class="create-status-header">
                <h3>Create Status</h3>
                <button class="add-status-btn" id="closeCreateStatusModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="create-status-tabs">
                <button class="create-status-tab active" data-tab="text">Text</button>
                <button class="create-status-tab" data-tab="media">Media</button>
                <button class="create-status-tab" data-tab="options">Options</button>
                <button class="create-status-tab" data-tab="templates">Templates</button>
                <button class="create-status-tab" data-tab="drafts">Drafts</button>
            </div>
            
            <div class="create-status-content">
                <!-- Text Status Tab -->
                <div class="create-status-tab-content active" id="textTab">
                    <div class="text-status-container">
                        <div class="text-status-preview" id="textStatusPreview">
                            Type your status here...
                        </div>
                        
                        <textarea class="text-status-input" id="textStatusInput" placeholder="Type your status here..." maxlength="500"></textarea>
                        
                        <div class="emoji-picker-container">
                            <button class="emoji-trigger-btn" id="emojiTriggerBtn">
                                <i class="fas fa-smile"></i> Add Emoji
                            </button>
                            <div class="emoji-picker-wrapper" id="emojiPickerWrapper">
                                <emoji-picker></emoji-picker>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label style="display: block; margin-bottom: 10px; font-weight: 500;">Background Color</label>
                            <input type="text" id="textStatusColor" value="#0084ff" style="width: 100%;">
                        </div>
                        
                        <div class="input-group">
                            <label style="display: block; margin-bottom: 10px; font-weight: 500;">Quick Backgrounds</label>
                            <div class="text-status-options" id="textStatusOptions">
                                <!-- Background options will be added here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Media Status Tab -->
                <div class="create-status-tab-content" id="mediaTab">
                    <div class="media-status-container">
                        <div class="media-upload-area" id="mediaUploadArea">
                            <div class="media-upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <h4>Upload Photo or Video</h4>
                            <p style="color: var(--text-secondary); margin-top: 10px;">Drag & drop or click to browse</p>
                            <input type="file" id="mediaUploadInput" accept="image/*,video/*" style="display: none;">
                        </div>
                        
                        <div class="media-preview" id="mediaPreview">
                            <!-- Media preview will be shown here -->
                        </div>
                        
                        <div class="input-group">
                            <label style="display: block; margin-bottom: 10px; font-weight: 500;">Caption</label>
                            <textarea class="text-input" id="mediaCaption" placeholder="Add a caption..." rows="3"></textarea>
                        </div>
                        
                        <div class="music-selector" id="musicSelector">
                            <h4 style="margin-bottom: 15px;">Add Music</h4>
                            <input type="text" class="music-search" placeholder="Search free music..." id="musicSearch">
                            <div class="music-tracks" id="musicTracks">
                                <!-- Music tracks will be added here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Options Tab -->
                <div class="create-status-tab-content" id="optionsTab">
                    <div class="status-options-container">
                        <div class="option-group">
                            <div class="option-title">
                                <i class="fas fa-user-friends"></i>
                                <span>Privacy</span>
                            </div>
                            <div class="option-item">
                                <div class="option-label">
                                    <i class="fas fa-globe option-icon"></i>
                                    <span>Who can see this?</span>
                                </div>
                                <select class="privacy-select" id="privacySelect">
                                    <option value="public">Everyone</option>
                                    <option value="friends">Friends Only</option>
                                    <option value="close">Close Friends</option>
                                    <option value="except">All Except...</option>
                                    <option value="specific">Specific People...</option>
                                </select>
                            </div>
                            <div class="option-item">
                                <div class="option-label">
                                    <i class="fas fa-clock option-icon"></i>
                                    <span>Duration</span>
                                </div>
                                <select class="duration-select" id="durationSelect">
                                    <option value="24h">24 Hours</option>
                                    <option value="12h">12 Hours</option>
                                    <option value="6h">6 Hours</option>
                                    <option value="1h">1 Hour</option>
                                    <option value="permanent">Permanent (Pin)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="option-group">
                            <div class="option-title">
                                <i class="fas fa-tag"></i>
                                <span>Category</span>
                            </div>
                            <div class="category-select-container" id="categorySelectContainer">
                                <!-- Categories will be added here -->
                            </div>
                        </div>
                        
                        <div class="option-group">
                            <div class="option-title">
                                <i class="fas fa-poll"></i>
                                <span>Add Poll</span>
                            </div>
                            <div class="poll-creator" id="pollCreator">
                                <input type="text" class="poll-question-input" placeholder="Ask a question..." id="pollQuestion">
                                <div id="pollOptionsContainer">
                                    <div class="poll-option">
                                        <input type="text" class="poll-option-input" placeholder="Option 1">
                                        <button class="status-action-btn danger remove-option-btn">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                    <div class="poll-option">
                                        <input type="text" class="poll-option-input" placeholder="Option 2">
                                        <button class="status-action-btn danger remove-option-btn">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                                <button class="add-option-btn" id="addPollOptionBtn">
                                    <i class="fas fa-plus"></i> Add Option
                                </button>
                            </div>
                        </div>
                        
                        <div class="option-group">
                            <div class="option-title">
                                <i class="fas fa-calendar"></i>
                                <span>Schedule</span>
                            </div>
                            <div class="schedule-container" id="scheduleContainer">
                                <input type="datetime-local" class="schedule-input" id="scheduleInput">
                                <div style="font-size: 14px; color: var(--text-secondary); margin-top: 10px;">
                                    Status will be posted automatically at the scheduled time
                                </div>
                            </div>
                        </div>
                        
                        <div class="option-group">
                            <div class="option-title">
                                <i class="fas fa-eye"></i>
                                <span>Sensitivity</span>
                            </div>
                            <div class="option-item">
                                <div class="option-label">
                                    <i class="fas fa-eye-slash option-icon"></i>
                                    <span>Blur sensitive content</span>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="sensitiveToggle">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="option-item">
                                <div class="option-label">
                                    <i class="fas fa-language option-icon"></i>
                                    <span>Auto-translate</span>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="translateToggle" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Templates Tab -->
                <div class="create-status-tab-content" id="templatesTab">
                    <div class="template-grid" id="templateGrid">
                        <!-- Templates will be added here -->
                    </div>
                </div>
                
                <!-- Drafts Tab -->
                <div class="create-status-tab-content" id="draftsTab">
                    <div class="drafts-container" id="draftsContainer">
                        <!-- Drafts will be added here -->
                    </div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="action-btn secondary" id="saveDraftBtn">
                    <i class="fas fa-save"></i> Save Draft
                </button>
                <button class="action-btn primary" id="postStatusBtn">
                    <i class="fas fa-paper-plane"></i> Post Status
                </button>
            </div>
        </div>
    </div>
    
    <!-- Highlights Modal -->
    <div class="highlights-modal" id="highlightsModal">
        <div class="highlights-container">
            <div class="highlights-header">
                <h3>Status Highlights</h3>
                <button class="add-status-btn" id="closeHighlightsModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="highlights-grid" id="highlightsGrid">
                <!-- Highlights will be added here -->
            </div>
            <div class="action-buttons">
                <button class="action-btn primary" id="addHighlightBtn">
                    <i class="fas fa-plus"></i> Add Highlight
                </button>
            </div>
        </div>
    </div>
    
    <!-- Stats Modal -->
    <div class="stats-modal" id="statsModal">
        <div class="stats-container">
            <div class="stats-header">
                <h3>Status Statistics</h3>
                <p id="statsPeriod">Last 24 hours</p>
            </div>
            <div class="stats-content">
                <div class="stat-item">
                    <span class="stat-label">Total Views</span>
                    <span class="stat-value" id="totalViews">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Average View Time</span>
                    <span class="stat-value" id="avgViewTime">0s</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Replies</span>
                    <span class="stat-value" id="totalReplies">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Reactions</span>
                    <span class="stat-value" id="totalReactions">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Shares</span>
                    <span class="stat-value" id="totalShares">0</span>
                </div>
                
                <h4 style="margin-top: 20px;">Recent Viewers</h4>
                <div class="viewers-list" id="viewersList">
                    <!-- Viewers will be added here -->
                </div>
            </div>
            <div class="action-buttons">
                <button class="action-btn secondary" id="closeStatsModal">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Operation completed successfully</span>
    </div>
    
    <!-- Upload Progress Bar -->
    <div class="upload-progress" id="uploadProgress"></div>

    <script>
        // =============================================
        // COMPLETE STATUS SYSTEM - BACKEND MIGRATION
        // =============================================

        // Global variables
        let currentUser = null;
        let userData = null;
        let myStatuses = [];
        let friendsStatuses = [];
        let allStatuses = [];
        let viewedStatusIds = new Set();
        let mutedUsers = new Set();
        let pinnedStatuses = [];
        let statusHighlights = [];
        let statusDrafts = [];
        let statusTemplates = [];
        let statusCategories = [];
        let musicTracks = [];
        let currentStatusIndex = 0;
        let currentViewerStatus = null;
        let statusAutoAdvance = true;
        let statusTimer = null;
        let currentPoll = null;
        let currentSchedule = null;
        let emojiPicker = null;
        let colorPicker = null;
        
        // Status types
        const STATUS_TYPES = {
            TEXT: 'text',
            PHOTO: 'photo',
            VIDEO: 'video',
            POLL: 'poll'
        };
        
        // Privacy settings
        const PRIVACY_SETTINGS = {
            PUBLIC: 'public',
            FRIENDS: 'friends',
            CLOSE_FRIENDS: 'close',
            EXCEPT: 'except',
            SPECIFIC: 'specific'
        };
        
        // Duration options
        const DURATION_OPTIONS = {
            '1h': 60 * 60 * 1000,
            '6h': 6 * 60 * 60 * 1000,
            '12h': 12 * 60 * 60 * 1000,
            '24h': 24 * 60 * 60 * 1000,
            'permanent': null
        };
        
        // Categories with colors and icons - ENHANCED FEATURE
        const CATEGORIES = [
            { id: 'life', name: 'Life', icon: 'fas fa-heart', color: '#ff6b6b' },
            { id: 'business', name: 'Business', icon: 'fas fa-briefcase', color: '#4caf50' },
            { id: 'school', name: 'Study', icon: 'fas fa-graduation-cap', color: '#2196f3' },
            { id: 'motivation', name: 'Motivation', icon: 'fas fa-rocket', color: '#ffa726' },
            { id: 'event', name: 'Event', icon: 'fas fa-calendar-alt', color: '#9c27b0' },
            { id: 'announcement', name: 'Announcement', icon: 'fas fa-bullhorn', color: '#00bcd4' },
            { id: 'devotions', name: 'Devotions', icon: 'fas fa-pray', color: '#8bc34a' },
            { id: 'travel', name: 'Travel', icon: 'fas fa-plane', color: '#f44336' },
            { id: 'food', name: 'Food', icon: 'fas fa-utensils', color: '#673ab7' },
            { id: 'fitness', name: 'Fitness', icon: 'fas fa-running', color: '#ff9800' },
            { id: 'music', name: 'Music', icon: 'fas fa-music', color: '#795548' },
            { id: 'art', name: 'Art', icon: 'fas fa-palette', color: '#607d8b' }
        ];
        
        // Background colors for text status
        const BACKGROUND_COLORS = [
            '#0084ff', '#00c853', '#ff6b6b', '#ffa726', '#9c27b0',
            '#00bcd4', '#795548', '#607d8b', '#3f51b5', '#e91e63',
            '#000000', '#ffffff'
        ];
        
        // Predefined templates
        const TEMPLATES = [
            { id: 'template1', name: 'Motivation', bg: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', textColor: '#ffffff', fontSize: '28px', emoji: '' },
            { id: 'template2', name: 'Question', bg: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)', textColor: '#ffffff', fontSize: '24px', emoji: '' },
            { id: 'template3', name: 'Celebration', bg: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)', textColor: '#ffffff', fontSize: '26px', emoji: '' },
            { id: 'template4', name: 'Thought', bg: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)', textColor: '#000000', fontSize: '22px', emoji: '' },
            { id: 'template5', name: 'Announcement', bg: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', textColor: '#000000', fontSize: '30px', emoji: '' },
            { id: 'template6', name: 'Mood', bg: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)', textColor: '#000000', fontSize: '24px', emoji: '' }
        ];
        
        // Free music tracks (royalty-free)
        const FREE_MUSIC_TRACKS = [
            { id: 'music1', title: 'Chill Vibes', artist: 'Free Music', duration: '1:30', genre: 'Chill', bpm: 90 },
            { id: 'music2', title: 'Upbeat Energy', artist: 'Free Music', duration: '2:00', genre: 'Upbeat', bpm: 120 },
            { id: 'music3', title: 'Calm Meditation', artist: 'Free Music', duration: '1:45', genre: 'Ambient', bpm: 60 },
            { id: 'music4', title: 'Happy Moments', artist: 'Free Music', duration: '1:15', genre: 'Happy', bpm: 110 },
            { id: 'music5', title: 'Epic Cinematic', artist: 'Free Music', duration: '2:30', genre: 'Cinematic', bpm: 70 },
            { id: 'music6', title: 'Funky Groove', artist: 'Free Music', duration: '1:50', genre: 'Funk', bpm: 100 }
        ];
        
        // DOM Elements
        const statusViewerPanel = document.getElementById('statusViewerPanel');
        const createStatusModal = document.getElementById('createStatusModal');
        const highlightsModal = document.getElementById('highlightsModal');
        const statsModal = document.getElementById('statsModal');
        const notification = document.getElementById('notification');
        
        // Status sections
        const statusListContent = document.getElementById('statusListContent');
        const myStatusAvatar = document.getElementById('myStatusAvatar');
        const myStatusName = document.getElementById('myStatusName');
        const myStatusText = document.getElementById('myStatusText');
        
        // Local Storage Keys
        const LOCAL_STORAGE_KEYS = {
            USER: 'knecta_current_user',
            USER_PROFILE: 'knecta_user_profile',
            MY_STATUSES: 'knecta_my_statuses',
            VIEWED_STATUSES: 'knecta_viewed_statuses',
            MUTED_USERS: 'knecta_muted_users',
            PINNED_STATUSES: 'knecta_pinned_statuses',
            STATUS_HIGHLIGHTS: 'knecta_status_highlights',
            STATUS_DRAFTS: 'knecta_status_drafts',
            STATUS_SETTINGS: 'knecta_status_settings',
            STATUS_STATS: 'knecta_status_stats'
        };
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Handle iframe token passing - BACKEND MIGRATION FIX
            if (window.self !== window.top) {
                // Running in iframe
                console.log('Running in iframe mode');
                // Check for token in parent window or URL
                handleIframeAuth();
            }
            
            // Load data from localStorage for instant display
            loadCachedDataInstantly();
            
            // Initialize app after a short delay
            setTimeout(() => {
                initializeApp();
            }, 100);
        });
        
        // Handle iframe authentication - BACKEND MIGRATION
        function handleIframeAuth() {
            try {
                // Check if we have a token from parent
                if (window.parent && window.parent.getAuthToken) {
                    const token = window.parent.getAuthToken();
                    if (token) {
                        localStorage.setItem('knecta_auth_token', token);
                        console.log('Token received from parent window');
                    }
                }
                
                // Check URL for token (for mobile apps)
                const urlParams = new URLSearchParams(window.location.search);
                const tokenFromUrl = urlParams.get('token');
                if (tokenFromUrl) {
                    localStorage.setItem('knecta_auth_token', tokenFromUrl);
                    console.log('Token received from URL');
                }
                
            } catch (error) {
                console.log('Iframe auth handling:', error);
            }
        }
        
        function loadCachedDataInstantly() {
            console.log('=== INSTANT STATUS CACHE LOAD START ===');
            
            try {
                // Load user from cache immediately
                const cachedUser = localStorage.getItem(LOCAL_STORAGE_KEYS.USER);
                if (cachedUser) {
                    currentUser = JSON.parse(cachedUser);
                    console.log(' Instant: User loaded from cache');
                }
                
                // Load user profile from cache
                const cachedProfile = localStorage.getItem(LOCAL_STORAGE_KEYS.USER_PROFILE);
                if (cachedProfile) {
                    userData = JSON.parse(cachedProfile);
                    
                    // Update my status section
                    if (myStatusAvatar) {
                        if (userData.photoURL) {
                            myStatusAvatar.style.backgroundImage = `url('${escapeHtml(userData.photoURL)}')`;
                            myStatusAvatar.innerHTML = '';
                        } else {
                            const initials = userData.displayName ? 
                                userData.displayName.split(' ').map(word => word[0]).join('').toUpperCase().substring(0, 2) : 
                                'ME';
                            myStatusAvatar.innerHTML = `<span style="color: white; font-size: 20px;">${initials}</span>`;
                        }
                    }
                    
                    if (myStatusName) {
                        myStatusName.textContent = userData.displayName || 'My Status';
                    }
                }
                
                // Load my statuses from cache
                const myStatusesData = localStorage.getItem(LOCAL_STORAGE_KEYS.MY_STATUSES);
                if (myStatusesData) {
                    myStatuses = JSON.parse(myStatusesData);
                    console.log(` Instant: ${myStatuses.length} statuses loaded from cache`);
                    
                    // Update my status text
                    updateMyStatusPreview();
                }
                
                // Load viewed statuses
                const viewedData = localStorage.getItem(LOCAL_STORAGE_KEYS.VIEWED_STATUSES);
                if (viewedData) {
                    viewedStatusIds = new Set(JSON.parse(viewedData));
                }
                
                // Load muted users
                const mutedData = localStorage.getItem(LOCAL_STORAGE_KEYS.MUTED_USERS);
                if (mutedData) {
                    mutedUsers = new Set(JSON.parse(mutedData));
                }
                
                // Load pinned statuses - ENHANCED FEATURE
                const pinnedData = localStorage.getItem(LOCAL_STORAGE_KEYS.PINNED_STATUSES);
                if (pinnedData) {
                    pinnedStatuses = JSON.parse(pinnedData);
                }
                
                // Load highlights - ENHANCED FEATURE
                const highlightsData = localStorage.getItem(LOCAL_STORAGE_KEYS.STATUS_HIGHLIGHTS);
                if (highlightsData) {
                    statusHighlights = JSON.parse(highlightsData);
                }
                
                // Load drafts - ENHANCED FEATURE
                const draftsData = localStorage.getItem(LOCAL_STORAGE_KEYS.STATUS_DRAFTS);
                if (draftsData) {
                    statusDrafts = JSON.parse(draftsData);
                }
                
                console.log('=== INSTANT STATUS CACHE LOAD COMPLETE ===');
                
            } catch (error) {
                console.error('Error in instant cache load:', error);
            }
        }
        
        async function initializeApp() {
            console.log('=== STATUS SYSTEM INITIALIZATION START ===');
            
            // Initialize settings manager
            if (typeof settingsManager !== 'undefined') {
                settingsManager.initializeSettings();
            }
            
            // Check for dark mode preference
            checkDarkMode();
            
            // Load user from cache first
            await loadUserFromCache();
            
            // Load initial data from backend in background
            loadInitialStatusData();
            
            // Setup event listeners
            setupEventListeners();
            
            // Initialize components
            initializeColorPicker();
            initializeEmojiPicker();
            loadTemplates();
            loadMusicTracks();
            loadCategories();
            
            // Load drafts into modal - ENHANCED FEATURE
            loadDraftsIntoModal();
            
            // Check for auto-schedule
            checkScheduledStatuses();
            
            console.log('=== STATUS SYSTEM INITIALIZATION COMPLETE ===');
        }
        
        async function loadUserFromCache() {
            try {
                // Try to get user from localStorage first
                const cachedUser = localStorage.getItem(LOCAL_STORAGE_KEYS.USER);
                if (cachedUser) {
                    currentUser = JSON.parse(cachedUser);
                    console.log('Loaded user from cache:', currentUser.id || currentUser._id);
                }
                
                // Try to get user data from app.js
                if (window.appState && window.appState.currentUser) {
                    currentUser = window.appState.currentUser;
                    console.log('User detected from app.js:', currentUser.id || currentUser._id);
                }
                
                // Load user profile from cache
                const cachedProfile = localStorage.getItem(LOCAL_STORAGE_KEYS.USER_PROFILE);
                if (cachedProfile) {
                    userData = JSON.parse(cachedProfile);
                }
                
                // If no user found, try to fetch from backend - BACKEND MIGRATION
                if (!currentUser || !currentUser.id) {
                    try {
                        // Use getCurrentUser from api.js
                        const response = await api('GET', '/api/auth/me');
                        if (response && response.user) {
                            currentUser = response.user;
                            userData = response.user;
                            localStorage.setItem(LOCAL_STORAGE_KEYS.USER, JSON.stringify(currentUser));
                            localStorage.setItem(LOCAL_STORAGE_KEYS.USER_PROFILE, JSON.stringify(userData));
                        }
                    } catch (error) {
                        console.log('No authenticated user found, will use offline mode');
                        // Create a temporary user for offline mode
                        currentUser = {
                            id: 'offline_user_' + Date.now(),
                            displayName: 'Guest User',
                            photoURL: '',
                            isOffline: true
                        };
                        userData = currentUser;
                    }
                }
                
            } catch (error) {
                console.error('Error loading user:', error);
                // Fallback to offline user
                currentUser = {
                    id: 'offline_user_' + Date.now(),
                    displayName: 'Guest User',
                    photoURL: '',
                    isOffline: true
                };
                userData = currentUser;
            }
        }
        
        async function loadInitialStatusData() {
            // Load statuses from backend in background
            setTimeout(async () => {
                try {
                    await loadStatusesFromBackend();
                    await loadFriendsStatuses();
                    updateStatusCounts();
                    showNotification('Status updates loaded', 'success');
                } catch (error) {
                    console.error('Error loading status data:', error);
                    // Use cached data
                    showNotification('Using cached status data', 'info');
                }
            }, 500);
        }
        
        async function loadStatusesFromBackend() {
            try {
                const response = await api('GET', '/api/status');
                
                if (response && response.statuses) {
                    allStatuses = response.statuses;
                    
                    // Filter out expired statuses
                    allStatuses = allStatuses.filter(status => !isStatusExpired(status));
                    
                    // Update UI
                    renderStatusList();
                    updateRecentUpdatesCount();
                    
                    console.log(`Loaded ${allStatuses.length} statuses from backend`);
                } else {
                    // If no statuses from backend, try to load from cache
                    const cachedStatuses = localStorage.getItem('knecta_all_statuses');
                    if (cachedStatuses) {
                        allStatuses = JSON.parse(cachedStatuses);
                        allStatuses = allStatuses.filter(status => !isStatusExpired(status));
                        renderStatusList();
                        updateRecentUpdatesCount();
                    }
                }
                
                // Save to cache
                localStorage.setItem('knecta_all_statuses', JSON.stringify(allStatuses));
                
            } catch (error) {
                console.error('Error loading statuses from backend:', error);
                // Use cached data
                const cachedStatuses = localStorage.getItem('knecta_all_statuses');
                if (cachedStatuses) {
                    allStatuses = JSON.parse(cachedStatuses);
                    allStatuses = allStatuses.filter(status => !isStatusExpired(status));
                    renderStatusList();
                    updateRecentUpdatesCount();
                }
            }
        }
        
        async function loadFriendsStatuses() {
            try {
                const response = await api('GET', '/api/status/friends');
                
                if (response && response.statuses) {
                    friendsStatuses = response.statuses.filter(status => !isStatusExpired(status));
                    
                    // Update friends status count
                    document.getElementById('friendsStatusCount').textContent = friendsStatuses.length;
                    
                    console.log(`Loaded ${friendsStatuses.length} friends statuses`);
                    
                    // Save to cache
                    localStorage.setItem('knecta_friends_statuses', JSON.stringify(friendsStatuses));
                }
                
            } catch (error) {
                console.error('Error loading friends statuses:', error);
                // Use cached data
                const cachedFriendsStatuses = localStorage.getItem('knecta_friends_statuses');
                if (cachedFriendsStatuses) {
                    friendsStatuses = JSON.parse(cachedFriendsStatuses);
                    friendsStatuses = friendsStatuses.filter(status => !isStatusExpired(status));
                    document.getElementById('friendsStatusCount').textContent = friendsStatuses.length;
                }
            }
        }
        
        function updateMyStatusPreview() {
            if (myStatuses.length > 0) {
                const latestStatus = myStatuses[0];
                myStatusText.textContent = getStatusPreviewText(latestStatus);
                
                // Add status ring to avatar
                myStatusAvatar.classList.add('has-status');
                
                // Check if all statuses are seen
                const allSeen = myStatuses.every(status => viewedStatusIds.has(status.id));
                if (allSeen) {
                    myStatusAvatar.classList.add('seen');
                } else {
                    myStatusAvatar.classList.remove('seen');
                }
            } else {
                myStatusText.textContent = 'Tap to add status update';
                myStatusAvatar.classList.remove('has-status', 'seen');
            }
        }
        
        function getStatusPreviewText(status) {
            switch (status.type) {
                case STATUS_TYPES.TEXT:
                    return status.text.length > 30 ? status.text.substring(0, 30) + '...' : status.text;
                case STATUS_TYPES.PHOTO:
                    return status.caption || ' Photo';
                case STATUS_TYPES.VIDEO:
                    return status.caption || ' Video';
                case STATUS_TYPES.POLL:
                    return ' Poll: ' + (status.pollQuestion || '');
                default:
                    return 'Status update';
            }
        }
        
        function renderStatusList() {
            statusListContent.innerHTML = '';
            
            if (allStatuses.length === 0) {
                statusListContent.innerHTML = `
                    <div class="empty-state" style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <i class="fas fa-comment-dots" style="font-size: 48px; margin-bottom: 15px;"></i>
                        <p>No status updates yet</p>
                        <p class="subtext">Be the first to share a status!</p>
                    </div>
                `;
                return;
            }
            
            // Group statuses by user
            const statusesByUser = {};
            allStatuses.forEach(status => {
                const userId = status.userId;
                if (!statusesByUser[userId]) {
                    statusesByUser[userId] = [];
                }
                statusesByUser[userId].push(status);
            });
            
            // Render each user's statuses
            Object.entries(statusesByUser).forEach(([userId, userStatuses]) => {
                const userStatus = userStatuses[0]; // Get latest status
                addStatusItem(userStatus, userStatuses.length);
            });
        }
        
        function addStatusItem(statusData, statusCount = 1) {
            const statusItem = document.createElement('div');
            statusItem.className = 'status-item';
            statusItem.dataset.userId = statusData.userId;
            statusItem.dataset.statusId = statusData.id;
            
            const userAvatar = statusData.user?.photoURL || '';
            const userName = statusData.user?.displayName || 'Unknown User';
            const userInitials = userName.split(' ').map(word => word[0]).join('').toUpperCase().substring(0, 2);
            
            const isViewed = viewedStatusIds.has(statusData.id);
            const isMuted = mutedUsers.has(statusData.userId);
            
            statusItem.innerHTML = `
                <div class="status-avatar ${statusCount > 0 ? 'has-status' : ''} ${isViewed ? 'seen' : ''}">
                    ${userAvatar ? '' : `<span style="color: white; font-size: 18px;">${userInitials}</span>`}
                </div>
                <div class="status-info">
                    <div class="status-name">
                        <span>${escapeHtml(userName)}</span>
                        ${statusCount > 1 ? `<span class="status-count">${statusCount}</span>` : ''}
                    </div>
                    <div class="status-time">
                        <span>${formatTimeAgo(new Date(statusData.createdAt))}</span>
                        ${isMuted ? '<span style="color: var(--text-secondary);"><i class="fas fa-volume-mute"></i> Muted</span>' : ''}
                    </div>
                    <div class="status-preview">
                        ${getStatusPreviewText(statusData)}
                    </div>
                </div>
            `;
            
            if (userAvatar) {
                statusItem.querySelector('.status-avatar').style.backgroundImage = `url('${escapeHtml(userAvatar)}')`;
            }
            
            statusItem.addEventListener('click', () => {
                viewUserStatuses(statusData.userId, statusData.user?.displayName || 'User');
            });
            
            statusListContent.appendChild(statusItem);
        }
        
        function viewUserStatuses(userId, userName) {
            // Get all statuses for this user
            const userStatuses = allStatuses.filter(status => status.userId === userId);
            
            if (userStatuses.length === 0) return;
            
            // Set current viewer status
            currentViewerStatus = {
                userId,
                userName,
                statuses: userStatuses,
                currentIndex: 0
            };
            
            // Show status viewer
            showStatusViewer();
            
            // Load first status
            loadStatusInViewer(0);
            
            // Mark as viewed
            userStatuses.forEach(status => {
                viewedStatusIds.add(status.id);
            });
            
            // Save viewed statuses
            saveToLocalStorage(LOCAL_STORAGE_KEYS.VIEWED_STATUSES, Array.from(viewedStatusIds));
            
            // Update UI
            updateStatusItemViewed(userId);
        }
        
        function showStatusViewer() {
            statusViewerPanel.classList.add('active');
            setupStatusViewerControls();
        }
        
        function loadStatusInViewer(index) {
            if (!currentViewerStatus || !currentViewerStatus.statuses[index]) return;
            
            const status = currentViewerStatus.statuses[index];
            currentViewerStatus.currentIndex = index;
            
            // Update viewer info
            document.getElementById('viewerName').textContent = currentViewerStatus.userName;
            document.getElementById('viewerTime').textContent = formatTimeAgo(new Date(status.createdAt));
            
            // Update avatar
            const viewerAvatar = document.getElementById('viewerAvatar');
            const userStatus = currentViewerStatus.statuses.find(s => s.user?.photoURL);
            if (userStatus?.user?.photoURL) {
                viewerAvatar.style.backgroundImage = `url('${escapeHtml(userStatus.user.photoURL)}')`;
            } else {
                const initials = currentViewerStatus.userName.split(' ').map(word => word[0]).join('').toUpperCase().substring(0, 2);
                viewerAvatar.innerHTML = `<span style="color: white; font-size: 20px;">${initials}</span>`;
            }
            
            // Clear previous content
            const viewerContent = document.getElementById('statusViewerContent');
            viewerContent.innerHTML = '';
            
            // Load status content based on type
            switch (status.type) {
                case STATUS_TYPES.TEXT:
                    loadTextStatus(status, viewerContent);
                    break;
                case STATUS_TYPES.PHOTO:
                    loadPhotoStatus(status, viewerContent);
                    break;
                case STATUS_TYPES.VIDEO:
                    loadVideoStatus(status, viewerContent);
                    break;
                case STATUS_TYPES.POLL:
                    loadPollStatus(status, viewerContent);
                    break;
            }
            
            // Setup progress bars with pause capability - ENHANCED FEATURE
            setupProgressBars();
            
            // Start auto-advance timer
            startAutoAdvance();
            
            // Track view - ENHANCED FEATURE: View Duration Tracking
            trackStatusView(status.id);
        }
        
        function loadTextStatus(status, container) {
            const textContent = document.createElement('div');
            textContent.className = 'status-text-content';
            
            // Apply styling
            textContent.style.backgroundColor = status.backgroundColor || '#0084ff';
            textContent.style.color = status.textColor || '#ffffff';
            textContent.style.fontSize = status.fontSize || '24px';
            
            if (status.backgroundImage) {
                textContent.style.backgroundImage = status.backgroundImage;
                textContent.style.backgroundSize = 'cover';
                textContent.style.backgroundPosition = 'center';
            }
            
            textContent.textContent = status.text;
            
            // Add emoji if present
            if (status.emoji) {
                textContent.innerHTML += `<div style="margin-top: 20px; font-size: 48px;">${status.emoji}</div>`;
            }
            
            // Add category badge if present - ENHANCED FEATURE
            if (status.category) {
                const category = CATEGORIES.find(c => c.id === status.category);
                if (category) {
                    textContent.innerHTML += `<div style="position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.7); color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">
                        <i class="${category.icon}"></i> ${category.name}
                    </div>`;
                }
            }
            
            container.appendChild(textContent);
        }
        
        function loadPhotoStatus(status, container) {
            const img = document.createElement('img');
            img.className = 'status-media';
            img.src = status.mediaUrl;
            img.alt = 'Status photo';
            
            // Add sensitive content warning if needed - ENHANCED FEATURE
            if (status.isSensitive) {
                img.classList.add('sensitive-content');
                
                const warning = document.createElement('div');
                warning.className = 'sensitive-warning';
                warning.innerHTML = `
                    <i class="fas fa-eye-slash" style="font-size: 32px; margin-bottom: 10px;"></i>
                    <p>Sensitive Content</p>
                    <p style="font-size: 14px; opacity: 0.8;">Tap to view</p>
                `;
                warning.addEventListener('click', () => {
                    img.classList.add('revealed');
                    warning.style.display = 'none';
                });
                
                container.appendChild(warning);
            }
            
            container.appendChild(img);
            
            // Add caption if present
            if (status.caption) {
                const caption = document.createElement('div');
                caption.className = 'status-text-content';
                caption.style.position = 'absolute';
                caption.style.bottom = '100px';
                caption.style.left = '0';
                caption.style.right = '0';
                caption.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
                caption.style.padding = '15px';
                caption.style.fontSize = '16px';
                caption.textContent = status.caption;
                container.appendChild(caption);
            }
            
            // Add category badge if present - ENHANCED FEATURE
            if (status.category) {
                const category = CATEGORIES.find(c => c.id === status.category);
                if (category) {
                    const badge = document.createElement('div');
                    badge.style.position = 'absolute';
                    badge.style.top = '20px';
                    badge.style.right = '20px';
                    badge.style.background = 'rgba(0,0,0,0.7)';
                    badge.style.color = 'white';
                    badge.style.padding = '5px 10px';
                    badge.style.borderRadius = '15px';
                    badge.style.fontSize = '12px';
                    badge.innerHTML = `<i class="${category.icon}"></i> ${category.name}`;
                    container.appendChild(badge);
                }
            }
        }
        
        function loadVideoStatus(status, container) {
            const video = document.createElement('video');
            video.className = 'status-media';
            video.src = status.mediaUrl;
            video.controls = true;
            video.autoplay = true;
            
            // Add video.js for better controls
            video.classList.add('video-js');
            video.setAttribute('playsinline', true);
            
            container.appendChild(video);
            
            // Initialize video.js
            if (typeof videojs !== 'undefined') {
                videojs(video);
            }
            
            // Add caption if present
            if (status.caption) {
                const caption = document.createElement('div');
                caption.className = 'status-text-content';
                caption.style.position = 'absolute';
                caption.style.bottom = '100px';
                caption.style.left = '0';
                caption.style.right = '0';
                caption.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
                caption.style.padding = '15px';
                caption.style.fontSize = '16px';
                caption.textContent = status.caption;
                container.appendChild(caption);
            }
            
            // Add category badge if present - ENHANCED FEATURE
            if (status.category) {
                const category = CATEGORIES.find(c => c.id === status.category);
                if (category) {
                    const badge = document.createElement('div');
                    badge.style.position = 'absolute';
                    badge.style.top = '20px';
                    badge.style.right = '20px';
                    badge.style.background = 'rgba(0,0,0,0.7)';
                    badge.style.color = 'white';
                    badge.style.padding = '5px 10px';
                    badge.style.borderRadius = '15px';
                    badge.style.fontSize = '12px';
                    badge.innerHTML = `<i class="${category.icon}"></i> ${category.name}`;
                    container.appendChild(badge);
                }
            }
        }
        
        function loadPollStatus(status, container) {
            const pollContainer = document.createElement('div');
            pollContainer.className = 'status-text-content';
            pollContainer.style.backgroundColor = '#ffffff';
            pollContainer.style.color = '#000000';
            pollContainer.style.padding = '30px';
            pollContainer.style.textAlign = 'left';
            
            pollContainer.innerHTML = `
                <div style="font-size: 20px; font-weight: 600; margin-bottom: 20px;">${escapeHtml(status.pollQuestion)}</div>
                <div id="pollOptionsList" style="margin-bottom: 20px;"></div>
                <div style="font-size: 14px; color: #666; margin-top: 10px;">
                    ${status.pollVotes || 0} votes  ${status.pollExpires ? `Ends ${formatTimeAgo(new Date(status.pollExpires))}` : 'No expiry'}
                </div>
            `;
            
            const optionsList = pollContainer.querySelector('#pollOptionsList');
            
            if (status.pollOptions && Array.isArray(status.pollOptions)) {
                status.pollOptions.forEach((option, index) => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'poll-option';
                    optionElement.style.marginBottom = '10px';
                    optionElement.style.padding = '12px';
                    optionElement.style.backgroundColor = '#f0f2f5';
                    optionElement.style.borderRadius = '8px';
                    optionElement.style.cursor = 'pointer';
                    optionElement.style.transition = 'background-color 0.2s';
                    
                    optionElement.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>${escapeHtml(option.text)}</span>
                            <span style="font-size: 14px; color: #666;">${option.votes || 0} votes</span>
                        </div>
                        <div style="height: 4px; background-color: #ddd; margin-top: 8px; border-radius: 2px;">
                            <div style="height: 100%; width: ${(option.votes / Math.max(status.totalVotes, 1)) * 100}%; background-color: #0084ff; border-radius: 2px;"></div>
                        </div>
                    `;
                    
                    optionElement.addEventListener('click', () => {
                        voteOnPoll(status.id, index);
                    });
                    
                    optionsList.appendChild(optionElement);
                });
            }
            
            container.appendChild(pollContainer);
        }
        
        function setupProgressBars() {
            if (!currentViewerStatus) return;
            
            const progressContainer = document.getElementById('statusProgressContainer');
            progressContainer.innerHTML = '';
            
            currentViewerStatus.statuses.forEach((status, index) => {
                const progressBar = document.createElement('div');
                progressBar.className = 'status-progress-bar';
                
                const progressFill = document.createElement('div');
                progressFill.className = 'status-progress-fill';
                
                if (index === currentViewerStatus.currentIndex) {
                    progressFill.style.width = '0%';
                    // Start progress animation
                    setTimeout(() => {
                        progressFill.style.width = '100%';
                    }, 50);
                } else if (index < currentViewerStatus.currentIndex) {
                    progressFill.style.width = '100%';
                }
                
                // Add click to pause/resume - ENHANCED FEATURE
                progressBar.addEventListener('click', (e) => {
                    e.stopPropagation();
                    statusAutoAdvance = !statusAutoAdvance;
                    if (statusAutoAdvance) {
                        startAutoAdvance();
                        showNotification('Auto-advance resumed', 'info');
                    } else {
                        if (statusTimer) clearTimeout(statusTimer);
                        showNotification('Auto-advance paused', 'info');
                    }
                });
                
                progressBar.appendChild(progressFill);
                progressContainer.appendChild(progressBar);
            });
        }
        
        function startAutoAdvance() {
            if (statusTimer) clearTimeout(statusTimer);
            
            if (!statusAutoAdvance || !currentViewerStatus) return;
            
            statusTimer = setTimeout(() => {
                nextStatus();
            }, 5000); // 5 seconds per status
        }
        
        function nextStatus() {
            if (!currentViewerStatus) return;
            
            const nextIndex = currentViewerStatus.currentIndex + 1;
            
            if (nextIndex < currentViewerStatus.statuses.length) {
                loadStatusInViewer(nextIndex);
            } else {
                // Close viewer if no more statuses
                closeStatusViewer();
            }
        }
        
        function prevStatus() {
            if (!currentViewerStatus) return;
            
            const prevIndex = currentViewerStatus.currentIndex - 1;
            
            if (prevIndex >= 0) {
                loadStatusInViewer(prevIndex);
            }
        }
        
        function closeStatusViewer() {
            statusViewerPanel.classList.remove('active');
            if (statusTimer) clearTimeout(statusTimer);
            currentViewerStatus = null;
        }
        
        // ENHANCED FEATURE: View Duration Tracking
        async function trackStatusView(statusId) {
            // Send view tracking to backend
            try {
                await api('POST', `/api/status/${statusId}/view`);
            } catch (error) {
                console.log('Offline: View tracking saved locally');
            }
            
            // Update local stats
            updateStatusStats(statusId);
        }
        
        function updateStatusStats(statusId) {
            // Load existing stats
            const statsData = localStorage.getItem(LOCAL_STORAGE_KEYS.STATUS_STATS);
            let stats = statsData ? JSON.parse(statsData) : {};
            
            if (!stats[statusId]) {
                stats[statusId] = {
                    views: 0,
                    viewDuration: [],
                    replies: 0,
                    reactions: 0,
                    shares: 0
                };
            }
            
            stats[statusId].views += 1;
            stats[statusId].viewDuration.push(Date.now());
            
            // Save updated stats
            localStorage.setItem(LOCAL_STORAGE_KEYS.STATUS_STATS, JSON.stringify(stats));
        }
        
        function updateStatusItemViewed(userId) {
            const statusItem = document.querySelector(`.status-item[data-user-id="${userId}"]`);
            if (statusItem) {
                statusItem.querySelector('.status-avatar').classList.add('seen');
            }
        }
        
        // ENHANCED FEATURE: Offline Status Creation
        async function createTextStatus(text, options = {}) {
            const statusId = 'status_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            const status = {
                id: statusId,
                userId: currentUser.id || currentUser._id,
                user: userData,
                type: STATUS_TYPES.TEXT,
                text: text,
                backgroundColor: options.backgroundColor || '#0084ff',
                textColor: options.textColor || '#ffffff',
                fontSize: options.fontSize || '24px',
                backgroundImage: options.backgroundImage,
                emoji: options.emoji,
                category: options.category, // ENHANCED FEATURE: Category
                privacy: options.privacy || PRIVACY_SETTINGS.FRIENDS,
                expiresAt: options.expiresAt || new Date(Date.now() + DURATION_OPTIONS['24h']).toISOString(),
                isPinned: options.isPinned || false, // ENHANCED FEATURE: Pin status
                isSensitive: options.isSensitive || false,
                autoTranslate: options.autoTranslate || false,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // Add to my statuses
            myStatuses.unshift(status);
            
            // Update local storage
            saveToLocalStorage(LOCAL_STORAGE_KEYS.MY_STATUSES, myStatuses);
            
            // Send to backend - OFFLINE SUPPORT
            try {
                const response = await api('POST', '/api/status', status);
                if (response && response.status) {
                    status.id = response.status.id || statusId;
                    console.log('Status posted to backend');
                }
            } catch (error) {
                console.log('Offline: Status saved locally, will sync when online');
                // Queue for sync when online
                queueForSync(status);
            }
            
            // Update UI
            updateMyStatusPreview();
            addStatusItem(status);
            updateRecentUpdatesCount();
            
            // If pinned, add to pinned statuses - ENHANCED FEATURE
            if (status.isPinned) {
                pinnedStatuses.push(status);
                saveToLocalStorage(LOCAL_STORAGE_KEYS.PINNED_STATUSES, pinnedStatuses);
                showNotification('Status pinned', 'success');
            }
            
            // Update all statuses list
            allStatuses.unshift(status);
            localStorage.setItem('knecta_all_statuses', JSON.stringify(allStatuses));
            
            showNotification('Status posted successfully', 'success');
            
            return status;
        }
        
        async function createMediaStatus(mediaUrl, type, options = {}) {
            const statusId = 'status_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            const status = {
                id: statusId,
                userId: currentUser.id || currentUser._id,
                user: userData,
                type: type,
                mediaUrl: mediaUrl,
                caption: options.caption,
                musicTrack: options.musicTrack,
                category: options.category, // ENHANCED FEATURE: Category
                privacy: options.privacy || PRIVACY_SETTINGS.FRIENDS,
                expiresAt: options.expiresAt || new Date(Date.now() + DURATION_OPTIONS['24h']).toISOString(),
                isPinned: options.isPinned || false, // ENHANCED FEATURE: Pin status
                isSensitive: options.isSensitive || false,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // Add to my statuses
            myStatuses.unshift(status);
            
            // Update local storage
            saveToLocalStorage(LOCAL_STORAGE_KEYS.MY_STATUSES, myStatuses);
            
            // Send to backend - OFFLINE SUPPORT
            try {
                const response = await api('POST', '/api/status', status);
                if (response && response.status) {
                    status.id = response.status.id || statusId;
                }
            } catch (error) {
                console.log('Offline: Media status saved locally');
                queueForSync(status);
            }
            
            // Update UI
            updateMyStatusPreview();
            addStatusItem(status);
            updateRecentUpdatesCount();
            
            // Update all statuses list
            allStatuses.unshift(status);
            localStorage.setItem('knecta_all_statuses', JSON.stringify(allStatuses));
            
            showNotification('Status posted successfully', 'success');
            
            return status;
        }
        
        // ENHANCED FEATURE: Poll Status
        async function createPollStatus(question, options, pollOptions = {}) {
            const statusId = 'status_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            const status = {
                id: statusId,
                userId: currentUser.id || currentUser._id,
                user: userData,
                type: STATUS_TYPES.POLL,
                pollQuestion: question,
                pollOptions: options.map(opt => ({ text: opt, votes: 0 })),
                totalVotes: 0,
                pollExpires: pollOptions.expiresAt || new Date(Date.now() + DURATION_OPTIONS['24h']).toISOString(),
                category: pollOptions.category, // ENHANCED FEATURE: Category
                privacy: pollOptions.privacy || PRIVACY_SETTINGS.FRIENDS,
                expiresAt: pollOptions.expiresAt || new Date(Date.now() + DURATION_OPTIONS['24h']).toISOString(),
                isPinned: pollOptions.isPinned || false, // ENHANCED FEATURE: Pin status
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // Add to my statuses
            myStatuses.unshift(status);
            
            // Update local storage
            saveToLocalStorage(LOCAL_STORAGE_KEYS.MY_STATUSES, myStatuses);
            
            // Send to backend - OFFLINE SUPPORT
            try {
                const response = await api('POST', '/api/status', status);
                if (response && response.status) {
                    status.id = response.status.id || statusId;
                }
            } catch (error) {
                console.log('Offline: Poll saved locally');
                queueForSync(status);
            }
            
            // Update UI
            updateMyStatusPreview();
            addStatusItem(status);
            updateRecentUpdatesCount();
            
            // Update all statuses list
            allStatuses.unshift(status);
            localStorage.setItem('knecta_all_statuses', JSON.stringify(allStatuses));
            
            showNotification('Poll posted successfully', 'success');
            
            return status;
        }
        
        async function voteOnPoll(statusId, optionIndex) {
            try {
                const response = await api('POST', `/api/status/${statusId}/vote`, { optionIndex });
                
                if (response && response.success) {
                    // Update local data
                    const status = allStatuses.find(s => s.id === statusId);
                    if (status && status.pollOptions) {
                        status.pollOptions[optionIndex].votes = (status.pollOptions[optionIndex].votes || 0) + 1;
                        status.totalVotes = (status.totalVotes || 0) + 1;
                    }
                    
                    showNotification('Vote recorded', 'success');
                }
                
            } catch (error) {
                console.error('Error voting on poll:', error);
                showNotification('Failed to vote', 'error');
            }
        }
        
        // ENHANCED FEATURE: Save Drafts
        function saveStatusDraft(statusData) {
            const draftId = 'draft_' + Date.now();
            const draft = {
                id: draftId,
                ...statusData,
                savedAt: new Date().toISOString()
            };
            
            statusDrafts.unshift(draft);
            saveToLocalStorage(LOCAL_STORAGE_KEYS.STATUS_DRAFTS, statusDrafts);
            
            showNotification('Draft saved', 'success');
            return draft;
        }
        
        function loadDraft(draftId) {
            const draft = statusDrafts.find(d => d.id === draftId);
            if (!draft) return null;
            
            // Load draft into create modal
            loadDraftIntoModal(draft);
            
            // Remove draft from list
            statusDrafts = statusDrafts.filter(d => d.id !== draftId);
            saveToLocalStorage(LOCAL_STORAGE_KEYS.STATUS_DRAFTS, statusDrafts);
            
            return draft;
        }
        
        function loadDraftIntoModal(draft) {
            // Based on draft type, load into appropriate tab
            if (draft.type === STATUS_TYPES.TEXT) {
                document.querySelector('.create-status-tab[data-tab="text"]').click();
                document.getElementById('textStatusInput').value = draft.text;
                
                if (draft.backgroundColor) {
                    document.getElementById('textStatusColor').value = draft.backgroundColor;
                    updateTextStatusPreview();
                }
                
                if (draft.emoji) {
                    // Add emoji to text
                    document.getElementById('textStatusInput').value += ' ' + draft.emoji;
                }
                
            } else if (draft.type === STATUS_TYPES.PHOTO || draft.type === STATUS_TYPES.VIDEO) {
                document.querySelector('.create-status-tab[data-tab="media"]').click();
                // Would need to handle media loading
            }
            
            // Load other options
            if (draft.category) {
                const categoryChip = document.querySelector(`.category-chip[data-category="${draft.category}"]`);
                if (categoryChip) categoryChip.click();
            }
            
            if (draft.privacy) {
                document.getElementById('privacySelect').value = draft.privacy;
            }
            
            if (draft.expiresAt) {
                const duration = getDurationFromExpiry(draft.expiresAt);
                if (duration) {
                    document.getElementById('durationSelect').value = duration;
                }
            }
        }
        
        // ENHANCED FEATURE: Schedule Status
        function scheduleStatus(statusData, scheduleTime) {
            const scheduledStatus = {
                ...statusData,
                scheduledFor: scheduleTime,
                status: 'scheduled'
            };
            
            // Save to local storage
            const scheduledStatuses = JSON.parse(localStorage.getItem('knecta_scheduled_statuses') || '[]');
            scheduledStatuses.push(scheduledStatus);
            localStorage.setItem('knecta_scheduled_statuses', JSON.stringify(scheduledStatuses));
            
            // Set up notification
            const timeUntilPost = new Date(scheduleTime) - Date.now();
            if (timeUntilPost > 0) {
                setTimeout(() => {
                    postScheduledStatus(scheduledStatus);
                }, timeUntilPost);
            }
            
            showNotification(`Status scheduled for ${new Date(scheduleTime).toLocaleString()}`, 'success');
        }
        
        function postScheduledStatus(scheduledStatus) {
            const { scheduledFor, status, ...statusData } = scheduledStatus;
            
            // Post the status
            if (statusData.type === STATUS_TYPES.TEXT) {
                createTextStatus(statusData.text, statusData);
            } else if (statusData.type === STATUS_TYPES.PHOTO) {
                createMediaStatus(statusData.mediaUrl, STATUS_TYPES.PHOTO, statusData);
            } else if (statusData.type === STATUS_TYPES.POLL) {
                createPollStatus(statusData.pollQuestion, statusData.pollOptions.map(o => o.text), statusData);
            }
            
            // Remove from scheduled
            const scheduledStatuses = JSON.parse(localStorage.getItem('knecta_scheduled_statuses') || '[]');
            const updatedScheduledStatuses = scheduledStatuses.filter(s => s.id !== scheduledStatus.id);
            localStorage.setItem('knecta_scheduled_statuses', JSON.stringify(updatedScheduledStatuses));
            
            showNotification('Scheduled status posted', 'success');
        }
        
        function checkScheduledStatuses() {
            const scheduledStatuses = JSON.parse(localStorage.getItem('knecta_scheduled_statuses') || '[]');
            const now = new Date();
            
            scheduledStatuses.forEach(scheduledStatus => {
                if (new Date(scheduledStatus.scheduledFor) <= now) {
                    postScheduledStatus(scheduledStatus);
                }
            });
        }
        
        // ENHANCED FEATURE: Add to Highlights
        function addToHighlights(statusId, highlightName = 'Highlight') {
            const status = myStatuses.find(s => s.id === statusId);
            if (!status) return;
            
            const highlight = {
                id: 'highlight_' + Date.now(),
                statusId: statusId,
                name: highlightName,
                coverUrl: getStatusCoverUrl(status),
                createdAt: new Date().toISOString()
            };
            
            statusHighlights.push(highlight);
            saveToLocalStorage(LOCAL_STORAGE_KEYS.STATUS_HIGHLIGHTS, statusHighlights);
            
            showNotification('Added to highlights', 'success');
        }
        
        function getStatusCoverUrl(status) {
            if (status.type === STATUS_TYPES.PHOTO) {
                return status.mediaUrl;
            } else if (status.type === STATUS_TYPES.VIDEO) {
                // Would need video thumbnail
                return '';
            } else {
                // Generate color-based cover
                return `data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 200 200"><rect width="200" height="200" fill="${escapeHtml(status.backgroundColor || '#0084ff')}"/></svg>`;
            }
        }
        
        function muteUser(userId) {
            mutedUsers.add(userId);
            saveToLocalStorage(LOCAL_STORAGE_KEYS.MUTED_USERS, Array.from(mutedUsers));
            
            // Update UI
            const statusItem = document.querySelector(`.status-item[data-user-id="${userId}"]`);
            if (statusItem) {
                statusItem.style.opacity = '0.5';
            }
            
            showNotification('User muted', 'success');
        }
        
        function unmuteUser(userId) {
            mutedUsers.delete(userId);
            saveToLocalStorage(LOCAL_STORAGE_KEYS.MUTED_USERS, Array.from(mutedUsers));
            
            // Update UI
            const statusItem = document.querySelector(`.status-item[data-user-id="${userId}"]`);
            if (statusItem) {
                statusItem.style.opacity = '1';
            }
            
            showNotification('User unmuted', 'success');
        }
        
        function reportStatus(statusId, reason) {
            // Send report to backend
            api('POST', `/api/status/${statusId}/report`, { reason }).catch(console.error);
            
            showNotification('Status reported', 'success');
        }
        
        function initializeColorPicker() {
            const colorInput = document.getElementById('textStatusColor');
            if (colorInput && typeof jQuery !== 'undefined' && jQuery.fn.spectrum) {
                colorPicker = jQuery(colorInput).spectrum({
                    color: '#0084ff',
                    showInput: true,
                    showInitial: true,
                    allowEmpty: false,
                    showAlpha: false,
                    preferredFormat: 'hex',
                    move: function(color) {
                        updateTextStatusPreview();
                    },
                    change: function(color) {
                        updateTextStatusPreview();
                    }
                });
            }
        }
        
        function initializeEmojiPicker() {
            const emojiTrigger = document.getElementById('emojiTriggerBtn');
            const emojiWrapper = document.getElementById('emojiPickerWrapper');
            
            if (emojiTrigger && emojiWrapper) {
                emojiTrigger.addEventListener('click', () => {
                    emojiWrapper.classList.toggle('active');
                });
                
                // Close emoji picker when clicking outside
                document.addEventListener('click', (event) => {
                    if (!emojiTrigger.contains(event.target) && !emojiWrapper.contains(event.target)) {
                        emojiWrapper.classList.remove('active');
                    }
                });
                
                // Handle emoji selection
                const picker = emojiWrapper.querySelector('emoji-picker');
                if (picker) {
                    picker.addEventListener('emoji-click', event => {
                        const emoji = event.detail.unicode;
                        const textInput = document.getElementById('textStatusInput');
                        textInput.value += emoji;
                        updateTextStatusPreview();
                        emojiWrapper.classList.remove('active');
                    });
                }
            }
        }
        
        function updateTextStatusPreview() {
            const preview = document.getElementById('textStatusPreview');
            const textInput = document.getElementById('textStatusInput');
            const colorInput = document.getElementById('textStatusColor');
            
            if (preview && textInput && colorInput) {
                preview.textContent = textInput.value || 'Type your status here...';
                
                // Get color from color picker
                let color = '#0084ff';
                if (colorPicker && colorPicker.spectrum) {
                    color = colorPicker.spectrum('get').toHexString();
                } else {
                    color = colorInput.value;
                }
                
                preview.style.backgroundColor = color;
                
                // Adjust text color for contrast
                const textColor = getContrastColor(color);
                preview.style.color = textColor;
            }
        }
        
        function getContrastColor(hexColor) {
            // Convert hex to RGB
            const r = parseInt(hexColor.substr(1, 2), 16);
            const g = parseInt(hexColor.substr(3, 2), 16);
            const b = parseInt(hexColor.substr(5, 2), 16);
            
            // Calculate luminance
            const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
            
            // Return black or white based on luminance
            return luminance > 0.5 ? '#000000' : '#ffffff';
        }
        
        function loadTemplates() {
            const templateGrid = document.getElementById('templateGrid');
            if (!templateGrid) return;
            
            templateGrid.innerHTML = '';
            
            TEMPLATES.forEach(template => {
                const templateItem = document.createElement('div');
                templateItem.className = 'template-item';
                templateItem.dataset.templateId = template.id;
                
                templateItem.innerHTML = `
                    <div class="template-preview" style="background: ${template.bg}; color: ${template.textColor}; font-size: ${template.fontSize};">
                        ${template.emoji} Preview
                    </div>
                    <div class="template-name">${template.name}</div>
                `;
                
                templateItem.addEventListener('click', () => {
                    applyTemplate(template);
                    
                    // Mark as selected
                    document.querySelectorAll('.template-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    templateItem.classList.add('selected');
                });
                
                templateGrid.appendChild(templateItem);
            });
        }
        
        function applyTemplate(template) {
            const textInput = document.getElementById('textStatusInput');
            const preview = document.getElementById('textStatusPreview');
            
            if (textInput && preview) {
                preview.style.background = template.bg;
                preview.style.color = template.textColor;
                preview.style.fontSize = template.fontSize;
                
                // Update color picker if available
                if (colorPicker && colorPicker.spectrum) {
                    // Extract first color from gradient for simplicity
                    const firstColor = template.bg.match(/#[0-9a-fA-F]{6}/)?.[0] || '#0084ff';
                    colorPicker.spectrum('set', firstColor);
                }
            }
        }
        
        function loadMusicTracks() {
            const musicTracksContainer = document.getElementById('musicTracks');
            if (!musicTracksContainer) return;
            
            musicTracksContainer.innerHTML = '';
            
            FREE_MUSIC_TRACKS.forEach(track => {
                const trackElement = document.createElement('div');
                trackElement.className = 'music-track';
                trackElement.dataset.trackId = track.id;
                
                trackElement.innerHTML = `
                    <div style="display: flex; align-items: center; width: 100%;">
                        <i class="fas fa-music music-track-icon"></i>
                        <div style="flex: 1;">
                            <div style="font-weight: 500;">${track.title}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">${track.artist}  ${track.genre}  ${track.bpm} BPM</div>
                        </div>
                        <span style="font-size: 12px; color: var(--text-secondary);">${track.duration}</span>
                    </div>
                `;
                
                trackElement.addEventListener('click', () => {
                    // Toggle selection
                    document.querySelectorAll('.music-track').forEach(t => {
                        t.classList.remove('selected');
                    });
                    trackElement.classList.add('selected');
                    
                    // Store selected track
                    window.selectedMusicTrack = track;
                });
                
                musicTracksContainer.appendChild(trackElement);
            });
        }
        
        // ENHANCED FEATURE: Load Categories
        function loadCategories() {
            const categoryContainer = document.getElementById('categorySelectContainer');
            if (!categoryContainer) return;
            
            categoryContainer.innerHTML = '';
            
            CATEGORIES.forEach(category => {
                const categoryChip = document.createElement('div');
                categoryChip.className = 'category-chip';
                categoryChip.dataset.category = category.id;
                categoryChip.innerHTML = `<i class="${category.icon}"></i> ${category.name}`;
                
                categoryChip.addEventListener('click', () => {
                    // Toggle selection
                    categoryChip.classList.toggle('selected');
                });
                
                categoryContainer.appendChild(categoryChip);
            });
        }
        
        function updateRecentUpdatesCount() {
            const recentCount = document.getElementById('recentUpdatesCount');
            if (recentCount) {
                recentCount.textContent = allStatuses.length;
            }
        }
        
        function updateStatusCounts() {
            document.getElementById('friendsStatusCount').textContent = friendsStatuses.length;
            updateRecentUpdatesCount();
        }
        
        function isStatusExpired(status) {
            if (!status.expiresAt) return false; // Pinned statuses
            return new Date(status.expiresAt) < new Date();
        }
        
        function getDurationFromExpiry(expiresAt) {
            const now = new Date();
            const expiry = new Date(expiresAt);
            const diff = expiry - now;
            
            if (diff <= DURATION_OPTIONS['1h']) return '1h';
            if (diff <= DURATION_OPTIONS['6h']) return '6h';
            if (diff <= DURATION_OPTIONS['12h']) return '12h';
            if (diff <= DURATION_OPTIONS['24h']) return '24h';
            return 'permanent';
        }
        
        function formatTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return `${Math.floor(diffDays / 7)}w ago`;
        }
        
        function showNotification(message, type = 'success') {
            const notificationText = document.getElementById('notificationText');
            if (!notificationText) return;
            
            notificationText.textContent = message;
            
            notification.className = 'notification';
            notification.classList.add(type);
            
            notification.classList.add('active');
            
            setTimeout(() => {
                notification.classList.remove('active');
            }, 3000);
        }
        
        function saveToLocalStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (error) {
                console.error('Error saving to localStorage:', error);
            }
        }
        
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function checkDarkMode() {
            if (typeof settingsManager !== 'undefined') {
                const darkMode = settingsManager.getSetting('darkMode');
                if (darkMode) {
                    document.body.setAttribute('data-theme', 'dark');
                }
            }
        }
        
        // ENHANCED FEATURE: Offline Sync Queue
        function queueForSync(status) {
            const syncQueue = JSON.parse(localStorage.getItem('knecta_sync_queue') || '[]');
            syncQueue.push({
                type: 'status',
                data: status,
                timestamp: Date.now(),
                retryCount: 0
            });
            localStorage.setItem('knecta_sync_queue', JSON.stringify(syncQueue));
        }
        
        function setupStatusViewerControls() {
            // Next/Previous buttons
            document.getElementById('prevStatusBtn').addEventListener('click', prevStatus);
            document.getElementById('nextStatusBtn').addEventListener('click', nextStatus);
            
            // ENHANCED FEATURE: Quick Reactions
            document.getElementById('reactStatusBtn').addEventListener('click', () => {
                if (!currentViewerStatus) return;
                
                const currentStatus = currentViewerStatus.statuses[currentViewerStatus.currentIndex];
                
                // Show reaction picker with enhanced options
                showEnhancedReactionPicker(currentStatus.id);
            });
            
            // Share button
            document.getElementById('shareStatusBtn').addEventListener('click', () => {
                if (!currentViewerStatus) return;
                
                const currentStatus = currentViewerStatus.statuses[currentViewerStatus.currentIndex];
                
                // Share status
                shareStatus(currentStatus);
            });
            
            // Mute button
            document.getElementById('muteStatusBtn').addEventListener('click', () => {
                if (!currentViewerStatus) return;
                
                const userId = currentViewerStatus.userId;
                
                if (mutedUsers.has(userId)) {
                    unmuteUser(userId);
                } else {
                    muteUser(userId);
                }
            });
            
            // Report button
            document.getElementById('reportStatusBtn').addEventListener('click', () => {
                if (!currentViewerStatus) return;
                
                const currentStatus = currentViewerStatus.statuses[currentViewerStatus.currentIndex];
                
                // Show report dialog
                showReportDialog(currentStatus.id);
            });
            
            // Viewer menu
            document.getElementById('viewerMenuBtn').addEventListener('click', () => {
                showViewerMenu();
            });
            
            // Reply functionality
            document.getElementById('sendReplyBtn').addEventListener('click', () => {
                const replyInput = document.getElementById('statusReplyInput');
                const replyText = replyInput.value.trim();
                
                if (replyText && currentViewerStatus) {
                    const currentStatus = currentViewerStatus.statuses[currentViewerStatus.currentIndex];
                    sendStatusReply(currentStatus.id, replyText);
                    replyInput.value = '';
                }
            });
            
            // Reply input enter key
            document.getElementById('statusReplyInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    document.getElementById('sendReplyBtn').click();
                }
            });
        }
        
        // ENHANCED FEATURE: Enhanced Reaction Picker
        function showEnhancedReactionPicker(statusId) {
            // Create reaction picker
            const reactionPicker = document.createElement('div');
            reactionPicker.className = 'reaction-picker';
            reactionPicker.style.position = 'absolute';
            reactionPicker.style.bottom = '100px';
            reactionPicker.style.left = '50%';
            reactionPicker.style.transform = 'translateX(-50%)';
            reactionPicker.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
            reactionPicker.style.borderRadius = '24px';
            reactionPicker.style.padding = '10px';
            reactionPicker.style.display = 'flex';
            reactionPicker.style.gap = '10px';
            reactionPicker.style.backdropFilter = 'blur(10px)';
            reactionPicker.style.zIndex = '1000';
            
            // Enhanced reactions with labels
            const enhancedReactions = [
                { emoji: '', label: 'Helpful', color: '#4caf50' },
                { emoji: '', label: 'Love', color: '#f44336' },
                { emoji: '', label: 'Inspiring', color: '#ff9800' },
                { emoji: '', label: 'Funny', color: '#ffeb3b' },
                { emoji: '', label: 'Not useful', color: '#9e9e9e' }
            ];
            
            enhancedReactions.forEach(reaction => {
                const reactionBtn = document.createElement('button');
                reactionBtn.className = 'status-action-btn';
                reactionBtn.style.fontSize = '24px';
                reactionBtn.style.display = 'flex';
                reactionBtn.style.flexDirection = 'column';
                reactionBtn.style.alignItems = 'center';
                reactionBtn.style.justifyContent = 'center';
                reactionBtn.style.width = '60px';
                reactionBtn.style.height = '60px';
                reactionBtn.innerHTML = `
                    <span>${reaction.emoji}</span>
                    <span style="font-size: 10px; color: white; margin-top: 5px;">${reaction.label}</span>
                `;
                reactionBtn.addEventListener('click', () => {
                    reactToStatus(statusId, reaction.emoji, reaction.label);
                    document.body.removeChild(reactionPicker);
                });
                reactionPicker.appendChild(reactionBtn);
            });
            
            document.body.appendChild(reactionPicker);
            
            // Remove after 5 seconds
            setTimeout(() => {
                if (document.body.contains(reactionPicker)) {
                    document.body.removeChild(reactionPicker);
                }
            }, 5000);
            
            // Close when clicking outside
            document.addEventListener('click', function closeReactionPicker(e) {
                if (!reactionPicker.contains(e.target) && e.target.id !== 'reactStatusBtn') {
                    if (document.body.contains(reactionPicker)) {
                        document.body.removeChild(reactionPicker);
                    }
                    document.removeEventListener('click', closeReactionPicker);
                }
            });
        }
        
        async function reactToStatus(statusId, reaction, label = '') {
            try {
                const response = await api('POST', `/api/status/${statusId}/react`, { reaction, label });
                
                if (response && response.success) {
                    showNotification(`Reacted with ${reaction} ${label ? '(' + label + ')' : ''}`, 'success');
                }
                
            } catch (error) {
                console.error('Error reacting to status:', error);
                showNotification('Reaction saved offline', 'info');
            }
        }
        
        function shareStatus(status) {
            if (navigator.share) {
                navigator.share({
                    title: 'Check out this status',
                    text: status.text || status.caption || 'Status update',
                    url: window.location.origin + `/status/${status.id}`
                }).catch(console.error);
            } else {
                // Fallback: copy link
                const link = window.location.origin + `/status/${status.id}`;
                navigator.clipboard.writeText(link).then(() => {
                    showNotification('Link copied to clipboard', 'success');
                });
            }
        }
        
        function showReportDialog(statusId) {
            const reasons = [
                'Spam',
                'Inappropriate content',
                'Harassment',
                'False information',
                'Violence',
                'Other'
            ];
            
            const reportDialog = document.createElement('div');
            reportDialog.className = 'create-status-modal active';
            reportDialog.style.zIndex = '3000';
            
            reportDialog.innerHTML = `
                <div class="create-status-container" style="max-width: 400px;">
                    <div class="create-status-header">
                        <h3>Report Status</h3>
                        <button class="add-status-btn close-report-dialog">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div style="padding: 25px;">
                        <p style="margin-bottom: 20px;">Why are you reporting this status?</p>
                        <div id="reportReasons" style="display: flex; flex-direction: column; gap: 10px;"></div>
                        <textarea id="reportAdditional" placeholder="Additional details (optional)" style="width: 100%; margin-top: 20px; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; min-height: 80px;"></textarea>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn secondary" id="cancelReportBtn">Cancel</button>
                        <button class="action-btn danger" id="submitReportBtn">Submit Report</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(reportDialog);
            
            const reasonsContainer = reportDialog.querySelector('#reportReasons');
            reasons.forEach(reason => {
                const reasonBtn = document.createElement('button');
                reasonBtn.className = 'my-status-action-btn';
                reasonBtn.textContent = reason;
                reasonBtn.style.textAlign = 'left';
                reasonBtn.addEventListener('click', () => {
                    reportDialog.querySelectorAll('.my-status-action-btn').forEach(btn => {
                        btn.style.backgroundColor = '';
                    });
                    reasonBtn.style.backgroundColor = 'rgba(255, 59, 48, 0.1)';
                    window.selectedReportReason = reason;
                });
                reasonsContainer.appendChild(reasonBtn);
            });
            
            // Event listeners
            reportDialog.querySelector('.close-report-dialog').addEventListener('click', () => {
                document.body.removeChild(reportDialog);
            });
            
            reportDialog.querySelector('#cancelReportBtn').addEventListener('click', () => {
                document.body.removeChild(reportDialog);
            });
            
            reportDialog.querySelector('#submitReportBtn').addEventListener('click', () => {
                const reason = window.selectedReportReason;
                const additional = reportDialog.querySelector('#reportAdditional').value;
                
                if (reason) {
                    reportStatus(statusId, `${reason}: ${additional}`);
                    document.body.removeChild(reportDialog);
                } else {
                    showNotification('Please select a reason', 'error');
                }
            });
        }
        
        // ENHANCED FEATURE: Viewer Menu with Enhanced Options
        function showViewerMenu() {
            if (!currentViewerStatus) return;
            
            const menu = document.createElement('div');
            menu.className = 'create-status-modal active';
            menu.style.zIndex = '3000';
            
            menu.innerHTML = `
                <div class="create-status-container" style="max-width: 300px;">
                    <div class="create-status-header">
                        <h3>Options</h3>
                        <button class="add-status-btn close-viewer-menu">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div style="padding: 25px;">
                        <div class="action-buttons" style="flex-direction: column; gap: 10px;">
                            <button class="action-btn secondary" id="viewProfileBtn">
                                <i class="fas fa-user"></i> View Profile
                            </button>
                            <button class="action-btn secondary" id="toggleAutoAdvanceBtn">
                                <i class="fas fa-play-circle"></i> ${statusAutoAdvance ? 'Pause Auto-Advance' : 'Resume Auto-Advance'}
                            </button>
                            <button class="action-btn secondary" id="saveToHighlightsBtn">
                                <i class="fas fa-star"></i> Save to Highlights
                            </button>
                            <button class="action-btn secondary" id="silentViewBtn">
                                <i class="fas fa-eye-slash"></i> Silent View Mode
                            </button>
                            <button class="action-btn secondary" id="translateStatusBtn">
                                <i class="fas fa-language"></i> Translate
                            </button>
                            <button class="action-btn danger" id="closeViewerBtn">
                                <i class="fas fa-times"></i> Close Viewer
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(menu);
            
            // Event listeners
            menu.querySelector('.close-viewer-menu').addEventListener('click', () => {
                document.body.removeChild(menu);
            });
            
            menu.querySelector('#viewProfileBtn').addEventListener('click', () => {
                // Navigate to user profile
                window.location.href = `../profile.html?user=${currentViewerStatus.userId}`;
                document.body.removeChild(menu);
            });
            
            menu.querySelector('#toggleAutoAdvanceBtn').addEventListener('click', () => {
                statusAutoAdvance = !statusAutoAdvance;
                if (statusAutoAdvance) {
                    startAutoAdvance();
                } else {
                    if (statusTimer) clearTimeout(statusTimer);
                }
                document.body.removeChild(menu);
                showNotification(statusAutoAdvance ? 'Auto-advance resumed' : 'Auto-advance paused', 'info');
            });
            
            menu.querySelector('#saveToHighlightsBtn').addEventListener('click', () => {
                const currentStatus = currentViewerStatus.statuses[currentViewerStatus.currentIndex];
                addToHighlights(currentStatus.id, 'From Viewer');
                document.body.removeChild(menu);
            });
            
            // ENHANCED FEATURE: Silent View Mode
            menu.querySelector('#silentViewBtn').addEventListener('click', () => {
                const silentMode = !localStorage.getItem('knecta_silent_view_mode');
                localStorage.setItem('knecta_silent_view_mode', silentMode);
                showNotification(silentMode ? 'Silent view mode enabled' : 'Silent view mode disabled', 'info');
                document.body.removeChild(menu);
            });
            
            menu.querySelector('#translateStatusBtn').addEventListener('click', () => {
                translateCurrentStatus();
                document.body.removeChild(menu);
            });
            
            menu.querySelector('#closeViewerBtn').addEventListener('click', () => {
                closeStatusViewer();
                document.body.removeChild(menu);
            });
        }
        
        async function translateCurrentStatus() {
            if (!currentViewerStatus) return;
            
            const currentStatus = currentViewerStatus.statuses[currentViewerStatus.currentIndex];
            let textToTranslate = '';
            
            switch (currentStatus.type) {
                case STATUS_TYPES.TEXT:
                    textToTranslate = currentStatus.text;
                    break;
                case STATUS_TYPES.PHOTO:
                case STATUS_TYPES.VIDEO:
                    textToTranslate = currentStatus.caption || '';
                    break;
                case STATUS_TYPES.POLL:
                    textToTranslate = currentStatus.pollQuestion;
                    break;
            }
            
            if (!textToTranslate) {
                showNotification('No text to translate', 'warning');
                return;
            }
            
            try {
                // This would call a translation API
                // For demo, we'll simulate translation
                showNotification('Translating...', 'info');
                
                // Simulate API call
                setTimeout(() => {
                    // In real implementation, you would update the displayed text
                    showNotification('Translation applied', 'success');
                }, 1000);
                
            } catch (error) {
                console.error('Error translating:', error);
                showNotification('Translation failed', 'error');
            }
        }
        
        async function sendStatusReply(statusId, text) {
            try {
                const response = await api('POST', `/api/status/${statusId}/reply`, { text });
                
                if (response && response.success) {
                    showNotification('Reply sent', 'success');
                    
                    // Open chat with the user
                    if (currentViewerStatus) {
                        openChat(currentViewerStatus.userId, currentViewerStatus.userName);
                    }
                }
                
            } catch (error) {
                console.error('Error sending reply:', error);
                showNotification('Failed to send reply', 'error');
            }
        }
        
        function openChat(userId, userName) {
            const encodedName = encodeURIComponent(userName);
            window.location.href = `../message.html?user=${userId}&name=${encodedName}`;
        }
        
        function setupEventListeners() {
            // Category tabs
            document.getElementById('allTab').addEventListener('click', function() {
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                renderStatusList();
            });
            
            document.getElementById('friendsTab').addEventListener('click', function() {
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                // Filter to show only friends statuses
                renderFriendsStatuses();
            });
            
            document.getElementById('closeTab').addEventListener('click', function() {
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                // Filter to show only close friends
                renderCloseFriendsStatuses();
            });
            
            document.getElementById('pinnedTab').addEventListener('click', function() {
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                // Show pinned statuses - ENHANCED FEATURE
                renderPinnedStatuses();
            });
            
            document.getElementById('mutedTab').addEventListener('click', function() {
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                // Show muted users' statuses
                renderMutedStatuses();
            });
            
            // Create status buttons
            document.getElementById('createStatusBtn').addEventListener('click', () => {
                showCreateStatusModal();
            });
            
            document.getElementById('createStatusQuickBtn').addEventListener('click', () => {
                showCreateStatusModal();
            });
            
            document.getElementById('textStatusBtn').addEventListener('click', () => {
                showCreateStatusModal();
                document.querySelector('.create-status-tab[data-tab="text"]').click();
            });
            
            document.getElementById('photoStatusBtn').addEventListener('click', () => {
                showCreateStatusModal();
                document.querySelector('.create-status-tab[data-tab="media"]').click();
            });
            
            // View highlights button - ENHANCED FEATURE
            document.getElementById('viewHighlightsBtn').addEventListener('click', () => {
                showHighlightsModal();
            });
            
            // View stats button - ENHANCED FEATURE
            document.getElementById('viewStatsBtn').addEventListener('click', () => {
                showStatsModal();
            });
            
            // Create status modal tabs
            document.querySelectorAll('.create-status-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    
                    document.querySelectorAll('.create-status-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    document.querySelectorAll('.create-status-tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    const tabContent = document.getElementById(`${tabName}Tab`);
                    if (tabContent) {
                        tabContent.classList.add('active');
                    }
                    
                    // Load drafts when drafts tab is selected - ENHANCED FEATURE
                    if (tabName === 'drafts') {
                        loadDraftsIntoModal();
                    }
                });
            });
            
            // Text status input
            const textStatusInput = document.getElementById('textStatusInput');
            if (textStatusInput) {
                textStatusInput.addEventListener('input', updateTextStatusPreview);
                
                // Initialize background options
                const textStatusOptions = document.getElementById('textStatusOptions');
                if (textStatusOptions) {
                    BACKGROUND_COLORS.forEach(color => {
                        const bgOption = document.createElement('div');
                        bgOption.className = 'text-status-bg';
                        bgOption.style.backgroundColor = color;
                        bgOption.dataset.color = color;
                        
                        bgOption.addEventListener('click', function() {
                            document.querySelectorAll('.text-status-bg').forEach(opt => {
                                opt.classList.remove('selected');
                            });
                            this.classList.add('selected');
                            
                            // Update color picker
                            if (colorPicker && colorPicker.spectrum) {
                                colorPicker.spectrum('set', color);
                            } else {
                                document.getElementById('textStatusColor').value = color;
                            }
                            
                            updateTextStatusPreview();
                        });
                        
                        textStatusOptions.appendChild(bgOption);
                    });
                }
            }
            
            // Media upload
            const mediaUploadArea = document.getElementById('mediaUploadArea');
            const mediaUploadInput = document.getElementById('mediaUploadInput');
            
            if (mediaUploadArea && mediaUploadInput) {
                mediaUploadArea.addEventListener('click', () => {
                    mediaUploadInput.click();
                });
                
                mediaUploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    mediaUploadArea.style.borderColor = 'var(--primary-color)';
                    mediaUploadArea.style.backgroundColor = 'rgba(0, 132, 255, 0.05)';
                });
                
                mediaUploadArea.addEventListener('dragleave', () => {
                    mediaUploadArea.style.borderColor = '';
                    mediaUploadArea.style.backgroundColor = '';
                });
                
                mediaUploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    mediaUploadArea.style.borderColor = '';
                    mediaUploadArea.style.backgroundColor = '';
                    
                    if (e.dataTransfer.files.length > 0) {
                        handleMediaUpload(e.dataTransfer.files[0]);
                    }
                });
                
                mediaUploadInput.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        handleMediaUpload(e.target.files[0]);
                    }
                });
            }
            
            // Add poll option - ENHANCED FEATURE
            document.getElementById('addPollOptionBtn')?.addEventListener('click', () => {
                const optionsContainer = document.getElementById('pollOptionsContainer');
                if (optionsContainer) {
                    const optionCount = optionsContainer.children.length;
                    const newOption = document.createElement('div');
                    newOption.className = 'poll-option';
                    newOption.innerHTML = `
                        <input type="text" class="poll-option-input" placeholder="Option ${optionCount + 1}">
                        <button class="status-action-btn danger remove-option-btn">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    
                    newOption.querySelector('.remove-option-btn').addEventListener('click', () => {
                        if (optionsContainer.children.length > 2) {
                            optionsContainer.removeChild(newOption);
                        }
                    });
                    
                    optionsContainer.appendChild(newOption);
                }
            });
            
            // Post status button
            document.getElementById('postStatusBtn').addEventListener('click', () => {
                postStatusFromModal();
            });
            
            // Save draft button - ENHANCED FEATURE
            document.getElementById('saveDraftBtn').addEventListener('click', () => {
                saveCurrentAsDraft();
            });
            
            // Close modals
            document.getElementById('closeCreateStatusModal').addEventListener('click', () => {
                createStatusModal.classList.remove('active');
            });
            
            document.getElementById('closeHighlightsModal').addEventListener('click', () => {
                highlightsModal.classList.remove('active');
            });
            
            document.getElementById('closeStatsModal').addEventListener('click', () => {
                statsModal.classList.remove('active');
            });
            
            // Back button in viewer
            document.getElementById('backBtn').addEventListener('click', () => {
                closeStatusViewer();
            });
            
            // Add highlight button - ENHANCED FEATURE
            document.getElementById('addHighlightBtn')?.addEventListener('click', () => {
                const highlightName = prompt('Enter highlight name:');
                if (highlightName) {
                    // Would need to select a status to add
                    showNotification('Select a status to add to highlights', 'info');
                }
            });
            
            // Swipe gestures for mobile - ENHANCED FEATURE
            setupSwipeGestures();
            
            // Window resize
            window.addEventListener('resize', () => {
                // Handle responsive adjustments
            });
            
            // Before unload
            window.addEventListener('beforeunload', () => {
                saveAllData();
            });
            
            // Network status for offline support - ENHANCED FEATURE
            window.addEventListener('online', () => {
                showNotification('Back online - syncing data', 'info');
                syncOfflineData();
            });
            
            window.addEventListener('offline', () => {
                showNotification('Working offline', 'info');
            });
        }
        
        // ENHANCED FEATURE: Swipe Gestures
        function setupSwipeGestures() {
            let touchStartX = 0;
            let touchStartY = 0;
            let touchEndX = 0;
            let touchEndY = 0;
            
            const viewerContent = document.getElementById('statusViewerContent');
            if (!viewerContent) return;
            
            viewerContent.addEventListener('touchstart', (e) => {
                touchStartX = e.changedTouches[0].screenX;
                touchStartY = e.changedTouches[0].screenY;
            });
            
            viewerContent.addEventListener('touchend', (e) => {
                touchEndX = e.changedTouches[0].screenX;
                touchEndY = e.changedTouches[0].screenY;
                handleSwipe();
            });
            
            function handleSwipe() {
                const diffX = touchEndX - touchStartX;
                const diffY = touchEndY - touchStartY;
                
                // Horizontal swipe (left/right)
                if (Math.abs(diffX) > Math.abs(diffY)) {
                    if (diffX > 50) {
                        // Swipe right - previous status
                        prevStatus();
                    } else if (diffX < -50) {
                        // Swipe left - next status
                        nextStatus();
                    }
                }
                // Vertical swipe (up/down)
                else {
                    if (diffY > 50) {
                        // Swipe down - show reactions
                        if (currentViewerStatus) {
                            const currentStatus = currentViewerStatus.statuses[currentViewerStatus.currentIndex];
                            showEnhancedReactionPicker(currentStatus.id);
                        }
                    }
                }
            }
        }
        
        function renderFriendsStatuses() {
            // Filter to show only friends' statuses
            const friendsIds = new Set(friendsStatuses.map(status => status.userId));
            const filteredStatuses = allStatuses.filter(status => friendsIds.has(status.userId));
            
            renderFilteredStatuses(filteredStatuses);
        }
        
        function renderCloseFriendsStatuses() {
            // Filter to show only close friends' statuses
            const closeFriendsIds = new Set(); // This should come from user's close friends list
            const filteredStatuses = allStatuses.filter(status => closeFriendsIds.has(status.userId));
            
            renderFilteredStatuses(filteredStatuses);
        }
        
        // ENHANCED FEATURE: Render Pinned Statuses
        function renderPinnedStatuses() {
            // Show pinned statuses at the top
            statusListContent.innerHTML = '';
            
            if (pinnedStatuses.length === 0) {
                statusListContent.innerHTML = `
                    <div class="empty-state" style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <i class="fas fa-thumbtack" style="font-size: 48px; margin-bottom: 15px;"></i>
                        <p>No pinned statuses</p>
                        <p class="subtext">Pin important statuses to keep them at the top</p>
                    </div>
                `;
                return;
            }
            
            pinnedStatuses.forEach(status => {
                const statusItem = document.createElement('div');
                statusItem.className = 'status-item pinned';
                statusItem.dataset.userId = status.userId;
                statusItem.dataset.statusId = status.id;
                
                const userAvatar = status.user?.photoURL || '';
                const userName = status.user?.displayName || 'Unknown User';
                const userInitials = userName.split(' ').map(word => word[0]).join('').toUpperCase().substring(0, 2);
                
                statusItem.innerHTML = `
                    <div class="status-avatar has-status">
                        ${userAvatar ? '' : `<span style="color: white; font-size: 18px;">${userInitials}</span>`}
                        <div style="position: absolute; bottom: -2px; right: -2px; background: #ff9800; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 10px;">
                            <i class="fas fa-thumbtack"></i>
                        </div>
                    </div>
                    <div class="status-info">
                        <div class="status-name">
                            <span>${escapeHtml(userName)} <span style="color: #ff9800; font-size: 12px;"><i class="fas fa-thumbtack"></i> Pinned</span></span>
                        </div>
                        <div class="status-time">
                            <span>${formatTimeAgo(new Date(status.createdAt))}</span>
                        </div>
                        <div class="status-preview">
                            ${getStatusPreviewText(status)}
                        </div>
                    </div>
                `;
                
                if (userAvatar) {
                    statusItem.querySelector('.status-avatar').style.backgroundImage = `url('${escapeHtml(userAvatar)}')`;
                }
                
                statusItem.addEventListener('click', () => {
                    viewUserStatuses(status.userId, status.user?.displayName || 'User');
                });
                
                statusListContent.appendChild(statusItem);
            });
        }
        
        function renderMutedStatuses() {
            // Show muted users' statuses
            const filteredStatuses = allStatuses.filter(status => mutedUsers.has(status.userId));
            renderFilteredStatuses(filteredStatuses);
        }
        
        function renderFilteredStatuses(statuses) {
            statusListContent.innerHTML = '';
            
            if (statuses.length === 0) {
                statusListContent.innerHTML = `
                    <div class="empty-state" style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <i class="fas fa-comment-dots" style="font-size: 48px; margin-bottom: 15px;"></i>
                        <p>No status updates in this category</p>
                    </div>
                `;
                return;
            }
            
            // Group statuses by user
            const statusesByUser = {};
            statuses.forEach(status => {
                const userId = status.userId;
                if (!statusesByUser[userId]) {
                    statusesByUser[userId] = [];
                }
                statusesByUser[userId].push(status);
            });
            
            // Render each user's statuses
            Object.entries(statusesByUser).forEach(([userId, userStatuses]) => {
                const userStatus = userStatuses[0]; // Get latest status
                addStatusItem(userStatus, userStatuses.length);
            });
        }
        
        function showCreateStatusModal() {
            createStatusModal.classList.add('active');
            
            // Reset form
            document.getElementById('textStatusInput').value = '';
            document.getElementById('mediaCaption').value = '';
            document.getElementById('pollQuestion').value = '';
            document.getElementById('scheduleInput').value = '';
            
            // Reset selections
            document.querySelectorAll('.category-chip').forEach(chip => {
                chip.classList.remove('selected');
            });
            
            document.querySelectorAll('.music-track').forEach(track => {
                track.classList.remove('selected');
            });
            
            document.querySelectorAll('.template-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            window.selectedMusicTrack = null;
            window.selectedMediaFile = null;
            window.selectedMediaUrl = null;
            window.selectedMediaType = null;
            
            // Clear media preview
            const mediaPreview = document.getElementById('mediaPreview');
            if (mediaPreview) {
                mediaPreview.innerHTML = '';
            }
            
            // Update preview
            updateTextStatusPreview();
        }
        
        function handleMediaUpload(file) {
            const preview = document.getElementById('mediaPreview');
            if (!preview) return;
            
            // Check file type
            const isImage = file.type.startsWith('image/');
            const isVideo = file.type.startsWith('video/');
            
            if (!isImage && !isVideo) {
                showNotification('Please upload an image or video', 'error');
                return;
            }
            
            // Check file size (max 50MB)
            if (file.size > 50 * 1024 * 1024) {
                showNotification('File size must be less than 50MB', 'error');
                return;
            }
            
            // Show upload progress - ENHANCED FEATURE
            const progressBar = document.getElementById('uploadProgress');
            progressBar.style.width = '0%';
            
            // Create preview
            const reader = new FileReader();
            reader.onloadstart = function() {
                progressBar.style.width = '10%';
            };
            
            reader.onprogress = function(e) {
                if (e.lengthComputable) {
                    const percentLoaded = Math.round((e.loaded / e.total) * 100);
                    progressBar.style.width = percentLoaded + '%';
                }
            };
            
            reader.onload = function(e) {
                progressBar.style.width = '100%';
                setTimeout(() => {
                    progressBar.style.width = '0%';
                }, 500);
                
                preview.innerHTML = '';
                
                if (isImage) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.width = '100%';
                    img.style.maxHeight = '300px';
                    img.style.objectFit = 'contain';
                    preview.appendChild(img);
                } else if (isVideo) {
                    const video = document.createElement('video');
                    video.src = e.target.result;
                    video.controls = true;
                    video.style.width = '100%';
                    video.style.maxHeight = '300px';
                    preview.appendChild(video);
                }
                
                // Add remove button
                const removeBtn = document.createElement('button');
                removeBtn.className = 'media-remove-btn';
                removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                removeBtn.addEventListener('click', () => {
                    preview.innerHTML = '';
                    window.selectedMediaFile = null;
                    window.selectedMediaUrl = null;
                    window.selectedMediaType = null;
                });
                preview.appendChild(removeBtn);
                
                // Store file for upload
                window.selectedMediaFile = file;
                window.selectedMediaUrl = e.target.result;
                window.selectedMediaType = isImage ? STATUS_TYPES.PHOTO : STATUS_TYPES.VIDEO;
            };
            
            reader.readAsDataURL(file);
        }
        
        function postStatusFromModal() {
            const activeTab = document.querySelector('.create-status-tab.active');
            if (!activeTab) return;
            
            const tabName = activeTab.dataset.tab;
            
            // Get common options
            const privacy = document.getElementById('privacySelect').value;
            const duration = document.getElementById('durationSelect').value;
            const expiresAt = duration === 'permanent' ? null : new Date(Date.now() + DURATION_OPTIONS[duration]).toISOString();
            
            const selectedCategories = Array.from(document.querySelectorAll('.category-chip.selected')).map(chip => chip.dataset.category);
            const category = selectedCategories.length > 0 ? selectedCategories[0] : null;
            
            const isSensitive = document.getElementById('sensitiveToggle')?.checked || false;
            const autoTranslate = document.getElementById('translateToggle')?.checked || false;
            
            const scheduleInput = document.getElementById('scheduleInput').value;
            const scheduleTime = scheduleInput ? new Date(scheduleInput).toISOString() : null;
            
            switch (tabName) {
                case 'text':
                    const text = document.getElementById('textStatusInput').value.trim();
                    if (!text) {
                        showNotification('Please enter status text', 'error');
                        return;
                    }
                    
                    let backgroundColor = '#0084ff';
                    if (colorPicker && colorPicker.spectrum) {
                        backgroundColor = colorPicker.spectrum('get').toHexString();
                    } else {
                        backgroundColor = document.getElementById('textStatusColor').value;
                    }
                    
                    const textColor = getContrastColor(backgroundColor);
                    
                    const statusData = {
                        text,
                        backgroundColor,
                        textColor,
                        fontSize: '24px', // Default, could be customizable
                        category,
                        privacy,
                        expiresAt,
                        isSensitive,
                        autoTranslate,
                        type: STATUS_TYPES.TEXT
                    };
                    
                    if (scheduleTime) {
                        scheduleStatus(statusData, scheduleTime);
                    } else {
                        createTextStatus(text, statusData);
                    }
                    break;
                    
                case 'media':
                    if (!window.selectedMediaFile) {
                        showNotification('Please select a photo or video', 'error');
                        return;
                    }
                    
                    const caption = document.getElementById('mediaCaption').value.trim();
                    const musicTrack = window.selectedMusicTrack;
                    
                    const mediaData = {
                        caption,
                        musicTrack,
                        category,
                        privacy,
                        expiresAt,
                        isSensitive,
                        type: window.selectedMediaType
                    };
                    
                    if (scheduleTime) {
                        scheduleStatus(mediaData, scheduleTime);
                    } else {
                        // In real implementation, you would upload the file first
                        // For now, we'll use the data URL
                        createMediaStatus(window.selectedMediaUrl, window.selectedMediaType, mediaData);
                    }
                    break;
                    
                case 'options':
                    // This tab doesn't create status directly
                    showNotification('Please use Text or Media tab to create status', 'info');
                    return;
                    
                case 'templates':
                    const selectedTemplate = document.querySelector('.template-item.selected');
                    if (!selectedTemplate) {
                        showNotification('Please select a template', 'error');
                        return;
                    }
                    
                    const templateText = document.getElementById('textStatusInput').value.trim() || 'Your status here';
                    const template = TEMPLATES.find(t => t.id === selectedTemplate.dataset.templateId);
                    
                    const templateData = {
                        text: templateText,
                        backgroundImage: template.bg,
                        textColor: template.textColor,
                        fontSize: template.fontSize,
                        emoji: template.emoji,
                        category,
                        privacy,
                        expiresAt,
                        isSensitive,
                        autoTranslate,
                        type: STATUS_TYPES.TEXT
                    };
                    
                    if (scheduleTime) {
                        scheduleStatus(templateData, scheduleTime);
                    } else {
                        createTextStatus(templateText, templateData);
                    }
                    break;
                    
                case 'drafts':
                    // This tab doesn't create status directly
                    showNotification('Select a draft to load', 'info');
                    return;
            }
            
            // Close modal
            createStatusModal.classList.remove('active');
        }
        
        // ENHANCED FEATURE: Save Current as Draft
        function saveCurrentAsDraft() {
            const activeTab = document.querySelector('.create-status-tab.active');
            if (!activeTab) return;
            
            const tabName = activeTab.dataset.tab;
            let draftData = {};
            
            switch (tabName) {
                case 'text':
                    const text = document.getElementById('textStatusInput').value.trim();
                    if (!text) {
                        showNotification('No text to save as draft', 'warning');
                        return;
                    }
                    
                    let backgroundColor = '#0084ff';
                    if (colorPicker && colorPicker.spectrum) {
                        backgroundColor = colorPicker.spectrum('get').toHexString();
                    } else {
                        backgroundColor = document.getElementById('textStatusColor').value;
                    }
                    
                    draftData = {
                        type: STATUS_TYPES.TEXT,
                        text,
                        backgroundColor,
                        textColor: getContrastColor(backgroundColor)
                    };
                    break;
                    
                case 'media':
                    if (!window.selectedMediaFile) {
                        showNotification('No media to save as draft', 'warning');
                        return;
                    }
                    
                    const caption = document.getElementById('mediaCaption').value.trim();
                    
                    draftData = {
                        type: window.selectedMediaType,
                        mediaUrl: window.selectedMediaUrl,
                        caption
                    };
                    break;
                    
                default:
                    showNotification('Cannot save draft from this tab', 'warning');
                    return;
            }
            
            // Add other options
            const privacy = document.getElementById('privacySelect').value;
            const duration = document.getElementById('durationSelect').value;
            const expiresAt = duration === 'permanent' ? null : new Date(Date.now() + DURATION_OPTIONS[duration]).toISOString();
            
            const selectedCategories = Array.from(document.querySelectorAll('.category-chip.selected')).map(chip => chip.dataset.category);
            const category = selectedCategories.length > 0 ? selectedCategories[0] : null;
            
            draftData.privacy = privacy;
            draftData.expiresAt = expiresAt;
            draftData.category = category;
            
            saveStatusDraft(draftData);
            
            // Update drafts tab
            loadDraftsIntoModal();
        }
        
        function loadDraftsIntoModal() {
            const draftsContainer = document.getElementById('draftsContainer');
            if (!draftsContainer) return;
            
            draftsContainer.innerHTML = '';
            
            if (statusDrafts.length === 0) {
                draftsContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-save" style="font-size: 32px; margin-bottom: 10px;"></i>
                        <p>No drafts saved</p>
                        <p style="font-size: 14px; margin-top: 10px;">Your drafts will appear here</p>
                    </div>
                `;
                return;
            }
            
            statusDrafts.forEach(draft => {
                const draftItem = document.createElement('div');
                draftItem.className = 'draft-item';
                draftItem.dataset.draftId = draft.id;
                
                let previewContent = '';
                let previewStyle = '';
                
                if (draft.type === STATUS_TYPES.TEXT) {
                    previewContent = draft.text.length > 50 ? draft.text.substring(0, 50) + '...' : draft.text;
                    previewStyle = `background-color: ${draft.backgroundColor}; color: ${draft.textColor};`;
                } else if (draft.type === STATUS_TYPES.PHOTO) {
                    previewContent = ' Photo';
                    previewStyle = 'background-color: #f0f2f5;';
                } else if (draft.type === STATUS_TYPES.VIDEO) {
                    previewContent = ' Video';
                    previewStyle = 'background-color: #f0f2f5;';
                }
                
                draftItem.innerHTML = `
                    <div class="draft-preview" style="${previewStyle}">
                        ${previewContent}
                    </div>
                    <div class="draft-info">
                        ${formatTimeAgo(new Date(draft.savedAt))}
                        ${draft.category ? `<br><small><i class="${CATEGORIES.find(c => c.id === draft.category)?.icon || 'fas fa-tag'}"></i> ${CATEGORIES.find(c => c.id === draft.category)?.name || 'Uncategorized'}</small>` : ''}
                    </div>
                `;
                
                draftItem.addEventListener('click', () => {
                    loadDraft(draft.id);
                    createStatusModal.classList.remove('active');
                    setTimeout(() => {
                        showCreateStatusModal();
                    }, 300);
                });
                
                draftsContainer.appendChild(draftItem);
            });
        }
        
        // ENHANCED FEATURE: Show Highlights Modal
        function showHighlightsModal() {
            const highlightsGrid = document.getElementById('highlightsGrid');
            if (!highlightsGrid) return;
            
            highlightsGrid.innerHTML = '';
            
            if (statusHighlights.length === 0) {
                highlightsGrid.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-secondary); grid-column: 1 / -1;">
                        <i class="fas fa-star" style="font-size: 48px; margin-bottom: 15px;"></i>
                        <p>No highlights yet</p>
                        <p style="font-size: 14px; margin-top: 10px;">Save your favorite statuses to highlights</p>
                        <button class="action-btn primary" style="margin-top: 20px;" onclick="showNotification('Create a status first, then save it to highlights', 'info')">
                            <i class="fas fa-plus"></i> Create Your First Highlight
                        </button>
                    </div>
                `;
            } else {
                statusHighlights.forEach(highlight => {
                    const highlightItem = document.createElement('div');
                    highlightItem.className = 'highlight-item';
                    
                    highlightItem.innerHTML = `
                        <div class="highlight-cover" style="background-image: url('${escapeHtml(highlight.coverUrl || '')}'); background-color: ${highlight.coverUrl ? '' : '#0084ff'};"></div>
                        <div class="highlight-name">${escapeHtml(highlight.name)}</div>
                    `;
                    
                    highlightItem.addEventListener('click', () => {
                        // View the highlighted status
                        const status = myStatuses.find(s => s.id === highlight.statusId);
                        if (status) {
                            viewUserStatuses(currentUser.id, userData.displayName || 'My Status');
                        }
                        highlightsModal.classList.remove('active');
                    });
                    
                    highlightsGrid.appendChild(highlightItem);
                });
            }
            
            highlightsModal.classList.add('active');
        }
        
        // ENHANCED FEATURE: Show Stats Modal
        async function showStatsModal() {
            // Load stats from backend
            try {
                const response = await api('GET', '/api/status/stats');
                
                if (response && response.stats) {
                    const stats = response.stats;
                    
                    // Update stats display
                    document.getElementById('totalViews').textContent = stats.totalViews || 0;
                    document.getElementById('avgViewTime').textContent = stats.avgViewTime ? Math.round(stats.avgViewTime) + 's' : '0s';
                    document.getElementById('totalReplies').textContent = stats.totalReplies || 0;
                    document.getElementById('totalReactions').textContent = stats.totalReactions || 0;
                    document.getElementById('totalShares').textContent = stats.totalShares || 0;
                    
                    // Load recent viewers
                    const viewersList = document.getElementById('viewersList');
                    if (viewersList && stats.recentViewers) {
                        viewersList.innerHTML = '';
                        
                        stats.recentViewers.forEach(viewer => {
                            const viewerItem = document.createElement('div');
                            viewerItem.className = 'viewer-item';
                            viewerItem.innerHTML = `
                                <div class="viewer-avatar" style="background-image: url('${escapeHtml(viewer.avatar || '')}'); background-color: ${viewer.avatar ? '' : '#ccc'};"></div>
                                <div class="viewer-info">
                                    <div class="viewer-name">${escapeHtml(viewer.name)}</div>
                                    <div style="display: flex; justify-content: space-between;">
                                        <span class="viewer-time">${formatTimeAgo(new Date(viewer.viewedAt))}</span>
                                        <span class="viewer-duration">${viewer.duration || '0s'}</span>
                                    </div>
                                </div>
                            `;
                            viewersList.appendChild(viewerItem);
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading stats:', error);
                // Fallback to cached stats
                loadCachedStats();
            }
            
            statsModal.classList.add('active');
        }
        
        function loadCachedStats() {
            // Load stats from localStorage
            const statsData = localStorage.getItem(LOCAL_STORAGE_KEYS.STATUS_STATS);
            const stats = statsData ? JSON.parse(statsData) : {};
            
            // Calculate totals
            let totalViews = 0;
            let totalViewDuration = 0;
            let viewCount = 0;
            let totalReplies = 0;
            let totalReactions = 0;
            let totalShares = 0;
            
            Object.values(stats).forEach(stat => {
                totalViews += stat.views || 0;
                totalReplies += stat.replies || 0;
                totalReactions += stat.reactions || 0;
                totalShares += stat.shares || 0;
                
                if (stat.viewDuration && stat.viewDuration.length > 0) {
                    viewCount += stat.viewDuration.length;
                    // Calculate average view time (simplified)
                    totalViewDuration += stat.viewDuration.length * 5; // Assume 5 seconds per view
                }
            });
            
            // Update stats display
            document.getElementById('totalViews').textContent = totalViews;
            document.getElementById('avgViewTime').textContent = viewCount > 0 ? Math.round(totalViewDuration / viewCount) + 's' : '0s';
            document.getElementById('totalReplies').textContent = totalReplies;
            document.getElementById('totalReactions').textContent = totalReactions;
            document.getElementById('totalShares').textContent = totalShares;
            
            // Load cached viewers if any
            const viewersList = document.getElementById('viewersList');
            if (viewersList) {
                viewersList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">Viewer data will sync when online</div>';
            }
        }
        
        // ENHANCED FEATURE: Sync Offline Data
        async function syncOfflineData() {
            const syncQueue = JSON.parse(localStorage.getItem('knecta_sync_queue') || '[]');
            if (syncQueue.length === 0) return;
            
            showNotification(`Syncing ${syncQueue.length} items...`, 'info');
            
            for (let i = 0; i < syncQueue.length; i++) {
                const item = syncQueue[i];
                try {
                    if (item.type === 'status') {
                        await api('POST', '/api/status', item.data);
                        // Remove from queue on success
                        syncQueue.splice(i, 1);
                        i--;
                    }
                } catch (error) {
                    console.log('Sync failed for item:', item);
                    item.retryCount = (item.retryCount || 0) + 1;
                    
                    // Remove if too many retries
                    if (item.retryCount > 3) {
                        syncQueue.splice(i, 1);
                        i--;
                    }
                }
            }
            
            localStorage.setItem('knecta_sync_queue', JSON.stringify(syncQueue));
            
            if (syncQueue.length === 0) {
                showNotification('All data synced successfully', 'success');
            } else {
                showNotification(`${syncQueue.length} items failed to sync`, 'warning');
            }
        }
        
        function saveAllData() {
            saveToLocalStorage(LOCAL_STORAGE_KEYS.MY_STATUSES, myStatuses);
            saveToLocalStorage(LOCAL_STORAGE_KEYS.VIEWED_STATUSES, Array.from(viewedStatusIds));
            saveToLocalStorage(LOCAL_STORAGE_KEYS.MUTED_USERS, Array.from(mutedUsers));
            saveToLocalStorage(LOCAL_STORAGE_KEYS.PINNED_STATUSES, pinnedStatuses);
            saveToLocalStorage(LOCAL_STORAGE_KEYS.STATUS_HIGHLIGHTS, statusHighlights);
            saveToLocalStorage(LOCAL_STORAGE_KEYS.STATUS_DRAFTS, statusDrafts);
            
            console.log('All status data saved to localStorage');
        }
        
        console.log('Complete status system initialized successfully with all enhanced features working');
        console.log('Features enabled: Categories, Pinned Statuses, Polls, Drafts, Offline Support, Quick Reactions, View Duration Tracking');
    </script>
    <!-- BACKEND MIGRATION: Using updated api.js and app.js -->
    <script src="js/api.js"></script>
    <script src="js/settingsManager.js"></script>
    <script src="js/app.js"></script>
</body>
</html>