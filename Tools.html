<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
    <link rel="icon" href="../icons/moodchat-192.png">
    <link rel="icon" href="../icons/moodchat-512.png">
    <meta name="theme-color" content="#000000">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Tools Dashboard | MoodChat</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-color: #0084ff;
            --secondary-color: #f0f2f5;
            --danger-color: #ff3b30;
            --success-color: #34c759;
            --warning-color: #ff9500;
            --info-color: #5ac8fa;
            --text-primary: #050505;
            --text-secondary: #65676b;
            --bg-color: #ffffff;
            --border-color: #dddfe2;
            --tools-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --premium-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --business-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --productivity-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --ai-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --marketplace-gradient: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.2);
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            --card-hover-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            --offline-overlay: rgba(255, 255, 255, 0.95);
            --free-plan: #34c759;
            --basic-plan: #007aff;
            --pro-plan: #5856d6;
            --business-plan: #ff2d55;
            --animation-duration: 0.3s;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            height: 100vh;
            overflow-x: hidden;
        }
        
        .app-container {
            display: flex;
            min-height: 100vh;
            position: relative;
        }
        
        /* Mobile Header */
        .mobile-header {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--tools-gradient);
            color: white;
            padding: 12px 15px;
            z-index: 1000;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow);
            height: 60px;
        }
        
        .mobile-header.active {
            display: flex;
        }
        
        .mobile-header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .back-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        
        .back-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .back-btn.active {
            display: flex;
        }
        
        .mobile-header-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        /* Mobile Navigation Menu */
        .mobile-nav-menu {
            display: none;
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-color);
            z-index: 999;
            overflow-y: auto;
            padding: 20px;
            animation: slideInRight 0.3s ease;
        }
        
        .mobile-nav-menu.active {
            display: block;
        }
        
        /* Offline Overlay */
        .offline-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--offline-overlay);
            z-index: 9999;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        .offline-overlay.active {
            display: flex;
        }
        
        .offline-icon {
            font-size: 64px;
            color: var(--text-secondary);
            margin-bottom: 20px;
            opacity: 0.7;
        }
        
        .offline-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 10px;
        }
        
        .offline-message {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 30px;
            max-width: 400px;
            line-height: 1.5;
        }
        
        .offline-submessage {
            font-size: 14px;
            color: var(--text-secondary);
            opacity: 0.8;
            max-width: 400px;
            margin-top: 20px;
            padding: 15px;
            background-color: var(--secondary-color);
            border-radius: 12px;
            border-left: 4px solid var(--warning-color);
        }
        
        .offline-dismiss-btn {
            margin-top: 30px;
            padding: 12px 30px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .offline-dismiss-btn:hover {
            background-color: #0073e6;
            transform: translateY(-2px);
        }
        
        .offline-indicator {
            position: fixed;
            top: 70px;
            right: 20px;
            background-color: var(--warning-color);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow);
            animation: slideInRight 0.3s ease;
            display: none;
        }
        
        .offline-indicator.active {
            display: flex;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: 380px;
            background-color: var(--bg-color);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow-y: auto;
            position: sticky;
            top: 0;
            flex-shrink: 0;
            transition: transform 0.3s ease;
            z-index: 900;
        }
        
        .sidebar-header {
            padding: 20px;
            background: var(--tools-gradient);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        
        .sidebar-header h2 {
            font-size: 24px;
            font-weight: 600;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
            font-weight: 600;
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }
        
        .user-details {
            color: white;
        }
        
        .user-name {
            font-weight: 600;
            font-size: 14px;
        }
        
        .user-plan {
            font-size: 12px;
            opacity: 0.9;
        }
        
        /* Credit Display */
        .credit-display {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }
        
        .credit-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .credit-amount {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .credit-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .credit-btn {
            flex: 1;
            padding: 8px 12px;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .credit-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            flex-direction: column;
            padding: 0 20px;
            gap: 5px;
            margin-top: 10px;
            flex-shrink: 0;
        }
        
        .nav-tab {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            border-radius: 10px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s;
            cursor: pointer;
            user-select: none;
        }
        
        .nav-tab:hover {
            background-color: var(--secondary-color);
        }
        
        .nav-tab.active {
            background-color: rgba(0, 132, 255, 0.1);
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .nav-tab i {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }
        
        .nav-tab span {
            font-size: 15px;
        }
        
        .nav-tab-badge {
            margin-left: auto;
            background-color: var(--primary-color);
            color: white;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 10px;
        }
        
        /* Mobile Navigation Items */
        .mobile-nav-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-radius: 10px;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.2s;
            cursor: pointer;
            margin-bottom: 8px;
            user-select: none;
        }
        
        .mobile-nav-item:hover {
            background-color: var(--secondary-color);
        }
        
        .mobile-nav-item.active {
            background-color: rgba(0, 132, 255, 0.1);
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .mobile-nav-item i {
            font-size: 20px;
            width: 30px;
        }
        
        /* Category Filters */
        .category-filters {
            padding: 20px;
            padding-top: 0;
            margin-top: 10px;
            flex-shrink: 0;
        }
        
        .category-filters-container {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 5px;
            scrollbar-width: none;
        }
        
        .category-filters-container::-webkit-scrollbar {
            display: none;
        }
        
        .category-filter-btn {
            padding: 8px 16px;
            background-color: var(--secondary-color);
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            flex-shrink: 0;
            transition: all 0.2s;
            user-select: none;
        }
        
        .category-filter-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .category-filter-btn:hover {
            background-color: #e4e6e9;
        }
        
        /* Quick Stats */
        .quick-stats {
            padding: 0 20px;
            margin-top: 10px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            flex-shrink: 0;
        }
        
        .stat-card {
            background-color: var(--secondary-color);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--card-shadow);
        }
        
        .stat-number {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* Tools Content Area */
        .tools-content {
            flex: 1;
            background-color: var(--bg-color);
            display: none;
            flex-direction: column;
            min-height: 100vh;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity var(--animation-duration) ease, transform var(--animation-duration) ease;
        }
        
        .tools-content.active {
            display: flex;
            opacity: 1;
            transform: translateY(0);
            animation: fadeInUp var(--animation-duration) ease;
        }
        
        .content-header {
            position: sticky;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background-color: var(--bg-color);
            z-index: 100;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .content-title {
            font-size: 24px;
            font-weight: 600;
        }
        
        .content-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            white-space: nowrap;
            user-select: none;
        }
        
        .action-btn:hover {
            background-color: #0073e6;
        }
        
        .action-btn.secondary {
            background-color: var(--secondary-color);
            color: var(--text-primary);
        }
        
        .action-btn.secondary:hover {
            background-color: #e4e6e9;
        }
        
        /* Scrollable Content */
        .scrollable-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        /* Tools Grid */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .tool-card {
            background-color: var(--bg-color);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            user-select: none;
        }
        
        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-shadow);
            border-color: var(--primary-color);
        }
        
        .tool-card.locked {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .tool-card.locked:hover {
            transform: none;
            box-shadow: none;
            border-color: var(--border-color);
        }
        
        .tool-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: white;
            margin-bottom: 15px;
        }
        
        .tool-icon.ai { background: var(--ai-gradient); }
        .tool-icon.business { background: var(--business-gradient); }
        .tool-icon.productivity { background: var(--productivity-gradient); }
        .tool-icon.premium { background: var(--premium-gradient); }
        .tool-icon.marketplace { background: var(--marketplace-gradient); }
        
        .tool-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .tool-description {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .tool-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }
        
        .tool-cost {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .tool-cost.free {
            color: var(--success-color);
        }
        
        .tool-usage {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .locked-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 10px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tool-card.locked .locked-overlay {
            opacity: 1;
        }
        
        .locked-text {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .upgrade-btn {
            padding: 6px 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
        }
        
        /* Tool Preview Modal */
        .tool-preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1100;
            align-items: center;
            justify-content: center;
            animation: fadeIn var(--animation-duration) ease;
        }
        
        .tool-preview-modal.active {
            display: flex;
        }
        
        .tool-preview-container {
            width: 90%;
            max-width: 800px;
            background-color: var(--bg-color);
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
            box-shadow: var(--shadow-lg);
            animation: slideInUp var(--animation-duration) ease;
        }
        
        .tool-preview-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .tool-preview-title {
            font-size: 20px;
            font-weight: 600;
        }
        
        .tool-preview-content {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }
        
        /* Payment Modal */
        .payment-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1100;
            align-items: center;
            justify-content: center;
            animation: fadeIn var(--animation-duration) ease;
        }
        
        .payment-modal.active {
            display: flex;
        }
        
        .payment-container {
            width: 90%;
            max-width: 500px;
            background-color: var(--bg-color);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            animation: slideInUp var(--animation-duration) ease;
        }
        
        .payment-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            background: var(--tools-gradient);
            color: white;
        }
        
        /* Transaction History */
        .transactions-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        
        .transaction-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: var(--secondary-color);
            border-radius: 10px;
            transition: all 0.2s;
        }
        
        .transaction-item:hover {
            background-color: #e4e6e9;
        }
        
        .transaction-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .transaction-details {
            flex: 1;
            min-width: 0;
        }
        
        .transaction-title {
            font-weight: 600;
            margin-bottom: 5px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .transaction-date {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .transaction-amount {
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .transaction-amount.positive {
            color: var(--success-color);
        }
        
        .transaction-amount.negative {
            color: var(--danger-color);
        }
        
        /* Affiliate Section */
        .affiliate-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .affiliate-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        /* Dashboard Charts */
        .chart-container {
            background-color: var(--bg-color);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        /* Consultation Booking */
        .consultation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .consultation-card {
            background-color: var(--bg-color);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }
        
        .consultation-card:hover {
            border-color: var(--primary-color);
            box-shadow: var(--card-shadow);
        }
        
        /* Marketplace */
        .marketplace-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .marketplace-item {
            background-color: var(--bg-color);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .marketplace-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--card-shadow);
        }
        
        /* Tool Execution Modal */
        .tool-execution-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1100;
            align-items: center;
            justify-content: center;
            animation: fadeIn var(--animation-duration) ease;
        }
        
        .tool-execution-modal.active {
            display: flex;
        }
        
        .tool-execution-container {
            width: 95%;
            height: 90vh;
            background-color: var(--bg-color);
            border-radius: 15px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: slideInUp var(--animation-duration) ease;
        }
        
        .tool-execution-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .tool-execution-content {
            flex: 1;
            overflow: hidden;
        }
        
        .tool-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            z-index: 1200;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
        }
        
        .notification.active {
            transform: translateY(0);
            opacity: 1;
        }
        
        .notification.error {
            background-color: var(--danger-color);
        }
        
        .notification.warning {
            background-color: var(--warning-color);
        }
        
        .notification.info {
            background-color: var(--info-color);
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            z-index: 1300;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 20px;
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--secondary-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* Plan Badges */
        .plan-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .plan-badge.free {
            background-color: rgba(52, 199, 89, 0.1);
            color: var(--free-plan);
        }
        
        .plan-badge.basic {
            background-color: rgba(0, 122, 255, 0.1);
            color: var(--basic-plan);
        }
        
        .plan-badge.pro {
            background-color: rgba(88, 86, 214, 0.1);
            color: var(--pro-plan);
        }
        
        .plan-badge.business {
            background-color: rgba(255, 45, 85, 0.1);
            color: var(--business-plan);
        }
        
        /* Security Badge */
        .security-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            background-color: rgba(52, 199, 89, 0.1);
            color: var(--success-color);
            border-radius: 6px;
            font-size: 12px;
            margin-top: 10px;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideInUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ================= RESPONSIVE STYLES ================= */
        
        /* Large screens */
        @media (max-width: 1200px) {
            .sidebar {
                width: 350px;
            }
            
            .tools-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }
        
        /* Tablets */
        @media (max-width: 992px) {
            .sidebar {
                width: 320px;
            }
            
            .affiliate-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Mobile Landscape & Small Tablets */
        @media (max-width: 768px) {
            body {
                overflow-x: hidden;
            }
            
            .app-container {
                flex-direction: column;
                min-height: 100vh;
            }
            
            .mobile-header {
                display: flex;
            }
            
            .sidebar {
                display: none;
            }
            
            .tools-content {
                width: 100%;
                margin-top: 60px;
                min-height: calc(100vh - 60px);
            }
            
            .content-header {
                padding: 15px;
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .content-title {
                font-size: 20px;
            }
            
            .content-actions {
                width: 100%;
                justify-content: center;
            }
            
            .scrollable-content {
                padding: 15px;
            }
            
            .tools-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .consultation-grid {
                grid-template-columns: 1fr;
            }
            
            .affiliate-stats {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .chart-container {
                padding: 15px;
            }
            
            .sidebar-header h2 {
                font-size: 20px;
            }
            
            .credit-amount {
                font-size: 28px;
            }
            
            .offline-indicator {
                top: 70px;
            }
        }
        
        /* Mobile Portrait */
        @media (max-width: 576px) {
            .mobile-header {
                padding: 12px 15px;
            }
            
            .tools-content {
                margin-top: 60px;
                min-height: calc(100vh - 60px);
            }
            
            .tools-grid {
                grid-template-columns: 1fr;
            }
            
            .marketplace-grid {
                grid-template-columns: 1fr;
            }
            
            .affiliate-stats {
                grid-template-columns: 1fr;
            }
            
            .content-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .content-actions {
                width: 100%;
            }
            
            .action-btn {
                padding: 8px 16px;
                font-size: 14px;
                flex: 1;
                justify-content: center;
            }
            
            .credit-display {
                margin: 15px;
                padding: 15px;
            }
            
            .nav-tabs {
                padding: 0 15px;
            }
            
            .nav-tab {
                padding: 12px 15px;
            }
            
            .category-filters {
                padding: 15px;
                padding-top: 0;
            }
            
            .quick-stats {
                padding: 0 15px;
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stat-card {
                padding: 12px;
            }
            
            .tool-preview-container {
                width: 95%;
                margin: 10px;
            }
            
            .tool-preview-content {
                padding: 15px;
            }
            
            .payment-container {
                width: 95%;
                margin: 10px;
            }
            
            .tool-execution-container {
                width: 100%;
                height: 100vh;
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Header -->
    <div class="mobile-header" id="mobileHeader">
        <div class="mobile-header-left">
            <button class="back-btn" id="backBtn">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="mobile-header-title" id="mobileHeaderTitle">Dashboard</div>
        </div>
        <div style="display: flex; align-items: center; gap: 15px;">
            <div style="text-align: right; color: white;">
                <div style="font-size: 11px; opacity: 0.9;">Credits</div>
                <div style="font-size: 18px; font-weight: 700;" id="mobileCreditAmount">100</div>
            </div>
            <button class="action-btn" id="menuToggleBtn" style="padding: 8px 12px; background: rgba(255,255,255,0.2);">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </div>
    
    <!-- Mobile Navigation Menu -->
    <div class="mobile-nav-menu" id="mobileNavMenu">
        <div class="user-info" style="padding: 20px; border-bottom: 1px solid var(--border-color); margin-bottom: 20px;">
            <div class="user-avatar" id="mobileUserAvatar">ME</div>
            <div class="user-details">
                <div class="user-name" id="mobileUserName">Loading...</div>
                <div class="user-plan" id="mobileUserPlan">Free Plan</div>
            </div>
        </div>
        
        <!-- Quick Stats in Mobile Menu -->
        <div class="quick-stats" style="padding: 0; margin-bottom: 20px;">
            <div class="stat-card">
                <div class="stat-number" id="mobileToolsUsed">0</div>
                <div class="stat-label">Tools Used</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="mobileAiUses">0</div>
                <div class="stat-label">AI Uses</div>
            </div>
        </div>
        
        <!-- Navigation Items -->
        <div class="nav-tabs" style="padding: 0;">
            <div class="mobile-nav-item active" data-tab="dashboard">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </div>
            <div class="mobile-nav-item" data-tab="tools">
                <i class="fas fa-tools"></i>
                <span>AI Tools</span>
            </div>
            <div class="mobile-nav-item" data-tab="transactions">
                <i class="fas fa-exchange-alt"></i>
                <span>Transactions</span>
            </div>
            <div class="mobile-nav-item" data-tab="affiliate">
                <i class="fas fa-user-friends"></i>
                <span>Affiliate</span>
            </div>
            <div class="mobile-nav-item" data-tab="consultation">
                <i class="fas fa-calendar-check"></i>
                <span>Consultation</span>
            </div>
            <div class="mobile-nav-item" data-tab="marketplace">
                <i class="fas fa-store"></i>
                <span>Marketplace</span>
            </div>
            <div class="mobile-nav-item" data-tab="settings">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </div>
        </div>
        
        <!-- Category Filters in Mobile Menu -->
        <div class="category-filters" style="padding: 20px 0 0 0;">
            <div style="font-size: 14px; font-weight: 600; margin-bottom: 10px; color: var(--text-primary);">Categories</div>
            <div class="category-filters-container">
                <button class="category-filter-btn active" data-category="all">All</button>
                <button class="category-filter-btn" data-category="ai">AI</button>
                <button class="category-filter-btn" data-category="business">Business</button>
                <button class="category-filter-btn" data-category="productivity">Productivity</button>
            </div>
        </div>
    </div>
    
    <!-- Offline Overlay -->
    <div class="offline-overlay" id="offlineOverlay">
        <div class="offline-icon">
            <i class="fas fa-wifi-slash"></i>
        </div>
        <div class="offline-title">You're Offline</div>
        <div class="offline-message">Some tools require internet connection to work properly.</div>
        <div class="offline-submessage">
            <i class="fas fa-info-circle"></i> You can still use cached tools, view your credits, and access most features. Tool usage and purchases will sync when you're back online.
        </div>
        <button class="offline-dismiss-btn" id="dismissOfflineBtn">
            <i class="fas fa-eye"></i> View Cached Tools
        </button>
    </div>
    
    <!-- Offline Indicator -->
    <div class="offline-indicator" id="offlineIndicator">
        <i class="fas fa-wifi-slash"></i>
        <span>Offline</span>
    </div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div id="loadingText">Loading tools...</div>
    </div>
    
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>AI Tools Dashboard</h2>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">ME</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Loading...</div>
                        <div class="user-plan" id="userPlan">Free Plan</div>
                    </div>
                </div>
            </div>
            
            <!-- Credit Display -->
            <div class="credit-display">
                <div class="credit-label">Available Credits</div>
                <div class="credit-amount" id="creditAmount">100</div>
                <div class="credit-actions">
                    <button class="credit-btn" id="buyCreditsBtn">
                        <i class="fas fa-coins"></i> Buy Credits
                    </button>
                    <button class="credit-btn" id="upgradePlanBtn">
                        <i class="fas fa-crown"></i> Upgrade Plan
                    </button>
                </div>
            </div>
            
            <!-- Navigation Tabs -->
            <div class="nav-tabs">
                <div class="nav-tab active" data-tab="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </div>
                <div class="nav-tab" data-tab="tools">
                    <i class="fas fa-tools"></i>
                    <span>AI Tools</span>
                </div>
                <div class="nav-tab" data-tab="transactions">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Transactions</span>
                </div>
                <div class="nav-tab" data-tab="affiliate">
                    <i class="fas fa-user-friends"></i>
                    <span>Affiliate Program</span>
                </div>
                <div class="nav-tab" data-tab="consultation">
                    <i class="fas fa-calendar-check"></i>
                    <span>Consultation</span>
                </div>
                <div class="nav-tab" data-tab="marketplace">
                    <i class="fas fa-store"></i>
                    <span>Marketplace</span>
                </div>
                <div class="nav-tab" data-tab="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
            </div>
            
            <!-- Quick Stats -->
            <div class="quick-stats">
                <div class="stat-card">
                    <div class="stat-number" id="toolsUsed">0</div>
                    <div class="stat-label">Tools Used</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="aiUses">0</div>
                    <div class="stat-label">AI Uses</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="productivityScore">0</div>
                    <div class="stat-label">Productivity</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="monthlyRevenue">$0</div>
                    <div class="stat-label">Revenue</div>
                </div>
            </div>
            
            <!-- Category Filters -->
            <div class="category-filters">
                <div class="category-filters-container">
                    <button class="category-filter-btn active" data-category="all">All Tools</button>
                    <button class="category-filter-btn" data-category="ai">AI Tools</button>
                    <button class="category-filter-btn" data-category="business">Business</button>
                    <button class="category-filter-btn" data-category="productivity">Productivity</button>
                    <button class="category-filter-btn" data-category="premium">Premium</button>
                    <button class="category-filter-btn" data-category="marketplace">Marketplace</button>
                </div>
            </div>
        </div>
        
        <!-- Dashboard Content -->
        <div class="tools-content active" id="dashboardContent">
            <div class="content-header">
                <div class="content-title">Dashboard Overview</div>
                <div class="content-actions">
                    <button class="action-btn secondary" id="refreshDashboardBtn">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button class="action-btn" id="exportDataBtn">
                        <i class="fas fa-download"></i> Export Data
                    </button>
                </div>
            </div>
            
            <div class="scrollable-content">
                <!-- Revenue Chart -->
                <div class="chart-container">
                    <div class="chart-title">Monthly Revenue</div>
                    <canvas id="revenueChart" height="100"></canvas>
                </div>
                
                <!-- Credit Usage Chart -->
                <div class="chart-container">
                    <div class="chart-title">Credit Usage</div>
                    <canvas id="creditChart" height="100"></canvas>
                </div>
                
                <!-- Productivity Chart -->
                <div class="chart-container">
                    <div class="chart-title">Productivity Score</div>
                    <canvas id="productivityChart" height="100"></canvas>
                </div>
                
                <!-- Recent Transactions -->
                <div class="chart-container">
                    <div class="chart-title">Recent Transactions</div>
                    <div class="transactions-list" id="recentTransactions">
                        <div class="transaction-item">
                            <div class="transaction-icon" style="background-color: var(--warning-color);">
                                <i class="fas fa-coins"></i>
                            </div>
                            <div class="transaction-details">
                                <div class="transaction-title">Credit Purchase</div>
                                <div class="transaction-date">Today â€¢ 100 credits</div>
                            </div>
                            <div class="transaction-amount negative">-$9.99</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tools Content -->
        <div class="tools-content" id="toolsContent">
            <div class="content-header">
                <div class="content-title">AI Tools</div>
                <div class="content-actions">
                    <button class="action-btn secondary" id="filterFreeBtn">
                        <i class="fas fa-filter"></i> Free Tools
                    </button>
                    <button class="action-btn" id="searchToolsBtn">
                        <i class="fas fa-search"></i> Search
                    </button>
                </div>
            </div>
            
            <div class="scrollable-content">
                <div class="tools-grid" id="toolsGrid">
                    <!-- Tools will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Transactions Content -->
        <div class="tools-content" id="transactionsContent">
            <div class="content-header">
                <div class="content-title">Transaction History</div>
                <div class="content-actions">
                    <select class="form-input" id="transactionFilter" style="width: 150px; padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 6px;">
                        <option value="all">All Transactions</option>
                        <option value="credit">Credit Purchases</option>
                        <option value="usage">Tool Usage</option>
                    </select>
                </div>
            </div>
            
            <div class="scrollable-content">
                <div class="transactions-list" id="transactionsList">
                    <!-- Transactions will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Affiliate Content -->
        <div class="tools-content" id="affiliateContent">
            <div class="content-header">
                <div class="content-title">Affiliate Program</div>
                <div class="content-actions">
                    <button class="action-btn secondary" id="payoutRequestBtn">
                        <i class="fas fa-money-bill-wave"></i> Request Payout
                    </button>
                </div>
            </div>
            
            <div class="scrollable-content">
                <!-- Affiliate Card -->
                <div class="affiliate-card">
                    <h3 style="margin-bottom: 15px;">Earn 30% Commission</h3>
                    <p style="margin-bottom: 20px; opacity: 0.9;">
                        Share your referral link and earn 30% commission on every purchase made by your referrals.
                    </p>
                    
                    <div class="copy-container" style="display: flex; gap: 10px; margin-top: 15px;">
                        <input type="text" class="copy-input" id="referralLink" value="https://moodchat.com/ref/yourcode" readonly 
                               style="flex: 1; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; background: rgba(255,255,255,0.1); color: white;">
                        <button class="copy-btn" id="copyReferralBtn" style="padding: 10px 15px; background: white; color: var(--primary-color); border: none; border-radius: 6px; cursor: pointer;">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                </div>
                
                <!-- Affiliate Stats -->
                <div class="affiliate-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalEarnings">$0</div>
                        <div class="stat-label">Total Earnings</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="referralCount">0</div>
                        <div class="stat-label">Referrals</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingPayout">$0</div>
                        <div class="stat-label">Pending Payout</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Consultation Content -->
        <div class="tools-content" id="consultationContent">
            <div class="content-header">
                <div class="content-title">Book a Consultation</div>
                <div class="content-actions">
                    <button class="action-btn" id="bookConsultationBtn">
                        <i class="fas fa-calendar-plus"></i> Book Now
                    </button>
                </div>
            </div>
            
            <div class="scrollable-content">
                <div class="consultation-grid" id="consultationGrid">
                    <!-- Consultation cards will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Marketplace Content -->
        <div class="tools-content" id="marketplaceContent">
            <div class="content-header">
                <div class="content-title">Marketplace</div>
                <div class="content-actions">
                    <button class="action-btn secondary" id="viewCartBtn">
                        <i class="fas fa-shopping-cart"></i> View Cart (0)
                    </button>
                </div>
            </div>
            
            <div class="scrollable-content">
                <div class="marketplace-grid" id="marketplaceGrid">
                    <!-- Marketplace items will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Settings Content -->
        <div class="tools-content" id="settingsContent">
            <div class="content-header">
                <div class="content-title">Settings</div>
                <div class="content-actions">
                    <button class="action-btn secondary" id="saveSettingsBtn">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                </div>
            </div>
            
            <div class="scrollable-content">
                <!-- Plan Management -->
                <div class="chart-container">
                    <div class="chart-title">Plan Management</div>
                    <div class="plan-comparison" id="planComparison" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                        <!-- Plans will be loaded here -->
                    </div>
                </div>
                
                <!-- Notification Settings -->
                <div class="chart-container">
                    <div class="chart-title">Notification Settings</div>
                    <div style="padding: 15px 0;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-color);">
                            <span>Email Notifications</span>
                            <label class="switch" style="position: relative; display: inline-block; width: 50px; height: 24px;">
                                <input type="checkbox" id="emailNotifications" checked>
                                <span class="slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px;"></span>
                            </label>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-color);">
                            <span>Tool Updates</span>
                            <label class="switch" style="position: relative; display: inline-block; width: 50px; height: 24px;">
                                <input type="checkbox" id="toolUpdates" checked>
                                <span class="slider" style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px;"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tool Preview Modal -->
    <div class="tool-preview-modal" id="toolPreviewModal">
        <div class="tool-preview-container">
            <div class="tool-preview-header">
                <div class="tool-preview-title" id="toolPreviewTitle">Tool Preview</div>
                <button class="add-friend-btn" id="closePreviewModal" style="background: none; border: none; font-size: 20px; cursor: pointer; color: var(--text-primary);">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="tool-preview-content" id="toolPreviewContent">
                <!-- Tool preview will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Payment Modal -->
    <div class="payment-modal" id="paymentModal">
        <div class="payment-container">
            <div class="payment-header">
                <h3 style="margin-bottom: 10px;">Purchase Credits</h3>
                <p>Secure payment processed with bank-level encryption</p>
            </div>
            <div style="padding: 25px;">
                <div class="credit-packages" id="creditPackages" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                    <!-- Credit packages will be loaded here -->
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 30px;">
                    <button class="action-btn secondary" id="cancelPaymentBtn" style="flex: 1;">Cancel</button>
                    <button class="action-btn" id="confirmPaymentBtn" style="flex: 1;">
                        <i class="fas fa-lock"></i> Pay Now
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Tool Execution Modal -->
    <div class="tool-execution-modal" id="toolExecutionModal">
        <div class="tool-execution-container">
            <div class="tool-execution-header">
                <div class="tool-preview-title" id="executionToolTitle">Running Tool...</div>
                <button class="add-friend-btn" id="closeExecutionModal" style="background: none; border: none; font-size: 20px; cursor: pointer; color: var(--text-primary);">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="tool-execution-content">
                <iframe class="tool-iframe" id="toolIframe" sandbox="allow-scripts allow-same-origin allow-forms allow-popups"></iframe>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Operation completed successfully</span>
    </div>

    <script>
        // =============================================
        // COMPLETE TOOLS DASHBOARD SYSTEM - FIXED VERSION
        // =============================================

        // Global variables
        let currentUser = null;
        let userData = null;
        let userCredits = 100;
        let userPlan = 'free';
        let tools = [];
        let transactions = [];
        let selectedTool = null;
        let selectedCreditPackage = null;
        let currentCategoryFilter = 'all';
        let isOnline = navigator.onLine;
        let isMobile = window.innerWidth <= 768;
        let currentContent = 'dashboard';
        let charts = {};
        
        // Tool categories
        const toolCategories = {
            'ai': {
                name: 'AI Tools',
                icon: 'fas fa-robot',
                gradient: 'ai-gradient',
                color: '#fa709a'
            },
            'business': {
                name: 'Business',
                icon: 'fas fa-briefcase',
                gradient: 'business-gradient',
                color: '#4facfe'
            },
            'productivity': {
                name: 'Productivity',
                icon: 'fas fa-chart-line',
                gradient: 'productivity-gradient',
                color: '#43e97b'
            },
            'premium': {
                name: 'Premium',
                icon: 'fas fa-crown',
                gradient: 'premium-gradient',
                color: '#f093fb'
            },
            'marketplace': {
                name: 'Marketplace',
                icon: 'fas fa-store',
                gradient: 'marketplace-gradient',
                color: '#a8edea'
            }
        };
        
        // User plans with features
        const userPlans = {
            'free': {
                name: 'Free',
                price: 0,
                monthlyCredits: 100,
                features: [
                    'Basic AI Tools',
                    '5 Free Tools per month',
                    'Community Support',
                    'Basic Analytics'
                ],
                limitations: [
                    'No Premium Tools',
                    'Limited Credits',
                    'No Priority Support'
                ]
            },
            'basic': {
                name: 'Basic',
                price: 9.99,
                monthlyCredits: 500,
                features: [
                    'All Basic Tools',
                    '10 Premium Tools',
                    'Email Support',
                    'Advanced Analytics',
                    '100 Credits/month'
                ],
                limitations: [
                    'Limited Premium Tools',
                    'No Business Tools'
                ]
            },
            'pro': {
                name: 'Pro',
                price: 29.99,
                monthlyCredits: 2000,
                features: [
                    'All Tools Access',
                    'Unlimited Premium Tools',
                    'Priority Support',
                    'API Access',
                    'Custom Integrations',
                    '500 Credits/month'
                ],
                limitations: [
                    'No Dedicated Account Manager'
                ]
            }
        };
        
        // Credit packages
        const creditPackages = [
            { id: 'basic', credits: 100, price: 9.99, bonus: 0 },
            { id: 'standard', credits: 500, price: 39.99, bonus: 50 },
            { id: 'premium', credits: 1000, price: 69.99, bonus: 200 }
        ];
        
        // Consultation services
        const consultationServices = [
            {
                id: 'strategy',
                name: 'Business Strategy',
                description: 'Get expert advice on implementing AI in your business',
                duration: '60 min',
                price: 299,
                features: [
                    'Business Analysis',
                    'AI Integration Plan',
                    'ROI Projection'
                ]
            },
            {
                id: 'implementation',
                name: 'AI Implementation',
                description: 'Hands-on help implementing AI solutions',
                duration: '90 min',
                price: 499,
                features: [
                    'Technical Setup',
                    'Custom Configuration',
                    'Team Training'
                ]
            }
        ];
        
        // Marketplace items
        const marketplaceItems = [
            {
                id: 'template1',
                name: 'AI Marketing Template',
                description: 'Complete marketing automation template',
                category: 'templates',
                price: 49.99,
                icon: 'fas fa-file-alt'
            },
            {
                id: 'integration1',
                name: 'Shopify Integration',
                description: 'Connect your store with AI tools',
                category: 'integration',
                price: 79.99,
                icon: 'fas fa-plug'
            }
        ];
        
        // Sample tools data
        const sampleTools = [
            {
                id: 'ai_chat',
                name: 'AI Chat Assistant',
                description: 'Advanced conversational AI for customer support',
                category: 'ai',
                cost: 10,
                plan: 'free',
                usage: 0,
                locked: false,
                icon: 'fas fa-comments',
                features: ['24/7 Support', 'Multi-language', 'Custom Training'],
                requirements: 'Internet connection',
                instructions: 'Type your questions and the AI will respond'
            },
            {
                id: 'content_writer',
                name: 'Content Writer Pro',
                description: 'AI-powered content creation for blogs and social media',
                category: 'ai',
                cost: 15,
                plan: 'basic',
                usage: 0,
                locked: false,
                icon: 'fas fa-pen-fancy',
                features: ['SEO Optimized', 'Multiple Formats', 'Plagiarism Check'],
                requirements: 'Topic and keywords',
                instructions: 'Provide topic and keywords for content generation'
            },
            {
                id: 'analytics_dash',
                name: 'Analytics Dashboard',
                description: 'Real-time business analytics and insights',
                category: 'business',
                cost: 25,
                plan: 'pro',
                usage: 0,
                locked: true,
                icon: 'fas fa-chart-bar',
                features: ['Real-time Data', 'Custom Reports', 'Predictive Analytics'],
                requirements: 'Data source connection',
                instructions: 'Connect your data sources and customize dashboard'
            },
            {
                id: 'automation',
                name: 'Workflow Automation',
                description: 'Automate repetitive tasks and processes',
                category: 'productivity',
                cost: 20,
                plan: 'basic',
                usage: 0,
                locked: false,
                icon: 'fas fa-robot',
                features: ['Drag & Drop', 'Multiple Triggers', 'API Integration'],
                requirements: 'Process definition',
                instructions: 'Define triggers and actions for automation'
            },
            {
                id: 'marketplace_tool',
                name: 'Marketplace Tool',
                description: 'Access exclusive marketplace tools',
                category: 'marketplace',
                cost: 0,
                plan: 'free',
                usage: 0,
                locked: false,
                icon: 'fas fa-store',
                features: ['Exclusive Tools', 'Community Rated', 'Regular Updates'],
                requirements: 'Marketplace access',
                instructions: 'Browse and use community tools'
            }
        ];
        
        // Sample transactions
        const sampleTransactions = [
            {
                id: 'tx1',
                type: 'credit_purchase',
                title: 'Credit Purchase',
                amount: -9.99,
                date: new Date(Date.now() - 86400000),
                status: 'completed',
                details: '100 credits'
            },
            {
                id: 'tx2',
                type: 'tool_usage',
                title: 'AI Chat Usage',
                amount: -10,
                date: new Date(Date.now() - 172800000),
                status: 'completed',
                details: 'AI Chat Assistant'
            }
        ];
        
        // DOM Elements
        const mobileHeader = document.getElementById('mobileHeader');
        const mobileHeaderTitle = document.getElementById('mobileHeaderTitle');
        const backBtn = document.getElementById('backBtn');
        const menuToggleBtn = document.getElementById('menuToggleBtn');
        const mobileNavMenu = document.getElementById('mobileNavMenu');
        const offlineOverlay = document.getElementById('offlineOverlay');
        const offlineIndicator = document.getElementById('offlineIndicator');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const notification = document.getElementById('notification');
        const toolPreviewModal = document.getElementById('toolPreviewModal');
        const paymentModal = document.getElementById('paymentModal');
        const toolExecutionModal = document.getElementById('toolExecutionModal');
        
        // Content areas
        const contentAreas = {
            dashboard: document.getElementById('dashboardContent'),
            tools: document.getElementById('toolsContent'),
            transactions: document.getElementById('transactionsContent'),
            affiliate: document.getElementById('affiliateContent'),
            consultation: document.getElementById('consultationContent'),
            marketplace: document.getElementById('marketplaceContent'),
            settings: document.getElementById('settingsContent')
        };
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Tools Dashboard Initializing...');
            
            // Initialize
            initializeToolsDashboard();
            
            // Setup event listeners
            setupEventListeners();
            
            // Setup navigation
            setupNavigation();
            
            // Check mobile status
            checkMobileStatus();
            
            // Load initial data
            loadInitialData();
            
            console.log('Tools Dashboard Initialized');
        });
        
        function checkMobileStatus() {
            isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                document.body.classList.add('mobile');
                mobileHeader.classList.add('active');
                // Hide sidebar on mobile
                document.getElementById('sidebar').style.display = 'none';
            } else {
                document.body.classList.remove('mobile');
                mobileHeader.classList.remove('active');
                // Show sidebar on desktop
                document.getElementById('sidebar').style.display = 'flex';
                mobileNavMenu.classList.remove('active');
                backBtn.classList.remove('active');
            }
            
            // Update back button visibility
            updateBackButton();
        }
        
        function initializeToolsDashboard() {
            console.log('Initializing Tools Dashboard...');
            
            // Initialize user data
            initializeUserData();
            
            // Initialize offline detection
            initializeOfflineDetection();
            
            console.log('Tools Dashboard Initialized');
        }
        
        function initializeUserData() {
            // Set default user data
            userData = {
                displayName: 'Demo User',
                photoURL: null
            };
            
            // Update user display
            updateUserDisplay();
            updateMobileUserDisplay();
        }
        
        function updateUserDisplay() {
            const userName = document.getElementById('userName');
            const userAvatar = document.getElementById('userAvatar');
            
            if (userName) {
                userName.textContent = userData.displayName || 'User';
            }
            
            if (userAvatar) {
                if (userData.photoURL) {
                    userAvatar.style.backgroundImage = `url('${userData.photoURL}')`;
                    userAvatar.innerHTML = '';
                } else {
                    const initials = (userData.displayName || 'U')
                        .split(' ')
                        .map(word => word[0])
                        .join('')
                        .toUpperCase()
                        .substring(0, 2);
                    userAvatar.innerHTML = initials;
                }
            }
        }
        
        function updateMobileUserDisplay() {
            const mobileUserName = document.getElementById('mobileUserName');
            const mobileUserAvatar = document.getElementById('mobileUserAvatar');
            
            if (mobileUserName) {
                mobileUserName.textContent = userData.displayName || 'User';
            }
            
            if (mobileUserAvatar) {
                if (userData.photoURL) {
                    mobileUserAvatar.style.backgroundImage = `url('${userData.photoURL}')`;
                    mobileUserAvatar.innerHTML = '';
                } else {
                    const initials = (userData.displayName || 'U')
                        .split(' ')
                        .map(word => word[0])
                        .join('')
                        .toUpperCase()
                        .substring(0, 2);
                    mobileUserAvatar.innerHTML = initials;
                }
            }
            
            // Update plan display
            const mobileUserPlan = document.getElementById('mobileUserPlan');
            if (mobileUserPlan) {
                mobileUserPlan.textContent = userPlans[userPlan]?.name + ' Plan';
            }
            
            const userPlanElement = document.getElementById('userPlan');
            if (userPlanElement) {
                userPlanElement.textContent = userPlans[userPlan]?.name + ' Plan';
            }
        }
        
        function initializeOfflineDetection() {
            updateOnlineStatus();
            
            window.addEventListener('online', handleOnline);
            window.addEventListener('offline', handleOffline);
            
            updateUIForConnectivity();
        }
        
        function updateOnlineStatus() {
            isOnline = navigator.onLine;
            console.log('Network status:', isOnline ? 'Online' : 'Offline');
        }
        
        function handleOnline() {
            console.log('App is now online');
            isOnline = true;
            updateUIForConnectivity();
            
            // Hide offline indicators
            offlineIndicator.classList.remove('active');
            offlineOverlay.classList.remove('active');
            
            showNotification('Back online!', 'success');
        }
        
        function handleOffline() {
            console.log('App is now offline');
            isOnline = false;
            
            offlineIndicator.classList.add('active');
            
            // Show offline overlay if not already dismissed
            const overlayDismissed = localStorage.getItem('offline_overlay_dismissed');
            if (overlayDismissed !== 'true') {
                offlineOverlay.classList.add('active');
            }
            
            showNotification('You are offline. Some features may not work.', 'warning');
        }
        
        function updateUIForConnectivity() {
            if (!isOnline) {
                updateUIForOfflineMode();
            } else {
                updateUIForOnlineMode();
            }
        }
        
        function updateUIForOfflineMode() {
            offlineIndicator.classList.add('active');
            updateButtonStatesForOffline();
        }
        
        function updateUIForOnlineMode() {
            offlineIndicator.classList.remove('active');
            offlineOverlay.classList.remove('active');
            updateButtonStatesForOnline();
        }
        
        function updateButtonStatesForOffline() {
            const onlineOnlyButtons = ['buyCreditsBtn', 'upgradePlanBtn', 'payoutRequestBtn', 'bookConsultationBtn'];
            
            onlineOnlyButtons.forEach(buttonId => {
                const button = document.getElementById(buttonId);
                if (button) {
                    button.disabled = true;
                    button.style.opacity = '0.7';
                }
            });
        }
        
        function updateButtonStatesForOnline() {
            const onlineOnlyButtons = ['buyCreditsBtn', 'upgradePlanBtn', 'payoutRequestBtn', 'bookConsultationBtn'];
            
            onlineOnlyButtons.forEach(buttonId => {
                const button = document.getElementById(buttonId);
                if (button) {
                    button.disabled = false;
                    button.style.opacity = '1';
                }
            });
        }
        
        function dismissOfflineOverlay() {
            offlineOverlay.classList.remove('active');
            localStorage.setItem('offline_overlay_dismissed', 'true');
            showNotification('Showing cached tools data', 'info');
        }
        
        function setupNavigation() {
            console.log('Setting up navigation...');
            
            // Desktop navigation
            const desktopNavTabs = document.querySelectorAll('.sidebar .nav-tab');
            desktopNavTabs.forEach(tab => {
                tab.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const tabName = this.dataset.tab;
                    console.log('Desktop nav clicked:', tabName);
                    navigateToContent(tabName);
                });
            });
            
            // Mobile navigation
            const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
            mobileNavItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const tabName = this.dataset.tab;
                    console.log('Mobile nav clicked:', tabName);
                    navigateToContent(tabName);
                    // Close mobile menu after selection
                    mobileNavMenu.classList.remove('active');
                });
            });
            
            // Menu toggle button
            if (menuToggleBtn) {
                menuToggleBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    toggleMobileMenu();
                });
            }
            
            // Back button
            if (backBtn) {
                backBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    goBack();
                });
            }
            
            // Handle window resize
            window.addEventListener('resize', handleResize);
            
            console.log('Navigation setup complete');
        }
        
        function navigateToContent(contentName) {
            console.log('Navigating to:', contentName);
            
            // Update current content
            currentContent = contentName;
            
            // Update active states
            // Desktop
            document.querySelectorAll('.sidebar .nav-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.tab === contentName) {
                    tab.classList.add('active');
                }
            });
            
            // Mobile
            document.querySelectorAll('.mobile-nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.tab === contentName) {
                    item.classList.add('active');
                }
            });
            
            // Hide all content areas with animation
            Object.values(contentAreas).forEach(area => {
                if (area) {
                    area.classList.remove('active');
                }
            });
            
            // Show selected content area with animation
            setTimeout(() => {
                if (contentAreas[contentName]) {
                    contentAreas[contentName].classList.add('active');
                    
                    // Update mobile header title
                    const titleMap = {
                        'dashboard': 'Dashboard',
                        'tools': 'AI Tools',
                        'transactions': 'Transactions',
                        'affiliate': 'Affiliate Program',
                        'consultation': 'Consultation',
                        'marketplace': 'Marketplace',
                        'settings': 'Settings'
                    };
                    
                    if (mobileHeaderTitle) {
                        mobileHeaderTitle.textContent = titleMap[contentName] || contentName;
                    }
                    
                    // Load content
                    loadContent(contentName);
                }
            }, 50);
            
            // Update back button visibility
            updateBackButton();
            
            // Close mobile menu if open
            if (isMobile) {
                mobileNavMenu.classList.remove('active');
            }
        }
        
        function updateBackButton() {
            if (isMobile && currentContent !== 'dashboard') {
                backBtn.classList.add('active');
            } else {
                backBtn.classList.remove('active');
            }
        }
        
        function goBack() {
            if (currentContent !== 'dashboard') {
                navigateToContent('dashboard');
            }
        }
        
        function toggleMobileMenu() {
            mobileNavMenu.classList.toggle('active');
        }
        
        function handleResize() {
            checkMobileStatus();
            
            // Close mobile menu when switching to desktop
            if (!isMobile) {
                mobileNavMenu.classList.remove('active');
            }
        }
        
        function loadInitialData() {
            // Load tools
            tools = [...sampleTools];
            
            // Load transactions
            transactions = [...sampleTransactions];
            
            // Load content
            loadContent('dashboard');
        }
        
        function loadContent(contentName) {
            console.log('Loading content:', contentName);
            
            switch (contentName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'tools':
                    loadTools();
                    break;
                case 'transactions':
                    loadTransactions();
                    break;
                case 'affiliate':
                    loadAffiliate();
                    break;
                case 'consultation':
                    loadConsultation();
                    break;
                case 'marketplace':
                    loadMarketplace();
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }
        
        function loadDashboard() {
            updateDashboardStats();
            updateRecentTransactions();
            
            // Update mobile stats
            updateMobileStats();
            
            // Initialize charts if not already done
            initializeCharts();
        }
        
        function updateDashboardStats() {
            const toolsUsed = tools.reduce((sum, tool) => sum + (tool.usage || 0), 0);
            const aiUses = tools.filter(t => t.category === 'ai').reduce((sum, tool) => sum + (tool.usage || 0), 0);
            const productivityScore = Math.min(toolsUsed * 10, 100);
            const monthlyRevenue = 0;
            
            const toolsUsedElement = document.getElementById('toolsUsed');
            const aiUsesElement = document.getElementById('aiUses');
            const productivityScoreElement = document.getElementById('productivityScore');
            const monthlyRevenueElement = document.getElementById('monthlyRevenue');
            
            if (toolsUsedElement) toolsUsedElement.textContent = toolsUsed;
            if (aiUsesElement) aiUsesElement.textContent = aiUses;
            if (productivityScoreElement) productivityScoreElement.textContent = productivityScore;
            if (monthlyRevenueElement) monthlyRevenueElement.textContent = `$${monthlyRevenue}`;
        }
        
        function updateMobileStats() {
            const toolsUsed = tools.reduce((sum, tool) => sum + (tool.usage || 0), 0);
            const aiUses = tools.filter(t => t.category === 'ai').reduce((sum, tool) => sum + (tool.usage || 0), 0);
            
            const mobileToolsUsed = document.getElementById('mobileToolsUsed');
            const mobileAiUses = document.getElementById('mobileAiUses');
            
            if (mobileToolsUsed) mobileToolsUsed.textContent = toolsUsed;
            if (mobileAiUses) mobileAiUses.textContent = aiUses;
        }
        
        function updateRecentTransactions() {
            const container = document.getElementById('recentTransactions');
            if (!container) return;
            
            // Clear existing content
            const existingItems = container.querySelectorAll('.transaction-item:not(:first-child)');
            existingItems.forEach(item => item.remove());
            
            // Add recent transactions
            const recent = transactions.slice(0, 3);
            
            recent.forEach(transaction => {
                const item = document.createElement('div');
                item.className = 'transaction-item';
                
                let icon = 'fas fa-exchange-alt';
                let iconColor = 'var(--primary-color)';
                
                switch (transaction.type) {
                    case 'credit_purchase':
                        icon = 'fas fa-coins';
                        iconColor = 'var(--warning-color)';
                        break;
                    case 'tool_usage':
                        icon = 'fas fa-tools';
                        iconColor = 'var(--info-color)';
                        break;
                }
                
                const amountClass = transaction.amount >= 0 ? 'positive' : 'negative';
                const amountDisplay = transaction.amount >= 0 ? `+$${Math.abs(transaction.amount)}` : `-$${Math.abs(transaction.amount)}`;
                const dateDisplay = formatDate(transaction.date);
                
                item.innerHTML = `
                    <div class="transaction-icon" style="background-color: ${iconColor}">
                        <i class="${icon}"></i>
                    </div>
                    <div class="transaction-details">
                        <div class="transaction-title">${transaction.title}</div>
                        <div class="transaction-date">${dateDisplay} â€¢ ${transaction.details || ''}</div>
                    </div>
                    <div class="transaction-amount ${amountClass}">${amountDisplay}</div>
                `;
                
                container.appendChild(item);
            });
        }
        
        function initializeCharts() {
            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart');
            if (revenueCtx && !charts.revenue) {
                charts.revenue = new Chart(revenueCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Revenue',
                            data: [150, 230, 180, 290, 310, 400],
                            borderColor: 'var(--primary-color)',
                            backgroundColor: 'rgba(0, 132, 255, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { color: 'rgba(0, 0, 0, 0.05)' } },
                            x: { grid: { display: false } }
                        }
                    }
                });
            }
            
            // Credit Usage Chart
            const creditCtx = document.getElementById('creditChart');
            if (creditCtx && !charts.credit) {
                charts.credit = new Chart(creditCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                        datasets: [{
                            label: 'Credits Used',
                            data: [45, 78, 52, 89],
                            backgroundColor: 'var(--primary-color)',
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { color: 'rgba(0, 0, 0, 0.05)' } },
                            x: { grid: { display: false } }
                        }
                    }
                });
            }
            
            // Productivity Chart
            const productivityCtx = document.getElementById('productivityChart');
            if (productivityCtx && !charts.productivity) {
                charts.productivity = new Chart(productivityCtx.getContext('2d'), {
                    type: 'radar',
                    data: {
                        labels: ['AI Usage', 'Tool Variety', 'Consistency', 'Efficiency', 'Learning'],
                        datasets: [{
                            label: 'Productivity',
                            data: [85, 70, 90, 65, 80],
                            backgroundColor: 'rgba(52, 199, 89, 0.2)',
                            borderColor: 'var(--success-color)',
                            borderWidth: 2,
                            pointBackgroundColor: 'var(--success-color)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: { beginAtZero: true, max: 100, grid: { color: 'rgba(0, 0, 0, 0.1)' } }
                        }
                    }
                });
            }
        }
        
        function loadTools() {
            const toolsGrid = document.getElementById('toolsGrid');
            if (!toolsGrid) return;
            
            toolsGrid.innerHTML = '';
            
            // Filter tools based on category
            let filteredTools = tools;
            if (currentCategoryFilter !== 'all') {
                filteredTools = tools.filter(tool => tool.category === currentCategoryFilter);
            }
            
            if (filteredTools.length === 0) {
                toolsGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1; padding: 40px 20px;">
                        <i class="fas fa-tools"></i>
                        <p>No tools found in this category</p>
                    </div>
                `;
                return;
            }
            
            filteredTools.forEach(tool => {
                const toolCard = document.createElement('div');
                toolCard.className = `tool-card ${tool.locked ? 'locked' : ''}`;
                toolCard.dataset.toolId = tool.id;
                
                const isLocked = tool.locked || !checkToolAccess(tool);
                const costDisplay = tool.cost === 0 ? 'Free' : `${tool.cost} credits`;
                const costClass = tool.cost === 0 ? 'free' : '';
                
                toolCard.innerHTML = `
                    <div class="tool-icon ${tool.category}">
                        <i class="${tool.icon || 'fas fa-tools'}"></i>
                    </div>
                    <div class="tool-name">${tool.name}</div>
                    <div class="tool-description">${tool.description}</div>
                    <div class="tool-meta">
                        <div class="tool-cost ${costClass}">${costDisplay}</div>
                        <div class="tool-usage">
                            <i class="fas fa-chart-bar"></i>
                            ${tool.usage || 0} uses
                        </div>
                    </div>
                    
                    ${isLocked ? `
                    <div class="locked-overlay">
                        <div class="locked-text">${getLockedMessage(tool)}</div>
                        ${tool.locked ? '' : `<button class="upgrade-btn" data-action="upgrade">Upgrade Plan</button>`}
                    </div>
                    ` : ''}
                `;
                
                if (!isLocked) {
                    toolCard.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        showToolPreview(tool);
                    });
                } else {
                    toolCard.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        if (e.target.closest('.upgrade-btn')) {
                            showUpgradeModal();
                        }
                    });
                }
                
                toolsGrid.appendChild(toolCard);
            });
        }
        
        function checkToolAccess(tool) {
            if (tool.plan === 'free') return true;
            
            const planHierarchy = ['free', 'basic', 'pro'];
            const userPlanIndex = planHierarchy.indexOf(userPlan);
            const toolPlanIndex = planHierarchy.indexOf(tool.plan);
            
            return userPlanIndex >= toolPlanIndex;
        }
        
        function getLockedMessage(tool) {
            if (tool.locked) {
                return 'Coming Soon';
            }
            
            switch (tool.plan) {
                case 'basic': return 'Upgrade to Basic Plan';
                case 'pro': return 'Upgrade to Pro Plan';
                default: return 'Not Available';
            }
        }
        
        function showToolPreview(tool) {
            selectedTool = tool;
            
            const toolPreviewTitle = document.getElementById('toolPreviewTitle');
            const previewContent = document.getElementById('toolPreviewContent');
            
            if (toolPreviewTitle) {
                toolPreviewTitle.textContent = tool.name;
            }
            
            if (previewContent) {
                previewContent.innerHTML = `
                    <div style="margin-bottom: 30px;">
                        <div class="tool-icon ${tool.category}" style="width: 70px; height: 70px; font-size: 28px;">
                            <i class="${tool.icon || 'fas fa-tools'}"></i>
                        </div>
                        <h3 style="margin: 15px 0 10px 0;">${tool.name}</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 20px;">${tool.description}</p>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500;">Features</label>
                        <div style="padding: 15px; background-color: var(--secondary-color); border-radius: 8px;">
                            ${(tool.features || []).map(feature => `
                                <div style="display: flex; align-items: center; gap: 10px; padding: 8px 0;">
                                    <i class="fas fa-check" style="color: var(--success-color);"></i>
                                    <span>${feature}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <div style="flex: 1;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">Cost</label>
                            <div style="font-size: 24px; font-weight: 600; color: ${tool.cost === 0 ? 'var(--success-color)' : 'var(--primary-color)'}">
                                ${tool.cost === 0 ? 'FREE' : `${tool.cost} credits`}
                            </div>
                        </div>
                        <div style="flex: 1;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">Usage</label>
                            <div style="font-size: 18px; font-weight: 600;">
                                ${tool.usage || 0} times
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 30px;">
                        <button class="action-btn secondary" id="cancelToolPreview" style="flex: 1;">
                            Cancel
                        </button>
                        <button class="action-btn" id="useToolBtn" style="flex: 1;" ${userCredits < tool.cost ? 'disabled' : ''}>
                            <i class="fas fa-play"></i> Use Tool (${tool.cost} credits)
                        </button>
                    </div>
                `;
            }
            
            toolPreviewModal.classList.add('active');
            
            // Add event listeners
            setTimeout(() => {
                const cancelBtn = document.getElementById('cancelToolPreview');
                const useBtn = document.getElementById('useToolBtn');
                const closeBtn = document.getElementById('closePreviewModal');
                
                if (cancelBtn) {
                    cancelBtn.addEventListener('click', () => {
                        toolPreviewModal.classList.remove('active');
                    });
                }
                
                if (useBtn) {
                    useBtn.addEventListener('click', () => {
                        useTool(tool);
                    });
                }
                
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => {
                        toolPreviewModal.classList.remove('active');
                    });
                }
            }, 10);
        }
        
        function useTool(tool) {
            if (userCredits < tool.cost) {
                showNotification('Insufficient credits', 'error');
                return;
            }
            
            // Deduct credits
            userCredits -= tool.cost;
            document.getElementById('creditAmount').textContent = userCredits;
            document.getElementById('mobileCreditAmount').textContent = userCredits;
            
            // Update tool usage
            tool.usage = (tool.usage || 0) + 1;
            
            // Record transaction
            const transaction = {
                id: 'tx_' + Date.now(),
                type: 'tool_usage',
                title: tool.name + ' Usage',
                amount: -tool.cost,
                date: new Date(),
                status: 'completed',
                details: `Used ${tool.cost} credits`
            };
            
            transactions.unshift(transaction);
            
            // Update UI
            updateDashboardStats();
            updateMobileStats();
            
            // Show success message
            showNotification(`${tool.name} executed successfully!`, 'success');
            
            // Close preview modal
            toolPreviewModal.classList.remove('active');
            
            // Execute tool
            executeTool(tool);
        }
        
        function executeTool(tool) {
            const executionToolTitle = document.getElementById('executionToolTitle');
            if (executionToolTitle) {
                executionToolTitle.textContent = `Running: ${tool.name}`;
            }
            
            // Show loading state
            toolExecutionModal.classList.add('active');
            loadingOverlay.classList.add('active');
            const loadingText = document.getElementById('loadingText');
            if (loadingText) {
                loadingText.textContent = `Loading ${tool.name}...`;
            }
            
            // Simulate loading
            setTimeout(() => {
                loadingOverlay.classList.remove('active');
                
                // Create a simple tool interface for demo
                const iframe = document.getElementById('toolIframe');
                if (iframe) {
                    const toolHtml = `
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <style>
                                body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background: #f5f5f5; }
                                .tool-container { max-width: 800px; margin: 0 auto; background: white; border-radius: 10px; padding: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                                .tool-header { text-align: center; margin-bottom: 30px; }
                                .tool-result { background: #f0f2f5; padding: 20px; border-radius: 10px; margin-top: 20px; }
                                .success-icon { color: #34c759; font-size: 48px; margin-bottom: 20px; }
                            </style>
                        </head>
                        <body>
                            <div class="tool-container">
                                <div class="tool-header">
                                    <h2>${tool.name}</h2>
                                    <p>${tool.description}</p>
                                </div>
                                <div style="text-align: center; padding: 40px;">
                                    <div class="success-icon">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                    <h3>Tool Executed Successfully!</h3>
                                    <p>You've used ${tool.cost} credits for this tool.</p>
                                    <div class="tool-result">
                                        <h4>Sample Output:</h4>
                                        <p>This is where the tool's output would be displayed. In a real tool, you would see results, data analysis, or generated content here.</p>
                                    </div>
                                </div>
                            </div>
                        </body>
                        </html>
                    `;
                    
                    iframe.srcdoc = toolHtml;
                }
            }, 1500);
        }
        
        function showUpgradeModal() {
            navigateToContent('settings');
        }
        
        function loadTransactions() {
            updateTransactionsDisplay();
            
            // Setup filter
            const filter = document.getElementById('transactionFilter');
            if (filter) {
                filter.addEventListener('change', function() {
                    updateTransactionsDisplay(this.value);
                });
            }
        }
        
        function updateTransactionsDisplay(filter = 'all') {
            const container = document.getElementById('transactionsList');
            if (!container) return;
            
            container.innerHTML = '';
            
            let filteredTransactions = transactions;
            if (filter !== 'all') {
                filteredTransactions = transactions.filter(t => t.type === filter);
            }
            
            if (filteredTransactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="padding: 40px 20px;">
                        <i class="fas fa-exchange-alt"></i>
                        <p>No transactions</p>
                        <p class="subtext">${filter === 'all' ? 'Your transactions will appear here' : `No ${filter} transactions`}</p>
                    </div>
                `;
                return;
            }
            
            filteredTransactions.forEach(transaction => {
                const item = document.createElement('div');
                item.className = 'transaction-item';
                
                let icon = 'fas fa-exchange-alt';
                let iconColor = 'var(--primary-color)';
                
                switch (transaction.type) {
                    case 'credit_purchase':
                        icon = 'fas fa-coins';
                        iconColor = 'var(--warning-color)';
                        break;
                    case 'tool_usage':
                        icon = 'fas fa-tools';
                        iconColor = 'var(--info-color)';
                        break;
                }
                
                const amountClass = transaction.amount >= 0 ? 'positive' : 'negative';
                const amountDisplay = transaction.amount >= 0 ? `+$${Math.abs(transaction.amount)}` : `-$${Math.abs(transaction.amount)}`;
                const dateDisplay = formatDate(transaction.date);
                
                item.innerHTML = `
                    <div class="transaction-icon" style="background-color: ${iconColor}">
                        <i class="${icon}"></i>
                    </div>
                    <div class="transaction-details">
                        <div class="transaction-title">${transaction.title}</div>
                        <div class="transaction-date">${dateDisplay} â€¢ ${transaction.status || 'completed'}</div>
                        ${transaction.details ? `<div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">${transaction.details}</div>` : ''}
                    </div>
                    <div class="transaction-amount ${amountClass}">${amountDisplay}</div>
                `;
                
                container.appendChild(item);
            });
        }
        
        function loadAffiliate() {
            updateAffiliateDisplay();
            
            // Setup copy referral link
            const copyBtn = document.getElementById('copyReferralBtn');
            if (copyBtn) {
                copyBtn.addEventListener('click', copyReferralLink);
            }
            
            // Setup payout request
            const payoutBtn = document.getElementById('payoutRequestBtn');
            if (payoutBtn) {
                payoutBtn.addEventListener('click', requestPayout);
            }
        }
        
        function updateAffiliateDisplay() {
            const totalEarnings = document.getElementById('totalEarnings');
            const referralCount = document.getElementById('referralCount');
            const pendingPayout = document.getElementById('pendingPayout');
            
            if (totalEarnings) totalEarnings.textContent = '$0';
            if (referralCount) referralCount.textContent = '0';
            if (pendingPayout) pendingPayout.textContent = '$0';
            
            // Generate referral link
            const referralLink = document.getElementById('referralLink');
            if (referralLink && currentUser) {
                referralLink.value = `https://moodchat.com/ref/demo123`;
            }
        }
        
        function copyReferralLink() {
            const referralLink = document.getElementById('referralLink');
            if (!referralLink) return;
            
            navigator.clipboard.writeText(referralLink.value)
                .then(() => {
                    showNotification('Referral link copied to clipboard!', 'success');
                })
                .catch(err => {
                    console.error('Failed to copy:', err);
                    // Fallback for browsers that don't support clipboard API
                    referralLink.select();
                    document.execCommand('copy');
                    showNotification('Referral link copied!', 'success');
                });
        }
        
        function requestPayout() {
            if (!isOnline) {
                showNotification('Cannot request payout while offline', 'error');
                return;
            }
            
            showNotification('Payout request submitted', 'success');
        }
        
        function loadConsultation() {
            const container = document.getElementById('consultationGrid');
            if (!container) return;
            
            container.innerHTML = '';
            
            consultationServices.forEach(service => {
                const card = document.createElement('div');
                card.className = 'consultation-card';
                
                card.innerHTML = `
                    <h3 style="margin-bottom: 10px;">${service.name}</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">${service.description}</p>
                    <div style="margin-bottom: 20px;">
                        ${service.features.map(feature => `
                            <div style="display: flex; align-items: center; gap: 8px; padding: 6px 0;">
                                <i class="fas fa-check" style="color: var(--success-color);"></i>
                                <span>${feature}</span>
                            </div>
                        `).join('')}
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
                        <div>
                            <div style="font-size: 24px; font-weight: 600; color: var(--primary-color);">$${service.price}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">${service.duration} session</div>
                        </div>
                        <button class="action-btn book-consultation-btn" data-service-id="${service.id}">
                            <i class="fas fa-calendar-plus"></i> Book Now
                        </button>
                    </div>
                `;
                
                const bookBtn = card.querySelector('.book-consultation-btn');
                if (bookBtn) {
                    bookBtn.addEventListener('click', () => {
                        bookConsultation(service);
                    });
                }
                
                container.appendChild(card);
            });
        }
        
        function bookConsultation(service) {
            if (!isOnline) {
                showNotification('Cannot book consultations while offline', 'error');
                return;
            }
            
            showNotification(`Booking ${service.name} for $${service.price}...`, 'info');
            
            setTimeout(() => {
                showNotification(`${service.name} booked successfully! We'll contact you shortly.`, 'success');
            }, 2000);
        }
        
        function loadMarketplace() {
            const container = document.getElementById('marketplaceGrid');
            if (!container) return;
            
            container.innerHTML = '';
            
            marketplaceItems.forEach(item => {
                const card = document.createElement('div');
                card.className = 'marketplace-item';
                
                card.innerHTML = `
                    <div style="text-align: center; margin-bottom: 15px;">
                        <i class="${item.icon}" style="font-size: 36px; color: var(--primary-color);"></i>
                    </div>
                    <h4 style="margin-bottom: 10px;">${item.name}</h4>
                    <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 15px;">${item.description}</p>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="font-size: 20px; font-weight: 600; color: var(--primary-color);">$${item.price}</div>
                        <button class="action-btn secondary buy-marketplace-btn" data-item-id="${item.id}">
                            <i class="fas fa-cart-plus"></i> Add to Cart
                        </button>
                    </div>
                `;
                
                const buyBtn = card.querySelector('.buy-marketplace-btn');
                if (buyBtn) {
                    buyBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        buyMarketplaceItem(item);
                    });
                }
                
                card.addEventListener('click', () => {
                    showNotification(`${item.name}: $${item.price}`, 'info');
                });
                
                container.appendChild(card);
            });
        }
        
        function buyMarketplaceItem(item) {
            if (!isOnline) {
                showNotification('Cannot purchase marketplace items while offline', 'error');
                return;
            }
            
            showNotification(`Added ${item.name} to cart`, 'success');
            
            // Update cart count
            const cartBtn = document.getElementById('viewCartBtn');
            if (cartBtn) {
                const currentCount = parseInt(cartBtn.textContent.match(/\((\d+)\)/)?.[1] || 0);
                cartBtn.textContent = cartBtn.textContent.replace(/\(\d+\)/, `(${currentCount + 1})`);
            }
        }
        
        function loadSettings() {
            loadPlanComparison();
            loadSettingsFromStorage();
        }
        
        function loadPlanComparison() {
            const container = document.getElementById('planComparison');
            if (!container) return;
            
            container.innerHTML = '';
            
            Object.entries(userPlans).forEach(([planId, plan]) => {
                const isCurrentPlan = planId === userPlan;
                
                const card = document.createElement('div');
                card.className = `plan-card ${isCurrentPlan ? 'current-plan' : ''}`;
                card.style.backgroundColor = 'var(--bg-color)';
                card.style.borderRadius = '12px';
                card.style.padding = '20px';
                card.style.border = `2px solid ${isCurrentPlan ? 'var(--primary-color)' : 'var(--border-color)'}`;
                card.style.transition = 'all 0.3s';
                
                card.innerHTML = `
                    <div style="font-size: 20px; font-weight: 600; margin-bottom: 10px;">${plan.name}</div>
                    <div style="font-size: 32px; font-weight: 700; margin-bottom: 20px;">
                        $${plan.price}
                        <span style="font-size: 14px; color: var(--text-secondary); font-weight: normal;">
                            ${plan.price === 0 ? 'forever' : '/month'}
                        </span>
                    </div>
                    
                    <ul style="list-style: none; margin-bottom: 20px;">
                        ${plan.features.map(feature => `
                            <li style="padding: 8px 0; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-check" style="color: var(--success-color);"></i>
                                <span>${feature}</span>
                            </li>
                        `).join('')}
                    </ul>
                    
                    <button class="action-btn ${isCurrentPlan ? 'secondary' : ''}" 
                            style="width: 100%;"
                            ${isCurrentPlan ? 'disabled' : ''}>
                        ${isCurrentPlan ? 'Current Plan' : 'Upgrade Now'}
                    </button>
                `;
                
                if (!isCurrentPlan) {
                    const upgradeBtn = card.querySelector('button');
                    if (upgradeBtn) {
                        upgradeBtn.addEventListener('click', () => {
                            upgradePlan(planId, plan.price);
                        });
                    }
                }
                
                container.appendChild(card);
            });
        }
        
        function upgradePlan(planId, price) {
            if (!isOnline) {
                showNotification('Cannot upgrade plan while offline', 'error');
                return;
            }
            
            if (price > 0) {
                showPaymentModal('plan', planId, price);
            } else {
                userPlan = planId;
                updateMobileUserDisplay();
                loadPlanComparison();
                showNotification(`Upgraded to ${userPlans[planId].name} Plan!`, 'success');
            }
        }
        
        function loadSettingsFromStorage() {
            try {
                // Load notification settings
                const emailNotifications = document.getElementById('emailNotifications');
                const toolUpdates = document.getElementById('toolUpdates');
                
                if (emailNotifications) {
                    emailNotifications.checked = localStorage.getItem('email_notifications') !== 'false';
                }
                
                if (toolUpdates) {
                    toolUpdates.checked = localStorage.getItem('tool_updates') !== 'false';
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }
        
        function saveSettings() {
            try {
                const emailNotifications = document.getElementById('emailNotifications');
                const toolUpdates = document.getElementById('toolUpdates');
                
                if (emailNotifications) {
                    localStorage.setItem('email_notifications', emailNotifications.checked);
                }
                
                if (toolUpdates) {
                    localStorage.setItem('tool_updates', toolUpdates.checked);
                }
                
                showNotification('Settings saved successfully!', 'success');
            } catch (error) {
                console.error('Error saving settings:', error);
                showNotification('Error saving settings', 'error');
            }
        }
        
        function showPaymentModal(type, id, amount) {
            const packagesContainer = document.getElementById('creditPackages');
            if (packagesContainer && type === 'credits') {
                packagesContainer.innerHTML = '';
                
                creditPackages.forEach(pkg => {
                    const packageEl = document.createElement('div');
                    packageEl.className = 'credit-package';
                    packageEl.dataset.packageId = pkg.id;
                    packageEl.style.cssText = 'background-color: var(--secondary-color); border-radius: 10px; padding: 15px; text-align: center; cursor: pointer; transition: all 0.3s; border: 2px solid transparent;';
                    
                    packageEl.innerHTML = `
                        <div style="font-size: 24px; font-weight: 700; margin-bottom: 5px;">${pkg.credits}</div>
                        <div style="font-size: 18px; font-weight: 600; color: var(--primary-color); margin-bottom: 10px;">$${pkg.price}</div>
                        ${pkg.bonus > 0 ? `<div style="font-size: 12px; color: var(--success-color); background-color: rgba(52, 199, 89, 0.1); padding: 4px 8px; border-radius: 10px; display: inline-block;">+${pkg.bonus} bonus</div>` : ''}
                    `;
                    
                    packageEl.addEventListener('click', () => {
                        document.querySelectorAll('.credit-package').forEach(p => {
                            p.style.borderColor = 'transparent';
                            p.style.backgroundColor = 'var(--secondary-color)';
                        });
                        packageEl.style.borderColor = 'var(--primary-color)';
                        packageEl.style.backgroundColor = 'rgba(0, 132, 255, 0.1)';
                        selectedCreditPackage = pkg;
                    });
                    
                    packagesContainer.appendChild(packageEl);
                });
                
                // Select first package by default
                if (creditPackages.length > 0) {
                    packagesContainer.querySelector('.credit-package').click();
                }
            }
            
            paymentModal.classList.add('active');
        }
        
        function processPayment() {
            if (!selectedCreditPackage) {
                showNotification('Please select a credit package', 'warning');
                return;
            }
            
            loadingOverlay.classList.add('active');
            const loadingText = document.getElementById('loadingText');
            if (loadingText) loadingText.textContent = 'Processing payment...';
            
            setTimeout(() => {
                loadingOverlay.classList.remove('active');
                
                // Add credits
                userCredits += selectedCreditPackage.credits + selectedCreditPackage.bonus;
                document.getElementById('creditAmount').textContent = userCredits;
                document.getElementById('mobileCreditAmount').textContent = userCredits;
                
                // Record transaction
                const transaction = {
                    id: 'tx_' + Date.now(),
                    type: 'credit_purchase',
                    title: 'Credit Purchase',
                    amount: -selectedCreditPackage.price,
                    date: new Date(),
                    status: 'completed',
                    details: `Purchased ${selectedCreditPackage.credits + selectedCreditPackage.bonus} credits`
                };
                
                transactions.unshift(transaction);
                
                // Update UI
                updateDashboardStats();
                
                // Close modal and show success
                paymentModal.classList.remove('active');
                showNotification(`Successfully purchased ${selectedCreditPackage.credits + selectedCreditPackage.bonus} credits!`, 'success');
                
            }, 2000);
        }
        
        function setupEventListeners() {
            console.log('Setting up event listeners...');
            
            // Dismiss offline overlay
            const dismissOfflineBtn = document.getElementById('dismissOfflineBtn');
            if (dismissOfflineBtn) {
                dismissOfflineBtn.addEventListener('click', dismissOfflineOverlay);
            }
            
            // Category filters (desktop)
            document.querySelectorAll('.sidebar .category-filter-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    document.querySelectorAll('.sidebar .category-filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentCategoryFilter = this.dataset.category;
                    console.log('Category filter changed to:', currentCategoryFilter);
                    loadTools();
                });
            });
            
            // Category filters (mobile)
            document.querySelectorAll('.mobile-nav-menu .category-filter-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    document.querySelectorAll('.mobile-nav-menu .category-filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentCategoryFilter = this.dataset.category;
                    console.log('Mobile category filter changed to:', currentCategoryFilter);
                    loadTools();
                    mobileNavMenu.classList.remove('active');
                });
            });
            
            // Credit actions
            const buyCreditsBtn = document.getElementById('buyCreditsBtn');
            if (buyCreditsBtn) {
                buyCreditsBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    if (!isOnline) {
                        showNotification('Cannot purchase credits while offline', 'error');
                        return;
                    }
                    showPaymentModal('credits');
                });
            }
            
            const upgradePlanBtn = document.getElementById('upgradePlanBtn');
            if (upgradePlanBtn) {
                upgradePlanBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    navigateToContent('settings');
                });
            }
            
            // Dashboard actions
            const refreshDashboardBtn = document.getElementById('refreshDashboardBtn');
            if (refreshDashboardBtn) {
                refreshDashboardBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    loadDashboard();
                    showNotification('Dashboard refreshed', 'success');
                });
            }
            
            const exportDataBtn = document.getElementById('exportDataBtn');
            if (exportDataBtn) {
                exportDataBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    showNotification('Data export feature coming soon!', 'info');
                });
            }
            
            // Modal close buttons
            const closePreviewModal = document.getElementById('closePreviewModal');
            if (closePreviewModal) {
                closePreviewModal.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    toolPreviewModal.classList.remove('active');
                });
            }
            
            const closeExecutionModal = document.getElementById('closeExecutionModal');
            if (closeExecutionModal) {
                closeExecutionModal.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    toolExecutionModal.classList.remove('active');
                });
            }
            
            // Payment modal
            const cancelPaymentBtn = document.getElementById('cancelPaymentBtn');
            if (cancelPaymentBtn) {
                cancelPaymentBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    paymentModal.classList.remove('active');
                });
            }
            
            const confirmPaymentBtn = document.getElementById('confirmPaymentBtn');
            if (confirmPaymentBtn) {
                confirmPaymentBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    processPayment();
                });
            }
            
            // Settings
            const saveSettingsBtn = document.getElementById('saveSettingsBtn');
            if (saveSettingsBtn) {
                saveSettingsBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    saveSettings();
                });
            }
            
            // Free tools filter
            const filterFreeBtn = document.getElementById('filterFreeBtn');
            if (filterFreeBtn) {
                filterFreeBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    currentCategoryFilter = 'all';
                    document.querySelectorAll('.category-filter-btn').forEach(b => b.classList.remove('active'));
                    const allBtn = document.querySelector('.category-filter-btn[data-category="all"]');
                    if (allBtn) allBtn.classList.add('active');
                    
                    // Filter tools to show only free ones
                    const toolsGrid = document.getElementById('toolsGrid');
                    if (toolsGrid) {
                        toolsGrid.innerHTML = '';
                        
                        const freeTools = tools.filter(tool => tool.cost === 0);
                        if (freeTools.length === 0) {
                            toolsGrid.innerHTML = `
                                <div class="empty-state" style="grid-column: 1 / -1; padding: 40px 20px;">
                                    <i class="fas fa-tools"></i>
                                    <p>No free tools available</p>
                                </div>
                            `;
                            return;
                        }
                        
                        freeTools.forEach(tool => {
                            const toolCard = document.createElement('div');
                            toolCard.className = 'tool-card';
                            toolCard.dataset.toolId = tool.id;
                            
                            toolCard.innerHTML = `
                                <div class="tool-icon ${tool.category}">
                                    <i class="${tool.icon || 'fas fa-tools'}"></i>
                                </div>
                                <div class="tool-name">${tool.name}</div>
                                <div class="tool-description">${tool.description}</div>
                                <div class="tool-meta">
                                    <div class="tool-cost free">Free</div>
                                    <div class="tool-usage">
                                        <i class="fas fa-chart-bar"></i>
                                        ${tool.usage || 0} uses
                                    </div>
                                </div>
                            `;
                            
                            toolCard.addEventListener('click', (e) => {
                                e.preventDefault();
                                e.stopPropagation();
                                showToolPreview(tool);
                            });
                            
                            toolsGrid.appendChild(toolCard);
                        });
                    }
                });
            }
            
            // Search tools button
            const searchToolsBtn = document.getElementById('searchToolsBtn');
            if (searchToolsBtn) {
                searchToolsBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    showNotification('Search feature coming soon!', 'info');
                });
            }
            
            // View cart button
            const viewCartBtn = document.getElementById('viewCartBtn');
            if (viewCartBtn) {
                viewCartBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    showNotification('Cart feature coming soon!', 'info');
                });
            }
            
            // Book consultation button
            const bookConsultationBtn = document.getElementById('bookConsultationBtn');
            if (bookConsultationBtn) {
                bookConsultationBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    showNotification('Consultation booking modal coming soon!', 'info');
                });
            }
            
            console.log('Event listeners setup complete');
        }
        
        function formatDate(date) {
            if (!date) return 'Unknown';
            
            const d = new Date(date);
            const now = new Date();
            const diffMs = now - d;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }
        
        function showNotification(message, type = 'success') {
            const notificationText = document.getElementById('notificationText');
            if (!notificationText || !notification) return;
            
            notificationText.textContent = message;
            
            notification.className = 'notification';
            notification.classList.add(type);
            
            notification.classList.add('active');
            
            setTimeout(() => {
                notification.classList.remove('active');
            }, 3000);
        }
        
        // Initialize on load
        console.log('Tools dashboard ready');
    </script>
</body>
</html>