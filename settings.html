<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
     <link rel="manifest" href="/manifest.json">
     <meta name="theme-color" content="#000000">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Uniconnect</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="responsive.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
    
    <!-- Custom Scripts -->
    <script src="user-data.js"></script>
    <script src="display-user-selections.js"></script>
    
    <style>
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .primary-gradient {
            background: linear-gradient(135deg, #3B82F6 0%, #8B5CF6 100%);
        }
        .settings-card {
            background: rgba(30, 30, 60, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        .settings-card:hover {
            border-color: rgba(59, 130, 246, 0.6);
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4B5563;
            transition: .4s;
            border-radius: 34px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: #3B82F6;
        }
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            z-index: 1000;
            transition: all 0.3s;
        }
        .connection-status.connected {
            background: rgba(34, 197, 94, 0.8);
            color: white;
        }
        .connection-status.connecting {
            background: rgba(245, 158, 11, 0.8);
            color: white;
        }
        .connection-status.disconnected {
            background: rgba(239, 68, 68, 0.8);
            color: white;
        }
        .theme-option {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
        }
        .theme-option:hover {
            transform: scale(1.05);
        }
        .theme-option.active {
            border-color: white;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }
        .theme-blue {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
        }
        .theme-purple {
            background: linear-gradient(135deg, #7e22ce 0%, #a855f7 100%);
        }
        .theme-green {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        }
        .theme-dark {
            background: linear-gradient(135deg, #0f172a 0%, #334155 100%);
        }
        .theme-cyber {
            background: linear-gradient(135deg, #1e3a8a 0%, #7e22ce 100%);
        }
        .theme-red {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
        }
        .notification-item {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }
        .notification-item:hover {
            background: rgba(59, 130, 246, 0.1);
        }
        .notification-item:last-child {
            border-bottom: none;
        }
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #3B82F6;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Theme-specific styles */
        .blue-theme body {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
        }
        .purple-theme body {
            background: linear-gradient(135deg, #7e22ce 0%, #a855f7 100%);
        }
        .green-theme body {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        }
        .dark-theme body {
            background: linear-gradient(135deg, #0f172a 0%, #334155 100%);
        }
        .cyber-theme body {
            background: linear-gradient(135deg, #1e3a8a 0%, #7e22ce 100%);
        }
        .red-theme body {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
        }
        
        /* Mobile menu styles */
        .mobile-menu {
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
        }
        .mobile-menu.open {
            transform: translateX(0);
        }
        .mobile-overlay {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out;
        }
        .mobile-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        
        /* Mood & Interests Styles */
        .mood-chip {
            display: inline-flex;
            align-items: center;
            padding: 8px 16px;
            margin: 4px;
            border-radius: 20px;
            font-size: 0.9rem;
            transition: all 0.2s;
            cursor: pointer;
            user-select: none;
        }
        .mood-chip:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .mood-chip.selected {
            border: 2px solid white;
        }
        .mood-chip .remove-btn {
            margin-left: 8px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .mood-chip .remove-btn:hover {
            opacity: 1;
        }
        .mood-category {
            margin-bottom: 20px;
        }
        .mood-emoji {
            font-size: 1.2rem;
            margin-right: 8px;
        }
        .interest-tag {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            margin: 3px;
            border-radius: 16px;
            font-size: 0.85rem;
            transition: all 0.2s;
            cursor: pointer;
            user-select: none;
        }
        .interest-tag:hover {
            transform: scale(1.05);
        }
        .interest-tag.selected {
            border: 2px solid white;
        }
        .color-preview {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }
        .color-preview:hover {
            transform: scale(1.1);
        }
        .color-preview.selected {
            border-color: white;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        .mood-theme-preview {
            width: 100%;
            height: 80px;
            border-radius: 10px;
            margin-top: 10px;
            overflow: hidden;
            position: relative;
        }
        .mood-theme-preview::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, var(--color-1), var(--color-2), var(--color-3));
        }
        .custom-color-input {
            width: 100%;
            height: 40px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
        }
        .gradient-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, var(--gradient-start), var(--gradient-end));
            margin: 10px 0;
            position: relative;
        }
        .gradient-slider-thumb {
            position: absolute;
            top: -6px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        .mood-privacy-option {
            padding: 12px 16px;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .mood-privacy-option:hover {
            background: rgba(59, 130, 246, 0.1);
        }
        .mood-privacy-option.selected {
            border-color: #3B82F6;
            background: rgba(59, 130, 246, 0.15);
        }
        .mood-privacy-option .privacy-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }
        .preset-theme {
            width: 80px;
            height: 60px;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
            overflow: hidden;
            position: relative;
        }
        .preset-theme:hover {
            transform: scale(1.05);
        }
        .preset-theme.selected {
            border-color: white;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }
        .preset-theme .theme-colors {
            display: flex;
            width: 100%;
            height: 100%;
        }
        .preset-theme .theme-color {
            flex: 1;
            height: 100%;
        }
        .selection-counter {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            font-size: 0.8rem;
            margin-left: 8px;
        }
    </style>
</head>
<body class="h-full bg-gradient-to-br from-gray-900 via-blue-900 to-gray-900 text-white overflow-x-hidden">
    <!-- Connection Status -->
    <div class="connection-status connecting" id="connectionStatus">
        <i class="fas fa-circle-notch fa-spin mr-2"></i>
        <span id="connectionText">Connecting to Firebase...</span>
    </div>

    <!-- Navigation -->
    <div class="w-full glass-effect border-b border-blue-800 p-4">
        <div class="max-w-6xl mx-auto flex items-center justify-between">
            <a href="home.html" class="flex items-center space-x-3">
                <div class="w-10 h-10 primary-gradient rounded-2xl flex items-center justify-center">
                    <i class="fas fa-id-card-alt text-white"></i>
                </div>
                <span class="text-xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400">
                    Uniconnect
                </span>
            </a>
            
            <!-- Desktop Navigation -->
            <div class="hidden md:flex items-center space-x-4">
                <a href="home.html" class="text-blue-300 hover:text-white transition">Home</a>
                <a href="chat.html" class="text-blue-300 hover:text-white transition">Chat</a>
                <a href="profile.html" class="text-blue-300 hover:text-white transition">Profile</a>
                <a href="settings.html" class="text-white font-semibold">Settings</a>
            </div>
            
            <!-- Mobile Menu Button -->
            <button id="mobileMenuButton" class="md:hidden text-blue-300 hover:text-white transition">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </div>
    </div>
    
    <!-- Mobile Menu Overlay -->
    <div id="mobileMenuOverlay" class="mobile-overlay fixed inset-0 bg-black bg-opacity-70 z-40"></div>
    
    <!-- Mobile Menu -->
    <div id="mobileMenu" class="mobile-menu fixed top-0 left-0 h-full w-64 glass-effect z-50 p-6">
        <div class="flex justify-between items-center mb-8">
            <a href="home.html" class="flex items-center space-x-3">
                <div class="w-10 h-10 primary-gradient rounded-2xl flex items-center justify-center">
                    <i class="fas fa-id-card-alt text-white"></i>
                </div>
                <span class="text-xl font-black text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400">
                    Uniconnect
                </span>
            </a>
            <button id="closeMobileMenu" class="text-blue-300 hover:text-white transition">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        
        <div class="flex flex-col space-y-6">
            <a href="home.html" class="text-blue-300 hover:text-white transition text-lg">Home</a>
            <a href="chat.html" class="text-blue-300 hover:text-white transition text-lg">Chat</a>
            <a href="profile.html" class="text-blue-300 hover:text-white transition text-lg">Profile</a>
            <a href="settings.html" class="text-white font-semibold text-lg">Settings</a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-6 max-w-6xl">
        <div class="mb-8">
            <h1 class="text-3xl font-bold mb-2">Settings</h1>
            <p class="text-blue-300">Manage your Uniconnect preferences and account settings</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column - Account & Profile -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Account Settings -->
                <div class="settings-card p-4 md:p-6">
                    <h2 class="text-xl font-bold mb-4 text-blue-300">Account Settings</h2>
                    
                    <div class="space-y-4">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div class="mb-3 sm:mb-0">
                                <h3 class="font-semibold">Display Name</h3>
                                <p class="text-sm text-blue-300">Change how your name appears</p>
                            </div>
                            <div class="flex items-center space-x-3">
                                <span id="displayName" class="flex items-center">
                                    <div class="loading-spinner mr-2"></div>
                                    Loading...
                                </span>
                                <button id="editNameBtn" class="text-blue-400 hover:text-blue-300 transition">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div class="mb-3 sm:mb-0">
                                <h3 class="font-semibold">Email Address</h3>
                                <p class="text-sm text-blue-300">Your account email</p>
                            </div>
                            <span id="userEmail" class="text-blue-300 flex items-center">
                                <div class="loading-spinner mr-2"></div>
                                Loading...
                            </span>
                        </div>
                        
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div class="mb-3 sm:mb-0">
                                <h3 class="font-semibold">Account Created</h3>
                                <p class="text-sm text-blue-300">When you joined Uniconnect</p>
                            </div>
                            <span id="accountCreated" class="text-blue-300 flex items-center">
                                <div class="loading-spinner mr-2"></div>
                                Loading...
                            </span>
                        </div>

                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div class="mb-3 sm:mb-0">
                                <h3 class="font-semibold">User ID</h3>
                                <p class="text-sm text-blue-300">Your unique identifier</p>
                            </div>
                            <span id="userId" class="text-blue-300 text-sm flex items-center">
                                <div class="loading-spinner mr-2"></div>
                                Loading...
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Mood & Interests Settings -->
                <div class="settings-card p-4 md:p-6">
                    <h2 class="text-xl font-bold mb-4 text-blue-300">Mood & Interests</h2>
                    
                    <div class="space-y-6">
                        <!-- Current Moods Display -->
                        <div>
                            <div class="flex justify-between items-center mb-3">
                                <h3 class="font-semibold">Current Moods</h3>
                                <span class="text-sm text-blue-300">Selected: <span id="moodCount">0</span>/5</span>
                            </div>
                            <div id="selectedMoodsContainer" class="flex flex-wrap gap-2 p-3 glass-effect rounded-lg min-h-[60px]">
                                <div class="text-blue-300 text-sm italic">No moods selected yet</div>
                            </div>
                        </div>
                        
                        <!-- Mood Selection -->
                        <div class="mood-category">
                            <h3 class="font-semibold mb-3">Select Your Moods</h3>
                            <div class="flex flex-wrap gap-2">
                                <div class="mood-chip" data-mood="happy" data-color="#FFD700" style="background: linear-gradient(135deg, #FFD700, #FFA500);">
                                    <span class="mood-emoji">üòä</span> Happy
                                </div>
                                <div class="mood-chip" data-mood="energetic" data-color="#FF6B6B" style="background: linear-gradient(135deg, #FF6B6B, #FF8E53);">
                                    <span class="mood-emoji">‚ö°</span> Energetic
                                </div>
                                <div class="mood-chip" data-mood="calm" data-color="#4ECDC4" style="background: linear-gradient(135deg, #4ECDC4, #44A08D);">
                                    <span class="mood-emoji">üßò</span> Calm
                                </div>
                                <div class="mood-chip" data-mood="creative" data-color="#A78BFA" style="background: linear-gradient(135deg, #A78BFA, #7C3AED);">
                                    <span class="mood-emoji">üé®</span> Creative
                                </div>
                                <div class="mood-chip" data-mood="focused" data-color="#10B981" style="background: linear-gradient(135deg, #10B981, #059669);">
                                    <span class="mood-emoji">üéØ</span> Focused
                                </div>
                                <div class="mood-chip" data-mood="relaxed" data-color="#60A5FA" style="background: linear-gradient(135deg, #60A5FA, #3B82F6);">
                                    <span class="mood-emoji">üå¥</span> Relaxed
                                </div>
                                <div class="mood-chip" data-mood="adventurous" data-color="#F97316" style="background: linear-gradient(135deg, #F97316, #EA580C);">
                                    <span class="mood-emoji">üèîÔ∏è</span> Adventurous
                                </div>
                                <div class="mood-chip" data-mood="romantic" data-color="#EC4899" style="background: linear-gradient(135deg, #EC4899, #BE185D);">
                                    <span class="mood-emoji">üíñ</span> Romantic
                                </div>
                                <div class="mood-chip" data-mood="nostalgic" data-color="#8B5CF6" style="background: linear-gradient(135deg, #8B5CF6, #7C3AED);">
                                    <span class="mood-emoji">üìª</span> Nostalgic
                                </div>
                                <div class="mood-chip" data-mood="mysterious" data-color="#6B7280" style="background: linear-gradient(135deg, #6B7280, #4B5563);">
                                    <span class="mood-emoji">üîÆ</span> Mysterious
                                </div>
                            </div>
                        </div>
                        
                        <!-- Interests Selection -->
                        <div class="mood-category">
                            <div class="flex justify-between items-center mb-3">
                                <h3 class="font-semibold">Your Interests</h3>
                                <span class="text-sm text-blue-300">Selected: <span id="interestCount">0</span>/10</span>
                            </div>
                            <div class="flex flex-wrap gap-2">
                                <div class="interest-tag" data-interest="music" style="background: rgba(59, 130, 246, 0.3);">
                                    üéµ Music
                                </div>
                                <div class="interest-tag" data-interest="gaming" style="background: rgba(139, 92, 246, 0.3);">
                                    üéÆ Gaming
                                </div>
                                <div class="interest-tag" data-interest="sports" style="background: rgba(34, 197, 94, 0.3);">
                                    ‚öΩ Sports
                                </div>
                                <div class="interest-tag" data-interest="art" style="background: rgba(245, 158, 11, 0.3);">
                                    üé® Art
                                </div>
                                <div class="interest-tag" data-interest="technology" style="background: rgba(59, 130, 246, 0.3);">
                                    üíª Technology
                                </div>
                                <div class="interest-tag" data-interest="travel" style="background: rgba(16, 185, 129, 0.3);">
                                    ‚úàÔ∏è Travel
                                </div>
                                <div class="interest-tag" data-interest="food" style="background: rgba(239, 68, 68, 0.3);">
                                    üçî Food
                                </div>
                                <div class="interest-tag" data-interest="fitness" style="background: rgba(168, 85, 247, 0.3);">
                                    üí™ Fitness
                                </div>
                                <div class="interest-tag" data-interest="books" style="background: rgba(6, 182, 212, 0.3);">
                                    üìö Books
                                </div>
                                <div class="interest-tag" data-interest="movies" style="background: rgba(249, 115, 22, 0.3);">
                                    üé¨ Movies
                                </div>
                                <div class="interest-tag" data-interest="photography" style="background: rgba(99, 102, 241, 0.3);">
                                    üì∏ Photography
                                </div>
                                <div class="interest-tag" data-interest="fashion" style="background: rgba(236, 72, 153, 0.3);">
                                    üëó Fashion
                                </div>
                                <div class="interest-tag" data-interest="science" style="background: rgba(20, 184, 166, 0.3);">
                                    üî¨ Science
                                </div>
                                <div class="interest-tag" data-interest="nature" style="background: rgba(5, 150, 105, 0.3);">
                                    üåø Nature
                                </div>
                                <div class="interest-tag" data-interest="business" style="background: rgba(139, 92, 246, 0.3);">
                                    üíº Business
                                </div>
                            </div>
                        </div>
                        
                        <!-- Reset Button -->
                        <div class="flex justify-end">
                            <button id="resetSelectionsBtn" class="px-4 py-2 glass-effect rounded-lg hover:bg-red-900/30 transition text-red-400">
                                <i class="fas fa-redo-alt mr-2"></i>Reset All Selections
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Mood Theme Customizer -->
                <div class="settings-card p-4 md:p-6">
                    <h2 class="text-xl font-bold mb-4 text-blue-300">Mood Theme Customizer</h2>
                    
                    <div class="space-y-6">
                        <!-- Theme Preview -->
                        <div>
                            <h3 class="font-semibold mb-3">Theme Preview</h3>
                            <div id="moodThemePreview" class="mood-theme-preview" style="--color-1: #3B82F6; --color-2: #8B5CF6; --color-3: #EC4899;">
                                <!-- Gradient preview will be generated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Preset Themes -->
                        <div>
                            <h3 class="font-semibold mb-3">Preset Themes</h3>
                            <div class="grid grid-cols-3 md:grid-cols-6 gap-3">
                                <div class="preset-theme" data-theme="ocean">
                                    <div class="theme-colors">
                                        <div class="theme-color" style="background: #3B82F6;"></div>
                                        <div class="theme-color" style="background: #60A5FA;"></div>
                                        <div class="theme-color" style="background: #93C5FD;"></div>
                                    </div>
                                </div>
                                <div class="preset-theme" data-theme="sunset">
                                    <div class="theme-colors">
                                        <div class="theme-color" style="background: #F97316;"></div>
                                        <div class="theme-color" style="background: #FB923C;"></div>
                                        <div class="theme-color" style="background: #FDBA74;"></div>
                                    </div>
                                </div>
                                <div class="preset-theme" data-theme="forest">
                                    <div class="theme-colors">
                                        <div class="theme-color" style="background: #10B981;"></div>
                                        <div class="theme-color" style="background: #34D399;"></div>
                                        <div class="theme-color" style="background: #6EE7B7;"></div>
                                    </div>
                                </div>
                                <div class="preset-theme" data-theme="royal">
                                    <div class="theme-colors">
                                        <div class="theme-color" style="background: #8B5CF6;"></div>
                                        <div class="theme-color" style="background: #A78BFA;"></div>
                                        <div class="theme-color" style="background: #C4B5FD;"></div>
                                    </div>
                                </div>
                                <div class="preset-theme" data-theme="candy">
                                    <div class="theme-colors">
                                        <div class="theme-color" style="background: #EC4899;"></div>
                                        <div class="theme-color" style="background: #F472B6;"></div>
                                        <div class="theme-color" style="background: #F9A8D4;"></div>
                                    </div>
                                </div>
                                <div class="preset-theme" data-theme="midnight">
                                    <div class="theme-colors">
                                        <div class="theme-color" style="background: #1F2937;"></div>
                                        <div class="theme-color" style="background: #374151;"></div>
                                        <div class="theme-color" style="background: #4B5563;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Custom Color Picker -->
                        <div>
                            <h3 class="font-semibold mb-3">Custom Colors</h3>
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm mb-2">Primary Color</label>
                                    <input type="color" id="color1Picker" class="custom-color-input" value="#3B82F6">
                                </div>
                                <div>
                                    <label class="block text-sm mb-2">Secondary Color</label>
                                    <input type="color" id="color2Picker" class="custom-color-input" value="#8B5CF6">
                                </div>
                                <div>
                                    <label class="block text-sm mb-2">Accent Color</label>
                                    <input type="color" id="color3Picker" class="custom-color-input" value="#EC4899">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Gradient Direction -->
                        <div>
                            <h3 class="font-semibold mb-3">Gradient Direction</h3>
                            <div class="flex flex-wrap gap-3">
                                <button class="px-4 py-2 glass-effect rounded-lg hover:bg-blue-900/30 transition gradient-direction" data-direction="to right">‚Üí Horizontal</button>
                                <button class="px-4 py-2 glass-effect rounded-lg hover:bg-blue-900/30 transition gradient-direction" data-direction="to bottom">‚Üì Vertical</button>
                                <button class="px-4 py-2 glass-effect rounded-lg hover:bg-blue-900/30 transition gradient-direction" data-direction="45deg">‚Üó Diagonal</button>
                                <button class="px-4 py-2 glass-effect rounded-lg hover:bg-blue-900/30 transition gradient-direction" data-direction="135deg">‚Üò Diagonal</button>
                            </div>
                        </div>
                        
                        <!-- Apply Theme Button -->
                        <div class="flex justify-end">
                            <button id="applyThemeBtn" class="px-6 py-2 primary-gradient rounded-lg font-semibold hover:opacity-90 transition">
                                <i class="fas fa-palette mr-2"></i>Apply Theme
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Privacy Settings -->
                <div class="settings-card p-4 md:p-6">
                    <h2 class="text-xl font-bold mb-4 text-blue-300">Privacy Settings</h2>
                    
                    <div class="space-y-6">
                        <!-- Mood & Interests Privacy -->
                        <div>
                            <h3 class="font-semibold mb-3">Mood & Interests Visibility</h3>
                            <div class="space-y-3">
                                <div class="mood-privacy-option" data-privacy="public">
                                    <div class="flex items-center">
                                        <div class="privacy-icon" style="background: rgba(34, 197, 94, 0.2);">
                                            <i class="fas fa-globe text-green-400"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-medium">Public</h4>
                                            <p class="text-sm text-blue-300">Everyone can see your moods and interests</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="mood-privacy-option" data-privacy="friends">
                                    <div class="flex items-center">
                                        <div class="privacy-icon" style="background: rgba(59, 130, 246, 0.2);">
                                            <i class="fas fa-user-friends text-blue-400"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-medium">Friends Only</h4>
                                            <p class="text-sm text-blue-300">Only your friends can see your moods and interests</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="mood-privacy-option" data-privacy="private">
                                    <div class="flex items-center">
                                        <div class="privacy-icon" style="background: rgba(107, 114, 128, 0.2);">
                                            <i class="fas fa-lock text-gray-400"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-medium">Private</h4>
                                            <p class="text-sm text-blue-300">Only you can see your moods and interests</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div class="mb-3 sm:mb-0">
                                <h3 class="font-semibold">Profile Visibility</h3>
                                <p class="text-sm text-blue-300">Control who can see your profile</p>
                            </div>
                            <select id="profileVisibility" class="bg-gray-800 border border-blue-700 rounded-lg p-2 text-white w-full sm:w-auto">
                                <option value="public">Public</option>
                                <option value="friends">Friends Only</option>
                                <option value="private">Private</option>
                            </select>
                        </div>
                        
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div class="mb-3 sm:mb-0">
                                <h3 class="font-semibold">Online Status</h3>
                                <p class="text-sm text-blue-300">Show when you're online</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="onlineStatusToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div class="mb-3 sm:mb-0">
                                <h3 class="font-semibold">Read Receipts</h3>
                                <p class="text-sm text-blue-300">Let others see when you've read their messages</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="readReceiptsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div class="mb-3 sm:mb-0">
                                <h3 class="font-semibold">Activity Status</h3>
                                <p class="text-sm text-blue-300">Show when you're active on the platform</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="activityStatusToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Notification Settings -->
                <div class="settings-card p-4 md:p-6">
                    <h2 class="text-xl font-bold mb-4 text-blue-300">Notification Settings</h2>
                    
                    <div class="space-y-4">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div class="mb-3 sm:mb-0">
                                <h3 class="font-semibold">Push Notifications</h3>
                                <p class="text-sm text-blue-300">Receive notifications in your browser</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="pushNotificationsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div class="mb-3 sm:mb-0">
                                <h3 class="font-semibold">Email Notifications</h3>
                                <p class="text-sm text-blue-300">Receive notifications via email</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="emailNotificationsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div class="mb-3 sm:mb-0">
                                <h3 class="font-semibold">Message Notifications</h3>
                                <p class="text-sm text-blue-300">Get notified about new messages</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="messageNotificationsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div class="mb-3 sm:mb-0">
                                <h3 class="font-semibold">Friend Request Notifications</h3>
                                <p class="text-sm text-blue-300">Get notified about friend requests</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="friendRequestNotificationsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <!-- Mood Change Notifications -->
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div class="mb-3 sm:mb-0">
                                <h3 class="font-semibold">Mood Change Notifications</h3>
                                <p class="text-sm text-blue-300">Get notified when friends change their mood</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="moodChangeNotificationsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <!-- Interest Match Notifications -->
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div class="mb-3 sm:mb-0">
                                <h3 class="font-semibold">Interest Match Notifications</h3>
                                <p class="text-sm text-blue-300">Get notified when you have interest matches</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="interestMatchNotificationsToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Appearance & Actions -->
            <div class="space-y-6">
                <!-- Theme Settings -->
                <div class="settings-card p-4 md:p-6">
                    <h2 class="text-xl font-bold mb-4 text-blue-300">Appearance</h2>
                    
                    <div class="mb-4">
                        <h3 class="font-semibold mb-3">Theme</h3>
                        <div class="grid grid-cols-3 gap-3">
                            <div class="theme-option theme-blue active" data-theme="blue-theme"></div>
                            <div class="theme-option theme-purple" data-theme="purple-theme"></div>
                            <div class="theme-option theme-green" data-theme="green-theme"></div>
                            <div class="theme-option theme-dark" data-theme="dark-theme"></div>
                            <div class="theme-option theme-cyber" data-theme="cyber-theme"></div>
                            <div class="theme-option theme-red" data-theme="red-theme"></div>
                        </div>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mt-4">
                        <div class="mb-3 sm:mb-0">
                            <h3 class="font-semibold">Dark Mode</h3>
                            <p class="text-sm text-blue-300">Use dark theme</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="darkModeToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Data Management -->
                <div class="settings-card p-4 md:p-6">
                    <h2 class="text-xl font-bold mb-4 text-blue-300">Data Management</h2>
                    
                    <div class="space-y-3">
                        <button id="exportDataBtn" class="w-full text-left p-3 glass-effect rounded-lg hover:bg-blue-900/30 transition flex items-center justify-between">
                            <span class="text-sm md:text-base">Export My Data</span>
                            <i class="fas fa-download text-blue-400"></i>
                        </button>
                        
                        <button id="clearCacheBtn" class="w-full text-left p-3 glass-effect rounded-lg hover:bg-blue-900/30 transition flex items-center justify-between">
                            <span class="text-sm md:text-base">Clear Cache</span>
                            <i class="fas fa-broom text-blue-400"></i>
                        </button>
                        
                        <button id="deleteAccountBtn" class="w-full text-left p-3 glass-effect rounded-lg hover:bg-red-900/30 transition flex items-center justify-between text-red-400">
                            <span class="text-sm md:text-base">Delete Account</span>
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>

                <!-- App Information -->
                <div class="settings-card p-4 md:p-6">
                    <h2 class="text-xl font-bold mb-4 text-blue-300">About Uniconnect</h2>
                    
                    <div class="space-y-3 text-sm">
                        <div class="flex justify-between">
                            <span class="text-blue-300">Version</span>
                            <span>2.1.0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-blue-300">Build Date</span>
                            <span>Nov 2023</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-blue-300">Firebase Status</span>
                            <span id="firebaseStatus" class="text-yellow-400">Connecting...</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-blue-300">Database</span>
                            <span id="databaseStatus" class="text-yellow-400">Loading...</span>
                        </div>
                    </div>
                    
                    <div class="mt-4 pt-4 border-t border-blue-800">
                        <button id="logoutBtn" class="w-full p-3 primary-gradient rounded-lg font-semibold hover:opacity-90 transition text-sm md:text-base">
                            Sign Out
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Name Modal -->
    <div id="editNameModal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden">
        <div class="settings-card p-4 md:p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-blue-300">Edit Display Name</h2>
                <button id="closeEditNameModal" class="text-blue-400 hover:text-blue-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium mb-2">New Display Name</label>
                <input type="text" id="newDisplayName" class="w-full p-3 glass-effect border border-blue-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent" placeholder="Enter your display name">
                <p class="text-xs text-blue-300 mt-1">This name will be visible to other users</p>
            </div>
            
            <div class="flex justify-end space-x-3">
                <button id="cancelEditName" class="px-4 py-2 glass-effect rounded-lg hover:bg-blue-900/30 transition">Cancel</button>
                <button id="saveDisplayName" class="px-4 py-2 primary-gradient rounded-lg font-semibold hover:opacity-90 transition">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Delete Account Confirmation Modal -->
    <div id="deleteAccountModal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden">
        <div class="settings-card p-4 md:p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-red-400">Delete Account</h2>
                <button id="closeDeleteModal" class="text-blue-400 hover:text-blue-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-4">
                <p class="text-red-300 mb-3">This action cannot be undone. All your data will be permanently deleted.</p>
                <p class="text-sm text-blue-300 mb-3">To confirm, please type your password:</p>
                <input type="password" id="confirmPassword" class="w-full p-3 glass-effect border border-red-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-400 focus:border-transparent" placeholder="Enter your password">
            </div>
            
            <div class="flex justify-end space-x-3">
                <button id="cancelDelete" class="px-4 py-2 glass-effect rounded-lg hover:bg-blue-900/30 transition">Cancel</button>
                <button id="confirmDelete" class="px-4 py-2 bg-red-600 rounded-lg font-semibold hover:bg-red-700 transition text-white">Delete Account</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDHHyGgsSV18BcXrGgzi4C8frzDAE1C1zo",
            authDomain: "uniconnect-ee95c.firebaseapp.com",
            projectId: "uniconnect-ee95c",
            storageBucket: "uniconnect-ee95c.firebasestorage.app",
            messagingSenderId: "1003264444309",
            appId: "1:1003264444309:web:9f0307516e44d21e97d89c"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const auth = firebase.auth();
        const db = firebase.firestore();

        // Settings Application
        class SettingsApplication {
            constructor() {
                this.currentUser = null;
                this.userSettings = {};
                this.isConnected = false;
                this.userData = {};
                this.settingsListeners = [];
                this.selectedMoods = [];
                this.selectedInterests = [];
                this.moodTheme = {
                    colors: ['#3B82F6', '#8B5CF6', '#EC4899'],
                    direction: '45deg',
                    preset: 'ocean'
                };
                this.moodPrivacy = 'public';
            }

            async initialize() {
                try {
                    console.log("üöÄ Initializing Settings Application...");
                    await this.initializeFirebase();
                    this.setupEventListeners();
                    await this.loadUserSettings();
                    this.initializeMoodSystem();
                    this.showNotification("Settings loaded successfully!", "success");
                } catch (error) {
                    console.error('‚ùå Initialization failed:', error);
                    this.updateConnectionStatus('disconnected');
                    this.showNotification("Failed to load settings. Please refresh the page.", "error");
                }
            }

            async initializeFirebase() {
                this.updateConnectionStatus('connecting');
                
                return new Promise((resolve, reject) => {
                    const unsubscribe = auth.onAuthStateChanged(async (user) => {
                        if (user) {
                            this.currentUser = user;
                            console.log("‚úÖ User authenticated:", user.uid);
                            
                            try {
                                // Load user data
                                await this.loadUserData();
                                this.updateConnectionStatus('connected');
                                resolve();
                            } catch (error) {
                                console.error("‚ùå Error loading user data:", error);
                                reject(error);
                            }
                        } else {
                            console.log("‚ùå User not authenticated, redirecting to login...");
                            // Redirect to login if not authenticated
                            window.location.href = 'index.html';
                            reject(new Error('User not authenticated'));
                        }
                    }, (error) => {
                        console.error("‚ùå Auth state change error:", error);
                        reject(error);
                    });
                });
            }

            async loadUserData() {
                try {
                    console.log("üì• Loading user data from Firestore...");
                    const userDoc = await db.collection('users').doc(this.currentUser.uid).get();
                    
                    if (userDoc.exists) {
                        this.userData = userDoc.data();
                        console.log("‚úÖ User data loaded:", this.userData);
                        
                        // Update UI with user data
                        this.updateUserInterface();
                        
                        // Load mood data if exists
                        if (this.userData.moods) {
                            this.selectedMoods = this.userData.moods.selectedMoods || [];
                            this.selectedInterests = this.userData.moods.selectedInterests || [];
                            this.moodTheme = this.userData.moods.theme || this.moodTheme;
                            this.moodPrivacy = this.userData.moods.privacy || 'public';
                            this.updateMoodUI();
                        }
                        
                        // Load settings
                        if (this.userData.settings) {
                            this.userSettings = this.userData.settings;
                            this.applySettingsToUI();
                            this.notifySettingsChange();
                        } else {
                            // Initialize default settings
                            await this.initializeDefaultSettings();
                        }
                    } else {
                        // Create user document if it doesn't exist
                        console.log("üìù Creating new user document...");
                        await this.createUserDocument();
                    }
                } catch (error) {
                    console.error('‚ùå Error loading user data:', error);
                    throw error;
                }
            }

            updateUserInterface() {
                // Update display name
                const displayName = 
                    this.userData.profile?.displayName || 
                    this.userData.profile?.firstName || 
                    'User_' + this.currentUser.uid.slice(-6);
                document.getElementById('displayName').textContent = displayName;
                
                // Update email
                document.getElementById('userEmail').textContent = this.currentUser.email || 'Not provided';
                
                // Update account creation date
                const createdAt = this.userData.createdAt ? 
                    new Date(this.userData.createdAt.toDate()).toLocaleDateString() : 
                    new Date().toLocaleDateString();
                document.getElementById('accountCreated').textContent = createdAt;
                
                // Update user ID
                document.getElementById('userId').textContent = this.currentUser.uid.slice(0, 8) + '...';
            }

            initializeMoodSystem() {
                // Initialize mood selection
                this.setupMoodSelection();
                
                // Initialize mood theme customizer
                this.setupMoodThemeCustomizer();
                
                // Initialize mood privacy settings
                this.setupMoodPrivacy();
                
                // Update mood UI
                this.updateMoodUI();
            }

            setupMoodSelection() {
                // Mood chips selection
                document.querySelectorAll('.mood-chip').forEach(chip => {
                    chip.addEventListener('click', () => {
                        const mood = chip.getAttribute('data-mood');
                        const color = chip.getAttribute('data-color');
                        
                        if (this.selectedMoods.length >= 5 && !this.selectedMoods.includes(mood)) {
                            this.showNotification('Maximum 5 moods allowed. Remove one to add another.', 'error');
                            return;
                        }
                        
                        if (this.selectedMoods.includes(mood)) {
                            // Remove mood
                            this.selectedMoods = this.selectedMoods.filter(m => m !== mood);
                            chip.classList.remove('selected');
                        } else {
                            // Add mood
                            this.selectedMoods.push(mood);
                            chip.classList.add('selected');
                        }
                        
                        this.updateSelectedMoodsDisplay();
                        this.saveMoodsToFirebase();
                    });
                });
                
                // Interest tags selection
                document.querySelectorAll('.interest-tag').forEach(tag => {
                    tag.addEventListener('click', () => {
                        const interest = tag.getAttribute('data-interest');
                        
                        if (this.selectedInterests.length >= 10 && !this.selectedInterests.includes(interest)) {
                            this.showNotification('Maximum 10 interests allowed. Remove one to add another.', 'error');
                            return;
                        }
                        
                        if (this.selectedInterests.includes(interest)) {
                            // Remove interest
                            this.selectedInterests = this.selectedInterests.filter(i => i !== interest);
                            tag.classList.remove('selected');
                        } else {
                            // Add interest
                            this.selectedInterests.push(interest);
                            tag.classList.add('selected');
                        }
                        
                        this.updateInterestCount();
                        this.saveMoodsToFirebase();
                    });
                });
                
                // Reset selections button
                document.getElementById('resetSelectionsBtn').addEventListener('click', () => {
                    if (confirm('Are you sure you want to reset all your mood and interest selections?')) {
                        this.selectedMoods = [];
                        this.selectedInterests = [];
                        this.updateMoodUI();
                        this.saveMoodsToFirebase();
                        this.showNotification('All selections have been reset', 'success');
                    }
                });
            }

            setupMoodThemeCustomizer() {
                // Preset theme selection
                document.querySelectorAll('.preset-theme').forEach(theme => {
                    theme.addEventListener('click', () => {
                        const themeName = theme.getAttribute('data-theme');
                        this.moodTheme.preset = themeName;
                        
                        // Update theme colors based on preset
                        switch(themeName) {
                            case 'ocean':
                                this.moodTheme.colors = ['#3B82F6', '#60A5FA', '#93C5FD'];
                                break;
                            case 'sunset':
                                this.moodTheme.colors = ['#F97316', '#FB923C', '#FDBA74'];
                                break;
                            case 'forest':
                                this.moodTheme.colors = ['#10B981', '#34D399', '#6EE7B7'];
                                break;
                            case 'royal':
                                this.moodTheme.colors = ['#8B5CF6', '#A78BFA', '#C4B5FD'];
                                break;
                            case 'candy':
                                this.moodTheme.colors = ['#EC4899', '#F472B6', '#F9A8D4'];
                                break;
                            case 'midnight':
                                this.moodTheme.colors = ['#1F2937', '#374151', '#4B5563'];
                                break;
                        }
                        
                        // Update color pickers
                        document.getElementById('color1Picker').value = this.moodTheme.colors[0];
                        document.getElementById('color2Picker').value = this.moodTheme.colors[1];
                        document.getElementById('color3Picker').value = this.moodTheme.colors[2];
                        
                        // Update UI
                        this.updateThemePreview();
                        
                        // Remove active class from all themes
                        document.querySelectorAll('.preset-theme').forEach(t => t.classList.remove('selected'));
                        // Add active class to selected theme
                        theme.classList.add('selected');
                    });
                });
                
                // Color pickers
                document.getElementById('color1Picker').addEventListener('input', (e) => {
                    this.moodTheme.colors[0] = e.target.value;
                    this.updateThemePreview();
                });
                
                document.getElementById('color2Picker').addEventListener('input', (e) => {
                    this.moodTheme.colors[1] = e.target.value;
                    this.updateThemePreview();
                });
                
                document.getElementById('color3Picker').addEventListener('input', (e) => {
                    this.moodTheme.colors[2] = e.target.value;
                    this.updateThemePreview();
                });
                
                // Gradient direction buttons
                document.querySelectorAll('.gradient-direction').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.moodTheme.direction = btn.getAttribute('data-direction');
                        this.updateThemePreview();
                        
                        // Update active state
                        document.querySelectorAll('.gradient-direction').forEach(b => {
                            b.style.background = '';
                        });
                        btn.style.background = 'rgba(59, 130, 246, 0.3)';
                    });
                });
                
                // Apply theme button
                document.getElementById('applyThemeBtn').addEventListener('click', () => {
                    this.saveMoodThemeToFirebase();
                    this.showNotification('Mood theme applied successfully!', 'success');
                });
                
                // Initialize with default theme
                this.updateThemePreview();
            }

            setupMoodPrivacy() {
                // Privacy option selection
                document.querySelectorAll('.mood-privacy-option').forEach(option => {
                    option.addEventListener('click', () => {
                        const privacy = option.getAttribute('data-privacy');
                        this.moodPrivacy = privacy;
                        
                        // Update UI
                        document.querySelectorAll('.mood-privacy-option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        option.classList.add('selected');
                        
                        // Save to Firebase
                        this.saveMoodsToFirebase();
                    });
                });
                
                // Set initial privacy selection
                document.querySelector(`.mood-privacy-option[data-privacy="${this.moodPrivacy}"]`)?.classList.add('selected');
            }

            updateMoodUI() {
                this.updateSelectedMoodsDisplay();
                this.updateInterestCount();
                
                // Update mood chips selection state
                document.querySelectorAll('.mood-chip').forEach(chip => {
                    const mood = chip.getAttribute('data-mood');
                    if (this.selectedMoods.includes(mood)) {
                        chip.classList.add('selected');
                    } else {
                        chip.classList.remove('selected');
                    }
                });
                
                // Update interest tags selection state
                document.querySelectorAll('.interest-tag').forEach(tag => {
                    const interest = tag.getAttribute('data-interest');
                    if (this.selectedInterests.includes(interest)) {
                        tag.classList.add('selected');
                    } else {
                        tag.classList.remove('selected');
                    }
                });
            }

            updateSelectedMoodsDisplay() {
                const container = document.getElementById('selectedMoodsContainer');
                const countElement = document.getElementById('moodCount');
                
                // Update count
                countElement.textContent = this.selectedMoods.length;
                
                // Clear container
                container.innerHTML = '';
                
                // Add selected moods
                this.selectedMoods.forEach(mood => {
                    const moodChip = document.querySelector(`.mood-chip[data-mood="${mood}"]`);
                    if (moodChip) {
                        const clone = moodChip.cloneNode(true);
                        clone.classList.add('selected');
                        
                        // Add remove button
                        const removeBtn = document.createElement('span');
                        removeBtn.className = 'remove-btn';
                        removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                        removeBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            this.selectedMoods = this.selectedMoods.filter(m => m !== mood);
                            this.updateMoodUI();
                            this.saveMoodsToFirebase();
                        });
                        
                        clone.appendChild(removeBtn);
                        container.appendChild(clone);
                    }
                });
                
                // Show message if no moods selected
                if (this.selectedMoods.length === 0) {
                    container.innerHTML = '<div class="text-blue-300 text-sm italic">No moods selected yet</div>';
                }
            }

            updateInterestCount() {
                const countElement = document.getElementById('interestCount');
                countElement.textContent = this.selectedInterests.length;
            }

            updateThemePreview() {
                const preview = document.getElementById('moodThemePreview');
                const [color1, color2, color3] = this.moodTheme.colors;
                
                // Update CSS variables
                preview.style.setProperty('--color-1', color1);
                preview.style.setProperty('--color-2', color2);
                preview.style.setProperty('--color-3', color3);
                
                // Update background gradient
                preview.style.background = `linear-gradient(${this.moodTheme.direction}, ${color1}, ${color2}, ${color3})`;
            }

            async saveMoodsToFirebase() {
                if (!this.currentUser) return;
                
                try {
                    await db.collection('users').doc(this.currentUser.uid).set({
                        moods: {
                            selectedMoods: this.selectedMoods,
                            selectedInterests: this.selectedInterests,
                            theme: this.moodTheme,
                            privacy: this.moodPrivacy,
                            updatedAt: new Date()
                        }
                    }, { merge: true });
                    
                    console.log("‚úÖ Moods saved to Firebase");
                } catch (error) {
                    console.error('‚ùå Error saving moods:', error);
                }
            }

            async saveMoodThemeToFirebase() {
                if (!this.currentUser) return;
                
                try {
                    await db.collection('users').doc(this.currentUser.uid).set({
                        moods: {
                            theme: this.moodTheme,
                            updatedAt: new Date()
                        }
                    }, { merge: true });
                    
                    console.log("‚úÖ Mood theme saved to Firebase");
                } catch (error) {
                    console.error('‚ùå Error saving mood theme:', error);
                }
            }

            async createUserDocument() {
                try {
                    const defaultSettings = {
                        theme: 'blue-theme',
                        darkMode: true,
                        profileVisibility: 'public',
                        onlineStatus: true,
                        readReceipts: true,
                        activityStatus: true,
                        pushNotifications: true,
                        emailNotifications: false,
                        messageNotifications: true,
                        friendRequestNotifications: true,
                        moodChangeNotifications: true,
                        interestMatchNotifications: true
                    };

                    await db.collection('users').doc(this.currentUser.uid).set({
                        profile: {
                            displayName: 'User_' + this.currentUser.uid.slice(-6),
                            email: this.currentUser.email,
                            createdAt: new Date()
                        },
                        moods: {
                            selectedMoods: [],
                            selectedInterests: [],
                            theme: this.moodTheme,
                            privacy: 'public',
                            createdAt: new Date()
                        },
                        settings: defaultSettings,
                        createdAt: new Date(),
                        lastLogin: new Date()
                    });
                    
                    console.log("‚úÖ User document created successfully");
                    
                    // Reload user data
                    await this.loadUserData();
                } catch (error) {
                    console.error('‚ùå Error creating user document:', error);
                    throw error;
                }
            }

            async initializeDefaultSettings() {
                const defaultSettings = {
                    theme: 'blue-theme',
                    darkMode: true,
                    profileVisibility: 'public',
                    onlineStatus: true,
                    readReceipts: true,
                    activityStatus: true,
                    pushNotifications: true,
                    emailNotifications: false,
                    messageNotifications: true,
                    friendRequestNotifications: true,
                    moodChangeNotifications: true,
                    interestMatchNotifications: true
                };

                this.userSettings = defaultSettings;
                await this.saveAllSettings();
                this.applySettingsToUI();
                this.notifySettingsChange();
            }

            applySettingsToUI() {
                console.log("üé® Applying settings to UI:", this.userSettings);
                
                // Apply theme
                if (this.userSettings.theme) {
                    this.applyTheme(this.userSettings.theme);
                }
                
                // Apply toggle states
                const toggleMappings = {
                    'darkModeToggle': 'darkMode',
                    'onlineStatusToggle': 'onlineStatus',
                    'readReceiptsToggle': 'readReceipts',
                    'activityStatusToggle': 'activityStatus',
                    'pushNotificationsToggle': 'pushNotifications',
                    'emailNotificationsToggle': 'emailNotifications',
                    'messageNotificationsToggle': 'messageNotifications',
                    'friendRequestNotificationsToggle': 'friendRequestNotifications',
                    'moodChangeNotificationsToggle': 'moodChangeNotifications',
                    'interestMatchNotificationsToggle': 'interestMatchNotifications'
                };

                Object.entries(toggleMappings).forEach(([elementId, settingKey]) => {
                    const element = document.getElementById(elementId);
                    if (element && this.userSettings[settingKey] !== undefined) {
                        element.checked = this.userSettings[settingKey];
                    }
                });
                
                // Apply select values
                if (this.userSettings.profileVisibility) {
                    document.getElementById('profileVisibility').value = this.userSettings.profileVisibility;
                }
            }

            applyTheme(theme) {
                // Remove all theme classes
                document.body.classList.remove('blue-theme', 'purple-theme', 'green-theme', 'dark-theme', 'cyber-theme', 'red-theme');
                
                // Add selected theme
                document.body.classList.add(theme);
                
                // Update active theme indicator
                document.querySelectorAll('.theme-option').forEach(option => {
                    option.classList.remove('active');
                    if (option.getAttribute('data-theme') === theme) {
                        option.classList.add('active');
                    }
                });
                
                // Save theme to localStorage for cross-page consistency
                localStorage.setItem('uniconnect-theme', theme);
            }

            async saveSetting(key, value) {
                if (!this.currentUser) {
                    console.error("‚ùå Cannot save setting: No user authenticated");
                    return;
                }
                
                try {
                    console.log(`üíæ Saving setting: ${key} = ${value}`);
                    
                    // Update local settings
                    this.userSettings[key] = value;
                    
                    // Save to Firebase
                    await db.collection('users').doc(this.currentUser.uid).set({
                        settings: this.userSettings
                    }, { merge: true });
                    
                    console.log(`‚úÖ Setting saved: ${key} = ${value}`);
                    
                    // Also save to localStorage as backup
                    localStorage.setItem('uniconnectSettings', JSON.stringify(this.userSettings));
                    
                    // Notify listeners about settings change
                    this.notifySettingsChange();
                } catch (error) {
                    console.error('‚ùå Error saving setting:', error);
                    this.showNotification('Failed to save setting. Please try again.', 'error');
                }
            }

            async saveAllSettings() {
                if (!this.currentUser) return;
                
                try {
                    await db.collection('users').doc(this.currentUser.uid).set({
                        settings: this.userSettings
                    }, { merge: true });
                    
                    console.log("‚úÖ All settings saved to Firebase");
                    
                    // Notify listeners about settings change
                    this.notifySettingsChange();
                } catch (error) {
                    console.error('‚ùå Error saving all settings:', error);
                }
            }

            // Add listener for settings changes
            addSettingsListener(callback) {
                this.settingsListeners.push(callback);
            }

            // Notify all listeners about settings changes
            notifySettingsChange() {
                this.settingsListeners.forEach(callback => {
                    try {
                        callback(this.userSettings);
                    } catch (error) {
                        console.error('Error in settings listener:', error);
                    }
                });
            }

            async updateDisplayName(newName) {
                if (!this.currentUser || !newName.trim()) {
                    this.showNotification('Please enter a valid display name', 'error');
                    return;
                }
                
                try {
                    console.log(`üîÑ Updating display name to: ${newName.trim()}`);
                    
                    await db.collection('users').doc(this.currentUser.uid).set({
                        profile: {
                            displayName: newName.trim(),
                            updatedAt: new Date()
                        }
                    }, { merge: true });
                    
                    // Update local data and UI
                    this.userData.profile = this.userData.profile || {};
                    this.userData.profile.displayName = newName.trim();
                    this.updateUserInterface();
                    
                    this.showNotification('Display name updated successfully!', 'success');
                    
                    // Close modal
                    document.getElementById('editNameModal').classList.add('hidden');
                } catch (error) {
                    console.error('‚ùå Error updating display name:', error);
                    this.showNotification('Failed to update display name. Please try again.', 'error');
                }
            }

            async exportUserData() {
                if (!this.currentUser) return;
                
                try {
                    console.log("üì§ Exporting user data...");
                    this.showNotification("Preparing your data export...", "info");
                    
                    // Get all user data
                    const userDoc = await db.collection('users').doc(this.currentUser.uid).get();
                    const userData = userDoc.exists ? userDoc.data() : {};
                    
                    // Create downloadable file
                    const dataStr = JSON.stringify(userData, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `uniconnect-data-${this.currentUser.uid}-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    this.showNotification('Data exported successfully!', 'success');
                } catch (error) {
                    console.error('‚ùå Error exporting data:', error);
                    this.showNotification('Failed to export data. Please try again.', 'error');
                }
            }

            async deleteUserAccount(password) {
                if (!this.currentUser || !password) return;
                
                try {
                    console.log("üóëÔ∏è Deleting user account...");
                    this.showNotification("Deleting your account...", "info");
                    
                    // Re-authenticate user
                    const credential = firebase.auth.EmailAuthProvider.credential(
                        this.currentUser.email, 
                        password
                    );
                    
                    await this.currentUser.reauthenticateWithCredential(credential);
                    
                    // Delete user data from Firestore
                    await db.collection('users').doc(this.currentUser.uid).delete();
                    
                    // Delete user from Firebase Auth
                    await this.currentUser.delete();
                    
                    this.showNotification('Account deleted successfully. Redirecting...', 'success');
                    
                    // Redirect to home page after delay
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                    
                } catch (error) {
                    console.error('‚ùå Error deleting account:', error);
                    
                    if (error.code === 'auth/wrong-password') {
                        this.showNotification('Incorrect password. Please try again.', 'error');
                    } else {
                        this.showNotification('Failed to delete account. Please try again.', 'error');
                    }
                }
            }

            setupEventListeners() {
                console.log("üîß Setting up event listeners...");
                
                // Mobile menu functionality
                const mobileMenuButton = document.getElementById('mobileMenuButton');
                const closeMobileMenu = document.getElementById('closeMobileMenu');
                const mobileMenu = document.getElementById('mobileMenu');
                const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
                
                if (mobileMenuButton && mobileMenu && mobileMenuOverlay && closeMobileMenu) {
                    mobileMenuButton.addEventListener('click', () => {
                        mobileMenu.classList.add('open');
                        mobileMenuOverlay.classList.add('open');
                    });
                    
                    closeMobileMenu.addEventListener('click', () => {
                        mobileMenu.classList.remove('open');
                        mobileMenuOverlay.classList.remove('open');
                    });
                    
                    mobileMenuOverlay.addEventListener('click', () => {
                        mobileMenu.classList.remove('open');
                        mobileMenuOverlay.classList.remove('open');
                    });
                }
                
                // Theme selection
                document.querySelectorAll('.theme-option').forEach(option => {
                    option.addEventListener('click', () => {
                        const theme = option.getAttribute('data-theme');
                        this.applyTheme(theme);
                        this.saveSetting('theme', theme);
                    });
                });
                
                // Toggle switches
                const toggleMappings = {
                    'darkModeToggle': 'darkMode',
                    'onlineStatusToggle': 'onlineStatus',
                    'readReceiptsToggle': 'readReceipts',
                    'activityStatusToggle': 'activityStatus',
                    'pushNotificationsToggle': 'pushNotifications',
                    'emailNotificationsToggle': 'emailNotifications',
                    'messageNotificationsToggle': 'messageNotifications',
                    'friendRequestNotificationsToggle': 'friendRequestNotifications',
                    'moodChangeNotificationsToggle': 'moodChangeNotifications',
                    'interestMatchNotificationsToggle': 'interestMatchNotifications'
                };

                Object.entries(toggleMappings).forEach(([elementId, settingKey]) => {
                    const element = document.getElementById(elementId);
                    if (element) {
                        element.addEventListener('change', (e) => {
                            this.saveSetting(settingKey, e.target.checked);
                        });
                    }
                });
                
                // Profile visibility
                document.getElementById('profileVisibility').addEventListener('change', (e) => {
                    this.saveSetting('profileVisibility', e.target.value);
                });
                
                // Edit name functionality
                document.getElementById('editNameBtn').addEventListener('click', () => {
                    document.getElementById('editNameModal').classList.remove('hidden');
                    document.getElementById('newDisplayName').value = document.getElementById('displayName').textContent;
                    document.getElementById('newDisplayName').focus();
                });
                
                document.getElementById('closeEditNameModal').addEventListener('click', () => {
                    document.getElementById('editNameModal').classList.add('hidden');
                });
                
                document.getElementById('cancelEditName').addEventListener('click', () => {
                    document.getElementById('editNameModal').classList.add('hidden');
                });
                
                document.getElementById('saveDisplayName').addEventListener('click', () => {
                    const newName = document.getElementById('newDisplayName').value;
                    this.updateDisplayName(newName);
                });
                
                // Data management
                document.getElementById('exportDataBtn').addEventListener('click', () => {
                    this.exportUserData();
                });
                
                document.getElementById('clearCacheBtn').addEventListener('click', () => {
                    localStorage.clear();
                    sessionStorage.clear();
                    this.showNotification('Cache cleared successfully!', 'success');
                });
                
                document.getElementById('deleteAccountBtn').addEventListener('click', () => {
                    document.getElementById('deleteAccountModal').classList.remove('hidden');
                    document.getElementById('confirmPassword').value = '';
                    document.getElementById('confirmPassword').focus();
                });
                
                // Delete account modal
                document.getElementById('closeDeleteModal').addEventListener('click', () => {
                    document.getElementById('deleteAccountModal').classList.add('hidden');
                });
                
                document.getElementById('cancelDelete').addEventListener('click', () => {
                    document.getElementById('deleteAccountModal').classList.add('hidden');
                });
                
                document.getElementById('confirmDelete').addEventListener('click', () => {
                    const password = document.getElementById('confirmPassword').value;
                    if (!password) {
                        this.showNotification('Please enter your password', 'error');
                        return;
                    }
                    this.deleteUserAccount(password);
                });
                
                // Logout
                document.getElementById('logoutBtn').addEventListener('click', () => {
                    auth.signOut().then(() => {
                        console.log("üëã User signed out");
                        window.location.href = 'index.html';
                    }).catch(error => {
                        console.error('‚ùå Error signing out:', error);
                        this.showNotification('Error signing out. Please try again.', 'error');
                    });
                });

                // Enter key support for modals
                document.getElementById('newDisplayName').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        document.getElementById('saveDisplayName').click();
                    }
                });

                document.getElementById('confirmPassword').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        document.getElementById('confirmDelete').click();
                    }
                });

                console.log("‚úÖ Event listeners setup complete");
            }

            updateConnectionStatus(status) {
                const statusElement = document.getElementById('connectionStatus');
                const firebaseStatus = document.getElementById('firebaseStatus');
                const databaseStatus = document.getElementById('databaseStatus');
                
                statusElement.className = `connection-status ${status}`;
                
                switch(status) {
                    case 'connected':
                        statusElement.innerHTML = '<i class="fas fa-wifi mr-2"></i><span id="connectionText">Connected to Firebase</span>';
                        if (firebaseStatus) {
                            firebaseStatus.textContent = 'Connected';
                            firebaseStatus.className = 'text-green-400';
                        }
                        if (databaseStatus) {
                            databaseStatus.textContent = 'Online';
                            databaseStatus.className = 'text-green-400';
                        }
                        break;
                    case 'connecting':
                        statusElement.innerHTML = '<i class="fas fa-circle-notch fa-spin mr-2"></i><span id="connectionText">Connecting to Firebase...</span>';
                        if (firebaseStatus) {
                            firebaseStatus.textContent = 'Connecting';
                            firebaseStatus.className = 'text-yellow-400';
                        }
                        if (databaseStatus) {
                            databaseStatus.textContent = 'Loading...';
                            databaseStatus.className = 'text-yellow-400';
                        }
                        break;
                    case 'disconnected':
                        statusElement.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i><span id="connectionText">Disconnected from Firebase</span>';
                        if (firebaseStatus) {
                            firebaseStatus.textContent = 'Disconnected';
                            firebaseStatus.className = 'text-red-400';
                        }
                        if (databaseStatus) {
                            databaseStatus.textContent = 'Offline';
                            databaseStatus.className = 'text-red-400';
                        }
                        break;
                }
            }

            showNotification(message, type = 'success') {
                // Create notification element
                const notification = document.createElement('div');
                notification.className = `fixed top-4 left-1/2 transform -translate-x-1/2 p-4 rounded-2xl glass-effect border ${
                    type === 'success' ? 'border-green-500 text-green-400' : 
                    type === 'error' ? 'border-red-500 text-red-400' : 
                    'border-blue-500 text-blue-400'
                } z-50 max-w-sm transition-all duration-300 opacity-0 transform -translate-y-2`;
                notification.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <i class="fas ${
                            type === 'success' ? 'fa-check-circle' : 
                            type === 'error' ? 'fa-exclamation-circle' : 
                            'fa-info-circle'
                        }"></i>
                        <p class="text-sm">${message}</p>
                    </div>
                `;
                
                // Add to page
                document.body.appendChild(notification);
                
                // Animate in
                setTimeout(() => {
                    notification.classList.remove('opacity-0', '-translate-y-2');
                    notification.classList.add('opacity-100', 'translate-y-0');
                }, 10);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    notification.classList.remove('opacity-100', 'translate-y-0');
                    notification.classList.add('opacity-0', '-translate-y-2');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }

            async loadUserSettings() {
                // Load settings from localStorage as fallback
                const savedSettings = localStorage.getItem('uniconnectSettings');
                if (savedSettings) {
                    this.userSettings = { ...this.userSettings, ...JSON.parse(savedSettings) };
                    this.applySettingsToUI();
                }
                
                // Load moods from localStorage as fallback
                const savedMoods = localStorage.getItem('uniconnectMoods');
                if (savedMoods) {
                    const moodData = JSON.parse(savedMoods);
                    this.selectedMoods = moodData.selectedMoods || [];
                    this.selectedInterests = moodData.selectedInterests || [];
                    this.updateMoodUI();
                }
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üöÄ DOM loaded, initializing Settings Application...");
            window.settingsApp = new SettingsApplication();
            window.settingsApp.initialize().catch(error => {
                console.error("‚ùå Failed to initialize application:", error);
            });
        });
    </script>
</body>
</html>