
<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#4F46E5">
    <link rel="icon" href="../icons/moodchat-192.png">
    <link rel="icon" href="../icons/moodchat-512.png">
    <meta name="theme-color" content="#000000">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Settings | Knecta Chat</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Color Picker Library -->
    <script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/nano.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-color: #0084ff;
            --primary-dark: #0066cc;
            --secondary-color: #f0f2f5;
            --secondary-dark: #e4e6e9;
            --danger-color: #ff3b30;
            --danger-dark: #d70015;
            --success-color: #34c759;
            --warning-color: #ff9500;
            --info-color: #5ac8fa;
            --text-primary: #050505;
            --text-secondary: #65676b;
            --text-tertiary: #8e8e93;
            --bg-color: #ffffff;
            --bg-secondary: #f8f9fa;
            --border-color: #dddfe2;
            --border-light: #e9ebee;
            --settings-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.2);
            --shadow-inner: inset 0 1px 3px rgba(0, 0, 0, 0.1);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-full: 9999px;
            
            /* Mood Colors */
            --mood-happy: #FFD700;
            --mood-calm: #4A90E2;
            --mood-energetic: #FF6B6B;
            --mood-focused: #7B68EE;
            --mood-relaxed: #4ECDC4;
            --mood-stressed: #FF8C00;
            --mood-tired: #A9A9A9;
            --mood-excited: #FF1493;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
            position: relative;
        }
        
        /* Sidebar Styles */
        .settings-sidebar {
            width: 280px;
            background-color: var(--bg-color);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .settings-header {
            padding: 20px;
            background: var(--settings-gradient);
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-shrink: 0;
        }
        
        .back-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        
        .back-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .settings-title {
            font-size: 20px;
            font-weight: 600;
        }
        
        .settings-user-profile {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 15px;
            flex-shrink: 0;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: var(--text-secondary);
            overflow: hidden;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .user-status {
            font-size: 13px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--success-color);
        }
        
        .settings-search {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        
        .search-container {
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            background-color: var(--secondary-color);
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            background-color: var(--bg-color);
        }
        
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }
        
        .settings-menu {
            flex: 1;
            overflow-y: auto;
            padding: 10px 0;
        }
        
        .menu-section {
            margin-bottom: 20px;
        }
        
        .section-title {
            padding: 10px 20px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-tertiary);
            font-weight: 600;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            gap: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
            text-decoration: none;
            color: inherit;
            border-left: 3px solid transparent;
        }
        
        .menu-item:hover {
            background-color: var(--secondary-color);
        }
        
        .menu-item.active {
            background-color: rgba(0, 132, 255, 0.05);
            border-left-color: var(--primary-color);
        }
        
        .menu-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 16px;
        }
        
        .menu-item.active .menu-icon {
            color: var(--primary-color);
        }
        
        .menu-text {
            flex: 1;
            font-size: 14px;
            font-weight: 500;
        }
        
        .menu-badge {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            background-color: var(--secondary-color);
            color: var(--text-secondary);
        }
        
        .menu-item.active .menu-badge {
            background-color: var(--primary-color);
            color: white;
        }
        
        /* Settings Content */
        .settings-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background-color: var(--bg-secondary);
        }
        
        .content-header {
            padding: 20px;
            background-color: var(--bg-color);
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .content-title {
            font-size: 22px;
            font-weight: 600;
        }
        
        .content-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        .content-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .action-btn.primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .action-btn.primary:hover {
            background-color: var(--primary-dark);
        }
        
        .action-btn.secondary {
            background-color: var(--secondary-color);
            color: var(--text-primary);
        }
        
        .action-btn.secondary:hover {
            background-color: var(--secondary-dark);
        }
        
        .action-btn.danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .action-btn.danger:hover {
            background-color: var(--danger-dark);
        }
        
        .content-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .settings-section {
            background-color: var(--bg-color);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .section-header {
            padding: 18px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .section-header h3 {
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-icon {
            color: var(--text-secondary);
        }
        
        .section-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 5px;
            max-width: 800px;
        }
        
        .section-body {
            padding: 20px;
        }
        
        .setting-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-light);
        }
        
        .setting-item:last-child {
            border-bottom: none;
        }
        
        .setting-info {
            flex: 1;
            min-width: 0;
        }
        
        .setting-label {
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .setting-label-icon {
            color: var(--text-tertiary);
            font-size: 12px;
        }
        
        .setting-description {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.4;
        }
        
        .setting-control {
            margin-left: 20px;
            flex-shrink: 0;
        }
        
        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 28px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-color);
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }
        
        input:disabled + .toggle-slider {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Dropdown */
        .setting-dropdown {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--bg-color);
            font-size: 14px;
            min-width: 150px;
            cursor: pointer;
        }
        
        .setting-dropdown:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        /* Input Fields */
        .setting-input {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--bg-color);
            font-size: 14px;
            width: 200px;
            transition: all 0.2s;
        }
        
        .setting-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 132, 255, 0.1);
        }
        
        .setting-textarea {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            resize: vertical;
            font-family: inherit;
        }
        
        .setting-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 132, 255, 0.1);
        }
        
        /* Button Styles */
        .setting-button {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--bg-color);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .setting-button:hover {
            background-color: var(--secondary-color);
        }
        
        .setting-button.primary {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .setting-button.primary:hover {
            background-color: var(--primary-dark);
        }
        
        /* Radio Buttons */
        .radio-group {
            display: flex;
            gap: 20px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .radio-input {
            width: 18px;
            height: 18px;
            accent-color: var(--primary-color);
            cursor: pointer;
        }
        
        .radio-label {
            font-size: 14px;
            cursor: pointer;
        }
        
        /* Slider */
        .setting-slider {
            width: 200px;
            height: 4px;
            -webkit-appearance: none;
            appearance: none;
            background: var(--border-color);
            border-radius: 2px;
            outline: none;
        }
        
        .setting-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
        }
        
        .setting-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: none;
        }
        
        /* Color Picker */
        .color-picker {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid var(--border-color);
        }
        
        /* Layout Previews */
        .layout-previews {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .layout-preview {
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s;
            background-color: var(--bg-color);
        }
        
        .layout-preview:hover {
            border-color: var(--primary-color);
        }
        
        .layout-preview.selected {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 132, 255, 0.1);
        }
        
        .preview-thumbnail {
            width: 100%;
            aspect-ratio: 1;
            background-color: var(--secondary-color);
            border-radius: var(--radius-sm);
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
        }
        
        .preview-title {
            font-size: 12px;
            font-weight: 500;
            text-align: center;
        }
        
        /* Storage Progress */
        .storage-info {
            margin-bottom: 20px;
        }
        
        .storage-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .storage-label {
            font-size: 14px;
            font-weight: 500;
        }
        
        .storage-value {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .storage-bar {
            height: 8px;
            background-color: var(--secondary-color);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .storage-fill {
            height: 100%;
            background: var(--settings-gradient);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        /* Mood Colors */
        .mood-colors-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .mood-color-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .mood-color-preview {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .mood-color-item.active .mood-color-preview {
            border-color: var(--text-primary);
            transform: scale(1.1);
        }
        
        .mood-color-label {
            font-size: 12px;
            font-weight: 500;
            text-align: center;
        }
        
        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-container {
            width: 90%;
            max-width: 500px;
            background-color: var(--bg-color);
            border-radius: var(--radius-lg);
            overflow: hidden;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-lg);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-header h3 {
            font-size: 18px;
            font-weight: 600;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--text-secondary);
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        
        .modal-close:hover {
            background-color: var(--secondary-color);
        }
        
        .modal-body {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        /* Photo Upload */
        .photo-upload-container {
            text-align: center;
            padding: 30px 20px;
        }
        
        .photo-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            margin: 0 auto 20px;
            background-size: cover;
            background-position: center;
            position: relative;
            cursor: pointer;
            border: 4px solid var(--bg-color);
            box-shadow: var(--shadow);
        }
        
        .photo-change-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .photo-preview:hover .photo-change-overlay {
            opacity: 1;
        }
        
        /* Sessions List */
        .sessions-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .session-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border-light);
        }
        
        .session-item:last-child {
            border-bottom: none;
        }
        
        .session-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background-color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: var(--text-secondary);
            margin-right: 15px;
        }
        
        .session-info {
            flex: 1;
        }
        
        .session-device {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .session-details {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .session-actions {
            display: flex;
            gap: 10px;
        }
        
        /* Blocked Users */
        .blocked-users-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .blocked-user-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border-light);
        }
        
        .blocked-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            margin-right: 15px;
            background-size: cover;
            background-position: center;
        }
        
        .blocked-user-info {
            flex: 1;
        }
        
        .blocked-user-name {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .blocked-user-details {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        .empty-state p {
            margin-bottom: 10px;
        }
        
        /* Danger Zone */
        .danger-zone {
            border: 2px solid var(--danger-color);
            border-radius: var(--radius-md);
            padding: 20px;
            background-color: rgba(255, 59, 48, 0.05);
        }
        
        .danger-zone .setting-item {
            border-bottom-color: rgba(255, 59, 48, 0.2);
        }
        
        .danger-zone .setting-label {
            color: var(--danger-color);
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .settings-sidebar {
                width: 240px;
            }
        }
        
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .settings-sidebar {
                width: 100%;
                height: auto;
                max-height: 50vh;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
            
            .settings-content {
                height: 50vh;
            }
            
            .layout-previews {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .mood-colors-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .layout-previews {
                grid-template-columns: 1fr;
            }
            
            .mood-colors-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .content-actions {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .setting-control {
                margin-left: 10px;
            }
            
            .setting-input {
                width: 150px;
            }
        }
        
        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Success/Error States */
        .success-message {
            color: var(--success-color);
            font-size: 12px;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .error-message {
            color: var(--danger-color);
            font-size: 12px;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Shortcut Preview */
        .shortcut-preview {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background-color: var(--secondary-color);
            border-radius: var(--radius-sm);
            margin-top: 10px;
        }
        
        .shortcut-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary-color);
            color: white;
            border-radius: 6px;
            font-size: 12px;
        }
        
        .shortcut-name {
            font-size: 13px;
            font-weight: 500;
        }
        
        /* Theme Preview */
        .theme-preview {
            width: 100px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin: 10px 0;
        }
        
        .theme-light {
            background: linear-gradient(to bottom, #ffffff 50%, #f0f2f5 50%);
        }
        
        .theme-dark {
            background: linear-gradient(to bottom, #1c1c1e 50%, #000000 50%);
        }
        
        .theme-auto {
            background: linear-gradient(to right, #ffffff 50%, #1c1c1e 50%);
        }
        
        /* Interactive Elements */
        .interactive-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .interactive-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid var(--border-light);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .interactive-item:hover {
            background-color: var(--secondary-color);
        }
        
        .interactive-item.selected {
            background-color: rgba(0, 132, 255, 0.1);
        }
        
        .interactive-checkbox {
            width: 18px;
            height: 18px;
            margin-right: 10px;
            accent-color: var(--primary-color);
        }
        
        .interactive-label {
            flex: 1;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Modals -->
    <div class="modal-overlay" id="changePhotoModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3>Change Profile Photo</h3>
                <button class="modal-close" id="closePhotoModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="photo-upload-container">
                    <div class="photo-preview" id="photoPreview">
                        <div class="photo-change-overlay">
                            <i class="fas fa-camera"></i>
                        </div>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <p style="margin-bottom: 10px; color: var(--text-secondary); font-size: 14px;">
                            Choose a new profile photo
                        </p>
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button class="action-btn secondary" id="takePhotoBtn">
                                <i class="fas fa-camera"></i> Take Photo
                            </button>
                            <button class="action-btn secondary" id="choosePhotoBtn">
                                <i class="fas fa-images"></i> Choose from Gallery
                            </button>
                        </div>
                    </div>
                    <div style="border-top: 1px solid var(--border-color); padding-top: 20px;">
                        <button class="action-btn danger" id="removePhotoBtn" style="width: 100%;">
                            <i class="fas fa-trash"></i> Remove Current Photo
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="action-btn secondary" id="cancelPhotoBtn">Cancel</button>
                <button class="action-btn primary" id="savePhotoBtn">Save Photo</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="changePasswordModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3>Change Password</h3>
                <button class="modal-close" id="closePasswordModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500;">
                            Current Password
                        </label>
                        <input type="password" class="setting-input" id="currentPassword" style="width: 100%;" 
                               placeholder="Enter current password">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500;">
                            New Password
                        </label>
                        <input type="password" class="setting-input" id="newPassword" style="width: 100%;" 
                               placeholder="Enter new password">
                        <div class="error-message" id="passwordError" style="display: none;"></div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500;">
                            Confirm New Password
                        </label>
                        <input type="password" class="setting-input" id="confirmPassword" style="width: 100%;" 
                               placeholder="Confirm new password">
                    </div>
                    <div style="background-color: rgba(0, 132, 255, 0.1); padding: 12px; border-radius: 6px; margin-top: 20px;">
                        <p style="font-size: 12px; color: var(--text-secondary); margin-bottom: 5px;">
                            <i class="fas fa-info-circle"></i> Password Requirements:
                        </p>
                        <ul style="font-size: 12px; color: var(--text-secondary); padding-left: 20px;">
                            <li>At least 8 characters long</li>
                            <li>Include uppercase and lowercase letters</li>
                            <li>Include at least one number</li>
                            <li>Include at least one special character</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="action-btn secondary" id="cancelPasswordBtn">Cancel</button>
                <button class="action-btn primary" id="savePasswordBtn">Change Password</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="sessionsModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3>Active Sessions</h3>
                <button class="modal-close" id="closeSessionsModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="sessions-list" id="sessionsList">
                    <!-- Sessions will be loaded here -->
                </div>
                <div style="border-top: 1px solid var(--border-color); padding-top: 20px; margin-top: 20px;">
                    <button class="action-btn danger" id="terminateAllSessionsBtn" style="width: 100%;">
                        <i class="fas fa-sign-out-alt"></i> Terminate All Other Sessions
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="action-btn secondary" id="closeSessionsBtn">Close</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="blockedUsersModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3>Blocked Users</h3>
                <button class="modal-close" id="closeBlockedModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="blocked-users-list" id="blockedUsersList">
                    <!-- Blocked users will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="action-btn secondary" id="closeBlockedBtn">Close</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="confirmationModal">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="confirmationTitle">Confirm Action</h3>
                <button class="modal-close" id="closeConfirmationModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p id="confirmationMessage">Are you sure you want to perform this action?</p>
            </div>
            <div class="modal-footer">
                <button class="action-btn secondary" id="cancelConfirmationBtn">Cancel</button>
                <button class="action-btn danger" id="confirmActionBtn">Confirm</button>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Operation completed successfully</span>
    </div>
    
    <!-- Main App Container -->
    <div class="app-container">
        <!-- Settings Sidebar -->
        <div class="settings-sidebar">
            <div class="settings-header">
                <button class="back-btn" id="backToAppBtn">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="settings-title">Settings</div>
            </div>
            
            <div class="settings-user-profile">
                <div class="user-avatar" id="userAvatarPreview">
                    <!-- User avatar will be loaded here -->
                </div>
                <div class="user-info">
                    <div class="user-name" id="userNamePreview">Loading...</div>
                    <div class="user-status">
                        <div class="status-indicator" id="userStatusIndicator"></div>
                        <span id="userStatusText">Online</span>
                    </div>
                </div>
            </div>
            
            <div class="settings-search">
                <div class="search-container">
                    <input type="text" class="search-input" id="settingsSearch" placeholder="Search settings...">
                    <i class="fas fa-search search-icon"></i>
                </div>
            </div>
            
            <div class="settings-menu" id="settingsMenu">
                <!-- Menu items will be dynamically generated -->
            </div>
        </div>
        
        <!-- Settings Content Area -->
        <div class="settings-content">
            <div class="content-header">
                <div>
                    <div class="content-title" id="contentTitle">Profile Settings</div>
                    <div class="content-subtitle" id="contentSubtitle">Manage your personal information and account settings</div>
                </div>
                <div class="content-actions">
                    <button class="action-btn secondary" id="resetSectionBtn">
                        <i class="fas fa-undo"></i> Reset Section
                    </button>
                    <button class="action-btn primary" id="saveSectionBtn">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>
            </div>
            
            <div class="content-body" id="settingsContent">
                <!-- Settings content will be dynamically loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Color Picker (hidden) -->
    <div id="colorPickerContainer" style="display: none;"></div>

    <script>
        // =============================================
        // SETTINGS SYSTEM - COMPLETE IMPLEMENTATION
        // =============================================
        
        // Global variables
        let currentUser = null;
        let userSettings = {};
        let currentSection = 'profile';
        let unsavedChanges = false;
        let colorPicker = null;
        let blockedUsers = [];
        let activeSessions = [];
        let userContacts = [];
        let userGroups = [];
        
        // Default settings structure (222 features organized by section)
        const DEFAULT_SETTINGS = {
            // PROFILE SECTION (22 features)
            profile: {
                photoUrl: '',
                displayName: '',
                username: '',
                bio: '',
                phoneNumber: '',
                email: '',
                currentMood: 'neutral',
                currentMoodText: '',
                profileVisibility: 'everyone', // everyone/friendsOnly/nobody
                lastSeen: true,
                onlineStatus: true,
                profilePhotoVisibility: 'everyone'
            },
            
            // SECURITY SECTION (11 features)
            security: {
                twoFactorAuth: false,
                loginNotifications: true,
                sessionTimeout: '30min', // 15min/30min/1hr/8hr/never
                appLock: false,
                screenCaptureProtection: true,
                encryption: true,
                biometricBypass: true,
                timeoutWarnings: true,
                enhancedTimeout: false,
                lockScreenAfter: '5min', // 1min/5min/15min/30min/never
                logoutAfter: '8hr' // 1hr/4hr/8hr/24hr/never
            },
            
            // PRIVACY SECTION (25 features)
            privacy: {
                whoCanAddMe: 'everyone', // everyone/friendsOfFriends/nobody
                readReceipts: true,
                typingIndicators: true,
                messageForwarding: true,
                contactDiscovery: true,
                canMessageMe: 'everyone',
                canCallMe: 'everyone',
                canSeeMyStatus: 'friendsOnly',
                canSeeProfilePhoto: 'everyone',
                canSeeLastSeen: 'friendsOnly',
                canForwardMessages: 'friendsOnly',
                canTakeScreenshots: false,
                blockedUsers: []
            },
            
            // CHAT SECTION (12 features)
            chat: {
                chatWallpaper: 'default',
                enterKeySends: true,
                mediaAutoDownload: 'wifiOnly', // wifiOnly/always/never
                saveToCameraRoll: true,
                messageHistory: 'forever', // forever/30days/7days/24hours
                disappearingMessages: 'off', // off/1hour/1day/7days/30days
                smartReplies: true,
                messageTranslation: false,
                chatSummarization: false,
                spamDetection: true,
                messageApprovalMode: false,
                keywordFiltering: false
            },
            
            // FRIENDS SECTION (10 features)
            friends: {
                discoverByPhone: true,
                discoverByEmail: true,
                nearbyDiscovery: false,
                qrCodeScanner: true,
                friendSuggestions: true,
                temporaryFriends: true,
                friendshipNotes: true,
                friendCategories: true,
                trustScore: true,
                friendAnalytics: true
            },
            
            // GROUPS SECTION (15 features)
            groups: {
                autoJoinGroups: false,
                groupInvitations: 'everyone', // everyone/friendsOnly/nobody
                groupPrivacy: 'everyone', // everyone/myApprovalRequired
                groupAnnouncements: true,
                autoDownloadGroupMedia: 'wifiOnly',
                messageApprovalModeGroup: false,
                keywordFilteringGroup: false,
                groupSpamDetection: true,
                memberWarnings: true,
                activityTracking: true,
                topContributors: true,
                messageVolumeAnalytics: true,
                groupDataCache: 'activeGroupsOnly' // activeGroupsOnly/allGroups/noGroupCache
            },
            
            // CALLS SECTION (18 features)
            calls: {
                whoCanCallMe: 'everyone', // everyone/friendsOnly/nobody
                callVerification: true,
                ringtone: 'default', // default/classic/modern/custom
                callVibration: true,
                autoAnswer: false,
                videoQuality: 'auto', // auto/high/medium/low
                cameraDefault: 'front', // front/back
                noiseCancellation: true,
                echoCancellation: true,
                liveReactions: true,
                inCallChat: true,
                sharedWhiteboard: true,
                sharedNotes: true,
                polls: true,
                callHistoryCache: '90days' // 30days/90days/180days/all
            },
            
            // STATUS SECTION (12 features)
            status: {
                whoCanViewMyStatus: 'friendsOnly', // everyone/friendsOnly/selectedFriends/nobody
                autoExpireStatus: '24h', // 24h/12h/6h/1h/custom
                replyPermissions: 'friendsOnly', // everyone/friendsOnly/nobody
                downloadPermissions: false,
                hideFromSpecificUsers: [],
                viewCount: true,
                viewerList: true,
                engagementReactions: true,
                autoCaptions: false,
                aiEnhancement: false,
                statusScheduling: false,
                statusCache: '24hours' // 24hours/7days/none
            },
            
            // NOTIFICATIONS SECTION (13 features)
            notifications: {
                messageNotifications: true,
                groupNotifications: true,
                friendRequestNotifications: true,
                callNotifications: true,
                statusNotifications: true,
                notificationSound: true,
                vibration: true,
                popupNotifications: true,
                notificationLight: true,
                doNotDisturb: false,
                schedule: 'custom', // custom/night/workHours
                allowCalls: true,
                allowMessagesFrom: 'everyone' // everyone/selectedContacts
            },
            
            // APPEARANCE SECTION (13 features)
            appearance: {
                theme: 'auto', // light/dark/auto
                accentColor: '#0084ff',
                fontSize: 16, // 12-20px
                reduceMotion: false,
                language: 'en', // en/es/fr/de/zh/ar
                timeFormat: '12-hour', // 12-hour/24-hour
                dateFormat: 'MM/DD/YYYY', // MM/DD/YYYY/DD/MM/YYYY/YYYY-MM-DD
                layoutMode: 'auto', // compact/detailed/focus/auto
                moodBasedLayouts: true,
                customIcons: false,
                chatIcon: 'default',
                callIcon: 'default',
                statusIcon: 'default',
                buttonStyles: 'rounded' // rounded/square/pill/floating
            },
            
            // STORAGE SECTION (7 features)
            storage: {
                autoClearCache: 'never', // never/weekly/monthly
                chatCacheSize: 0,
                mediaCacheSize: 0,
                otherCacheSize: 0,
                totalStorageUsed: 0,
                storageTotal: 1024 * 1024 * 1024, // 1GB default
                storageBreakdown: {
                    chats: 0,
                    media: 0,
                    other: 0
                }
            },
            
            // MOOD SETTINGS SECTION (24 features)
            mood: {
                moodLinkedTheme: true,
                moodColors: {
                    happy: '#FFD700',
                    calm: '#4A90E2',
                    energetic: '#FF6B6B',
                    focused: '#7B68EE',
                    relaxed: '#4ECDC4',
                    stressed: '#FF8C00',
                    tired: '#A9A9A9',
                    excited: '#FF1493'
                },
                currentMood: 'neutral',
                manualMoodOverride: 'autoDetect', // autoDetect/happy/calm/etc
                smartNotifications: true,
                stressedModeRules: true,
                focusedModeRules: true,
                happyModeRules: true,
                autoMoodDetection: true,
                updateAfterCalls: true,
                updateAfterStatusPosts: true,
                updateAfterActivity: true,
                moodPrivacyRules: true,
                tiredMoodRule: true,
                stressedMoodRule: true,
                happyMoodRule: true,
                ruleDuration: '6hr' // 2hr/6hr/24hr/untilMoodChanges
            },
            
            // SMART ACTIVITY SECTION (18 features)
            activity: {
                focusMode: false,
                focusDuration: '1hr', // 30min/1hr/2hr/custom
                focusModeEssentialContacts: true,
                focusModeUrgentCalls: true,
                focusModeWorkMessages: true,
                focusModeFamilyMessages: true,
                autoEnableFocusMode: false,
                autoArchiveChats: false,
                inactivityPeriod: '90', // 30/60/90/180 days
                excludeImportantChats: true,
                archiveNotifications: true,
                offlineDataControl: 'balanced', // minimal/balanced/extended/custom
                chatPageCache: '30days', // 7days/30days/90days/all
                callHistoryCacheActivity: '90days',
                groupDataCacheActivity: 'activeGroupsOnly',
                statusCacheActivity: '7days'
            },
            
            // INTERACTION INTELLIGENCE SECTION (23 features)
            intelligence: {
                smartVisibility: true,
                visibleToGroups: [],
                visibleToContacts: [],
                timeBasedVisibility: false,
                activityBasedVisibility: true,
                interactionAnalytics: true,
                mostContacted: 0,
                responseTime: 0,
                activeHours: '',
                engagementScore: 0,
                weeklyReports: true,
                interactionTrends: true,
                moodAutoReplies: true,
                busyMoodTemplate: 'I\'m busy right now, I\'ll get back to you soon.',
                focusedMoodTemplate: 'In focus mode, will respond when available.',
                relaxedMoodTemplate: 'Taking it easy, feel free to chat!',
                smartTemplateSelection: true
            },
            
            // PERSONALIZATION SECTION (17 features)
            personalization: {
                layoutMode: 'auto',
                moodBasedLayouts: true,
                customIcons: false,
                chatIcon: 'default',
                callIcon: 'default',
                statusIcon: 'default',
                buttonStyles: 'rounded',
                quickAccess: true,
                shortcut1: 'tools',
                shortcut2: 'marketplace',
                shortcut3: 'groups',
                shortcutPosition: 'topBar'
            },
            
            // SAFETY & PRIVACY+ SECTION (19 features)
            safety: {
                invisibleMode: false,
                invisibleDuration: '30min', // 30min/1hr/3hr/custom
                hideFromContacts: [],
                alwaysVisibleTo: [],
                invisibleTimer: 0,
                moodPrivacyRules: true,
                tiredMoodRule: true,
                stressedMoodRule: true,
                happyMoodRule: true,
                ruleDuration: '6hr',
                enhancedTimeout: false,
                lockScreenAfter: '5min',
                logoutAfter: '8hr',
                biometricBypass: true,
                timeoutWarnings: true
            },
            
            // ADVANCED SECTION (10 features)
            advanced: {
                offlineMode: false,
                intranetSupport: false,
                lowBandwidthMode: false,
                debugMode: false,
                proxySettings: {},
                dataSaver: false
            },
            
            // BACKUP & RESTORE SECTION (11 features)
            backup: {
                autoBackup: true,
                backupFrequency: 'weekly', // daily/weekly/monthly
                backupLocation: 'cloud', // cloud/local
                lastBackup: null,
                backupSize: 0
            }
        };
        
        // Settings menu structure
        const SETTINGS_MENU = [
            {
                id: 'profile',
                title: 'Profile',
                icon: 'fas fa-user',
                badge: null
            },
            {
                id: 'security',
                title: 'Security',
                icon: 'fas fa-shield-alt',
                badge: null
            },
            {
                id: 'privacy',
                title: 'Privacy',
                icon: 'fas fa-lock',
                badge: null
            },
            {
                id: 'chat',
                title: 'Chat',
                icon: 'fas fa-comments',
                badge: null
            },
            {
                id: 'friends',
                title: 'Friends',
                icon: 'fas fa-user-friends',
                badge: null
            },
            {
                id: 'groups',
                title: 'Groups',
                icon: 'fas fa-users',
                badge: null
            },
            {
                id: 'calls',
                title: 'Calls',
                icon: 'fas fa-phone',
                badge: null
            },
            {
                id: 'status',
                title: 'Status',
                icon: 'fas fa-circle',
                badge: null
            },
            {
                id: 'notifications',
                title: 'Notifications',
                icon: 'fas fa-bell',
                badge: null
            },
            {
                id: 'appearance',
                title: 'Appearance',
                icon: 'fas fa-palette',
                badge: null
            },
            {
                id: 'storage',
                title: 'Storage',
                icon: 'fas fa-database',
                badge: null
            },
            {
                id: 'mood',
                title: 'Mood Settings',
                icon: 'fas fa-smile',
                badge: 'NEW'
            },
            {
                id: 'activity',
                title: 'Smart Activity',
                icon: 'fas fa-brain',
                badge: null
            },
            {
                id: 'intelligence',
                title: 'Interaction Intelligence',
                icon: 'fas fa-robot',
                badge: null
            },
            {
                id: 'personalization',
                title: 'Personalization',
                icon: 'fas fa-sliders-h',
                badge: null
            },
            {
                id: 'safety',
                title: 'Safety & Privacy+',
                icon: 'fas fa-user-secret',
                badge: 'PRO'
            },
            {
                id: 'advanced',
                title: 'Advanced',
                icon: 'fas fa-cogs',
                badge: null
            },
            {
                id: 'backup',
                title: 'Backup & Restore',
                icon: 'fas fa-cloud-upload-alt',
                badge: null
            },
            {
                id: 'danger',
                title: 'Danger Zone',
                icon: 'fas fa-exclamation-triangle',
                badge: '!',
                danger: true
            }
        ];
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== SETTINGS SYSTEM INITIALIZATION START ===');
            
            // Load user data
            loadUserData();
            
            // Load settings
            loadSettings();
            
            // Initialize UI
            initializeUI();
            
            // Load current section
            loadSection(currentSection);
            
            console.log('=== SETTINGS SYSTEM INITIALIZATION COMPLETE ===');
        });
        
        // Load user data
        async function loadUserData() {
            try {
                // Try to get from localStorage first
                const cachedUser = localStorage.getItem('knecta_current_user');
                if (cachedUser) {
                    currentUser = JSON.parse(cachedUser);
                    console.log('User loaded from cache:', currentUser);
                    
                    // Update UI
                    document.getElementById('userNamePreview').textContent = currentUser.displayName || 'User';
                    
                    if (currentUser.photoURL) {
                        document.getElementById('userAvatarPreview').style.backgroundImage = `url('${currentUser.photoURL}')`;
                    } else {
                        const initials = currentUser.displayName ? 
                            currentUser.displayName.split(' ').map(word => word[0]).join('').toUpperCase().substring(0, 2) : 
                            'U';
                        document.getElementById('userAvatarPreview').innerHTML = `<span style="color: var(--text-secondary); font-size: 18px;">${initials}</span>`;
                    }
                }
                
                // Try to get from API
                try {
                    const response = await api('GET', '/api/auth/user');
                    if (response && response.user) {
                        currentUser = response.user;
                        console.log('User loaded from API:', currentUser);
                    }
                } catch (apiError) {
                    console.log('Could not load user from API, using cached data');
                }
                
                // Load additional data
                await loadBlockedUsers();
                await loadActiveSessions();
                await loadUserContacts();
                await loadUserGroups();
                
            } catch (error) {
                console.error('Error loading user data:', error);
                // Create fallback user
                currentUser = {
                    id: 'fallback_user',
                    displayName: 'User',
                    email: '',
                    photoURL: ''
                };
            }
        }
        
        // Load settings from localStorage or API
        async function loadSettings() {
            try {
                // Try to load from localStorage
                const savedSettings = localStorage.getItem('knecta_user_settings');
                
                if (savedSettings) {
                    userSettings = JSON.parse(savedSettings);
                    console.log('Settings loaded from localStorage');
                } else {
                    // Load from API
                    try {
                        const response = await api('GET', '/api/settings');
                        if (response && response.settings) {
                            userSettings = response.settings;
                            console.log('Settings loaded from API');
                        } else {
                            // Use defaults
                            userSettings = JSON.parse(JSON.stringify(DEFAULT_SETTINGS));
                            console.log('Using default settings');
                        }
                    } catch (apiError) {
                        console.log('Could not load settings from API, using defaults');
                        userSettings = JSON.parse(JSON.stringify(DEFAULT_SETTINGS));
                    }
                }
                
                // Ensure all sections exist
                Object.keys(DEFAULT_SETTINGS).forEach(section => {
                    if (!userSettings[section]) {
                        userSettings[section] = JSON.parse(JSON.stringify(DEFAULT_SETTINGS[section]));
                    }
                });
                
                // Calculate storage usage
                calculateStorageUsage();
                
            } catch (error) {
                console.error('Error loading settings:', error);
                userSettings = JSON.parse(JSON.stringify(DEFAULT_SETTINGS));
            }
        }
        
        // Save settings to localStorage and API
        async function saveSettings() {
            try {
                // Save to localStorage
                localStorage.setItem('knecta_user_settings', JSON.stringify(userSettings));
                
                // Save to API
                try {
                    await api('POST', '/api/settings', { settings: userSettings });
                    console.log('Settings saved to API');
                } catch (apiError) {
                    console.log('Could not save settings to API, saved locally only');
                }
                
                unsavedChanges = false;
                updateSaveButton();
                showNotification('Settings saved successfully', 'success');
                
            } catch (error) {
                console.error('Error saving settings:', error);
                showNotification('Error saving settings', 'error');
            }
        }
        
        // Initialize UI
        function initializeUI() {
            // Build settings menu
            buildSettingsMenu();
            
            // Setup event listeners
            setupEventListeners();
            
            // Update user status
            updateUserStatus();
            
            // Initialize color picker
            initializeColorPicker();
        }
        
        // Build settings menu
        function buildSettingsMenu() {
            const menuContainer = document.getElementById('settingsMenu');
            menuContainer.innerHTML = '';
            
            SETTINGS_MENU.forEach(item => {
                const menuItem = document.createElement('a');
                menuItem.href = '#';
                menuItem.className = 'menu-item';
                if (item.id === currentSection) {
                    menuItem.classList.add('active');
                }
                if (item.danger) {
                    menuItem.style.color = 'var(--danger-color)';
                }
                
                menuItem.innerHTML = `
                    <div class="menu-icon">
                        <i class="${item.icon}"></i>
                    </div>
                    <div class="menu-text">${item.title}</div>
                    ${item.badge ? `<div class="menu-badge">${item.badge}</div>` : ''}
                `;
                
                menuItem.addEventListener('click', (e) => {
                    e.preventDefault();
                    loadSection(item.id);
                    
                    // Update active menu item
                    document.querySelectorAll('.menu-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    menuItem.classList.add('active');
                });
                
                menuContainer.appendChild(menuItem);
            });
        }
        
        // Load a settings section
        function loadSection(sectionId) {
            currentSection = sectionId;
            unsavedChanges = false;
            
            // Update UI
            updateSectionTitle(sectionId);
            updateSaveButton();
            
            // Load section content
            const contentContainer = document.getElementById('settingsContent');
            
            switch(sectionId) {
                case 'profile':
                    loadProfileSection(contentContainer);
                    break;
                case 'security':
                    loadSecuritySection(contentContainer);
                    break;
                case 'privacy':
                    loadPrivacySection(contentContainer);
                    break;
                case 'chat':
                    loadChatSection(contentContainer);
                    break;
                case 'friends':
                    loadFriendsSection(contentContainer);
                    break;
                case 'groups':
                    loadGroupsSection(contentContainer);
                    break;
                case 'calls':
                    loadCallsSection(contentContainer);
                    break;
                case 'status':
                    loadStatusSection(contentContainer);
                    break;
                case 'notifications':
                    loadNotificationsSection(contentContainer);
                    break;
                case 'appearance':
                    loadAppearanceSection(contentContainer);
                    break;
                case 'storage':
                    loadStorageSection(contentContainer);
                    break;
                case 'mood':
                    loadMoodSection(contentContainer);
                    break;
                case 'activity':
                    loadActivitySection(contentContainer);
                    break;
                case 'intelligence':
                    loadIntelligenceSection(contentContainer);
                    break;
                case 'personalization':
                    loadPersonalizationSection(contentContainer);
                    break;
                case 'safety':
                    loadSafetySection(contentContainer);
                    break;
                case 'advanced':
                    loadAdvancedSection(contentContainer);
                    break;
                case 'backup':
                    loadBackupSection(contentContainer);
                    break;
                case 'danger':
                    loadDangerSection(contentContainer);
                    break;
                default:
                    contentContainer.innerHTML = '<p>Section not found</p>';
            }
            
            // Scroll to top
            contentContainer.scrollTop = 0;
        }
        
        // Update section title
        function updateSectionTitle(sectionId) {
            const menuItem = SETTINGS_MENU.find(item => item.id === sectionId);
            if (menuItem) {
                document.getElementById('contentTitle').textContent = menuItem.title;
                document.getElementById('contentSubtitle').textContent = getSectionDescription(sectionId);
            }
        }
        
        // Get section description
        function getSectionDescription(sectionId) {
            const descriptions = {
                profile: 'Manage your personal information and account settings',
                security: 'Secure your account with advanced security features',
                privacy: 'Control who can see your information and contact you',
                chat: 'Customize your chat experience and messaging preferences',
                friends: 'Configure how you connect and interact with friends',
                groups: 'Manage group settings and participation preferences',
                calls: 'Set up calling preferences and video call options',
                status: 'Configure status updates and story preferences',
                notifications: 'Manage notifications and alert preferences',
                appearance: 'Customize the look and feel of the app',
                storage: 'Monitor and manage your storage usage',
                mood: 'Configure mood detection and mood-based features',
                activity: 'Smart activity management and focus modes',
                intelligence: 'Interaction analytics and smart features',
                personalization: 'Personalize shortcuts and interface elements',
                safety: 'Advanced safety and privacy protection features',
                advanced: 'Developer options and advanced configuration',
                backup: 'Backup and restore your data',
                danger: 'Irreversible actions - proceed with caution'
            };
            
            return descriptions[sectionId] || 'Configure settings for this section';
        }
        
        // Update save button state
        function updateSaveButton() {
            const saveBtn = document.getElementById('saveSectionBtn');
            if (unsavedChanges) {
                saveBtn.disabled = false;
                saveBtn.innerHTML = '<i class="fas fa-save"></i> Save Changes';
                saveBtn.classList.remove('secondary');
                saveBtn.classList.add('primary');
            } else {
                saveBtn.disabled = true;
                saveBtn.innerHTML = '<i class="fas fa-check"></i> No Changes';
                saveBtn.classList.remove('primary');
                saveBtn.classList.add('secondary');
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Back to app button
            document.getElementById('backToAppBtn').addEventListener('click', () => {
                if (unsavedChanges) {
                    showConfirmation(
                        'Unsaved Changes',
                        'You have unsaved changes. Are you sure you want to leave?',
                        () => {
                            window.location.href = '../index.html';
                        }
                    );
                } else {
                    window.location.href = '../index.html';
                }
            });
            
            // Save section button
            document.getElementById('saveSectionBtn').addEventListener('click', saveSettings);
            
            // Reset section button
            document.getElementById('resetSectionBtn').addEventListener('click', () => {
                showConfirmation(
                    'Reset Section',
                    'Are you sure you want to reset all settings in this section to default?',
                    () => {
                        resetCurrentSection();
                    }
                );
            });
            
            // Search input
            document.getElementById('settingsSearch').addEventListener('input', function(e) {
                searchSettings(e.target.value);
            });
            
            // Modal close buttons
            document.getElementById('closePhotoModal').addEventListener('click', () => {
                document.getElementById('changePhotoModal').classList.remove('active');
            });
            
            document.getElementById('cancelPhotoBtn').addEventListener('click', () => {
                document.getElementById('changePhotoModal').classList.remove('active');
            });
            
            document.getElementById('closePasswordModal').addEventListener('click', () => {
                document.getElementById('changePasswordModal').classList.remove('active');
            });
            
            document.getElementById('cancelPasswordBtn').addEventListener('click', () => {
                document.getElementById('changePasswordModal').classList.remove('active');
            });
            
            document.getElementById('closeSessionsModal').addEventListener('click', () => {
                document.getElementById('sessionsModal').classList.remove('active');
            });
            
            document.getElementById('closeSessionsBtn').addEventListener('click', () => {
                document.getElementById('sessionsModal').classList.remove('active');
            });
            
            document.getElementById('closeBlockedModal').addEventListener('click', () => {
                document.getElementById('blockedUsersModal').classList.remove('active');
            });
            
            document.getElementById('closeBlockedBtn').addEventListener('click', () => {
                document.getElementById('blockedUsersModal').classList.remove('active');
            });
            
            document.getElementById('closeConfirmationModal').addEventListener('click', () => {
                document.getElementById('confirmationModal').classList.remove('active');
            });
            
            document.getElementById('cancelConfirmationBtn').addEventListener('click', () => {
                document.getElementById('confirmationModal').classList.remove('active');
            });
            
            // Photo modal buttons
            document.getElementById('takePhotoBtn').addEventListener('click', takePhoto);
            document.getElementById('choosePhotoBtn').addEventListener('click', choosePhoto);
            document.getElementById('removePhotoBtn').addEventListener('click', removePhoto);
            document.getElementById('savePhotoBtn').addEventListener('click', savePhoto);
            
            // Password modal buttons
            document.getElementById('savePasswordBtn').addEventListener('click', changePassword);
            
            // Sessions modal
            document.getElementById('terminateAllSessionsBtn').addEventListener('click', terminateAllSessions);
            
            // Before unload warning
            window.addEventListener('beforeunload', (e) => {
                if (unsavedChanges) {
                    e.preventDefault();
                    e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
                }
            });
        }
        
        // Initialize color picker
        function initializeColorPicker() {
            const container = document.getElementById('colorPickerContainer');
            colorPicker = Pickr.create({
                el: container,
                theme: 'nano',
                default: userSettings.appearance.accentColor,
                swatches: [
                    '#0084ff', '#34c759', '#ff9500', '#ff3b30',
                    '#af52de', '#5856d6', '#007aff', '#5ac8fa'
                ],
                components: {
                    preview: true,
                    opacity: false,
                    hue: true,
                    interaction: {
                        hex: true,
                        rgba: true,
                        hsla: false,
                        hsva: false,
                        cmyk: false,
                        input: true,
                        clear: false,
                        save: true
                    }
                }
            });
            
            colorPicker.on('save', (color) => {
                if (color) {
                    const hexColor = color.toHEXA().toString();
                    userSettings.appearance.accentColor = hexColor;
                    unsavedChanges = true;
                    updateSaveButton();
                    updateAccentColor(hexColor);
                }
            });
        }
        
        // Update accent color in UI
        function updateAccentColor(color) {
            document.documentElement.style.setProperty('--primary-color', color);
            
            // Calculate darker variant
            const darkerColor = shadeColor(color, -20);
            document.documentElement.style.setProperty('--primary-dark', darkerColor);
        }
        
        // Utility function to shade color
        function shadeColor(color, percent) {
            let R = parseInt(color.substring(1,3),16);
            let G = parseInt(color.substring(3,5),16);
            let B = parseInt(color.substring(5,7),16);

            R = parseInt(R * (100 + percent) / 100);
            G = parseInt(G * (100 + percent) / 100);
            B = parseInt(B * (100 + percent) / 100);

            R = (R<255)?R:255;  
            G = (G<255)?G:255;  
            B = (B<255)?B:255;  

            const RR = ((R.toString(16).length===1)?"0"+R.toString(16):R.toString(16));
            const GG = ((G.toString(16).length===1)?"0"+G.toString(16):G.toString(16));
            const BB = ((B.toString(16).length===1)?"0"+B.toString(16):B.toString(16));

            return "#"+RR+GG+BB;
        }
        
        // Search settings
        function searchSettings(query) {
            const normalizedQuery = query.toLowerCase().trim();
            
            if (!normalizedQuery) {
                // Reset to current section
                loadSection(currentSection);
                return;
            }
            
            // Search in settings
            const results = [];
            const contentContainer = document.getElementById('settingsContent');
            
            // Simple search implementation
            contentContainer.innerHTML = `
                <div class="settings-section">
                    <div class="section-header">
                        <h3>Search Results for "${query}"</h3>
                    </div>
                    <div class="section-body">
                        <p>Search functionality would show matching settings here.</p>
                        <p class="setting-description">In a full implementation, this would search through all settings and display relevant results.</p>
                    </div>
                </div>
            `;
        }
        
        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            notification.className = 'notification';
            notification.classList.add(type);
            notification.classList.add('active');
            
            setTimeout(() => {
                notification.classList.remove('active');
            }, 3000);
        }
        
        // Show confirmation dialog
        function showConfirmation(title, message, confirmCallback) {
            document.getElementById('confirmationTitle').textContent = title;
            document.getElementById('confirmationMessage').textContent = message;
            
            const modal = document.getElementById('confirmationModal');
            modal.classList.add('active');
            
            const confirmBtn = document.getElementById('confirmActionBtn');
            confirmBtn.onclick = () => {
                modal.classList.remove('active');
                if (confirmCallback) confirmCallback();
            };
        }
        
        // =============================================
        // SECTION LOADING FUNCTIONS
        // =============================================
        
        // PROFILE SECTION (22 features)
        function loadProfileSection(container) {
            const settings = userSettings.profile;
            
            container.innerHTML = `
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-user section-icon"></i> Profile Information</h3>
                        <div class="section-description">
                            Manage your personal information and how others see your profile
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">
                                    Profile Photo
                                    <i class="fas fa-info-circle setting-label-icon" title="Your profile picture visible to others"></i>
                                </div>
                                <div class="setting-description">
                                    Click to change your profile photo
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button" id="changePhotoBtn">
                                    <i class="fas fa-camera"></i> Change Photo
                                </button>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Display Name</div>
                                <div class="setting-description">
                                    Your name as shown to other users
                                </div>
                            </div>
                            <div class="setting-control">
                                <input type="text" class="setting-input" id="displayNameInput" 
                                       value="${escapeHtml(settings.displayName)}" 
                                       placeholder="Your name">
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Username</div>
                                <div class="setting-description">
                                    Your unique @username for mentions and sharing
                                </div>
                            </div>
                            <div class="setting-control">
                                <input type="text" class="setting-input" id="usernameInput" 
                                       value="${escapeHtml(settings.username)}" 
                                       placeholder="@username" 
                                       pattern="^@[a-zA-Z0-9_]+$">
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Bio</div>
                                <div class="setting-description">
                                    A short bio about yourself (max 150 characters)
                                </div>
                            </div>
                            <div class="setting-control">
                                <textarea class="setting-textarea" id="bioInput" 
                                          placeholder="Tell people about yourself..." 
                                          maxlength="150">${escapeHtml(settings.bio)}</textarea>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Phone Number</div>
                                <div class="setting-description">
                                    Your phone number for verification and contacts
                                </div>
                            </div>
                            <div class="setting-control">
                                <input type="tel" class="setting-input" id="phoneNumberInput" 
                                       value="${escapeHtml(settings.phoneNumber)}" 
                                       placeholder="+1 234 567 8900">
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Email Address</div>
                                <div class="setting-description">
                                    Your email for account recovery and notifications
                                </div>
                            </div>
                            <div class="setting-control">
                                <input type="email" class="setting-input" id="emailInput" 
                                       value="${escapeHtml(settings.email)}" 
                                       placeholder="your@email.com">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-eye section-icon"></i> Profile Visibility</h3>
                        <div class="section-description">
                            Control who can see your profile information
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Profile Visibility</div>
                                <div class="setting-description">
                                    Who can see your full profile
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="profileVisibilitySelect">
                                    <option value="everyone" ${settings.profileVisibility === 'everyone' ? 'selected' : ''}>Everyone</option>
                                    <option value="friendsOnly" ${settings.profileVisibility === 'friendsOnly' ? 'selected' : ''}>Friends Only</option>
                                    <option value="nobody" ${settings.profileVisibility === 'nobody' ? 'selected' : ''}>Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Profile Photo Visibility</div>
                                <div class="setting-description">
                                    Who can see your profile photo
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="profilePhotoVisibilitySelect">
                                    <option value="everyone" ${settings.profilePhotoVisibility === 'everyone' ? 'selected' : ''}>Everyone</option>
                                    <option value="friendsOnly" ${settings.profilePhotoVisibility === 'friendsOnly' ? 'selected' : ''}>Friends Only</option>
                                    <option value="nobody" ${settings.profilePhotoVisibility === 'nobody' ? 'selected' : ''}>Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Last Seen</div>
                                <div class="setting-description">
                                    Show when you were last active
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="lastSeenToggle" ${settings.lastSeen ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Online Status</div>
                                <div class="setting-description">
                                    Show when you're online
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="onlineStatusToggle" ${settings.onlineStatus ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-smile section-icon"></i> Current Mood</h3>
                        <div class="section-description">
                            Your current mood status and settings
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Current Mood</div>
                                <div class="setting-description" id="currentMoodText">
                                    ${getMoodText(settings.currentMood)}
                                </div>
                            </div>
                            <div class="setting-control">
                                <div class="mood-indicator" style="width: 24px; height: 24px; border-radius: 50%; background-color: ${getMoodColor(settings.currentMood)};"></div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Mood Text</div>
                                <div class="setting-description">
                                    Custom text to display with your mood
                                </div>
                            </div>
                            <div class="setting-control">
                                <input type="text" class="setting-input" id="moodTextInput" 
                                       value="${escapeHtml(settings.currentMoodText)}" 
                                       placeholder="How you're feeling...">
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for profile section
            document.getElementById('changePhotoBtn').addEventListener('click', () => {
                document.getElementById('changePhotoModal').classList.add('active');
            });
            
            // Input change listeners
            const inputs = ['displayNameInput', 'usernameInput', 'bioInput', 'phoneNumberInput', 'emailInput', 'moodTextInput'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        userSettings.profile[id.replace('Input', '')] = element.value;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
            
            // Select change listeners
            const selects = ['profileVisibilitySelect', 'profilePhotoVisibilitySelect'];
            selects.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Select', '');
                        userSettings.profile[property] = element.value;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
            
            // Toggle change listeners
            const toggles = ['lastSeenToggle', 'onlineStatusToggle'];
            toggles.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Toggle', '');
                        userSettings.profile[property] = element.checked;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
        }
        
        // SECURITY SECTION (11 features)
        function loadSecuritySection(container) {
            const settings = userSettings.security;
            
            container.innerHTML = `
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-shield-alt section-icon"></i> Account Security</h3>
                        <div class="section-description">
                            Enhanced security features to protect your account
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Two-Factor Authentication</div>
                                <div class="setting-description">
                                    Add an extra layer of security to your account
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="twoFactorAuthToggle" ${settings.twoFactorAuth ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Change Password</div>
                                <div class="setting-description">
                                    Update your account password regularly
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button" id="changePasswordBtn">
                                    <i class="fas fa-key"></i> Change Password
                                </button>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Login Notifications</div>
                                <div class="setting-description">
                                    Get notified when someone logs into your account
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="loginNotificationsToggle" ${settings.loginNotifications ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Active Sessions</div>
                                <div class="setting-description">
                                    View and manage devices logged into your account
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button" id="viewSessionsBtn">
                                    <i class="fas fa-desktop"></i> View All
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-clock section-icon"></i> Session Management</h3>
                        <div class="section-description">
                            Control how long your sessions stay active
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Session Timeout</div>
                                <div class="setting-description">
                                    Automatically log out after period of inactivity
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="sessionTimeoutSelect">
                                    <option value="15min" ${settings.sessionTimeout === '15min' ? 'selected' : ''}>15 Minutes</option>
                                    <option value="30min" ${settings.sessionTimeout === '30min' ? 'selected' : ''}>30 Minutes</option>
                                    <option value="1hr" ${settings.sessionTimeout === '1hr' ? 'selected' : ''}>1 Hour</option>
                                    <option value="8hr" ${settings.sessionTimeout === '8hr' ? 'selected' : ''}>8 Hours</option>
                                    <option value="never" ${settings.sessionTimeout === 'never' ? 'selected' : ''}>Never</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Enhanced Timeout</div>
                                <div class="setting-description">
                                    Additional security for timeout protection
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="enhancedTimeoutToggle" ${settings.enhancedTimeout ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Lock Screen After</div>
                                <div class="setting-description">
                                    Lock app screen after specified time
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="lockScreenAfterSelect">
                                    <option value="1min" ${settings.lockScreenAfter === '1min' ? 'selected' : ''}>1 Minute</option>
                                    <option value="5min" ${settings.lockScreenAfter === '5min' ? 'selected' : ''}>5 Minutes</option>
                                    <option value="15min" ${settings.lockScreenAfter === '15min' ? 'selected' : ''}>15 Minutes</option>
                                    <option value="30min" ${settings.lockScreenAfter === '30min' ? 'selected' : ''}>30 Minutes</option>
                                    <option value="never" ${settings.lockScreenAfter === 'never' ? 'selected' : ''}>Never</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Logout After</div>
                                <div class="setting-description">
                                    Complete logout after specified time
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="logoutAfterSelect">
                                    <option value="1hr" ${settings.logoutAfter === '1hr' ? 'selected' : ''}>1 Hour</option>
                                    <option value="4hr" ${settings.logoutAfter === '4hr' ? 'selected' : ''}>4 Hours</option>
                                    <option value="8hr" ${settings.logoutAfter === '8hr' ? 'selected' : ''}>8 Hours</option>
                                    <option value="24hr" ${settings.logoutAfter === '24hr' ? 'selected' : ''}>24 Hours</option>
                                    <option value="never" ${settings.logoutAfter === 'never' ? 'selected' : ''}>Never</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Timeout Warnings</div>
                                <div class="setting-description">
                                    Show warnings before session timeout
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="timeoutWarningsToggle" ${settings.timeoutWarnings ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-lock section-icon"></i> App Protection</h3>
                        <div class="section-description">
                            Additional protection for the app
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">App Lock</div>
                                <div class="setting-description">
                                    Require authentication to open the app
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="appLockToggle" ${settings.appLock ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Screen Capture Protection</div>
                                <div class="setting-description">
                                    Prevent screenshots and screen recording
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="screenCaptureToggle" ${settings.screenCaptureProtection ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">End-to-End Encryption</div>
                                <div class="setting-description">
                                    Encrypt all messages and calls
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="encryptionToggle" ${settings.encryption ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Biometric Bypass</div>
                                <div class="setting-description">
                                    Allow biometric authentication to bypass locks
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="biometricBypassToggle" ${settings.biometricBypass ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for security section
            document.getElementById('changePasswordBtn').addEventListener('click', () => {
                document.getElementById('changePasswordModal').classList.add('active');
            });
            
            document.getElementById('viewSessionsBtn').addEventListener('click', () => {
                showActiveSessions();
            });
            
            // Toggle change listeners
            const toggles = ['twoFactorAuthToggle', 'loginNotificationsToggle', 'enhancedTimeoutToggle', 
                           'timeoutWarningsToggle', 'appLockToggle', 'screenCaptureToggle', 
                           'encryptionToggle', 'biometricBypassToggle'];
            toggles.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Toggle', '');
                        userSettings.security[property] = element.checked;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
            
            // Select change listeners
            const selects = ['sessionTimeoutSelect', 'lockScreenAfterSelect', 'logoutAfterSelect'];
            selects.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Select', '');
                        userSettings.security[property] = element.value;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
        }
        
        // PRIVACY SECTION (25 features)
        function loadPrivacySection(container) {
            const settings = userSettings.privacy;
            
            container.innerHTML = `
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-user-plus section-icon"></i> Connection Settings</h3>
                        <div class="section-description">
                            Control who can connect with you
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Who Can Add Me</div>
                                <div class="setting-description">
                                    Control who can send you friend requests
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="whoCanAddMeSelect">
                                    <option value="everyone" ${settings.whoCanAddMe === 'everyone' ? 'selected' : ''}>Everyone</option>
                                    <option value="friendsOfFriends" ${settings.whoCanAddMe === 'friendsOfFriends' ? 'selected' : ''}>Friends of Friends</option>
                                    <option value="nobody" ${settings.whoCanAddMe === 'nobody' ? 'selected' : ''}>Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Contact Discovery</div>
                                <div class="setting-description">
                                    Allow others to find you by phone number or email
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="contactDiscoveryToggle" ${settings.contactDiscovery ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-comments section-icon"></i> Messaging Privacy</h3>
                        <div class="section-description">
                            Control who can message you and how
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Who Can Message Me</div>
                                <div class="setting-description">
                                    Control who can send you messages
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="canMessageMeSelect">
                                    <option value="everyone" ${settings.canMessageMe === 'everyone' ? 'selected' : ''}>Everyone</option>
                                    <option value="friendsOnly" ${settings.canMessageMe === 'friendsOnly' ? 'selected' : ''}>Friends Only</option>
                                    <option value="nobody" ${settings.canMessageMe === 'nobody' ? 'selected' : ''}>Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Read Receipts</div>
                                <div class="setting-description">
                                    Let others see when you've read their messages
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="readReceiptsToggle" ${settings.readReceipts ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Typing Indicators</div>
                                <div class="setting-description">
                                    Show when you're typing a message
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="typingIndicatorsToggle" ${settings.typingIndicators ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Message Forwarding</div>
                                <div class="setting-description">
                                    Allow others to forward your messages
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="messageForwardingToggle" ${settings.messageForwarding ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Can Forward Messages</div>
                                <div class="setting-description">
                                    Who can forward your messages
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="canForwardMessagesSelect">
                                    <option value="everyone" ${settings.canForwardMessages === 'everyone' ? 'selected' : ''}>Everyone</option>
                                    <option value="friendsOnly" ${settings.canForwardMessages === 'friendsOnly' ? 'selected' : ''}>Friends Only</option>
                                    <option value="nobody" ${settings.canForwardMessages === 'nobody' ? 'selected' : ''}>Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Can Take Screenshots</div>
                                <div class="setting-description">
                                    Allow others to take screenshots of your chats
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="canTakeScreenshotsToggle" ${settings.canTakeScreenshots ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-phone section-icon"></i> Call Privacy</h3>
                        <div class="section-description">
                            Control who can call you
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Who Can Call Me</div>
                                <div class="setting-description">
                                    Control who can make voice or video calls to you
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="canCallMeSelect">
                                    <option value="everyone" ${settings.canCallMe === 'everyone' ? 'selected' : ''}>Everyone</option>
                                    <option value="friendsOnly" ${settings.canCallMe === 'friendsOnly' ? 'selected' : ''}>Friends Only</option>
                                    <option value="nobody" ${settings.canCallMe === 'nobody' ? 'selected' : ''}>Nobody</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-eye section-icon"></i> Visibility Settings</h3>
                        <div class="section-description">
                            Control what others can see about you
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Can See My Status</div>
                                <div class="setting-description">
                                    Who can see your status updates
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="canSeeMyStatusSelect">
                                    <option value="everyone" ${settings.canSeeMyStatus === 'everyone' ? 'selected' : ''}>Everyone</option>
                                    <option value="friendsOnly" ${settings.canSeeMyStatus === 'friendsOnly' ? 'selected' : ''}>Friends Only</option>
                                    <option value="nobody" ${settings.canSeeMyStatus === 'nobody' ? 'selected' : ''}>Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Can See Profile Photo</div>
                                <div class="setting-description">
                                    Who can see your profile picture
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="canSeeProfilePhotoSelect">
                                    <option value="everyone" ${settings.canSeeProfilePhoto === 'everyone' ? 'selected' : ''}>Everyone</option>
                                    <option value="friendsOnly" ${settings.canSeeProfilePhoto === 'friendsOnly' ? 'selected' : ''}>Friends Only</option>
                                    <option value="nobody" ${settings.canSeeProfilePhoto === 'nobody' ? 'selected' : ''}>Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Can See Last Seen</div>
                                <div class="setting-description">
                                    Who can see when you were last online
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="canSeeLastSeenSelect">
                                    <option value="everyone" ${settings.canSeeLastSeen === 'everyone' ? 'selected' : ''}>Everyone</option>
                                    <option value="friendsOnly" ${settings.canSeeLastSeen === 'friendsOnly' ? 'selected' : ''}>Friends Only</option>
                                    <option value="nobody" ${settings.canSeeLastSeen === 'nobody' ? 'selected' : ''}>Nobody</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-ban section-icon"></i> Blocking & Safety</h3>
                        <div class="section-description">
                            Manage blocked users and safety features
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Blocked Users</div>
                                <div class="setting-description">
                                    Manage users you've blocked
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button" id="manageBlockedBtn">
                                    <i class="fas fa-user-slash"></i> Manage
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for privacy section
            document.getElementById('manageBlockedBtn').addEventListener('click', () => {
                showBlockedUsers();
            });
            
            // Select change listeners
            const selects = ['whoCanAddMeSelect', 'canMessageMeSelect', 'canForwardMessagesSelect', 
                           'canCallMeSelect', 'canSeeMyStatusSelect', 'canSeeProfilePhotoSelect', 
                           'canSeeLastSeenSelect'];
            selects.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Select', '');
                        userSettings.privacy[property] = element.value;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
            
            // Toggle change listeners
            const toggles = ['contactDiscoveryToggle', 'readReceiptsToggle', 'typingIndicatorsToggle', 
                           'messageForwardingToggle', 'canTakeScreenshotsToggle'];
            toggles.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Toggle', '');
                        userSettings.privacy[property] = element.checked;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
        }
        
        // CHAT SECTION (12 features)
        function loadChatSection(container) {
            const settings = userSettings.chat;
            
            container.innerHTML = `
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-comments section-icon"></i> Chat Settings</h3>
                        <div class="section-description">
                            Customize your chat experience
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Chat Wallpaper</div>
                                <div class="setting-description">
                                    Change the background of your chats
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button" id="changeWallpaperBtn">
                                    <i class="fas fa-image"></i> Change
                                </button>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Enter Key Sends</div>
                                <div class="setting-description">
                                    Press Enter to send messages (Shift+Enter for new line)
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="enterKeySendsToggle" ${settings.enterKeySends ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Media Auto-Download</div>
                                <div class="setting-description">
                                    Automatically download media files
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="mediaAutoDownloadSelect">
                                    <option value="wifiOnly" ${settings.mediaAutoDownload === 'wifiOnly' ? 'selected' : ''}>Wi-Fi Only</option>
                                    <option value="always" ${settings.mediaAutoDownload === 'always' ? 'selected' : ''}>Always</option>
                                    <option value="never" ${settings.mediaAutoDownload === 'never' ? 'selected' : ''}>Never</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Save to Camera Roll</div>
                                <div class="setting-description">
                                    Automatically save received media to your device
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="saveToCameraRollToggle" ${settings.saveToCameraRoll ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-history section-icon"></i> Message History</h3>
                        <div class="section-description">
                            Control how long messages are stored
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Message History</div>
                                <div class="setting-description">
                                    How long to keep message history
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="messageHistorySelect">
                                    <option value="forever" ${settings.messageHistory === 'forever' ? 'selected' : ''}>Forever</option>
                                    <option value="30days" ${settings.messageHistory === '30days' ? 'selected' : ''}>30 Days</option>
                                    <option value="7days" ${settings.messageHistory === '7days' ? 'selected' : ''}>7 Days</option>
                                    <option value="24hours" ${settings.messageHistory === '24hours' ? 'selected' : ''}>24 Hours</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Disappearing Messages</div>
                                <div class="setting-description">
                                    Automatically delete messages after a period
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="disappearingMessagesSelect">
                                    <option value="off" ${settings.disappearingMessages === 'off' ? 'selected' : ''}>Off</option>
                                    <option value="1hour" ${settings.disappearingMessages === '1hour' ? 'selected' : ''}>1 Hour</option>
                                    <option value="1day" ${settings.disappearingMessages === '1day' ? 'selected' : ''}>1 Day</option>
                                    <option value="7days" ${settings.disappearingMessages === '7days' ? 'selected' : ''}>7 Days</option>
                                    <option value="30days" ${settings.disappearingMessages === '30days' ? 'selected' : ''}>30 Days</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-robot section-icon"></i> Smart Features</h3>
                        <div class="section-description">
                            AI-powered chat enhancements
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Smart Replies</div>
                                <div class="setting-description">
                                    Suggest quick replies based on conversation
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="smartRepliesToggle" ${settings.smartReplies ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Message Translation</div>
                                <div class="setting-description">
                                    Automatically translate foreign language messages
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="messageTranslationToggle" ${settings.messageTranslation ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Chat Summarization</div>
                                <div class="setting-description">
                                    Summarize long conversations
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="chatSummarizationToggle" ${settings.chatSummarization ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-shield-alt section-icon"></i> Safety Features</h3>
                        <div class="section-description">
                            Protect yourself from unwanted content
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Spam Detection</div>
                                <div class="setting-description">
                                    Automatically detect and filter spam messages
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="spamDetectionToggle" ${settings.spamDetection ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Message Approval Mode</div>
                                <div class="setting-description">
                                    Require approval before messages are sent
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="messageApprovalModeToggle" ${settings.messageApprovalMode ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Keyword Filtering</div>
                                <div class="setting-description">
                                    Filter messages containing specific keywords
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="keywordFilteringToggle" ${settings.keywordFiltering ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for chat section
            document.getElementById('changeWallpaperBtn').addEventListener('click', () => {
                showNotification('Wallpaper change feature would open here', 'info');
            });
            
            // Select change listeners
            const selects = ['mediaAutoDownloadSelect', 'messageHistorySelect', 'disappearingMessagesSelect'];
            selects.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Select', '');
                        userSettings.chat[property] = element.value;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
            
            // Toggle change listeners
            const toggles = ['enterKeySendsToggle', 'saveToCameraRollToggle', 'smartRepliesToggle', 
                           'messageTranslationToggle', 'chatSummarizationToggle', 'spamDetectionToggle',
                           'messageApprovalModeToggle', 'keywordFilteringToggle'];
            toggles.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Toggle', '');
                        userSettings.chat[property] = element.checked;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
        }
        
        // FRIENDS SECTION (10 features)
        function loadFriendsSection(container) {
            const settings = userSettings.friends;
            
            container.innerHTML = `
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-user-plus section-icon"></i> Friend Discovery</h3>
                        <div class="section-description">
                            Control how others can find and add you
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Discover by Phone Number</div>
                                <div class="setting-description">
                                    Allow others to find you by your phone number
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="discoverByPhoneToggle" ${settings.discoverByPhone ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Discover by Email</div>
                                <div class="setting-description">
                                    Allow others to find you by your email address
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="discoverByEmailToggle" ${settings.discoverByEmail ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Nearby Discovery</div>
                                <div class="setting-description">
                                    Allow discovery by nearby users using Bluetooth
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="nearbyDiscoveryToggle" ${settings.nearbyDiscovery ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">QR Code Scanner</div>
                                <div class="setting-description">
                                    Allow adding friends by scanning QR codes
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="qrCodeScannerToggle" ${settings.qrCodeScanner ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Friend Suggestions</div>
                                <div class="setting-description">
                                    Show friend suggestions based on mutual connections
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="friendSuggestionsToggle" ${settings.friendSuggestions ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-clock section-icon"></i> Friendship Features</h3>
                        <div class="section-description">
                            Advanced friendship management features
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Temporary Friends</div>
                                <div class="setting-description">
                                    Allow temporary friendships that expire after time
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="temporaryFriendsToggle" ${settings.temporaryFriends ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Friendship Notes</div>
                                <div class="setting-description">
                                    Add private notes to friends for reference
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="friendshipNotesToggle" ${settings.friendshipNotes ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Friend Categories</div>
                                <div class="setting-description">
                                    Organize friends into custom categories
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="friendCategoriesToggle" ${settings.friendCategories ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Trust Score</div>
                                <div class="setting-description">
                                    Show trust scores for friends based on interaction
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="trustScoreToggle" ${settings.trustScore ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Friend Analytics</div>
                                <div class="setting-description">
                                    Show analytics about your friendships
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="friendAnalyticsToggle" ${settings.friendAnalytics ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Toggle change listeners
            const toggles = ['discoverByPhoneToggle', 'discoverByEmailToggle', 'nearbyDiscoveryToggle',
                           'qrCodeScannerToggle', 'friendSuggestionsToggle', 'temporaryFriendsToggle',
                           'friendshipNotesToggle', 'friendCategoriesToggle', 'trustScoreToggle',
                           'friendAnalyticsToggle'];
            toggles.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Toggle', '');
                        userSettings.friends[property] = element.checked;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
        }
        
        // GROUPS SECTION (15 features)
        function loadGroupsSection(container) {
            const settings = userSettings.groups;
            
            container.innerHTML = `
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-users section-icon"></i> Group Settings</h3>
                        <div class="section-description">
                            Control your group participation and preferences
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Auto-Join Groups</div>
                                <div class="setting-description">
                                    Automatically join groups you're invited to
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="autoJoinGroupsToggle" ${settings.autoJoinGroups ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Group Invitations</div>
                                <div class="setting-description">
                                    Who can invite you to groups
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="groupInvitationsSelect">
                                    <option value="everyone" ${settings.groupInvitations === 'everyone' ? 'selected' : ''}>Everyone</option>
                                    <option value="friendsOnly" ${settings.groupInvitations === 'friendsOnly' ? 'selected' : ''}>Friends Only</option>
                                    <option value="nobody" ${settings.groupInvitations === 'nobody' ? 'selected' : ''}>Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Group Privacy</div>
                                <div class="setting-description">
                                    Control who can add you to groups
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="groupPrivacySelect">
                                    <option value="everyone" ${settings.groupPrivacy === 'everyone' ? 'selected' : ''}>Everyone</option>
                                    <option value="myApprovalRequired" ${settings.groupPrivacy === 'myApprovalRequired' ? 'selected' : ''}>My Approval Required</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Group Announcements</div>
                                <div class="setting-description">
                                    Receive announcements from group admins
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="groupAnnouncementsToggle" ${settings.groupAnnouncements ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Auto-Download Group Media</div>
                                <div class="setting-description">
                                    Automatically download media from groups
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="autoDownloadGroupMediaSelect">
                                    <option value="wifiOnly" ${settings.autoDownloadGroupMedia === 'wifiOnly' ? 'selected' : ''}>Wi-Fi Only</option>
                                    <option value="always" ${settings.autoDownloadGroupMedia === 'always' ? 'selected' : ''}>Always</option>
                                    <option value="never" ${settings.autoDownloadGroupMedia === 'never' ? 'selected' : ''}>Never</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-cog section-icon"></i> Group Management</h3>
                        <div class="section-description">
                            Advanced group management features
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Message Approval Mode</div>
                                <div class="setting-description">
                                    Require approval for messages in your groups
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="messageApprovalModeGroupToggle" ${settings.messageApprovalModeGroup ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Keyword Filtering</div>
                                <div class="setting-description">
                                    Filter messages containing specific keywords in groups
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="keywordFilteringGroupToggle" ${settings.keywordFilteringGroup ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Group Spam Detection</div>
                                <div class="setting-description">
                                    Automatically detect and filter spam in groups
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="groupSpamDetectionToggle" ${settings.groupSpamDetection ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Member Warnings</div>
                                <div class="setting-description">
                                    Show warnings for problematic group members
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="memberWarningsToggle" ${settings.memberWarnings ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-chart-bar section-icon"></i> Group Analytics</h3>
                        <div class="section-description">
                            Analytics and insights for groups
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Activity Tracking</div>
                                <div class="setting-description">
                                    Track group activity and participation
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="activityTrackingToggle" ${settings.activityTracking ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Top Contributors</div>
                                <div class="setting-description">
                                    Highlight top contributors in groups
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="topContributorsToggle" ${settings.topContributors ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Message Volume Analytics</div>
                                <div class="setting-description">
                                    Show analytics about message volume in groups
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="messageVolumeAnalyticsToggle" ${settings.messageVolumeAnalytics ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Group Data Cache</div>
                                <div class="setting-description">
                                    How much group data to cache locally
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="groupDataCacheSelect">
                                    <option value="activeGroupsOnly" ${settings.groupDataCache === 'activeGroupsOnly' ? 'selected' : ''}>Active groups only</option>
                                    <option value="allGroups" ${settings.groupDataCache === 'allGroups' ? 'selected' : ''}>All groups</option>
                                    <option value="noGroupCache" ${settings.groupDataCache === 'noGroupCache' ? 'selected' : ''}>No group cache</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Select change listeners
            const selects = ['groupInvitationsSelect', 'groupPrivacySelect', 'autoDownloadGroupMediaSelect', 'groupDataCacheSelect'];
            selects.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Select', '');
                        userSettings.groups[property] = element.value;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
            
            // Toggle change listeners
            const toggles = ['autoJoinGroupsToggle', 'groupAnnouncementsToggle', 'messageApprovalModeGroupToggle',
                           'keywordFilteringGroupToggle', 'groupSpamDetectionToggle', 'memberWarningsToggle',
                           'activityTrackingToggle', 'topContributorsToggle', 'messageVolumeAnalyticsToggle'];
            toggles.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Toggle', '');
                        userSettings.groups[property] = element.checked;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
        }
        
        // CALLS SECTION (18 features)
        function loadCallsSection(container) {
            const settings = userSettings.calls;
            
            container.innerHTML = `
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-phone section-icon"></i> Call Settings</h3>
                        <div class="section-description">
                            Configure your calling preferences
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Who Can Call Me</div>
                                <div class="setting-description">
                                    Control who can make voice or video calls to you
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="callsWhoCanCallMeSelect">
                                    <option value="everyone" ${settings.whoCanCallMe === 'everyone' ? 'selected' : ''}>Everyone</option>
                                    <option value="friendsOnly" ${settings.whoCanCallMe === 'friendsOnly' ? 'selected' : ''}>Friends Only</option>
                                    <option value="nobody" ${settings.whoCanCallMe === 'nobody' ? 'selected' : ''}>Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Call Verification</div>
                                <div class="setting-description">
                                    Verify caller identity before connecting calls
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="callVerificationToggle" ${settings.callVerification ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Ringtone</div>
                                <div class="setting-description">
                                    Choose your call ringtone
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="ringtoneSelect">
                                    <option value="default" ${settings.ringtone === 'default' ? 'selected' : ''}>Default</option>
                                    <option value="classic" ${settings.ringtone === 'classic' ? 'selected' : ''}>Classic</option>
                                    <option value="modern" ${settings.ringtone === 'modern' ? 'selected' : ''}>Modern</option>
                                    <option value="custom" ${settings.ringtone === 'custom' ? 'selected' : ''}>Custom</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Call Vibration</div>
                                <div class="setting-description">
                                    Vibrate on incoming calls
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="callVibrationToggle" ${settings.callVibration ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Auto-Answer</div>
                                <div class="setting-description">
                                    Automatically answer calls (use with caution)
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="autoAnswerToggle" ${settings.autoAnswer ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-video section-icon"></i> Video Call Settings</h3>
                        <div class="section-description">
                            Configure video call preferences
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Video Quality</div>
                                <div class="setting-description">
                                    Adjust video quality for calls
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="videoQualitySelect">
                                    <option value="auto" ${settings.videoQuality === 'auto' ? 'selected' : ''}>Auto</option>
                                    <option value="high" ${settings.videoQuality === 'high' ? 'selected' : ''}>High</option>
                                    <option value="medium" ${settings.videoQuality === 'medium' ? 'selected' : ''}>Medium</option>
                                    <option value="low" ${settings.videoQuality === 'low' ? 'selected' : ''}>Low</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Camera Default</div>
                                <div class="setting-description">
                                    Default camera for video calls
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="cameraDefaultSelect">
                                    <option value="front" ${settings.cameraDefault === 'front' ? 'selected' : ''}>Front Camera</option>
                                    <option value="back" ${settings.cameraDefault === 'back' ? 'selected' : ''}>Back Camera</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Noise Cancellation</div>
                                <div class="setting-description">
                                    Reduce background noise during calls
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="noiseCancellationToggle" ${settings.noiseCancellation ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Echo Cancellation</div>
                                <div class="setting-description">
                                    Reduce echo during calls
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="echoCancellationToggle" ${settings.echoCancellation ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-bolt section-icon"></i> Call Features</h3>
                        <div class="section-description">
                            Advanced calling features
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Live Reactions</div>
                                <div class="setting-description">
                                    Show live reactions during calls
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="liveReactionsToggle" ${settings.liveReactions ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">In-Call Chat</div>
                                <div class="setting-description">
                                    Chat during voice/video calls
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="inCallChatToggle" ${settings.inCallChat ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Shared Whiteboard</div>
                                <div class="setting-description">
                                    Share a whiteboard during calls
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="sharedWhiteboardToggle" ${settings.sharedWhiteboard ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Shared Notes</div>
                                <div class="setting-description">
                                    Share notes during calls
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="sharedNotesToggle" ${settings.sharedNotes ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Polls</div>
                                <div class="setting-description">
                                    Create polls during group calls
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="pollsToggle" ${settings.polls ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Call History Cache</div>
                                <div class="setting-description">
                                    How much call history to cache locally
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="callHistoryCacheSelect">
                                    <option value="30days" ${settings.callHistoryCache === '30days' ? 'selected' : ''}>30 Days</option>
                                    <option value="90days" ${settings.callHistoryCache === '90days' ? 'selected' : ''}>90 Days</option>
                                    <option value="180days" ${settings.callHistoryCache === '180days' ? 'selected' : ''}>180 Days</option>
                                    <option value="all" ${settings.callHistoryCache === 'all' ? 'selected' : ''}>All</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Select change listeners
            const selects = ['callsWhoCanCallMeSelect', 'ringtoneSelect', 'videoQualitySelect', 
                           'cameraDefaultSelect', 'callHistoryCacheSelect'];
            selects.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Select', '');
                        // Handle special case for whoCanCallMe
                        if (id === 'callsWhoCanCallMeSelect') {
                            userSettings.calls.whoCanCallMe = element.value;
                        } else {
                            userSettings.calls[property] = element.value;
                        }
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
            
            // Toggle change listeners
            const toggles = ['callVerificationToggle', 'callVibrationToggle', 'autoAnswerToggle',
                           'noiseCancellationToggle', 'echoCancellationToggle', 'liveReactionsToggle',
                           'inCallChatToggle', 'sharedWhiteboardToggle', 'sharedNotesToggle', 'pollsToggle'];
            toggles.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Toggle', '');
                        userSettings.calls[property] = element.checked;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
        }
        
        // STATUS SECTION (12 features)
        function loadStatusSection(container) {
            const settings = userSettings.status;
            
            container.innerHTML = `
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-circle section-icon"></i> Status Privacy</h3>
                        <div class="section-description">
                            Control who can see your status updates
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Who Can View My Status</div>
                                <div class="setting-description">
                                    Control who can see your status updates
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="whoCanViewMyStatusSelect">
                                    <option value="everyone" ${settings.whoCanViewMyStatus === 'everyone' ? 'selected' : ''}>Everyone</option>
                                    <option value="friendsOnly" ${settings.whoCanViewMyStatus === 'friendsOnly' ? 'selected' : ''}>Friends Only</option>
                                    <option value="selectedFriends" ${settings.whoCanViewMyStatus === 'selectedFriends' ? 'selected' : ''}>Selected Friends</option>
                                    <option value="nobody" ${settings.whoCanViewMyStatus === 'nobody' ? 'selected' : ''}>Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Auto-Expire Status</div>
                                <div class="setting-description">
                                    Automatically remove status after specified time
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="autoExpireStatusSelect">
                                    <option value="24h" ${settings.autoExpireStatus === '24h' ? 'selected' : ''}>24 Hours</option>
                                    <option value="12h" ${settings.autoExpireStatus === '12h' ? 'selected' : ''}>12 Hours</option>
                                    <option value="6h" ${settings.autoExpireStatus === '6h' ? 'selected' : ''}>6 Hours</option>
                                    <option value="1h" ${settings.autoExpireStatus === '1h' ? 'selected' : ''}>1 Hour</option>
                                    <option value="custom" ${settings.autoExpireStatus === 'custom' ? 'selected' : ''}>Custom</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Reply Permissions</div>
                                <div class="setting-description">
                                    Who can reply to your status
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="replyPermissionsSelect">
                                    <option value="everyone" ${settings.replyPermissions === 'everyone' ? 'selected' : ''}>Everyone</option>
                                    <option value="friendsOnly" ${settings.replyPermissions === 'friendsOnly' ? 'selected' : ''}>Friends Only</option>
                                    <option value="nobody" ${settings.replyPermissions === 'nobody' ? 'selected' : ''}>Nobody</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Download Permissions</div>
                                <div class="setting-description">
                                    Allow others to download your status media
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="downloadPermissionsToggle" ${settings.downloadPermissions ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Hide from Specific Users</div>
                                <div class="setting-description">
                                    Hide your status from specific users
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button" id="hideFromUsersBtn">
                                    <i class="fas fa-user-slash"></i> Manage
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-chart-bar section-icon"></i> Status Analytics</h3>
                        <div class="section-description">
                            Analytics and engagement features
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">View Count</div>
                                <div class="setting-description">
                                    Show how many people viewed your status
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="viewCountToggle" ${settings.viewCount ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Viewer List</div>
                                <div class="setting-description">
                                    Show who viewed your status
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="viewerListToggle" ${settings.viewerList ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Engagement Reactions</div>
                                <div class="setting-description">
                                    Allow reactions to your status
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="engagementReactionsToggle" ${settings.engagementReactions ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-magic section-icon"></i> Status Enhancements</h3>
                        <div class="section-description">
                            AI and automation features for status
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Auto Captions</div>
                                <div class="setting-description">
                                    Automatically add captions to video status
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="autoCaptionsToggle" ${settings.autoCaptions ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">AI Enhancement</div>
                                <div class="setting-description">
                                    Use AI to enhance status quality
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="aiEnhancementToggle" ${settings.aiEnhancement ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Status Scheduling</div>
                                <div class="setting-description">
                                    Schedule status posts for later
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="statusSchedulingToggle" ${settings.statusScheduling ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Status Cache</div>
                                <div class="setting-description">
                                    How much status data to cache locally
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="statusCacheSelect">
                                    <option value="24hours" ${settings.statusCache === '24hours' ? 'selected' : ''}>24 Hours</option>
                                    <option value="7days" ${settings.statusCache === '7days' ? 'selected' : ''}>7 Days</option>
                                    <option value="none" ${settings.statusCache === 'none' ? 'selected' : ''}>None</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for status section
            document.getElementById('hideFromUsersBtn').addEventListener('click', () => {
                showNotification('User selection feature would open here', 'info');
            });
            
            // Select change listeners
            const selects = ['whoCanViewMyStatusSelect', 'autoExpireStatusSelect', 'replyPermissionsSelect', 'statusCacheSelect'];
            selects.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Select', '');
                        userSettings.status[property] = element.value;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
            
            // Toggle change listeners
            const toggles = ['downloadPermissionsToggle', 'viewCountToggle', 'viewerListToggle',
                           'engagementReactionsToggle', 'autoCaptionsToggle', 'aiEnhancementToggle',
                           'statusSchedulingToggle'];
            toggles.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Toggle', '');
                        userSettings.status[property] = element.checked;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
        }
        
        // NOTIFICATIONS SECTION (13 features)
        function loadNotificationsSection(container) {
            const settings = userSettings.notifications;
            
            container.innerHTML = `
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-bell section-icon"></i> Notification Types</h3>
                        <div class="section-description">
                            Control which notifications you receive
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Message Notifications</div>
                                <div class="setting-description">
                                    Notifications for new messages
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="messageNotificationsToggle" ${settings.messageNotifications ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Group Notifications</div>
                                <div class="setting-description">
                                    Notifications for group activity
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="groupNotificationsToggle" ${settings.groupNotifications ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Friend Request Notifications</div>
                                <div class="setting-description">
                                    Notifications for friend requests
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="friendRequestNotificationsToggle" ${settings.friendRequestNotifications ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Call Notifications</div>
                                <div class="setting-description">
                                    Notifications for incoming calls
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="callNotificationsToggle" ${settings.callNotifications ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Status Notifications</div>
                                <div class="setting-description">
                                    Notifications for status updates
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="statusNotificationsToggle" ${settings.statusNotifications ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-volume-up section-icon"></i> Notification Preferences</h3>
                        <div class="section-description">
                            How notifications are delivered
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Notification Sound</div>
                                <div class="setting-description">
                                    Play sound for notifications
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="notificationSoundToggle" ${settings.notificationSound ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Vibration</div>
                                <div class="setting-description">
                                    Vibrate for notifications
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="vibrationToggle" ${settings.vibration ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Popup Notifications</div>
                                <div class="setting-description">
                                    Show popup notifications
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="popupNotificationsToggle" ${settings.popupNotifications ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Notification Light</div>
                                <div class="setting-description">
                                    Use notification LED (if available)
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="notificationLightToggle" ${settings.notificationLight ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-moon section-icon"></i> Do Not Disturb</h3>
                        <div class="section-description">
                            Quiet hours and disturbance control
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Do Not Disturb</div>
                                <div class="setting-description">
                                    Silence all notifications
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="doNotDisturbToggle" ${settings.doNotDisturb ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Schedule</div>
                                <div class="setting-description">
                                    When to enable Do Not Disturb
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="scheduleSelect">
                                    <option value="custom" ${settings.schedule === 'custom' ? 'selected' : ''}>Custom Hours</option>
                                    <option value="night" ${settings.schedule === 'night' ? 'selected' : ''}>Night (10pm-7am)</option>
                                    <option value="workHours" ${settings.schedule === 'workHours' ? 'selected' : ''}>Work Hours (9am-5pm)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Allow Calls</div>
                                <div class="setting-description">
                                    Allow calls even during Do Not Disturb
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="allowCallsToggle" ${settings.allowCalls ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Allow Messages From</div>
                                <div class="setting-description">
                                    Allow messages from specific contacts during DND
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button" id="allowMessagesFromBtn">
                                    <i class="fas fa-users"></i> Select
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for notifications section
            document.getElementById('allowMessagesFromBtn').addEventListener('click', () => {
                showNotification('Contact selection feature would open here', 'info');
            });
            
            // Select change listener
            document.getElementById('scheduleSelect').addEventListener('change', function() {
                userSettings.notifications.schedule = this.value;
                unsavedChanges = true;
                updateSaveButton();
            });
            
            // Toggle change listeners
            const toggles = ['messageNotificationsToggle', 'groupNotificationsToggle', 'friendRequestNotificationsToggle',
                           'callNotificationsToggle', 'statusNotificationsToggle', 'notificationSoundToggle',
                           'vibrationToggle', 'popupNotificationsToggle', 'notificationLightToggle',
                           'doNotDisturbToggle', 'allowCallsToggle'];
            toggles.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Toggle', '');
                        userSettings.notifications[property] = element.checked;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
        }
        
        // APPEARANCE SECTION (13 features)
        function loadAppearanceSection(container) {
            const settings = userSettings.appearance;
            
            container.innerHTML = `
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-palette section-icon"></i> Theme & Colors</h3>
                        <div class="section-description">
                            Customize the look and feel of the app
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Theme</div>
                                <div class="setting-description">
                                    Choose your preferred theme
                                </div>
                            </div>
                            <div class="setting-control">
                                <div class="radio-group">
                                    <label class="radio-option">
                                        <input type="radio" name="theme" class="radio-input" value="light" ${settings.theme === 'light' ? 'checked' : ''}>
                                        <span class="radio-label">Light</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="theme" class="radio-input" value="dark" ${settings.theme === 'dark' ? 'checked' : ''}>
                                        <span class="radio-label">Dark</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="theme" class="radio-input" value="auto" ${settings.theme === 'auto' ? 'checked' : ''}>
                                        <span class="radio-label">Auto</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Accent Color</div>
                                <div class="setting-description">
                                    Choose the primary color for the app
                                </div>
                            </div>
                            <div class="setting-control">
                                <div class="color-picker" id="accentColorPicker" 
                                     style="background-color: ${settings.accentColor};"
                                     title="Click to change color"></div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Font Size</div>
                                <div class="setting-description">
                                    Adjust the text size (${settings.fontSize}px)
                                </div>
                            </div>
                            <div class="setting-control">
                                <input type="range" class="setting-slider" id="fontSizeSlider" 
                                       min="12" max="20" value="${settings.fontSize}" step="1">
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Reduce Motion</div>
                                <div class="setting-description">
                                    Reduce animations and motion effects
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="reduceMotionToggle" ${settings.reduceMotion ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Mood-Based Layouts</div>
                                <div class="setting-description">
                                    Change layout based on your current mood
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="moodBasedLayoutsToggle" ${settings.moodBasedLayouts ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-globe section-icon"></i> Language & Region</h3>
                        <div class="section-description">
                            Regional and language settings
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Language</div>
                                <div class="setting-description">
                                    Choose your preferred language
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="languageSelect">
                                    <option value="en" ${settings.language === 'en' ? 'selected' : ''}>English</option>
                                    <option value="es" ${settings.language === 'es' ? 'selected' : ''}>Espaol</option>
                                    <option value="fr" ${settings.language === 'fr' ? 'selected' : ''}>Franais</option>
                                    <option value="de" ${settings.language === 'de' ? 'selected' : ''}>Deutsch</option>
                                    <option value="zh" ${settings.language === 'zh' ? 'selected' : ''}></option>
                                    <option value="ar" ${settings.language === 'ar' ? 'selected' : ''}></option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Time Format</div>
                                <div class="setting-description">
                                    Choose 12-hour or 24-hour time format
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="timeFormatSelect">
                                    <option value="12-hour" ${settings.timeFormat === '12-hour' ? 'selected' : ''}>12-hour (1:30 PM)</option>
                                    <option value="24-hour" ${settings.timeFormat === '24-hour' ? 'selected' : ''}>24-hour (13:30)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Date Format</div>
                                <div class="setting-description">
                                    Choose your preferred date format
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="dateFormatSelect">
                                    <option value="MM/DD/YYYY" ${settings.dateFormat === 'MM/DD/YYYY' ? 'selected' : ''}>MM/DD/YYYY</option>
                                    <option value="DD/MM/YYYY" ${settings.dateFormat === 'DD/MM/YYYY' ? 'selected' : ''}>DD/MM/YYYY</option>
                                    <option value="YYYY-MM-DD" ${settings.dateFormat === 'YYYY-MM-DD' ? 'selected' : ''}>YYYY-MM-DD</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-th-large section-icon"></i> Layout & Icons</h3>
                        <div class="section-description">
                            Customize layout and icon styles
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Layout Mode</div>
                                <div class="setting-description">
                                    Choose your preferred layout style
                                </div>
                            </div>
                            <div class="setting-control">
                                <div class="radio-group">
                                    <label class="radio-option">
                                        <input type="radio" name="layoutMode" class="radio-input" value="compact" ${settings.layoutMode === 'compact' ? 'checked' : ''}>
                                        <span class="radio-label">Compact</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="layoutMode" class="radio-input" value="detailed" ${settings.layoutMode === 'detailed' ? 'checked' : ''}>
                                        <span class="radio-label">Detailed</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="layoutMode" class="radio-input" value="focus" ${settings.layoutMode === 'focus' ? 'checked' : ''}>
                                        <span class="radio-label">Focus</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="layoutMode" class="radio-input" value="auto" ${settings.layoutMode === 'auto' ? 'checked' : ''}>
                                        <span class="radio-label">Auto</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Layout Previews</div>
                                <div class="setting-description">
                                    Preview different layout modes
                                </div>
                            </div>
                            <div class="setting-control">
                                <div class="layout-previews">
                                    <div class="layout-preview ${settings.layoutMode === 'compact' ? 'selected' : ''}" data-layout="compact">
                                        <div class="preview-thumbnail" style="background: linear-gradient(to bottom, var(--primary-color) 20%, var(--bg-color) 20%);"></div>
                                        <div class="preview-title">Compact</div>
                                    </div>
                                    <div class="layout-preview ${settings.layoutMode === 'detailed' ? 'selected' : ''}" data-layout="detailed">
                                        <div class="preview-thumbnail" style="background: linear-gradient(to bottom, var(--primary-color) 40%, var(--bg-color) 40%);"></div>
                                        <div class="preview-title">Detailed</div>
                                    </div>
                                    <div class="layout-preview ${settings.layoutMode === 'focus' ? 'selected' : ''}" data-layout="focus">
                                        <div class="preview-thumbnail" style="background: linear-gradient(to bottom, var(--primary-color) 60%, var(--bg-color) 40%);"></div>
                                        <div class="preview-title">Focus</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Custom Icons</div>
                                <div class="setting-description">
                                    Use custom icon sets
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="customIconsToggle" ${settings.customIcons ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Button Styles</div>
                                <div class="setting-description">
                                    Choose button style throughout the app
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="buttonStylesSelect">
                                    <option value="rounded" ${settings.buttonStyles === 'rounded' ? 'selected' : ''}>Rounded</option>
                                    <option value="square" ${settings.buttonStyles === 'square' ? 'selected' : ''}>Square</option>
                                    <option value="pill" ${settings.buttonStyles === 'pill' ? 'selected' : ''}>Pill</option>
                                    <option value="floating" ${settings.buttonStyles === 'floating' ? 'selected' : ''}>Floating</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for appearance section
            // Theme radio buttons
            document.querySelectorAll('input[name="theme"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    userSettings.appearance.theme = this.value;
                    unsavedChanges = true;
                    updateSaveButton();
                    applyTheme(this.value);
                });
            });
            
            // Layout radio buttons
            document.querySelectorAll('input[name="layoutMode"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    userSettings.appearance.layoutMode = this.value;
                    unsavedChanges = true;
                    updateSaveButton();
                    
                    // Update layout preview selection
                    document.querySelectorAll('.layout-preview').forEach(preview => {
                        preview.classList.remove('selected');
                        if (preview.dataset.layout === this.value) {
                            preview.classList.add('selected');
                        }
                    });
                });
            });
            
            // Layout preview clicks
            document.querySelectorAll('.layout-preview').forEach(preview => {
                preview.addEventListener('click', function() {
                    const layout = this.dataset.layout;
                    userSettings.appearance.layoutMode = layout;
                    unsavedChanges = true;
                    updateSaveButton();
                    
                    // Update radio button
                    document.querySelector(`input[name="layoutMode"][value="${layout}"]`).checked = true;
                    
                    // Update preview selection
                    document.querySelectorAll('.layout-preview').forEach(p => {
                        p.classList.remove('selected');
                    });
                    this.classList.add('selected');
                });
            });
            
            // Color picker
            document.getElementById('accentColorPicker').addEventListener('click', function() {
                colorPicker.show();
            });
            
            // Font size slider
            document.getElementById('fontSizeSlider').addEventListener('input', function() {
                userSettings.appearance.fontSize = parseInt(this.value);
                unsavedChanges = true;
                updateSaveButton();
                applyFontSize(this.value);
            });
            
            // Select change listeners
            const selects = ['languageSelect', 'timeFormatSelect', 'dateFormatSelect', 'buttonStylesSelect'];
            selects.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Select', '');
                        userSettings.appearance[property] = element.value;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
            
            // Toggle change listeners
            const toggles = ['reduceMotionToggle', 'moodBasedLayoutsToggle', 'customIconsToggle'];
            toggles.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Toggle', '');
                        userSettings.appearance[property] = element.checked;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
        }
        
        // STORAGE SECTION (7 features)
        function loadStorageSection(container) {
            const settings = userSettings.storage;
            const totalUsed = settings.totalStorageUsed;
            const totalAvailable = settings.storageTotal;
            const percentUsed = (totalUsed / totalAvailable) * 100;
            
            container.innerHTML = `
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-database section-icon"></i> Storage Overview</h3>
                        <div class="section-description">
                            Monitor your storage usage
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="storage-info">
                            <div class="storage-header">
                                <div class="storage-label">Total Storage Used</div>
                                <div class="storage-value">${formatStorageSize(totalUsed)} / ${formatStorageSize(totalAvailable)}</div>
                            </div>
                            <div class="storage-bar">
                                <div class="storage-fill" style="width: ${percentUsed}%;"></div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Chat Storage</div>
                                <div class="setting-description">
                                    Messages and chat data
                                </div>
                            </div>
                            <div class="setting-control">
                                <div class="storage-value">${formatStorageSize(settings.storageBreakdown.chats)}</div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Media Storage</div>
                                <div class="setting-description">
                                    Photos, videos, and documents
                                </div>
                            </div>
                            <div class="setting-control">
                                <div class="storage-value">${formatStorageSize(settings.storageBreakdown.media)}</div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Other Storage</div>
                                <div class="setting-description">
                                    Cache and other app data
                                </div>
                            </div>
                            <div class="setting-control">
                                <div class="storage-value">${formatStorageSize(settings.storageBreakdown.other)}</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-broom section-icon"></i> Cache Management</h3>
                        <div class="section-description">
                            Manage cached data and storage
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Auto-Clear Cache</div>
                                <div class="setting-description">
                                    Automatically clear cache at intervals
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="autoClearCacheSelect">
                                    <option value="never" ${settings.autoClearCache === 'never' ? 'selected' : ''}>Never</option>
                                    <option value="weekly" ${settings.autoClearCache === 'weekly' ? 'selected' : ''}>Weekly</option>
                                    <option value="monthly" ${settings.autoClearCache === 'monthly' ? 'selected' : ''}>Monthly</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Clear Chat Cache</div>
                                <div class="setting-description">
                                    Clear cached chat data
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button" id="clearChatCacheBtn">
                                    <i class="fas fa-trash"></i> Clear Now
                                </button>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Clear Media Cache</div>
                                <div class="setting-description">
                                    Clear cached media files
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button" id="clearMediaCacheBtn">
                                    <i class="fas fa-trash"></i> Clear Now
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for storage section
            document.getElementById('clearChatCacheBtn').addEventListener('click', () => {
                showConfirmation(
                    'Clear Chat Cache',
                    'Are you sure you want to clear all chat cache? This will remove temporary chat data but not your messages.',
                    () => {
                        clearChatCache();
                    }
                );
            });
            
            document.getElementById('clearMediaCacheBtn').addEventListener('click', () => {
                showConfirmation(
                    'Clear Media Cache',
                    'Are you sure you want to clear all media cache? This will remove downloaded media files but they can be re-downloaded.',
                    () => {
                        clearMediaCache();
                    }
                );
            });
            
            // Select change listener
            document.getElementById('autoClearCacheSelect').addEventListener('change', function() {
                userSettings.storage.autoClearCache = this.value;
                unsavedChanges = true;
                updateSaveButton();
            });
        }
        
        // MOOD SETTINGS SECTION (24 features)
        function loadMoodSection(container) {
            const settings = userSettings.mood;
            
            container.innerHTML = `
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-smile section-icon"></i> Mood Detection</h3>
                        <div class="section-description">
                            Configure how your mood is detected and displayed
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Auto Mood Detection</div>
                                <div class="setting-description">
                                    Automatically detect your mood based on activity
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="autoMoodDetectionToggle" ${settings.autoMoodDetection ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Manual Mood Override</div>
                                <div class="setting-description">
                                    Manually set your mood instead of auto-detection
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="manualMoodOverrideSelect">
                                    <option value="autoDetect" ${settings.manualMoodOverride === 'autoDetect' ? 'selected' : ''}>Auto-Detect</option>
                                    <option value="happy" ${settings.manualMoodOverride === 'happy' ? 'selected' : ''}>Happy</option>
                                    <option value="calm" ${settings.manualMoodOverride === 'calm' ? 'selected' : ''}>Calm</option>
                                    <option value="energetic" ${settings.manualMoodOverride === 'energetic' ? 'selected' : ''}>Energetic</option>
                                    <option value="focused" ${settings.manualMoodOverride === 'focused' ? 'selected' : ''}>Focused</option>
                                    <option value="relaxed" ${settings.manualMoodOverride === 'relaxed' ? 'selected' : ''}>Relaxed</option>
                                    <option value="stressed" ${settings.manualMoodOverride === 'stressed' ? 'selected' : ''}>Stressed</option>
                                    <option value="tired" ${settings.manualMoodOverride === 'tired' ? 'selected' : ''}>Tired</option>
                                    <option value="excited" ${settings.manualMoodOverride === 'excited' ? 'selected' : ''}>Excited</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Update After Calls</div>
                                <div class="setting-description">
                                    Update mood based on call interactions
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="updateAfterCallsToggle" ${settings.updateAfterCalls ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Update After Status Posts</div>
                                <div class="setting-description">
                                    Update mood based on status content
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="updateAfterStatusPostsToggle" ${settings.updateAfterStatusPosts ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Update After Activity</div>
                                <div class="setting-description">
                                    Update mood based on app usage patterns
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="updateAfterActivityToggle" ${settings.updateAfterActivity ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-palette section-icon"></i> Mood Colors</h3>
                        <div class="section-description">
                            Customize colors for each mood type
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Mood-Linked Theme</div>
                                <div class="setting-description">
                                    Change app theme based on your mood
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="moodLinkedThemeToggle" ${settings.moodLinkedTheme ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="mood-colors-grid">
                            <div class="mood-color-item ${settings.currentMood === 'happy' ? 'active' : ''}" data-mood="happy">
                                <div class="mood-color-preview" style="background-color: ${settings.moodColors.happy};"></div>
                                <div class="mood-color-label">Happy</div>
                            </div>
                            <div class="mood-color-item ${settings.currentMood === 'calm' ? 'active' : ''}" data-mood="calm">
                                <div class="mood-color-preview" style="background-color: ${settings.moodColors.calm};"></div>
                                <div class="mood-color-label">Calm</div>
                            </div>
                            <div class="mood-color-item ${settings.currentMood === 'energetic' ? 'active' : ''}" data-mood="energetic">
                                <div class="mood-color-preview" style="background-color: ${settings.moodColors.energetic};"></div>
                                <div class="mood-color-label">Energetic</div>
                            </div>
                            <div class="mood-color-item ${settings.currentMood === 'focused' ? 'active' : ''}" data-mood="focused">
                                <div class="mood-color-preview" style="background-color: ${settings.moodColors.focused};"></div>
                                <div class="mood-color-label">Focused</div>
                            </div>
                            <div class="mood-color-item ${settings.currentMood === 'relaxed' ? 'active' : ''}" data-mood="relaxed">
                                <div class="mood-color-preview" style="background-color: ${settings.moodColors.relaxed};"></div>
                                <div class="mood-color-label">Relaxed</div>
                            </div>
                            <div class="mood-color-item ${settings.currentMood === 'stressed' ? 'active' : ''}" data-mood="stressed">
                                <div class="mood-color-preview" style="background-color: ${settings.moodColors.stressed};"></div>
                                <div class="mood-color-label">Stressed</div>
                            </div>
                            <div class="mood-color-item ${settings.currentMood === 'tired' ? 'active' : ''}" data-mood="tired">
                                <div class="mood-color-preview" style="background-color: ${settings.moodColors.tired};"></div>
                                <div class="mood-color-label">Tired</div>
                            </div>
                            <div class="mood-color-item ${settings.currentMood === 'excited' ? 'active' : ''}" data-mood="excited">
                                <div class="mood-color-preview" style="background-color: ${settings.moodColors.excited};"></div>
                                <div class="mood-color-label">Excited</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; font-size: 12px; color: var(--text-secondary); text-align: center;">
                            Click on a mood to set it as current, or long press to edit its color
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-bell section-icon"></i> Mood-Based Features</h3>
                        <div class="section-description">
                            Smart features that adapt to your mood
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Smart Notifications</div>
                                <div class="setting-description">
                                    Adjust notification behavior based on mood
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="smartNotificationsToggle" ${settings.smartNotifications ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Mood Auto-Replies</div>
                                <div class="setting-description">
                                    Send automatic replies based on your mood
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="moodAutoRepliesToggle" ${settings.moodAutoReplies ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Smart Template Selection</div>
                                <div class="setting-description">
                                    Select message templates based on mood
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="smartTemplateSelectionToggle" ${settings.smartTemplateSelection ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-cog section-icon"></i> Mood Rules</h3>
                        <div class="section-description">
                            Configure rules for specific moods
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Stressed Mode Rules</div>
                                <div class="setting-description">
                                    Special rules when you're stressed
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="stressedModeRulesToggle" ${settings.stressedModeRules ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Focused Mode Rules</div>
                                <div class="setting-description">
                                    Special rules when you're focused
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="focusedModeRulesToggle" ${settings.focusedModeRules ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Happy Mode Rules</div>
                                <div class="setting-description">
                                    Special rules when you're happy
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="happyModeRulesToggle" ${settings.happyModeRules ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Mood Privacy Rules</div>
                                <div class="setting-description">
                                    Adjust privacy based on mood
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="moodPrivacyRulesToggle" ${settings.moodPrivacyRules ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Rule Duration</div>
                                <div class="setting-description">
                                    How long mood rules stay active
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="ruleDurationSelect">
                                    <option value="2hr" ${settings.ruleDuration === '2hr' ? 'selected' : ''}>2 Hours</option>
                                    <option value="6hr" ${settings.ruleDuration === '6hr' ? 'selected' : ''}>6 Hours</option>
                                    <option value="24hr" ${settings.ruleDuration === '24hr' ? 'selected' : ''}>24 Hours</option>
                                    <option value="untilMoodChanges" ${settings.ruleDuration === 'untilMoodChanges' ? 'selected' : ''}>Until Mood Changes</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for mood section
            // Mood color selection
            document.querySelectorAll('.mood-color-item').forEach(item => {
                item.addEventListener('click', function() {
                    const mood = this.dataset.mood;
                    userSettings.mood.currentMood = mood;
                    userSettings.profile.currentMood = mood;
                    unsavedChanges = true;
                    updateSaveButton();
                    
                    // Update active state
                    document.querySelectorAll('.mood-color-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    showNotification(`Mood set to ${mood}`, 'success');
                });
                
                // Long press for color editing (simplified)
                let pressTimer;
                item.addEventListener('mousedown', function(e) {
                    pressTimer = setTimeout(() => {
                        const mood = this.dataset.mood;
                        editMoodColor(mood);
                    }, 1000);
                });
                
                item.addEventListener('mouseup', function() {
                    clearTimeout(pressTimer);
                });
                
                item.addEventListener('mouseleave', function() {
                    clearTimeout(pressTimer);
                });
            });
            
            // Select change listeners
            const selects = ['manualMoodOverrideSelect', 'ruleDurationSelect'];
            selects.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Select', '');
                        userSettings.mood[property] = element.value;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
            
            // Toggle change listeners
            const toggles = ['autoMoodDetectionToggle', 'updateAfterCallsToggle', 'updateAfterStatusPostsToggle',
                           'updateAfterActivityToggle', 'moodLinkedThemeToggle', 'smartNotificationsToggle',
                           'moodAutoRepliesToggle', 'smartTemplateSelectionToggle', 'stressedModeRulesToggle',
                           'focusedModeRulesToggle', 'happyModeRulesToggle', 'moodPrivacyRulesToggle'];
            toggles.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Toggle', '');
                        userSettings.mood[property] = element.checked;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
        }
        
        // SMART ACTIVITY SECTION (18 features)
        function loadActivitySection(container) {
            const settings = userSettings.activity;
            
            container.innerHTML = `
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-brain section-icon"></i> Focus Mode</h3>
                        <div class="section-description">
                            Stay focused with minimal distractions
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Focus Mode</div>
                                <div class="setting-description">
                                    Enable focus mode to minimize distractions
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="focusModeToggle" ${settings.focusMode ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Focus Duration</div>
                                <div class="setting-description">
                                    How long focus mode stays active
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="focusDurationSelect">
                                    <option value="30min" ${settings.focusDuration === '30min' ? 'selected' : ''}>30 Minutes</option>
                                    <option value="1hr" ${settings.focusDuration === '1hr' ? 'selected' : ''}>1 Hour</option>
                                    <option value="2hr" ${settings.focusDuration === '2hr' ? 'selected' : ''}>2 Hours</option>
                                    <option value="custom" ${settings.focusDuration === 'custom' ? 'selected' : ''}>Custom</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Auto-Enable Focus Mode</div>
                                <div class="setting-description">
                                    Automatically enable focus mode based on schedule
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="autoEnableFocusModeToggle" ${settings.autoEnableFocusMode ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-user-shield section-icon"></i> Focus Mode Exceptions</h3>
                        <div class="section-description">
                            Allow specific contacts during focus mode
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Essential Contacts</div>
                                <div class="setting-description">
                                    Allow messages from essential contacts
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="focusModeEssentialContactsToggle" ${settings.focusModeEssentialContacts ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Urgent Calls</div>
                                <div class="setting-description">
                                    Allow urgent calls during focus mode
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="focusModeUrgentCallsToggle" ${settings.focusModeUrgentCalls ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Work Messages</div>
                                <div class="setting-description">
                                    Allow work-related messages
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="focusModeWorkMessagesToggle" ${settings.focusModeWorkMessages ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Family Messages</div>
                                <div class="setting-description">
                                    Allow family messages
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="focusModeFamilyMessagesToggle" ${settings.focusModeFamilyMessages ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-archive section-icon"></i> Auto-Archive</h3>
                        <div class="section-description">
                            Automatically archive inactive chats
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Auto-Archive Chats</div>
                                <div class="setting-description">
                                    Automatically archive inactive chats
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="autoArchiveChatsToggle" ${settings.autoArchiveChats ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Inactivity Period</div>
                                <div class="setting-description">
                                    Archive chats inactive for specified period
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="inactivityPeriodSelect">
                                    <option value="30" ${settings.inactivityPeriod === '30' ? 'selected' : ''}>30 Days</option>
                                    <option value="60" ${settings.inactivityPeriod === '60' ? 'selected' : ''}>60 Days</option>
                                    <option value="90" ${settings.inactivityPeriod === '90' ? 'selected' : ''}>90 Days</option>
                                    <option value="180" ${settings.inactivityPeriod === '180' ? 'selected' : ''}>180 Days</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Exclude Important Chats</div>
                                <div class="setting-description">
                                    Don't archive important/pinned chats
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="excludeImportantChatsToggle" ${settings.excludeImportantChats ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Archive Notifications</div>
                                <div class="setting-description">
                                    Notify when chats are archived
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="archiveNotificationsToggle" ${settings.archiveNotifications ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-database section-icon"></i> Data Caching</h3>
                        <div class="section-description">
                            Control how data is cached for offline use
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Offline Data Control</div>
                                <div class="setting-description">
                                    How much data to store for offline use
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="offlineDataControlSelect">
                                    <option value="minimal" ${settings.offlineDataControl === 'minimal' ? 'selected' : ''}>Minimal</option>
                                    <option value="balanced" ${settings.offlineDataControl === 'balanced' ? 'selected' : ''}>Balanced</option>
                                    <option value="extended" ${settings.offlineDataControl === 'extended' ? 'selected' : ''}>Extended</option>
                                    <option value="custom" ${settings.offlineDataControl === 'custom' ? 'selected' : ''}>Custom</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Chat Page Cache</div>
                                <div class="setting-description">
                                    How much chat history to cache
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="chatPageCacheSelect">
                                    <option value="7days" ${settings.chatPageCache === '7days' ? 'selected' : ''}>7 Days</option>
                                    <option value="30days" ${settings.chatPageCache === '30days' ? 'selected' : ''}>30 Days</option>
                                    <option value="90days" ${settings.chatPageCache === '90days' ? 'selected' : ''}>90 Days</option>
                                    <option value="all" ${settings.chatPageCache === 'all' ? 'selected' : ''}>All</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Call History Cache</div>
                                <div class="setting-description">
                                    How much call history to cache
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="callHistoryCacheActivitySelect">
                                    <option value="30days" ${settings.callHistoryCacheActivity === '30days' ? 'selected' : ''}>30 Days</option>
                                    <option value="90days" ${settings.callHistoryCacheActivity === '90days' ? 'selected' : ''}>90 Days</option>
                                    <option value="180days" ${settings.callHistoryCacheActivity === '180days' ? 'selected' : ''}>180 Days</option>
                                    <option value="all" ${settings.callHistoryCacheActivity === 'all' ? 'selected' : ''}>All</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Group Data Cache</div>
                                <div class="setting-description">
                                    How much group data to cache
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="groupDataCacheActivitySelect">
                                    <option value="activeGroupsOnly" ${settings.groupDataCacheActivity === 'activeGroupsOnly' ? 'selected' : ''}>Active groups only</option>
                                    <option value="allGroups" ${settings.groupDataCacheActivity === 'allGroups' ? 'selected' : ''}>All groups</option>
                                    <option value="noGroupCache" ${settings.groupDataCacheActivity === 'noGroupCache' ? 'selected' : ''}>No group cache</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Status Cache</div>
                                <div class="setting-description">
                                    How much status data to cache
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="statusCacheActivitySelect">
                                    <option value="24hours" ${settings.statusCacheActivity === '24hours' ? 'selected' : ''}>24 Hours</option>
                                    <option value="7days" ${settings.statusCacheActivity === '7days' ? 'selected' : ''}>7 Days</option>
                                    <option value="none" ${settings.statusCacheActivity === 'none' ? 'selected' : ''}>None</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Select change listeners
            const selects = ['focusDurationSelect', 'inactivityPeriodSelect', 'offlineDataControlSelect',
                           'chatPageCacheSelect', 'callHistoryCacheActivitySelect', 'groupDataCacheActivitySelect',
                           'statusCacheActivitySelect'];
            selects.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Select', '');
                        userSettings.activity[property] = element.value;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
            
            // Toggle change listeners
            const toggles = ['focusModeToggle', 'autoEnableFocusModeToggle', 'focusModeEssentialContactsToggle',
                           'focusModeUrgentCallsToggle', 'focusModeWorkMessagesToggle', 'focusModeFamilyMessagesToggle',
                           'autoArchiveChatsToggle', 'excludeImportantChatsToggle', 'archiveNotificationsToggle'];
            toggles.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Toggle', '');
                        userSettings.activity[property] = element.checked;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
        }
        
        // INTERACTION INTELLIGENCE SECTION (23 features)
        function loadIntelligenceSection(container) {
            const settings = userSettings.intelligence;
            
            container.innerHTML = `
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-eye section-icon"></i> Smart Visibility</h3>
                        <div class="section-description">
                            Intelligent visibility control based on context
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Smart Visibility</div>
                                <div class="setting-description">
                                    Automatically adjust visibility based on context
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="smartVisibilityToggle" ${settings.smartVisibility ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Visible To Groups</div>
                                <div class="setting-description">
                                    Control which groups can see you
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button" id="visibleToGroupsBtn">
                                    <i class="fas fa-users"></i> Select Groups
                                </button>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Visible To Contacts</div>
                                <div class="setting-description">
                                    Control which contacts can see you
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button" id="visibleToContactsBtn">
                                    <i class="fas fa-address-book"></i> Select Contacts
                                </button>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Time-Based Visibility</div>
                                <div class="setting-description">
                                    Adjust visibility based on time of day
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="timeBasedVisibilityToggle" ${settings.timeBasedVisibility ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Activity-Based Visibility</div>
                                <div class="setting-description">
                                    Adjust visibility based on your activity
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="activityBasedVisibilityToggle" ${settings.activityBasedVisibility ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-chart-line section-icon"></i> Interaction Analytics</h3>
                        <div class="section-description">
                            Insights about your interactions and usage
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Interaction Analytics</div>
                                <div class="setting-description">
                                    Track and analyze your interactions
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="interactionAnalyticsToggle" ${settings.interactionAnalytics ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Most Contacted</div>
                                <div class="setting-description">
                                    People you interact with most frequently
                                </div>
                            </div>
                            <div class="setting-control">
                                <div class="setting-value">${settings.mostContacted} contacts</div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Average Response Time</div>
                                <div class="setting-description">
                                    Your average time to respond to messages
                                </div>
                            </div>
                            <div class="setting-control">
                                <div class="setting-value">${settings.responseTime} minutes</div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Active Hours</div>
                                <div class="setting-description">
                                    When you're most active on the app
                                </div>
                            </div>
                            <div class="setting-control">
                                <div class="setting-value">${settings.activeHours || 'Not calculated'}</div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Engagement Score</div>
                                <div class="setting-description">
                                    Your overall engagement level
                                </div>
                            </div>
                            <div class="setting-control">
                                <div class="setting-value">${settings.engagementScore}/100</div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Weekly Reports</div>
                                <div class="setting-description">
                                    Receive weekly interaction reports
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="weeklyReportsToggle" ${settings.weeklyReports ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Interaction Trends</div>
                                <div class="setting-description">
                                    Show trends in your interactions over time
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="interactionTrendsToggle" ${settings.interactionTrends ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-reply section-icon"></i> Smart Replies</h3>
                        <div class="section-description">
                            Intelligent auto-replies based on mood and context
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Mood Auto-Replies</div>
                                <div class="setting-description">
                                    Send automatic replies based on your mood
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="moodAutoRepliesIntelligenceToggle" ${settings.moodAutoReplies ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Busy Mood Template</div>
                                <div class="setting-description">
                                    Auto-reply when you're busy
                                </div>
                            </div>
                            <div class="setting-control">
                                <input type="text" class="setting-input" id="busyMoodTemplateInput" 
                                       value="${escapeHtml(settings.busyMoodTemplate)}" 
                                       style="width: 250px;"
                                       placeholder="Auto-reply message for busy mood">
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Focused Mood Template</div>
                                <div class="setting-description">
                                    Auto-reply when you're focused
                                </div>
                            </div>
                            <div class="setting-control">
                                <input type="text" class="setting-input" id="focusedMoodTemplateInput" 
                                       value="${escapeHtml(settings.focusedMoodTemplate)}" 
                                       style="width: 250px;"
                                       placeholder="Auto-reply message for focused mood">
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Relaxed Mood Template</div>
                                <div class="setting-description">
                                    Auto-reply when you're relaxed
                                </div>
                            </div>
                            <div class="setting-control">
                                <input type="text" class="setting-input" id="relaxedMoodTemplateInput" 
                                       value="${escapeHtml(settings.relaxedMoodTemplate)}" 
                                       style="width: 250px;"
                                       placeholder="Auto-reply message for relaxed mood">
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Smart Template Selection</div>
                                <div class="setting-description">
                                    Intelligently select reply templates based on context
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="smartTemplateSelectionIntelligenceToggle" ${settings.smartTemplateSelection ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for intelligence section
            document.getElementById('visibleToGroupsBtn').addEventListener('click', () => {
                showNotification('Group selection feature would open here', 'info');
            });
            
            document.getElementById('visibleToContactsBtn').addEventListener('click', () => {
                showNotification('Contact selection feature would open here', 'info');
            });
            
            // Input change listeners
            const inputs = ['busyMoodTemplateInput', 'focusedMoodTemplateInput', 'relaxedMoodTemplateInput'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Input', '');
                        userSettings.intelligence[property] = element.value;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
            
            // Toggle change listeners
            const toggles = ['smartVisibilityToggle', 'timeBasedVisibilityToggle', 'activityBasedVisibilityToggle',
                           'interactionAnalyticsToggle', 'weeklyReportsToggle', 'interactionTrendsToggle',
                           'moodAutoRepliesIntelligenceToggle', 'smartTemplateSelectionIntelligenceToggle'];
            toggles.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Toggle', '').replace('Intelligence', '');
                        userSettings.intelligence[property] = element.checked;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
        }
        
        // PERSONALIZATION SECTION (17 features)
        function loadPersonalizationSection(container) {
            const settings = userSettings.personalization;
            
            container.innerHTML = `
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-sliders-h section-icon"></i> Layout & Navigation</h3>
                        <div class="section-description">
                            Customize how you navigate the app
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Layout Mode</div>
                                <div class="setting-description">
                                    Choose your preferred layout style
                                </div>
                            </div>
                            <div class="setting-control">
                                <div class="radio-group">
                                    <label class="radio-option">
                                        <input type="radio" name="personalizationLayoutMode" class="radio-input" value="compact" ${settings.layoutMode === 'compact' ? 'checked' : ''}>
                                        <span class="radio-label">Compact</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="personalizationLayoutMode" class="radio-input" value="detailed" ${settings.layoutMode === 'detailed' ? 'checked' : ''}>
                                        <span class="radio-label">Detailed</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="personalizationLayoutMode" class="radio-input" value="focus" ${settings.layoutMode === 'focus' ? 'checked' : ''}>
                                        <span class="radio-label">Focus</span>
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="personalizationLayoutMode" class="radio-input" value="auto" ${settings.layoutMode === 'auto' ? 'checked' : ''}>
                                        <span class="radio-label">Auto</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Quick Access</div>
                                <div class="setting-description">
                                    Enable quick access shortcuts
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="quickAccessToggle" ${settings.quickAccess ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Shortcut Position</div>
                                <div class="setting-description">
                                    Where to display quick access shortcuts
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="shortcutPositionSelect">
                                    <option value="topBar" ${settings.shortcutPosition === 'topBar' ? 'selected' : ''}>Top Bar</option>
                                    <option value="sidebar" ${settings.shortcutPosition === 'sidebar' ? 'selected' : ''}>Sidebar</option>
                                    <option value="floatingMenu" ${settings.shortcutPosition === 'floatingMenu' ? 'selected' : ''}>Floating Menu</option>
                                    <option value="bothTopAndSide" ${settings.shortcutPosition === 'bothTopAndSide' ? 'selected' : ''}>Both Top & Side</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="shortcut-preview">
                            <div class="shortcut-icon">
                                <i class="fas fa-tools"></i>
                            </div>
                            <div class="shortcut-name">Tools</div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-rocket section-icon"></i> Quick Shortcuts</h3>
                        <div class="section-description">
                            Customize your quick access shortcuts
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Shortcut 1</div>
                                <div class="setting-description">
                                    First quick access shortcut
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="shortcut1Select">
                                    <option value="tools" ${settings.shortcut1 === 'tools' ? 'selected' : ''}>Tools</option>
                                    <option value="marketplace" ${settings.shortcut1 === 'marketplace' ? 'selected' : ''}>Marketplace</option>
                                    <option value="groups" ${settings.shortcut1 === 'groups' ? 'selected' : ''}>Groups</option>
                                    <option value="status" ${settings.shortcut1 === 'status' ? 'selected' : ''}>Status</option>
                                    <option value="calls" ${settings.shortcut1 === 'calls' ? 'selected' : ''}>Calls</option>
                                    <option value="friends" ${settings.shortcut1 === 'friends' ? 'selected' : ''}>Friends</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Shortcut 2</div>
                                <div class="setting-description">
                                    Second quick access shortcut
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="shortcut2Select">
                                    <option value="tools" ${settings.shortcut2 === 'tools' ? 'selected' : ''}>Tools</option>
                                    <option value="marketplace" ${settings.shortcut2 === 'marketplace' ? 'selected' : ''}>Marketplace</option>
                                    <option value="groups" ${settings.shortcut2 === 'groups' ? 'selected' : ''}>Groups</option>
                                    <option value="status" ${settings.shortcut2 === 'status' ? 'selected' : ''}>Status</option>
                                    <option value="calls" ${settings.shortcut2 === 'calls' ? 'selected' : ''}>Calls</option>
                                    <option value="friends" ${settings.shortcut2 === 'friends' ? 'selected' : ''}>Friends</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Shortcut 3</div>
                                <div class="setting-description">
                                    Third quick access shortcut
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="shortcut3Select">
                                    <option value="tools" ${settings.shortcut3 === 'tools' ? 'selected' : ''}>Tools</option>
                                    <option value="marketplace" ${settings.shortcut3 === 'marketplace' ? 'selected' : ''}>Marketplace</option>
                                    <option value="groups" ${settings.shortcut3 === 'groups' ? 'selected' : ''}>Groups</option>
                                    <option value="status" ${settings.shortcut3 === 'status' ? 'selected' : ''}>Status</option>
                                    <option value="calls" ${settings.shortcut3 === 'calls' ? 'selected' : ''}>Calls</option>
                                    <option value="friends" ${settings.shortcut3 === 'friends' ? 'selected' : ''}>Friends</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-icons section-icon"></i> Icon Customization</h3>
                        <div class="section-description">
                            Customize app icons and visuals
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Custom Icons</div>
                                <div class="setting-description">
                                    Use custom icon sets
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="customIconsPersonalizationToggle" ${settings.customIcons ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Chat Icon</div>
                                <div class="setting-description">
                                    Icon for chat section
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="chatIconSelect">
                                    <option value="default" ${settings.chatIcon === 'default' ? 'selected' : ''}>Default</option>
                                    <option value="bubble" ${settings.chatIcon === 'bubble' ? 'selected' : ''}>Bubble</option>
                                    <option value="message" ${settings.chatIcon === 'message' ? 'selected' : ''}>Message</option>
                                    <option value="conversation" ${settings.chatIcon === 'conversation' ? 'selected' : ''}>Conversation</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Call Icon</div>
                                <div class="setting-description">
                                    Icon for call section
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="callIconSelect">
                                    <option value="default" ${settings.callIcon === 'default' ? 'selected' : ''}>Default</option>
                                    <option value="phone" ${settings.callIcon === 'phone' ? 'selected' : ''}>Phone</option>
                                    <option value="video" ${settings.callIcon === 'video' ? 'selected' : ''}>Video</option>
                                    <option value="headset" ${settings.callIcon === 'headset' ? 'selected' : ''}>Headset</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Status Icon</div>
                                <div class="setting-description">
                                    Icon for status section
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="statusIconSelect">
                                    <option value="default" ${settings.statusIcon === 'default' ? 'selected' : ''}>Default</option>
                                    <option value="circle" ${settings.statusIcon === 'circle' ? 'selected' : ''}>Circle</option>
                                    <option value="story" ${settings.statusIcon === 'story' ? 'selected' : ''}>Story</option>
                                    <option value="update" ${settings.statusIcon === 'update' ? 'selected' : ''}>Update</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Button Styles</div>
                                <div class="setting-description">
                                    Style of buttons throughout the app
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="buttonStylesPersonalizationSelect">
                                    <option value="rounded" ${settings.buttonStyles === 'rounded' ? 'selected' : ''}>Rounded</option>
                                    <option value="square" ${settings.buttonStyles === 'square' ? 'selected' : ''}>Square</option>
                                    <option value="pill" ${settings.buttonStyles === 'pill' ? 'selected' : ''}>Pill</option>
                                    <option value="floating" ${settings.buttonStyles === 'floating' ? 'selected' : ''}>Floating</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for personalization section
            // Layout mode radio buttons
            document.querySelectorAll('input[name="personalizationLayoutMode"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    userSettings.personalization.layoutMode = this.value;
                    userSettings.appearance.layoutMode = this.value;
                    unsavedChanges = true;
                    updateSaveButton();
                });
            });
            
            // Select change listeners
            const selects = ['shortcutPositionSelect', 'shortcut1Select', 'shortcut2Select', 'shortcut3Select',
                           'chatIconSelect', 'callIconSelect', 'statusIconSelect', 'buttonStylesPersonalizationSelect'];
            selects.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Select', '').replace('Personalization', '');
                        userSettings.personalization[property] = element.value;
                        
                        // Also update appearance settings for some properties
                        if (['chatIcon', 'callIcon', 'statusIcon', 'buttonStyles'].includes(property)) {
                            userSettings.appearance[property] = element.value;
                        }
                        
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
            
            // Toggle change listeners
            const toggles = ['quickAccessToggle', 'customIconsPersonalizationToggle'];
            toggles.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Toggle', '').replace('Personalization', '');
                        userSettings.personalization[property] = element.checked;
                        
                        // Also update appearance settings for customIcons
                        if (property === 'customIcons') {
                            userSettings.appearance.customIcons = element.checked;
                        }
                        
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
        }
        
        // SAFETY & PRIVACY+ SECTION (19 features)
        function loadSafetySection(container) {
            const settings = userSettings.safety;
            
            container.innerHTML = `
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-user-secret section-icon"></i> Invisible Mode</h3>
                        <div class="section-description">
                            Temporarily hide your online presence
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Invisible Mode</div>
                                <div class="setting-description">
                                    Temporarily hide your online status and activity
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="invisibleModeToggle" ${settings.invisibleMode ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Duration</div>
                                <div class="setting-description">
                                    How long to stay invisible
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="invisibleDurationSelect">
                                    <option value="30min" ${settings.invisibleDuration === '30min' ? 'selected' : ''}>30 Minutes</option>
                                    <option value="1hr" ${settings.invisibleDuration === '1hr' ? 'selected' : ''}>1 Hour</option>
                                    <option value="3hr" ${settings.invisibleDuration === '3hr' ? 'selected' : ''}>3 Hours</option>
                                    <option value="custom" ${settings.invisibleDuration === 'custom' ? 'selected' : ''}>Custom</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Invisible Timer</div>
                                <div class="setting-description">
                                    Time remaining in invisible mode
                                </div>
                            </div>
                            <div class="setting-control">
                                <div class="setting-value">${settings.invisibleTimer > 0 ? formatTime(settings.invisibleTimer) : 'Not active'}</div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Hide From</div>
                                <div class="setting-description">
                                    Specific contacts to hide from
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button" id="hideFromContactsBtn">
                                    <i class="fas fa-user-slash"></i> Select Contacts
                                </button>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Always Visible To</div>
                                <div class="setting-description">
                                    Contacts who can always see you
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button" id="alwaysVisibleToBtn">
                                    <i class="fas fa-eye"></i> Select Contacts
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-smile section-icon"></i> Mood Privacy Rules</h3>
                        <div class="section-description">
                            Adjust privacy based on your mood
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Mood Privacy Rules</div>
                                <div class="setting-description">
                                    Automatically adjust privacy based on mood
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="moodPrivacyRulesSafetyToggle" ${settings.moodPrivacyRules ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Tired Mood Rule</div>
                                <div class="setting-description">
                                    Special privacy rules when tired
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="tiredMoodRuleToggle" ${settings.tiredMoodRule ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Stressed Mood Rule</div>
                                <div class="setting-description">
                                    Special privacy rules when stressed
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="stressedMoodRuleToggle" ${settings.stressedMoodRule ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Happy Mood Rule</div>
                                <div class="setting-description">
                                    Special privacy rules when happy
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="happyMoodRuleToggle" ${settings.happyMoodRule ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Rule Duration</div>
                                <div class="setting-description">
                                    How long mood privacy rules stay active
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="ruleDurationSafetySelect">
                                    <option value="2hr" ${settings.ruleDuration === '2hr' ? 'selected' : ''}>2 Hours</option>
                                    <option value="6hr" ${settings.ruleDuration === '6hr' ? 'selected' : ''}>6 Hours</option>
                                    <option value="24hr" ${settings.ruleDuration === '24hr' ? 'selected' : ''}>24 Hours</option>
                                    <option value="untilMoodChanges" ${settings.ruleDuration === 'untilMoodChanges' ? 'selected' : ''}>Until Mood Changes</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-clock section-icon"></i> Enhanced Security</h3>
                        <div class="section-description">
                            Additional security timeout features
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Enhanced Timeout</div>
                                <div class="setting-description">
                                    Additional security for timeout protection
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="enhancedTimeoutSafetyToggle" ${settings.enhancedTimeout ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Lock Screen After</div>
                                <div class="setting-description">
                                    Lock app screen after specified time
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="lockScreenAfterSafetySelect">
                                    <option value="1min" ${settings.lockScreenAfter === '1min' ? 'selected' : ''}>1 Minute</option>
                                    <option value="5min" ${settings.lockScreenAfter === '5min' ? 'selected' : ''}>5 Minutes</option>
                                    <option value="15min" ${settings.lockScreenAfter === '15min' ? 'selected' : ''}>15 Minutes</option>
                                    <option value="30min" ${settings.lockScreenAfter === '30min' ? 'selected' : ''}>30 Minutes</option>
                                    <option value="never" ${settings.lockScreenAfter === 'never' ? 'selected' : ''}>Never</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Logout After</div>
                                <div class="setting-description">
                                    Complete logout after specified time
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="logoutAfterSafetySelect">
                                    <option value="1hr" ${settings.logoutAfter === '1hr' ? 'selected' : ''}>1 Hour</option>
                                    <option value="4hr" ${settings.logoutAfter === '4hr' ? 'selected' : ''}>4 Hours</option>
                                    <option value="8hr" ${settings.logoutAfter === '8hr' ? 'selected' : ''}>8 Hours</option>
                                    <option value="24hr" ${settings.logoutAfter === '24hr' ? 'selected' : ''}>24 Hours</option>
                                    <option value="never" ${settings.logoutAfter === 'never' ? 'selected' : ''}>Never</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Biometric Bypass</div>
                                <div class="setting-description">
                                    Allow biometric authentication to bypass locks
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="biometricBypassSafetyToggle" ${settings.biometricBypass ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Timeout Warnings</div>
                                <div class="setting-description">
                                    Show warnings before session timeout
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="timeoutWarningsSafetyToggle" ${settings.timeoutWarnings ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for safety section
            document.getElementById('hideFromContactsBtn').addEventListener('click', () => {
                showNotification('Contact selection feature would open here', 'info');
            });
            
            document.getElementById('alwaysVisibleToBtn').addEventListener('click', () => {
                showNotification('Contact selection feature would open here', 'info');
            });
            
            // Select change listeners
            const selects = ['invisibleDurationSelect', 'ruleDurationSafetySelect', 'lockScreenAfterSafetySelect', 'logoutAfterSafetySelect'];
            selects.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Select', '').replace('Safety', '');
                        userSettings.safety[property] = element.value;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
            
            // Toggle change listeners
            const toggles = ['invisibleModeToggle', 'moodPrivacyRulesSafetyToggle', 'tiredMoodRuleToggle',
                           'stressedMoodRuleToggle', 'happyMoodRuleToggle', 'enhancedTimeoutSafetyToggle',
                           'biometricBypassSafetyToggle', 'timeoutWarningsSafetyToggle'];
            toggles.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Toggle', '').replace('Safety', '');
                        userSettings.safety[property] = element.checked;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
        }
        
        // ADVANCED SECTION (10 features)
        function loadAdvancedSection(container) {
            const settings = userSettings.advanced;
            
            container.innerHTML = `
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-cogs section-icon"></i> Advanced Features</h3>
                        <div class="section-description">
                            Advanced settings for power users
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Offline Mode</div>
                                <div class="setting-description">
                                    Work offline with cached data only
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="offlineModeToggle" ${settings.offlineMode ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Intranet Support</div>
                                <div class="setting-description">
                                    Enable local network communication
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="intranetSupportToggle" ${settings.intranetSupport ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Low Bandwidth Mode</div>
                                <div class="setting-description">
                                    Optimize for slow connections
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="lowBandwidthModeToggle" ${settings.lowBandwidthMode ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Debug Mode</div>
                                <div class="setting-description">
                                    Enable debug logging and features
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="debugModeToggle" ${settings.debugMode ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Data Saver</div>
                                <div class="setting-description">
                                    Reduce data usage
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="dataSaverToggle" ${settings.dataSaver ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-tools section-icon"></i> Developer Options</h3>
                        <div class="section-description">
                            Settings for developers and technical users
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Developer Options</div>
                                <div class="setting-description">
                                    Access advanced developer settings
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button" id="developerOptionsBtn">
                                    <i class="fas fa-code"></i> Open
                                </button>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Proxy Settings</div>
                                <div class="setting-description">
                                    Configure proxy for network connections
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button" id="proxySettingsBtn">
                                    <i class="fas fa-network-wired"></i> Configure
                                </button>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Connection Test</div>
                                <div class="setting-description">
                                    Test your connection to Knecta servers
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button" id="connectionTestBtn">
                                    <i class="fas fa-wifi"></i> Test
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for advanced section
            document.getElementById('developerOptionsBtn').addEventListener('click', () => {
                showNotification('Developer options would open here', 'info');
            });
            
            document.getElementById('proxySettingsBtn').addEventListener('click', () => {
                showNotification('Proxy configuration would open here', 'info');
            });
            
            document.getElementById('connectionTestBtn').addEventListener('click', () => {
                testConnection();
            });
            
            // Toggle change listeners
            const toggles = ['offlineModeToggle', 'intranetSupportToggle', 'lowBandwidthModeToggle',
                           'debugModeToggle', 'dataSaverToggle'];
            toggles.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Toggle', '');
                        userSettings.advanced[property] = element.checked;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
        }
        
        // BACKUP & RESTORE SECTION (11 features)
        function loadBackupSection(container) {
            const settings = userSettings.backup;
            const lastBackupText = settings.lastBackup ? 
                new Date(settings.lastBackup).toLocaleString() : 'Never';
            
            container.innerHTML = `
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-cloud-upload-alt section-icon"></i> Auto Backup</h3>
                        <div class="section-description">
                            Automatic backup settings
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Auto Backup</div>
                                <div class="setting-description">
                                    Automatically backup your data
                                </div>
                            </div>
                            <div class="setting-control">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="autoBackupToggle" ${settings.autoBackup ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Backup Frequency</div>
                                <div class="setting-description">
                                    How often to create automatic backups
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="backupFrequencySelect">
                                    <option value="daily" ${settings.backupFrequency === 'daily' ? 'selected' : ''}>Daily</option>
                                    <option value="weekly" ${settings.backupFrequency === 'weekly' ? 'selected' : ''}>Weekly</option>
                                    <option value="monthly" ${settings.backupFrequency === 'monthly' ? 'selected' : ''}>Monthly</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Backup Location</div>
                                <div class="setting-description">
                                    Where to store your backups
                                </div>
                            </div>
                            <div class="setting-control">
                                <select class="setting-dropdown" id="backupLocationSelect">
                                    <option value="cloud" ${settings.backupLocation === 'cloud' ? 'selected' : ''}>Cloud Storage</option>
                                    <option value="local" ${settings.backupLocation === 'local' ? 'selected' : ''}>Local Device</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Last Backup</div>
                                <div class="setting-description">
                                    When your last backup was created
                                </div>
                            </div>
                            <div class="setting-control">
                                <div class="setting-value">${lastBackupText}</div>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Backup Size</div>
                                <div class="setting-description">
                                    Size of your last backup
                                </div>
                            </div>
                            <div class="setting-control">
                                <div class="setting-value">${formatStorageSize(settings.backupSize)}</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-download section-icon"></i> Manual Backup</h3>
                        <div class="section-description">
                            Create manual backups of your data
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Full Backup</div>
                                <div class="setting-description">
                                    Backup all your data including chats, media, and settings
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button primary" id="fullBackupBtn">
                                    <i class="fas fa-database"></i> Backup Now
                                </button>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Chat Backup</div>
                                <div class="setting-description">
                                    Backup only your chat conversations
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button secondary" id="chatBackupBtn">
                                    <i class="fas fa-comments"></i> Backup Now
                                </button>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Media Backup</div>
                                <div class="setting-description">
                                    Backup only your media files
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button secondary" id="mediaBackupBtn">
                                    <i class="fas fa-images"></i> Backup Now
                                </button>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Call Backup</div>
                                <div class="setting-description">
                                    Backup your call history
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button secondary" id="callBackupBtn">
                                    <i class="fas fa-phone"></i> Backup Now
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="section-header">
                        <h3><i class="fas fa-history section-icon"></i> Restore</h3>
                        <div class="section-description">
                            Restore your data from backup
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Restore Backup</div>
                                <div class="setting-description">
                                    Restore your data from a previous backup
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button primary" id="restoreBackupBtn">
                                    <i class="fas fa-history"></i> Restore
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for backup section
            document.getElementById('fullBackupBtn').addEventListener('click', () => {
                createBackup('full');
            });
            
            document.getElementById('chatBackupBtn').addEventListener('click', () => {
                createBackup('chat');
            });
            
            document.getElementById('mediaBackupBtn').addEventListener('click', () => {
                createBackup('media');
            });
            
            document.getElementById('callBackupBtn').addEventListener('click', () => {
                createBackup('call');
            });
            
            document.getElementById('restoreBackupBtn').addEventListener('click', () => {
                restoreBackup();
            });
            
            // Select change listeners
            const selects = ['backupFrequencySelect', 'backupLocationSelect'];
            selects.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', () => {
                        const property = id.replace('Select', '');
                        userSettings.backup[property] = element.value;
                        unsavedChanges = true;
                        updateSaveButton();
                    });
                }
            });
            
            // Toggle change listener
            document.getElementById('autoBackupToggle').addEventListener('change', function() {
                userSettings.backup.autoBackup = this.checked;
                unsavedChanges = true;
                updateSaveButton();
            });
        }
        
        // DANGER ZONE SECTION (3 features)
        function loadDangerSection(container) {
            container.innerHTML = `
                <div class="danger-zone">
                    <div class="section-header">
                        <h3><i class="fas fa-exclamation-triangle section-icon"></i> Danger Zone</h3>
                        <div class="section-description">
                            Irreversible actions - proceed with extreme caution
                        </div>
                    </div>
                    <div class="section-body">
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Clear All Chats</div>
                                <div class="setting-description">
                                    Permanently delete all your chat conversations
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button danger" id="clearAllChatsBtn">
                                    <i class="fas fa-trash"></i> Clear All
                                </button>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Export All Data</div>
                                <div class="setting-description">
                                    Export all your data for backup or transfer
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button secondary" id="exportAllDataBtn">
                                    <i class="fas fa-file-export"></i> Export
                                </button>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <div class="setting-label">Delete Account</div>
                                <div class="setting-description">
                                    Permanently delete your account and all data
                                </div>
                            </div>
                            <div class="setting-control">
                                <button class="setting-button danger" id="deleteAccountBtn">
                                    <i class="fas fa-user-slash"></i> Delete Account
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners for danger zone
            document.getElementById('clearAllChatsBtn').addEventListener('click', () => {
                showConfirmation(
                    'Clear All Chats',
                    'Are you absolutely sure you want to clear ALL your chats? This action is irreversible and will delete all your chat conversations permanently.',
                    () => {
                        clearAllChats();
                    }
                );
            });
            
            document.getElementById('exportAllDataBtn').addEventListener('click', () => {
                exportAllData();
            });
            
            document.getElementById('deleteAccountBtn').addEventListener('click', () => {
                showConfirmation(
                    'Delete Account',
                    'This will permanently delete your account and ALL your data. This action cannot be undone. Are you absolutely sure?',
                    () => {
                        deleteAccount();
                    }
                );
            });
        }
        
        // =============================================
        // HELPER FUNCTIONS
        // =============================================
        
        // Update user status display
        function updateUserStatus() {
            const isOnline = userSettings.profile.onlineStatus;
            const indicator = document.getElementById('userStatusIndicator');
            const statusText = document.getElementById('userStatusText');
            
            if (isOnline) {
                indicator.style.backgroundColor = 'var(--success-color)';
                statusText.textContent = 'Online';
            } else {
                indicator.style.backgroundColor = 'var(--text-secondary)';
                statusText.textContent = 'Offline';
            }
        }
        
        // Apply theme
        function applyTheme(theme) {
            if (theme === 'dark') {
                document.documentElement.style.setProperty('--bg-color', '#1c1c1e');
                document.documentElement.style.setProperty('--bg-secondary', '#000000');
                document.documentElement.style.setProperty('--text-primary', '#ffffff');
                document.documentElement.style.setProperty('--text-secondary', '#8e8e93');
                document.documentElement.style.setProperty('--secondary-color', '#2c2c2e');
                document.documentElement.style.setProperty('--border-color', '#38383a');
            } else if (theme === 'light') {
                document.documentElement.style.setProperty('--bg-color', '#ffffff');
                document.documentElement.style.setProperty('--bg-secondary', '#f8f9fa');
                document.documentElement.style.setProperty('--text-primary', '#050505');
                document.documentElement.style.setProperty('--text-secondary', '#65676b');
                document.documentElement.style.setProperty('--secondary-color', '#f0f2f5');
                document.documentElement.style.setProperty('--border-color', '#dddfe2');
            } else {
                // Auto theme - check system preference
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                if (prefersDark) {
                    applyTheme('dark');
                } else {
                    applyTheme('light');
                }
            }
        }
        
        // Apply font size
        function applyFontSize(size) {
            document.documentElement.style.fontSize = `${size}px`;
        }
        
        // Get mood color
        function getMoodColor(mood) {
            const moodColors = userSettings.mood.moodColors;
            switch(mood) {
                case 'happy': return moodColors.happy;
                case 'calm': return moodColors.calm;
                case 'energetic': return moodColors.energetic;
                case 'focused': return moodColors.focused;
                case 'relaxed': return moodColors.relaxed;
                case 'stressed': return moodColors.stressed;
                case 'tired': return moodColors.tired;
                case 'excited': return moodColors.excited;
                default: return '#8e8e93';
            }
        }
        
        // Get mood text
        function getMoodText(mood) {
            switch(mood) {
                case 'happy': return 'Happy and cheerful';
                case 'calm': return 'Calm and peaceful';
                case 'energetic': return 'Energetic and active';
                case 'focused': return 'Focused and productive';
                case 'relaxed': return 'Relaxed and comfortable';
                case 'stressed': return 'Stressed or anxious';
                case 'tired': return 'Tired or sleepy';
                case 'excited': return 'Excited and enthusiastic';
                default: return 'Neutral';
            }
        }
        
        // Format storage size
        function formatStorageSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            if (bytes < 1024 * 1024 * 1024) return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
            return (bytes / (1024 * 1024 * 1024)).toFixed(1) + ' GB';
        }
        
        // Format time
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (hours > 0) return `${hours}h ${minutes}m`;
            if (minutes > 0) return `${minutes}m ${secs}s`;
            return `${secs}s`;
        }
        
        // Escape HTML
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Reset current section to defaults
        function resetCurrentSection() {
            const defaultSection = DEFAULT_SETTINGS[currentSection];
            if (defaultSection) {
                userSettings[currentSection] = JSON.parse(JSON.stringify(defaultSection));
                unsavedChanges = true;
                updateSaveButton();
                loadSection(currentSection);
                showNotification('Section reset to defaults', 'success');
            }
        }
        
        // Calculate storage usage
        function calculateStorageUsage() {
            // Simulate storage calculation
            const chats = Math.floor(Math.random() * 200 * 1024 * 1024); // Up to 200MB
            const media = Math.floor(Math.random() * 500 * 1024 * 1024); // Up to 500MB
            const other = Math.floor(Math.random() * 100 * 1024 * 1024); // Up to 100MB
            const total = chats + media + other;
            
            userSettings.storage.storageBreakdown = { chats, media, other };
            userSettings.storage.totalStorageUsed = total;
            userSettings.storage.chatCacheSize = Math.floor(chats * 0.1);
            userSettings.storage.mediaCacheSize = Math.floor(media * 0.2);
            userSettings.storage.otherCacheSize = Math.floor(other * 0.5);
        }
        
        // Load blocked users
        async function loadBlockedUsers() {
            try {
                const response = await api('GET', '/api/users/blocked');
                if (response && response.users) {
                    blockedUsers = response.users;
                }
            } catch (error) {
                console.log('Could not load blocked users:', error);
                // Use empty array
                blockedUsers = [];
            }
        }
        
        // Load active sessions
        async function loadActiveSessions() {
            try {
                const response = await api('GET', '/api/auth/sessions');
                if (response && response.sessions) {
                    activeSessions = response.sessions;
                }
            } catch (error) {
                console.log('Could not load active sessions:', error);
                // Create mock sessions
                activeSessions = [
                    {
                        id: 'session_1',
                        device: 'iPhone 13',
                        browser: 'Safari',
                        location: 'New York, USA',
                        lastActive: Date.now() - 3600000, // 1 hour ago
                        current: true
                    },
                    {
                        id: 'session_2',
                        device: 'MacBook Pro',
                        browser: 'Chrome',
                        location: 'San Francisco, USA',
                        lastActive: Date.now() - 86400000, // 1 day ago
                        current: false
                    }
                ];
            }
        }
        
        // Load user contacts
        async function loadUserContacts() {
            try {
                const response = await api('GET', '/api/contacts');
                if (response && response.contacts) {
                    userContacts = response.contacts;
                }
            } catch (error) {
                console.log('Could not load contacts:', error);
                userContacts = [];
            }
        }
        
        // Load user groups
        async function loadUserGroups() {
            try {
                const response = await api('GET', '/api/groups');
                if (response && response.groups) {
                    userGroups = response.groups;
                }
            } catch (error) {
                console.log('Could not load groups:', error);
                userGroups = [];
            }
        }
        
        // Show active sessions modal
        function showActiveSessions() {
            const sessionsList = document.getElementById('sessionsList');
            sessionsList.innerHTML = '';
            
            if (activeSessions.length === 0) {
                sessionsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-desktop"></i>
                        <p>No active sessions</p>
                    </div>
                `;
            } else {
                activeSessions.forEach(session => {
                    const sessionItem = document.createElement('div');
                    sessionItem.className = 'session-item';
                    
                    const lastActive = new Date(session.lastActive);
                    const timeAgo = formatTimeAgo(lastActive);
                    const isCurrent = session.current ? ' (Current)' : '';
                    
                    sessionItem.innerHTML = `
                        <div class="session-icon">
                            <i class="fas ${session.device.includes('iPhone') ? 'fa-mobile-alt' : 'fa-laptop'}"></i>
                        </div>
                        <div class="session-info">
                            <div class="session-device">${session.device}${isCurrent}</div>
                            <div class="session-details">
                                ${session.browser}  ${session.location}  Last active ${timeAgo}
                            </div>
                        </div>
                        <div class="session-actions">
                            ${!session.current ? `
                                <button class="setting-button danger" data-session-id="${session.id}">
                                    <i class="fas fa-sign-out-alt"></i> Terminate
                                </button>
                            ` : ''}
                        </div>
                    `;
                    
                    sessionsList.appendChild(sessionItem);
                });
            }
            
            document.getElementById('sessionsModal').classList.add('active');
            
            // Add event listeners for terminate buttons
            document.querySelectorAll('.session-actions .setting-button').forEach(btn => {
                btn.addEventListener('click', function() {
                    const sessionId = this.dataset.sessionId;
                    terminateSession(sessionId);
                });
            });
        }
        
        // Show blocked users modal
        function showBlockedUsers() {
            const blockedList = document.getElementById('blockedUsersList');
            blockedList.innerHTML = '';
            
            if (blockedUsers.length === 0) {
                blockedList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-slash"></i>
                        <p>No blocked users</p>
                        <p class="subtext">Users you block will appear here</p>
                    </div>
                `;
            } else {
                blockedUsers.forEach(user => {
                    const userItem = document.createElement('div');
                    userItem.className = 'blocked-user-item';
                    
                    const initials = user.displayName ? 
                        user.displayName.split(' ').map(word => word[0]).join('').toUpperCase().substring(0, 2) : 
                        'U';
                    
                    userItem.innerHTML = `
                        <div class="blocked-user-avatar" ${user.photoURL ? `style="background-image: url('${user.photoURL}')"` : ''}>
                            ${user.photoURL ? '' : `<span style="color: white; font-size: 14px;">${initials}</span>`}
                        </div>
                        <div class="blocked-user-info">
                            <div class="blocked-user-name">${user.displayName || 'Unknown User'}</div>
                            <div class="blocked-user-details">
                                ${user.username || ''}  Blocked since ${new Date(user.blockedAt || Date.now()).toLocaleDateString()}
                            </div>
                        </div>
                        <div class="session-actions">
                            <button class="setting-button secondary" data-user-id="${user.id}">
                                <i class="fas fa-user-check"></i> Unblock
                            </button>
                        </div>
                    `;
                    
                    blockedList.appendChild(userItem);
                });
            }
            
            document.getElementById('blockedUsersModal').classList.add('active');
            
            // Add event listeners for unblock buttons
            document.querySelectorAll('.blocked-user-item .setting-button').forEach(btn => {
                btn.addEventListener('click', function() {
                    const userId = this.dataset.userId;
                    unblockUser(userId);
                });
            });
        }
        
        // =============================================
        // ACTION FUNCTIONS
        // =============================================
        
        // Take photo
        function takePhoto() {
            showNotification('Camera would open here to take a photo', 'info');
        }
        
        // Choose photo
        function choosePhoto() {
            showNotification('Gallery would open here to choose a photo', 'info');
        }
        
        // Remove photo
        function removePhoto() {
            userSettings.profile.photoUrl = '';
            unsavedChanges = true;
            updateSaveButton();
            showNotification('Profile photo removed', 'success');
        }
        
        // Save photo
        function savePhoto() {
            // In a real app, this would upload the photo
            showNotification('Profile photo saved', 'success');
            document.getElementById('changePhotoModal').classList.remove('active');
        }
        
        // Change password
        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const errorElement = document.getElementById('passwordError');
            
            // Basic validation
            if (!currentPassword || !newPassword || !confirmPassword) {
                errorElement.textContent = 'All fields are required';
                errorElement.style.display = 'block';
                return;
            }
            
            if (newPassword !== confirmPassword) {
                errorElement.textContent = 'New passwords do not match';
                errorElement.style.display = 'block';
                return;
            }
            
            if (newPassword.length < 8) {
                errorElement.textContent = 'Password must be at least 8 characters';
                errorElement.style.display = 'block';
                return;
            }
            
            // In a real app, this would make an API call
            showNotification('Password changed successfully', 'success');
            document.getElementById('changePasswordModal').classList.remove('active');
            
            // Clear form
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            errorElement.style.display = 'none';
        }
        
        // Terminate session
        function terminateSession(sessionId) {
            showConfirmation(
                'Terminate Session',
                'Are you sure you want to terminate this session?',
                () => {
                    // In a real app, this would make an API call
                    activeSessions = activeSessions.filter(s => s.id !== sessionId);
                    showActiveSessions();
                    showNotification('Session terminated', 'success');
                }
            );
        }
        
        // Terminate all sessions
        function terminateAllSessions() {
            showConfirmation(
                'Terminate All Sessions',
                'Are you sure you want to terminate all other sessions? You will be logged out on all other devices.',
                () => {
                    // In a real app, this would make an API call
                    activeSessions = activeSessions.filter(s => s.current);
                    showActiveSessions();
                    showNotification('All other sessions terminated', 'success');
                }
            );
        }
        
        // Unblock user
        function unblockUser(userId) {
            showConfirmation(
                'Unblock User',
                'Are you sure you want to unblock this user?',
                () => {
                    // In a real app, this would make an API call
                    blockedUsers = blockedUsers.filter(u => u.id !== userId);
                    showBlockedUsers();
                    showNotification('User unblocked', 'success');
                }
            );
        }
        
        // Edit mood color
        function editMoodColor(mood) {
            const currentColor = userSettings.mood.moodColors[mood];
            colorPicker.setColor(currentColor);
            colorPicker.show();
            
            colorPicker.on('save', (color) => {
                if (color) {
                    const hexColor = color.toHEXA().toString();
                    userSettings.mood.moodColors[mood] = hexColor;
                    unsavedChanges = true;
                    updateSaveButton();
                    loadSection('mood'); // Reload section to show new color
                    showNotification(`${mood} color updated`, 'success');
                }
            }, { once: true });
        }
        
        // Clear chat cache
        function clearChatCache() {
            // In a real app, this would clear the cache
            userSettings.storage.chatCacheSize = 0;
            calculateStorageUsage();
            loadSection('storage');
            showNotification('Chat cache cleared', 'success');
        }
        
        // Clear media cache
        function clearMediaCache() {
            // In a real app, this would clear the cache
            userSettings.storage.mediaCacheSize = 0;
            calculateStorageUsage();
            loadSection('storage');
            showNotification('Media cache cleared', 'success');
        }
        
        // Test connection
        function testConnection() {
            showNotification('Testing connection to Knecta servers...', 'info');
            
            // Simulate connection test
            setTimeout(() => {
                const success = Math.random() > 0.2; // 80% success rate
                if (success) {
                    showNotification('Connection test successful!', 'success');
                } else {
                    showNotification('Connection test failed. Please check your network.', 'error');
                }
            }, 1500);
        }
        
        // Create backup
        function createBackup(type) {
            showNotification(`Creating ${type} backup...`, 'info');
            
            // Simulate backup creation
            setTimeout(() => {
                userSettings.backup.lastBackup = new Date().toISOString();
                userSettings.backup.backupSize = Math.floor(Math.random() * 500 * 1024 * 1024); // Up to 500MB
                unsavedChanges = true;
                updateSaveButton();
                
                if (type === 'full') {
                    loadSection('backup'); // Reload to show updated last backup time
                }
                
                showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)} backup created successfully`, 'success');
            }, 2000);
        }
        
        // Restore backup
        function restoreBackup() {
            showConfirmation(
                'Restore Backup',
                'Are you sure you want to restore from backup? This will overwrite your current data.',
                () => {
                    showNotification('Restoring from backup...', 'info');
                    
                    // Simulate restore
                    setTimeout(() => {
                        showNotification('Backup restored successfully', 'success');
                    }, 2000);
                }
            );
        }
        
        // Clear all chats
        function clearAllChats() {
            // In a real app, this would delete all chats
            showNotification('All chats cleared', 'success');
        }
        
        // Export all data
        function exportAllData() {
            showNotification('Preparing data export...', 'info');
            
            // Simulate export preparation
            setTimeout(() => {
                // Create a blob with the data
                const data = {
                    user: currentUser,
                    settings: userSettings,
                    timestamp: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                // Create download link
                const a = document.createElement('a');
                a.href = url;
                a.download = `knecta-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('Data exported successfully', 'success');
            }, 1000);
        }
        
        // Delete account
        function deleteAccount() {
            // In a real app, this would delete the account
            showNotification('Account deletion initiated. You will be logged out.', 'warning');
            
            setTimeout(() => {
                window.location.href = '../index.html';
            }, 2000);
        }
        
        // Format time ago
        function formatTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return `${Math.floor(diffDays / 7)}w ago`;
        }
        
        console.log('Settings system loaded successfully with all 222 features');
    </script>
    
    <!-- External scripts -->
    <script src="js/api.js"></script>
</body>
</html>
